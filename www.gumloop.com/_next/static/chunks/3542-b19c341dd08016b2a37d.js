"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3542],{9888:function(e,o,t){t.d(o,{Z:function(){return H}});var l=t(85893),i=t(22495),n=t(77096),s=t(67294),r=t(18289),a=t(76345),d=t(85810),c=t(53695),u=t(98641),p=t(48578),f=t(45573),m=t(86762),_=t(30740),h=t(30202),w=t(27379),v=t(9962),k=t(29876),g=t(30010),j=t(55357),x=t(58708),b=t(45966),y=t(93713),C=t(64712),N=t(45837),I=t(5980),F=t(97257),P=t(82222),T=t(90273),S=t(68934),E=t(14142),Z=e=>{let{item:o,isFlowbook:t,itemId:l,projectId:n,setAnchorEl:r,setOpenPipelineRenameModal:a,setOpenMoveToProjectModal:d,setOpenEditDescriptionModal:c,setOpenMoveToFolderModal:u}=e,p=(0,i.TL)(),f=(0,h.NL)(),{userProfile:m,idTokenRef:_}=(0,s.useContext)(N.f),{currentFolder:w}=(0,s.useContext)(I.n),{currentProject:v}=(0,s.useContext)(F.xI),k=t&&o.is_legacy_saved_item,g=t&&!k,j=()=>{var e;let t=null!==(e=null==v?void 0:v.project_id)&&void 0!==e?e:null==m?void 0:m.user_id;f.invalidateQueries({queryKey:["hub","recent",t]}),f.invalidateQueries({queryKey:["hub","recent",null==o?void 0:o.author_id]})};return{handleCopyLink:e=>{let i;e.stopPropagation(),r(null),i=t?o.is_legacy_saved_item&&o.legacy_saved_item_id?"saved_item_id":"workbook_id":"flow_id";let n=(0,S.pm)("/pipeline?".concat(i,"=").concat(l));(0,E.v)(n,{successMessage:"Link copied to clipboard!",errorMessage:"Failed to copy link"})},handleRename:e=>{e.stopPropagation(),r(null),a(!0)},handleDuplicate:async e=>{e.stopPropagation(),r(null);let t=C.Am.loading("Duplicating...");try{if(g){let e=await o.duplicate(m,_.current,n);p((0,b.PA)(e))}else if(k){let e=await P.g.loadSavedItemAndPlConfig(l,m,_.current,!1,!1,n),o=await e.savedItem.duplicate(m,_.current,n);p((0,b.J4)(o))}else{let e=await o.duplicate(m,_.current,n);p((0,b.J4)(e))}C.Am.success("Duplicated successfully",{id:t}),j()}catch(e){C.Am.error("Duplication failed",{id:t})}},handleMove:async e=>{e.stopPropagation(),r(null);let t=C.Am.loading("Moving...");try{let e=null==w?void 0:w.parent_folder_id;if(g)await o.update_flowbook_folder(m,e,_.current,null==v?void 0:v.project_id),p((0,b.P1)({flowbookId:l,newFolderId:e}));else{if(k){let{savedItem:o}=await P.g.loadSavedItemAndPlConfig(l,m,_.current,!1,!1,n);await o.update_saved_item_folder(m,e,_.current,null==v?void 0:v.project_id)}else await o.update_saved_item_folder(m,e,_.current,null==v?void 0:v.project_id);p((0,b.$)({savedItemId:l,newFolderId:e}))}C.Am.success("Moved successfully",{id:t})}catch(e){C.Am.error("Move failed",{id:t})}},handleDelete:async()=>{r(null);let e=C.Am.loading("Deleting your saved workbook...");try{n&&await (0,T.eN)("project",m,_.current,"POST",{action:"remove_saved_item_id",user_email:m.user_email,saved_item_id:l,project_id:n});let t=g?"".concat(T.CT,"/delete_flowbook"):"".concat(T.CT,"/saved_item?saved_item_id=").concat(l),i=g?JSON.stringify({flowbook_id:l}):void 0;if(!(await fetch(t,{method:g?"POST":"DELETE",headers:{Authorization:"Bearer ".concat(m.api_key||_.current),"Content-Type":"application/json","x-auth-key":m.user_id},body:i})).ok)throw Error("Deletion failed");n&&p((0,y.Fz)({projectId:n,itemId:l}));let s=o.folder_id;try{p(x.KT.util.updateQueryData("fetchFlowFolderContents",{userProfile:m,idToken:_.current,folderId:s,folderType:"FLOWBOOK",projectId:null==v?void 0:v.project_id},e=>{g&&e.flowbooks&&(e.flowbooks=e.flowbooks.filter(e=>e.flowbook_id!==l))}))}catch(e){p(x.KT.util.invalidateTags([{type:"FlowsFolders",id:s||"root"}]))}C.Am.success("".concat(g?"Flowbook":"Flow"," deleted successfully!"),{id:e}),j()}catch(o){C.Am.error("Deletion failed! Please report this in the forum!.",{id:e})}},handleMoveAutomationToProject:e=>{e.stopPropagation(),r(null),d(!0)},handleEditDescription:e=>{e.stopPropagation(),r(null),c(!0)},handleMoveToFolder:e=>{e.stopPropagation(),r(null),u(!0)}}},A=t(85086),D=t(59496),M=t(98150),O=t(31172),L=t(86501),W=t(41248),z=t(7161),K=t(20479),B=e=>{let{open:o,setOpen:t,workflow:i,onSuccess:n}=e,r=(0,W.I0)(),{userProfile:a,idTokenRef:d}=(0,N.H)(),[c,u]=(0,s.useState)(!1),p=async e=>{let o=L.ZP.loading("Updating description...");try{u(!0),i.description=e,i.is_description_auto_generated=!1,await i.update_flowbook_only(a,d.current),r((0,b.Mo)({flowbookId:i.flowbook_id,description:e,isDescriptionAutoGenerated:!1})),t(!1),L.ZP.success("Description updated successfully",{id:o}),null==n||n()}catch(e){console.error(e),L.ZP.error("Failed to update description: ".concat(e.message),{id:o})}finally{u(!1)}};return(0,l.jsx)(z.Vq,{open:o,onOpenChange:t,children:(0,l.jsx)(z.cZ,{onClick:e=>e.stopPropagation(),children:(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),c||p(new FormData(e.target).get("workflow-description"))},children:[(0,l.jsxs)(z.a7,{className:"text-foreground",children:[(0,l.jsx)(z.fK,{children:(0,l.jsx)(z.$N,{className:"text-lg font-semibold",children:"Edit Workflow Description"})}),(0,l.jsx)("div",{children:(0,l.jsx)(K.g,{id:"workflow-description",name:"workflow-description",placeholder:"Enter your new workflow description",defaultValue:(null==i?void 0:i.description)||"",rows:3,required:!0})})]}),(0,l.jsxs)(z.cN,{children:[(0,l.jsx)(k.zx,{variant:"ghost",onClick:()=>{t(!1)},disabled:c,type:"button",children:"Cancel"}),(0,l.jsx)(k.zx,{type:"submit",disabled:c,children:"Continue"})]})]})})})},R=t(85210),V=t(64127),q=e=>{let{open:o,setOpen:t,workflow:i,onSuccess:n}=e,r=(0,W.I0)(),{userProfile:a,idTokenRef:d}=(0,s.useContext)(N.f),{currentProject:c}=(0,s.useContext)(F.xI),[u,p]=(0,s.useState)(!1),f=async e=>{let o=L.ZP.loading("Renaming your savedItem...");try{let l=i instanceof A.P,s=l&&i.is_legacy_saved_item,u=l&&!s;if(i.name=e||(u?"New Workflow":"New Flow"),i.created_ts=new Date,u)await i.update_flowbook_only(a,d.current,null==c?void 0:c.project_id),r((0,b.W2)({flowbook:i}));else if(s){let o=i.legacy_saved_item_id||i.flowbook_id,{savedItem:t}=await P.g.loadSavedItemAndPlConfig(o,a,d.current,!1,!1,null==c?void 0:c.project_id);t.name=e||"New Flow",t.created_ts=new Date,await t.update_saved_item_only(a,d.current,null==c?void 0:c.project_id),r((0,b.LW)({savedItem:t}))}else await i.update_saved_item_only(a,d.current,null==c?void 0:c.project_id),r((0,b.LW)({savedItem:i}));L.ZP.success("Rename successful!",{id:o}),null==n||n(),t(!1)}catch(e){console.log(e),L.ZP.error("".concat(e.message),{id:o})}finally{p(!1)}};return(0,l.jsx)(z.Vq,{open:o,onOpenChange:t,children:(0,l.jsx)(z.cZ,{onClick:e=>e.stopPropagation(),children:(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),u||f(new FormData(e.target).get("workflow-name"))},children:[(0,l.jsxs)(z.a7,{children:[(0,l.jsxs)(z.fK,{children:[(0,l.jsx)(z.$N,{className:"text-lg font-semibold",children:"Rename Your Workflow"}),(0,l.jsx)(z.Be,{children:"Enter a new name for your workflow."})]}),(0,l.jsx)("div",{children:(0,l.jsx)(V.I,{id:"workflow-name",name:"workflow-name",placeholder:"Enter your new workflow name",defaultValue:(null==i?void 0:i.name)||"",required:!0})})]}),(0,l.jsxs)(z.cN,{children:[(0,l.jsx)(k.zx,{variant:"ghost",onClick:()=>{t(!1)},disabled:u,type:"button",children:"Cancel"}),(0,l.jsx)(k.zx,{type:"submit",disabled:u,children:"Continue"})]})]})})})},H=e=>{var o;let{workflow:t,projects:x,folderTree:b,onSuccess:y,isOutline:C=!0}=e,I=(0,w.useRouter)(),P="saved_item_id"in t?t.saved_item_id:t.flowbook_id,T=(0,h.NL)(),{currentProject:S}=(0,F.d2)(),{userProfile:E}=(0,N.H)(),L=(0,i.CG)(n.xC.selectTemplatesTargetIdSet),W=(0,D.G7)(P,L),{bulkMoveToFolder:z}=(0,j.i)(),[K,V]=(0,s.useState)(!1),[H,Q]=(0,s.useState)(!1),[$,G]=(0,s.useState)(!1),[J,U]=(0,s.useState)(!1),[X,Y]=(0,s.useState)(!1),[ee,eo]=(0,s.useState)(!1),et=t instanceof A.P,el=et&&t.is_legacy_saved_item&&t.legacy_saved_item_id,ei=()=>{T.invalidateQueries({queryKey:["hub","recent",t.author_id]}),null==y||y()},{handleCopyLink:en,handleRename:es,handleDuplicate:er,handleDelete:ea,handleMoveAutomationToProject:ed,handleEditDescription:ec,handleMoveToFolder:eu}=Z({item:t,isFlowbook:et,itemId:P,projectId:null==S?void 0:S.project_id,setAnchorEl:()=>{},setOpenPipelineRenameModal:Q,setOpenMoveToProjectModal:G,setOpenEditDescriptionModal:U,setOpenMoveToFolderModal:Y}),ep=[{label:"Copy Link",onClick:e=>{V(!1),en(e)},Icon:r.Z,condition:!0},{label:"Rename",onClick:e=>{V(!1),es(e)},Icon:a.Z,condition:!E.is_flow_modification_restricted},{label:"Edit Description",onClick:e=>{V(!1),ec(e)},Icon:d.Z,condition:!E.is_flow_modification_restricted&&!el},{label:"Duplicate",onClick:async e=>{V(!1),await er(e),ei()},Icon:c.Z,condition:!E.is_flow_modification_restricted},{label:"Move to Workspace",onClick:e=>{V(!1),ed(e)},Icon:u.Z,condition:!!x&&(null==x?void 0:x.length)>0&&!E.is_flow_modification_restricted&&!el},{label:"Move to Folder",onClick:e=>{V(!1),eu(e)},Icon:p.Z,condition:!!b&&(null===(o=b.children)||void 0===o?void 0:o.length)>0&&!E.is_flow_modification_restricted&&!el},{label:"Create Template",onClick:()=>{V(!1);let e=t.is_legacy_saved_item?"saved_item_id":"workbook_id";I.push("/pipeline?".concat(e,"=").concat(P,"&publish_template=true"))},Icon:f.Z,condition:!!et&&!!(null==E?void 0:E.organization)&&!W&&!E.is_flow_modification_restricted&&!el},{label:"Delete",onClick:e=>{V(!1),eo(!0)},Icon:m.Z,condition:!E.is_flow_modification_restricted,destructive:!0}],ef=(0,O.xW)(ep);return 0===ef.length?null:(0,l.jsxs)("div",{onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)(g.h_,{open:K,onOpenChange:V,children:[(0,l.jsx)(g.$F,{asChild:!0,children:(0,l.jsx)(k.zx,{className:"data-[state=open]:bg-muted flex flex-row items-center justify-center",variant:C?"outline":"ghost",size:"icon-sm",children:(0,l.jsx)(_.Z,{})})}),(0,l.jsx)(g.AW,{className:"p-1",align:"end",children:null==ef?void 0:ef.map(e=>(0,l.jsx)(O.ZP,{label:e.label,onClick:e.onClick,Icon:e.Icon,destructive:e.destructive,description:e.description,noDescriptions:!0},e.label))})]}),(0,l.jsx)(q,{open:H,setOpen:Q,workflow:t,onSuccess:ei}),et&&(0,l.jsx)(B,{open:J,setOpen:U,workflow:t,onSuccess:ei}),x&&x.length>0&&(0,l.jsx)(R.Z,{open:$,setOpen:G,workflow:t,onSuccess:ei}),(0,l.jsx)(M.Z,{title:"Are you sure you want to delete this workbook?",description:"This action cannot be undone.",onConfirm:async()=>{await ea(),ei()},open:ee,setOpen:eo,confirmButtonProps:{text:"Delete"},cancelButtonProps:{text:"Cancel"}}),et&&(0,l.jsx)(v.$,{rootName:"Workflows",open:X,onOpenChange:Y,entity:t,entityName:"workbook",entityNamePlural:"workbooks",getEntityName:e=>e.name,getEntityFolderId:e=>e.folder_id,folderTree:b||null,isLoadingTree:!b,onMove:async(e,o)=>{await z([e],o)},onSuccess:ei})]})}},3542:function(e,o,t){t.d(o,{BX:function(){return h},te:function(){return _}});var l=t(85893),i=t(67294),n=t(41664),s=t.n(n),r=t(61857),a=t(45837),d=t(85086),c=t(5197),u=t(92290),p=t(72665),f=t(69307),m=t(9888);let _=e=>{var o;let{flowbook:t,template:n,projects:r,folderTree:_}=e,{userProfile:h}=(0,a.H)(),w=(0,i.useMemo)(()=>new d.P(t),[t]),v=(0,i.useMemo)(()=>t.is_legacy_saved_item&&t.legacy_saved_item_id?"/pipeline?flow_id=".concat(t.legacy_saved_item_id):"/pipeline?workbook_id=".concat(t.flowbook_id),[t.flowbook_id,t.is_legacy_saved_item,t.legacy_saved_item_id]);return(0,l.jsxs)(s(),{href:v,className:"relative flex h-full flex-col gap-4 rounded-lg border p-4 hover:text-inherit",children:[(0,l.jsx)("div",{className:"absolute top-2 right-2",onClick:e=>e.stopPropagation(),children:(0,l.jsx)(m.Z,{workflow:w,projects:r,folderTree:_,isOutline:!1})}),(0,l.jsxs)("div",{className:"flex h-full flex-col gap-2",children:[(0,l.jsx)("span",{className:"line-clamp-2 pr-6 text-base leading-tight font-medium select-none",children:t.name}),(0,l.jsx)("span",{className:"text-muted-foreground line-clamp-2 text-sm select-none",children:t.description})]}),(0,l.jsx)("div",{className:"mr-auto",children:n&&(0,l.jsx)(f.O,{status:n.status,isCreator:n.creator_user_id===h.user_id,isMarketplaceTemplate:!n.organization_id})}),(0,l.jsxs)("div",{className:"flex flex-row items-end gap-2",children:[(0,l.jsx)(u.Z,{keyOperators:(0,p.mf)(t)||{},className:"!gap-2 !divide-none !rounded-none !border-none !bg-transparent",maxOperators:3,operatorIconClassName:"size-10 rounded-md  border [&_img]:size-5"}),(0,l.jsxs)("div",{className:"text-muted-foreground ml-auto flex min-w-0 gap-1 text-xs select-none",children:[(0,l.jsx)("span",{className:"truncate",children:null!==(o=t.creator_first_name)&&void 0!==o?o:t.creator_user_email}),(0,l.jsx)("span",{className:"shrink-0",children:"â€¢"}),(0,l.jsx)("span",{className:"shrink-0",children:(0,c.Sy)(new Date(t.created_ts||""))})]})]})]})},h=()=>(0,l.jsxs)("div",{className:"flex h-full flex-col gap-4 rounded-lg border p-4",children:[(0,l.jsxs)("div",{className:"flex h-full flex-col gap-2",children:[(0,l.jsx)(r.O,{className:"h-5 w-3/4"}),(0,l.jsx)(r.O,{className:"h-4 w-full"}),(0,l.jsx)(r.O,{className:"h-4 w-5/6"})]}),(0,l.jsxs)("div",{className:"flex flex-row items-end gap-2",children:[(0,l.jsx)("div",{className:"flex flex-row items-center gap-2",children:Array.from({length:3}).map((e,o)=>(0,l.jsx)(r.O,{className:"size-10 rounded-md border"},o))}),(0,l.jsx)(r.O,{className:"ml-auto h-3 w-32"})]})]})},85210:function(e,o,t){var l=t(85893),i=t(93713),n=t(67294),s=t(98641),r=t(36127),a=t(70563),d=t(8267),c=t(28979),u=t(41248),p=t(64712),f=t(29876),m=t(7161),_=t(64127),h=t(92437),w=t(26659),v=t(55357),k=t(97257),g=t(45837),j=t(85086),x=t(78618),b=t(18998),y=t(5197),C=t(98150),N=t(50016);o.Z=e=>{let{open:o,setOpen:t,workflow:I,workflows:F,onSuccess:P}=e,{userProfile:T,idTokenRef:S}=(0,g.H)(),{currentProject:E}=(0,k.d2)(),{bulkMoveToWorkspace:Z}=(0,v.i)(),A=(0,u.I0)(),D=(0,n.useMemo)(()=>F&&F.length>0?F:I?[I]:[],[I,F]),M=D.length>1,O=(0,u.v9)(i.ak),L=(0,u.v9)(i._I),[W,z]=(0,n.useState)([]),[K,B]=(0,n.useState)(),[R,V]=(0,n.useState)(!1),[q,H]=(0,n.useState)(!1),Q=async e=>{if(V(!1),!e){p.Am.error("Please select a workspace");return}let o=e.project_name;if(0===D.length){p.Am.error("No workbooks selected");return}H(!0);let l=p.Am.loading("Moving ".concat(D.length," ").concat((0,y.Ri)(D.length,"workbook"),"..."));try{let i="personal"===e.project_id?void 0:e.project_id,n=await Z(D,i);t(!1),0===n.failed.length?p.Am.success("".concat(n.successful.length," ").concat((0,y.Ri)(n.successful.length,"workbook"),' moved to "').concat(o,'" successfully!'),{id:l}):n.successful.length>0?p.Am.success("".concat(n.successful.length," ").concat((0,y.Ri)(n.successful.length,"workbook"),' moved to "').concat(o,'" successfully. ').concat(n.failed.length," failed."),{id:l}):p.Am.error("Failed to move ".concat((0,y.Ri)(n.failed.length,"workbook"),' to "').concat(o,'"'),{id:l}),null==P||P()}catch(e){p.Am.error("Failed to move workbooks: ".concat(e.message),{id:l})}finally{H(!1),B(void 0)}},$=(0,n.useMemo)(()=>D.filter(e=>e instanceof j.P&&e.triggers&&e.triggers.length>0&&e.triggers.some(o=>o.user_id!==e.creator_user_id||o.project_id!==(null==e?void 0:e.author_id))).length>0,[D]);(0,n.useEffect)(()=>{T.isLoggedIn()&&"idle"===O&&A((0,i.bl)({userProfile:T,idToken:S.current})),"succeeded"===O&&z(L.filter(e=>e.project_id!==(null==E?void 0:E.project_id)))},[T,O,L,null==E?void 0:E.project_id,A,S]);let G=(0,n.useMemo)(()=>[new x.IK({project_name:"Personal",project_id:"personal"}),...W.sort((e,o)=>(null==e?void 0:e.project_name.localeCompare((null==o?void 0:o.project_name)||""))||0)].filter(e=>"personal"===e.project_id?D.some(e=>e.author_id!==T.user_id):D.some(o=>o.author_id!==e.project_id)),[W,D,T.user_id]),[J,U,X]=(0,w.X)(G,{searchKeys:["project_name"]}),Y=(0,n.useMemo)(()=>{var e;let o=M?"".concat(D.length," Workbooks"):'"'.concat((null===(e=D[0])||void 0===e?void 0:e.name)||"Workbook",'"');return"Move ".concat(o," to Workspace")},[D,M]),ee=(0,n.useMemo)(()=>{var e;if((null==K?void 0:K.project_id)==="personal"&&$)return"Are you sure you want to move ".concat(M?"these workbooks":"this workbook"," to your personal workspace?");let o=M?"".concat(D.length," Workbooks"):'"'.concat((null===(e=D[0])||void 0===e?void 0:e.name)||"Workbook",'"');return"Change owner of ".concat(o,"?")},[D,M,$,null==K?void 0:K.project_id]),eo=(0,n.useMemo)(()=>{var e;let o=M?"".concat(D.length," workbooks"):'"'.concat((null===(e=D[0])||void 0===e?void 0:e.name)||"Workbook",'"'),t=[];return(null==K?void 0:K.project_id)!=="personal"&&t.push("Moving ".concat(o,' to "').concat(null==K?void 0:K.project_name,'" will change the owner. You will not be able to undo this action unless you have administrator permissions in "').concat(null==K?void 0:K.project_name,'".')),$&&t.push("Users who are subscribed to these workflows that lose access will have their subscriptions removed."),t.join("\n\n")},[D,null==K?void 0:K.project_name,M,$,null==K?void 0:K.project_id]);return 0===D.length?null:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.Vq,{open:o,onOpenChange:t,children:(0,l.jsxs)(m.cZ,{className:"max-h-3/4 max-w-2xl",children:[(0,l.jsxs)(m.a7,{children:[(0,l.jsx)(m.fK,{children:(0,l.jsxs)(m.$N,{className:"flex items-center gap-2",children:[(0,l.jsx)(s.Z,{}),Y]})}),(0,l.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Currently in:"," ",(0,l.jsx)("span",{className:"text-foreground font-medium",children:(null==E?void 0:E.project_name)||"Personal"})]}),(0,l.jsx)(_.I,{placeholder:"Search workspaces...",value:J,LeadingIcon:r.Z,type:"search",onChange:e=>U(e.target.value)}),0===X.length&&(0,l.jsx)(N.Z,{title:"No workspaces found",description:"No workspaces found".concat(J?" for '".concat(J,"'"):""),Icon:a.Z,className:"py-16"}),X.length>0&&(0,l.jsx)(h.E,{value:(null==K?void 0:K.project_id)||"none",onValueChange:e=>{B(G.find(o=>o.project_id===e))},className:"max-h-96 gap-0 divide-y overflow-y-auto rounded-lg border",children:X.map(e=>{let o=(null==K?void 0:K.project_id)===e.project_id,t="personal"===e.project_id;return(0,l.jsxs)("label",{htmlFor:"workspace-".concat(e.project_id),onClick:()=>B(e),className:(0,b.cn)("flex cursor-pointer items-center gap-3 p-3 transition-colors",!o&&"hover:bg-muted/50"),children:[t?(0,l.jsx)(d.Z,{className:"size-4 flex-none"}):(0,l.jsx)(c.Z,{className:"size-4 flex-none"}),(0,l.jsx)("span",{className:"flex-1 text-sm font-medium",children:e.project_name}),(0,l.jsx)(h.m,{value:e.project_id,id:"workspace-".concat(e.project_id)})]},e.project_id)})})]}),(0,l.jsxs)(m.cN,{className:"flex items-center justify-between",children:[(0,l.jsx)(m.GG,{asChild:!0,children:(0,l.jsx)(f.zx,{type:"button",variant:"ghost",disabled:q,children:"Cancel"})}),(0,l.jsx)(f.zx,{onClick:()=>{K&&("personal"!==K.project_id||$)?V(!0):Q(K)},disabled:!K||q,children:q?"Moving...":"Move"})]})]})}),(0,l.jsx)(C.Z,{open:R,setOpen:V,title:ee,description:eo,onConfirm:()=>Q(K),onCancel:()=>V(!1),primaryActionButtonVariant:f.f1.DEFAULT,confirmButtonProps:{text:"Move to Workspace"},cancelButtonProps:{text:"Cancel"}})]})}},5980:function(e,o,t){t.d(o,{n:function(){return l}});let l=(0,t(67294).createContext)({currentFolder:void 0,setCurrentFolder:()=>{},folderTree:void 0})},55357:function(e,o,t){t.d(o,{i:function(){return f}});var l=t(58708),i=t(22495),n=t(93713),s=t(67294),r=t(821),a=t(97257),d=t(45837),c=t(85086),u=t(82222),p=t(90273);let f=()=>{let e=(0,i.TL)(),{userProfile:o,idTokenRef:t}=(0,d.H)(),{currentProject:f}=(0,a.d2)(),m=(0,r.QH)({path:"saved_items",method:r.J7.DELETE}),[_,{isLoading:h}]=(0,l.XJ)(),[w,{isLoading:v}]=(0,l.V1)(),[k,{isLoading:g}]=(0,l.Vd)(),j=(0,s.useCallback)(o=>{e(l.KT.util.invalidateTags([{type:"FlowsFolders",id:o||"root"}]))},[e]),x=(0,s.useCallback)(()=>{e(l.KT.util.invalidateTags([{type:"FlowsFolders",id:"tree"}]))},[e]),b=(0,s.useCallback)((i,n)=>e(l.KT.util.updateQueryData("fetchFlowFolderContents",{userProfile:o,idToken:t.current,folderId:n,folderType:"FLOWBOOK",projectId:null==f?void 0:f.project_id},e=>{e.flowbooks=e.flowbooks.filter(e=>!i.includes(e.flowbook_id))})),[e,o,t,null==f?void 0:f.project_id]),y=(0,s.useCallback)(o=>{let t=null==f?void 0:f.project_id,l=o instanceof c.P?o.flowbook_id:o.saved_item_id;t&&e((0,n.Fz)({projectId:t,itemId:l})),j(o.folder_id)},[e,null==f?void 0:f.project_id,j]),C=(0,s.useCallback)(async l=>{let i=l.filter(e=>e instanceof u.g),s=l.filter(e=>e instanceof c.P),r={successful:[],failed:[]};try{if(null==f?void 0:f.project_id)try{await (0,p.eN)("project",o,t.current,"POST",{action:"remove_saved_item_id",user_email:o.user_email,saved_item_ids:l.map(e=>e instanceof u.g?e.saved_item_id:e.flowbook_id),project_id:f.project_id})}catch(e){console.error("Failed to remove items from project:",e)}if(i.length>0)try{let e=await m.mutateAsync({saved_item_ids:i.map(e=>e.saved_item_id)});r.successful.push(...e.results.successful),r.failed.push(...e.results.failed),e.results.successful.forEach(e=>{let o=i.find(o=>o.saved_item_id===e.saved_item_id);o&&y(o)})}catch(e){console.error("Failed to delete saved items:",e),r.failed.push(...i.map(o=>({saved_item_id:o.saved_item_id,error:String(e)})))}if(s.length>0)try{var a;let l=await _({userProfile:o,idToken:null!==(a=t.current)&&void 0!==a?a:"",flowbookIds:s.map(e=>e.flowbook_id)}).unwrap();r.successful.push(...l.results.successful),r.failed.push(...l.results.failed);let i=new Map;l.results.successful.forEach(e=>{let o=s.find(o=>o.flowbook_id===e.flowbook_id);if(o){let t=o.folder_id;i.has(t)||i.set(t,[]),i.get(t).push(e.flowbook_id)}}),i.forEach((e,o)=>{b(e,o)}),i.forEach((e,o)=>{j(o)}),l.results.successful.forEach(o=>{let t=s.find(e=>e.flowbook_id===o.flowbook_id);t&&(null==f?void 0:f.project_id)&&e((0,n.Fz)({projectId:f.project_id,itemId:t.flowbook_id}))})}catch(e){console.error("Failed to delete flowbooks:",e),r.failed.push(...s.map(o=>({flowbook_id:o.flowbook_id,error:String(e)})))}return r}catch(e){throw console.error("Bulk delete operation failed:",e),e}},[m,_,y,b,j,e,null==f?void 0:f.project_id,o,t]),N=(0,s.useCallback)(async(e,l)=>{let i={successful:[],failed:[]};if(0===e.length)return i;let n=[...new Set(e.map(e=>e.folder_id))];try{(await k({userProfile:o,idToken:t.current,flowbookIds:e.map(e=>e.flowbook_id),folderId:l,oldFolderIds:n,flowbooksData:e,projectId:null==f?void 0:f.project_id}).unwrap()).results.forEach(e=>{"success"===e.status?i.successful.push(e):i.failed.push(e)}),i.failed.length>0&&(n.forEach(e=>j(e)),j(l))}catch(o){console.error("Failed to move flowbooks:",o),i.failed.push(...e.map(e=>({flowbook_id:e.flowbook_id,error:String(o)})))}return i},[k,o,t,j,null==f?void 0:f.project_id]);return{bulkDelete:C,bulkMoveToFolder:N,bulkMoveToWorkspace:(0,s.useCallback)(async(e,l)=>{let i=new Map;e.filter(e=>e instanceof c.P).forEach(e=>{let o=e.folder_id;i.has(o)||i.set(o,[]),i.get(o).push(e)});let n=l||o.user_id;try{var s;let l=await w({userProfile:o,idToken:null!==(s=t.current)&&void 0!==s?s:"",flowbookIds:e.map(e=>e instanceof u.g?e.saved_item_id:e.flowbook_id),newAuthorId:n}).unwrap(),r=l.results.filter(e=>"success"===e.status),a=l.results.filter(e=>"error"===e.status),d=new Set(r.map(e=>e.flowbook_id));i.forEach((e,o)=>{let t=e.filter(e=>d.has(e.flowbook_id)).map(e=>e.flowbook_id);t.length>0&&b(t,o)});let c=new Set;return e.forEach(e=>c.add(e.folder_id)),c.forEach(e=>j(e)),x(),{successful:r,failed:a}}catch(o){return console.error("Failed to move workflows to workspace:",o),{successful:[],failed:e.map(e=>({saved_item_id:e instanceof u.g?e.saved_item_id:e.flowbook_id,error:String(o)}))}}},[w,o,t,j,x,b]),moveToFolder:(0,s.useCallback)(async(e,l)=>{try{let i=e.folder_id,n=(await k({userProfile:o,idToken:t.current,flowbookIds:[e.flowbook_id],folderId:l,oldFolderIds:[i],flowbooksData:[e],projectId:null==f?void 0:f.project_id}).unwrap()).results[0];if((null==n?void 0:n.status)==="error")throw j(i),j(l),Error(n.error||"Failed to move flowbook");return!0}catch(e){throw console.error("Failed to move flowbook:",e),e}},[k,o,t,j,null==f?void 0:f.project_id]),isLoading:m.isPending||h||g||v}}}}]);