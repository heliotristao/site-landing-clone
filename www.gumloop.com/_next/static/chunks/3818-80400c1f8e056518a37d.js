"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3818],{31296:function(e,t,a){var r=a(85893),s=a(67294),n=a(36127),l=a(29762),i=a(18591),o=a(64127),c=a(18272),d=a(61857);t.Z=e=>{let{searchableItems:t=[],searchableItemsLoading:a=!1,searchValue:u,onSearchValueChange:m,onSelectedValueChange:p,placeholder:f,onSubmit:h,alwaysShowAll:v=!1,closeOnEmpty:x=!1,disabled:g=!1,hideLeadingIcon:w=!1}=e,[j,y]=(0,s.useState)(!1),k=(0,s.useMemo)(()=>t.reduce((e,t)=>(e[t.value]=t.label,e),{}),[t]),b=e=>{var t;m(null!==(t=k[e])&&void 0!==t?t:""),null==p||p(e),y(!1)},_=(0,s.useMemo)(()=>{var e,a;return u?null!==(a=null==t?void 0:null===(e=t.sort((e,t)=>e.label.localeCompare(t.label)))||void 0===e?void 0:e.filter(e=>{var t,a;return null==e?void 0:null===(a=e.label)||void 0===a?void 0:null===(t=a.toLowerCase())||void 0===t?void 0:t.includes(u.toLowerCase())}))&&void 0!==a?a:[]:null==t?void 0:t.sort((e,t)=>e.label.localeCompare(t.label))},[t,u]);return(0,s.useEffect)(()=>{v&&0!==t.length||!u||0!==_.length||a||y(!1)},[u,_.length,a,v,t.length]),(0,r.jsx)(c.J2,{open:j,onOpenChange:y,modal:!0,children:(0,r.jsxs)(i.mY,{shouldFilter:!1,children:[(0,r.jsx)(c.tW,{asChild:!0,children:(0,r.jsx)(l.mY.Input,{asChild:!0,value:u,onValueChange:e=>{m(e);let a=t.find(t=>t.label===e);a?null==p||p(a.value):null==p||p(null)},onKeyDown:e=>{"Enter"===e.key&&u&&!j?(e.preventDefault(),h(e)):"ArrowDown"===e.key||"ArrowUp"===e.key?y(!0):(v||u&&_.length>0)&&y(!0)},onMouseDown:()=>{(v||(null==_?void 0:_.length)>0)&&y(!0)},onFocus:()=>{(v||u)&&y(!0)},onBlur:e=>{e.relatedTarget instanceof Element&&e.relatedTarget.closest("[cmdk-item]")&&e.preventDefault()},onSubmit:h,autoComplete:"off",autoFocus:!1,disabled:g,children:(0,r.jsx)(o.I,{LeadingIcon:w?void 0:n.Z,placeholder:f,autoFocus:!1,type:"search"})})}),!j&&(0,r.jsx)(i.e8,{"aria-hidden":"true",className:"hidden"}),t.length>0&&((null==_?void 0:_.length)>0||!x)&&(0,r.jsx)(c.yk,{asChild:!0,onOpenAutoFocus:e=>e.preventDefault(),className:"z-50 w-[var(--radix-popover-trigger-width)] p-0",children:(0,r.jsxs)(i.e8,{children:[a&&(0,r.jsx)(l.mY.Loading,{children:(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(d.O,{className:"h-6 w-full"})})}),(null==_?void 0:_.length)>0&&!a?(0,r.jsx)(i.fu,{children:_.map(e=>(0,r.jsx)(i.di,{value:e.value,onSelect:b,onClick:e=>{e.stopPropagation()},children:e.label},e.value))}):(0,r.jsx)(i.rb,{children:"No options found."})]})})]})})}},58067:function(e,t,a){var r=a(85893),s=a(67294),n=a(30740),l=a(15432),i=a(4307),o=a(29876),c=a(30010),d=a(61857),u=a(18998),m=a(31296),p=a(94356);t.Z=e=>{let{searchableItems:t,searchableItemsLoading:a,searchValue:f,onSearchValueChange:h,selectedValue:v,onSelectedValueChange:x,placeholder:g,onConfirm:w,entities:j,entityActions:y,showEntityActions:k,requireSelection:b=!1,Icon:_}=e,[A,N]=(0,s.useState)(!1),I=()=>b?v:v||f,C=(0,s.useMemo)(()=>A?j:j.slice(0,3),[A,j]),O=(0,s.useCallback)(e=>y.filter(t=>{var a;return"function"==typeof t.condition?t.condition(e.id):null===(a=t.condition)||void 0===a||a}),[y]);return(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:flex-nowrap",children:[(0,r.jsx)(m.Z,{searchableItems:t,searchableItemsLoading:a,searchValue:f,onSearchValueChange:h,selectedValue:v,onSelectedValueChange:x,placeholder:g,onSubmit:async()=>{let e=I();e&&await w.action(e)},alwaysShowAll:b,disabled:w.loading}),(0,r.jsx)(o.zx,{variant:"secondary",type:"submit",onClick:async()=>{let e=I();e&&await w.action(e)},loading:w.loading,disabled:b?!v:!f,className:"w-full sm:w-fit",children:w.label})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-0.5",children:[a?Array.from({length:3}).map((e,t)=>(0,r.jsxs)("div",{className:"flex flex-row items-center gap-2 py-0.5",children:[(0,r.jsx)(d.O,{className:"h-7 w-7 rounded-md"}),(0,r.jsx)(d.O,{className:"h-3 w-full"})]},t)):null==C?void 0:C.map(e=>{var t,a;return(0,r.jsxs)("div",{className:"flex flex-row items-center gap-2 py-0.5",children:[_?(0,r.jsx)("div",{className:"bg-muted flex h-7 w-7 items-center justify-center rounded-md",children:(0,r.jsx)(_,{className:"text-muted-foreground !size-4 !shrink-0 text-xs"})}):(0,r.jsx)(p.Z,{src:void 0,name:e.name,className:"!size-7 !shrink-0 text-xs"}),(0,r.jsx)("div",{className:"text-foreground flex-1 text-sm",children:e.name}),(null===(t=O(e))||void 0===t?void 0:t.length)>0&&("function"==typeof k?k(e):null==k||k)&&(0,r.jsxs)(c.h_,{children:[(0,r.jsx)(c.$F,{asChild:!0,children:(0,r.jsx)(o.zx,{variant:"ghost",size:"icon-xs",children:(0,r.jsx)(n.Z,{})})}),(0,r.jsx)(c.AW,{className:"p-1",align:"end",children:null===(a=O(e))||void 0===a?void 0:a.map(t=>(0,r.jsxs)(c.Xi,{onClick:()=>t.action(e.id),disabled:t.loading||t.disabled,destructive:t.destructive,title:"function"==typeof t.description?t.description(e):t.description,className:(0,u.cn)("group/action-item flex max-w-xs flex-col items-start gap-0.5 text-left"),children:[(0,r.jsx)("p",{className:(0,u.cn)("text-sm",t.description&&"font-medium"),children:t.label}),(0,r.jsx)("p",{className:"text-muted-foreground text-xs group-hover/action-item:text-inherit",children:"function"==typeof t.description?t.description(e):t.description})]},t.label))})]})]},e.id)}),(null==j?void 0:j.length)>3&&!a&&(0,r.jsx)("div",{className:"mt-1.5",children:(0,r.jsxs)(o.zx,{variant:"unstyled",size:"unset",className:"text-muted-foreground hover:text-foreground w-fit text-xs",onClick:()=>N(!A),children:[(0,r.jsx)("span",{children:A?"Collapse":"See all"}),A?(0,r.jsx)(l.Z,{}):(0,r.jsx)(i.Z,{})]})})]})]})}},96545:function(e,t,a){var r=a(85893),s=a(23432);t.Z=e=>{let{title:t,description:a,Icon:n,isLoading:l,iconClassName:i="size-4"}=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[l?(0,r.jsx)(s.Z,{className:"animate-spin ".concat(i)}):n?(0,r.jsx)(n,{className:"text-muted-foreground ".concat(i)}):null,(0,r.jsx)("span",{className:"text-sm font-medium",children:t})]}),a&&(0,r.jsx)("p",{className:"text-muted-foreground line-clamp-2 text-left text-xs text-pretty",children:a})]})}},41491:function(e,t,a){var r=a(85893),s=a(67294),n=a(96545),l=a(66525),i=a(78244),o=a(45837);t.Z=e=>{let{disabled:t,defaultValue:a,onCallback:c,options:d,label:u}=e,[m,p]=(0,s.useState)(a),{userProfile:f}=(0,o.H)(),h=u.toLowerCase().replaceAll(" ","-");return(0,s.useEffect)(()=>{p(a)},[a]),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:u}),(0,r.jsxs)(l.Ph,{name:h,disabled:t,value:m,onValueChange:async e=>{if(e===i.ZI.ORGANIZATION){var t;await c(e,null==f?void 0:null===(t=f.organization)||void 0===t?void 0:t.organization_id)&&p(e)}else await c(e)&&p(e)},children:[(0,r.jsx)(l.i4,{className:"h-fit w-full",children:(0,r.jsx)(l.ki,{})}),(0,r.jsx)(l.Bw,{children:(0,r.jsx)(l.DI,{children:d.map(e=>(0,r.jsx)(l.Ql,{value:e.value,id:"".concat(h,"-").concat(e.value),disabled:null==e?void 0:e.restricted,children:(0,r.jsx)(n.Z,{title:e.label.title,description:e.label.description,Icon:e.label.Icon,isLoading:t})},e.value))})})]})]})}},39514:function(e,t,a){a.d(t,{A:function(){return s},K:function(){return d}});var r,s,n=a(82126),l=a(185),i=a(42020),o=a(7145),c=a(78244);(r=s||(s={})).INTERFACE="Interface",r.WORKBOOK="Flow",r.CUSTOM_AGENT="Agent",r.AGENT_CHAT="Chat";let d=(e,t,a,r,s,d)=>[{label:{title:"Workspace",description:"Only users in ".concat(t," can view and edit this ").concat(e),Icon:o.Z},value:c.ZI.WORKSPACE,condition:!!t,restricted:s},{label:{title:"Restricted",description:"Only users with access can view this ".concat(e),Icon:n.Z},value:c.ZI.RESTRICTED,condition:!t,restricted:s},{label:{title:"Organization",description:"Users in ".concat(a," can view this ").concat(e),Icon:l.Z},value:c.ZI.ORGANIZATION,condition:!!a,restricted:s&&d},{label:{title:"Anyone",description:"Anyone can view this ".concat(e),Icon:i.Z},value:c.ZI.ANYONE,restricted:r}].filter(e=>!1!==e.condition)},78244:function(e,t,a){a.d(t,{ZI:function(){return l},nl:function(){return n}});var r,s,n,l,i,o=a(34376),c=a(13526),d=a(60745),u=a(2164),m=a(67294),p=a(78551),f=a(27379),h=a(41248),v=a(64712),x=a(97257),g=a(45837),w=a(41999);(r=n||(n={})).OWNER="owner",r.VIEWER="viewer",(s=l||(l={})).ANYONE="anyone",s.RESTRICTED="restricted",s.WORKSPACE="workspace",s.ORGANIZATION="organization";let j={anyone:"anyone",restricted:"restricted access",workspace:"workspace members",organization:"organization members"};(i||(i={})).VIEWER="viewer",t.ZP=e=>{let t=(0,h.v9)(o.AV),a=(0,h.v9)(e=>(0,c.jy)(e,t)),{userProfile:r,idTokenRef:s}=(0,g.H)(),{currentProject:n}=(0,x.d2)(),l=(0,h.I0)(),i=(0,f.useSearchParams)(),[y,k]=(0,m.useState)({}),b={access_type:(null==n?void 0:n.project_id)?"workspace":"restricted"},{data:_,isLoading:A,refetch:N}=(0,p.a)({queryKey:["workbook-sharing",e.flowbook_id,null==n?void 0:n.project_id,r.user_id],queryFn:()=>e.fetchPermissions(r,s.current,null==n?void 0:n.project_id),enabled:!!e.flowbook_id&&r.isLoggedIn()}),{data:I,isLoading:C,refetch:O}=(0,p.a)({queryKey:["interface-sharing",null==a?void 0:a.form_id,null==r?void 0:r.user_id],queryFn:()=>w.Form.fetchPermissions(a,r,s.current,null==n?void 0:n.project_id),enabled:!!(null==a?void 0:a.form_id)&&r.isLoggedIn()}),Z=(0,m.useMemo)(()=>(null==_?void 0:_.users)?Object.fromEntries(Object.entries(_.users).sort((e,t)=>{let[a,r]=e,[s,n]=t;return"owner"===r&&"owner"!==n?-1:"owner"===n&&"owner"!==r?1:a.localeCompare(s)})):{},[null==_?void 0:_.users]),E=(null==_?void 0:_.general_access)||b,F=(null==I?void 0:I.general_access)||b,S=async t=>{if(t in Z)return v.Am.warning("User already has access to the workbook"),!1;k({email:t,action:"add"});try{let l={...Z,[t]:"viewer"},o=a?{users:l,general_access:F}:null,c=[e.update_flowbook_permissions(r,{users:l,general_access:E},s.current,null==n?void 0:n.project_id)];if(o&&c.push(w.Form.update_form_permissions(a,r,o,s.current,null==n?void 0:n.project_id)),await Promise.all(c),v.Am.success("User added to workbook"),i.get("share_email")){let e=new URLSearchParams(i.toString());e.delete("share_email"),window.history.replaceState({},"","?".concat(e.toString()))}return N(),o&&O(),!0}catch(e){return v.Am.error(e.message||"Failed to add user. Please ensure this user is a Gumloop user."),!1}finally{k({})}},T=async t=>{k({email:t,action:"remove"});try{let l=Object.fromEntries(Object.entries(Z).filter(e=>{let[a]=e;return a!==t})),i=a?{users:l,general_access:F}:null,o=[e.update_flowbook_permissions(r,{users:l,general_access:E},s.current,null==n?void 0:n.project_id)];return i&&o.push(w.Form.update_form_permissions(a,r,i,s.current,null==n?void 0:n.project_id)),await Promise.all(o),v.Am.success("User removed from workbook"),N(),i&&O(),!0}catch(e){return v.Am.error(e.message||"Failed to remove user from workbook"),!1}finally{k({})}},z=async(a,i,o)=>{k({workbookGeneralAccess:a,action:"update"});try{let c={access_type:a,..."organization"===a&&i?{organization_id:i}:{}};return await e.update_flowbook_permissions(r,{users:Z,general_access:c},s.current,null==n?void 0:n.project_id),o||v.Am.success("Workbook access updated to ".concat(j[a])),N(),l(u.UX.util.invalidateTags([{type:"Triggers",id:t},{type:"Triggers",id:e.flowbook_id}])),!0}catch(e){return v.Am.error(e.message||"Failed to update workbook access"),!1}finally{k({})}},R=async(t,i)=>{if(!a)return!1;k({interfaceGeneralAccess:t,action:"update"});try{let o={access_type:t,..."organization"===t&&i?{organization_id:i}:{}};return await w.Form.update_form_permissions(a,r,{users:Z,general_access:o},s.current,null==n?void 0:n.project_id),v.Am.success("Interface access updated"),O(),l(u.UX.util.invalidateTags([{type:"Triggers",id:null==a?void 0:a.saved_item_id},{type:"Triggers",id:e.flowbook_id}])),!0}catch(e){return v.Am.error(e.message||"Failed to update interface access"),!1}finally{k({})}};return{data:{workbook:{users:Z,general_access:E},interface:{general_access:F}},actions:{addSharedUser:S,removeSharedUser:T,workbook:{updateGeneralAccess:z,checkAccessImpact:async(t,a)=>{k({checkingImpact:"workbook"});try{return await e.fetchGeneralAccessImpact(r,t,a,s.current,null==n?void 0:n.project_id)}catch(e){return v.Am.error(e.message||"Failed to check impact"),null}finally{k(e=>{let{checkingImpact:t,...a}=e;return a})}},refetch:N},interface:{updateGeneralAccess:R,checkAccessImpact:async(e,t)=>{if(!a)return null;k({checkingImpact:"interface"});try{return await w.Form.fetchGeneralAccessImpact(a,r,e,t,s.current,null==n?void 0:n.project_id)}catch(e){return v.Am.error(e.message||"Failed to check impact"),null}finally{k(e=>{let{checkingImpact:t,...a}=e;return a})}},handleWorkflowAccess:async e=>{if(!a)return!1;k(t=>({...t,interfaceWorkflowAccess:e,action:"update"})),a.allow_workflow_access=e;try{return await l((0,d.saveForm)({form:a,userProfile:r,idToken:s.current,projectId:null==n?void 0:n.project_id})).unwrap(),v.Am.success("Workflow access updated"),!0}catch(e){return v.Am.error(e.message||"Failed to update workflow access"),!1}finally{k(e=>{let{interfaceWorkflowAccess:t,...a}=e;return a})}},refetch:O}},state:{workbook:{isLoading:A},interface:{isLoading:C},isUpdating:y}}}}}]);