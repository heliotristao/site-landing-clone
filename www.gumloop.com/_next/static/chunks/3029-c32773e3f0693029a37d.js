"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3029],{33029:function(e,r,l){l.d(r,{Z:function(){return eA}});var t,o,a,n,s=l(85893),d=l(58708),i=l(93713),c=l(77096),u=l(67294),m=l(79535),f=l(36298),p=l(41664),g=l.n(p),x=l(41248),h=l(64712),w=l(29876),_=l(42414),v=l(3033),k=l(18289),j=l(76345),y=l(85810),b=l(53695),C=l(12852),F=l(98641),T=l(48578),N=l(45573),I=l(86762);let A={entityName:"workflow",entityNamePlural:"workflows",folderType:"FLOWBOOK",getEntityId:e=>e.flowbook_id,getEntityName:e=>e.name,getEntityFolderId:e=>e.folder_id,getEntityHref:e=>e.is_legacy_saved_item&&e.legacy_saved_item_id?"/pipeline?flow_id=".concat(e.legacy_saved_item_id):"/pipeline?workbook_id=".concat(e.flowbook_id),getEntityCreatedTs:e=>e.created_ts?e.created_ts.toString():null,getEntityAuthorId:e=>e.author_id,getCreatorDisplayName:e=>{let r=[e.creator_first_name,e.creator_last_name].filter(Boolean);return r.length>0?r.join(" "):e.creator_user_email||"Unknown"},getCreatorProfilePicture:e=>{var r;return null!==(r=e.creator_profile_picture)&&void 0!==r?r:null},getFolderId:e=>e.folder_id,getFolderName:e=>e.name,getFolderParentId:e=>e.parent_folder_id,getEntityIcon:e=>e.has_trigger||e.triggers&&e.triggers.length>0?(0,s.jsx)(v.Z,{className:"text-success-foreground size-4"}):(0,s.jsx)(m.Z,{className:"size-4"}),canSelect:e=>!e.is_legacy_saved_item,features:{canMoveToWorkspace:!0,canMoveToFolder:!0,canDuplicate:!0,canShare:!1,canCreateTemplate:!0,canEditDescription:!0},getEntityActions:(e,r)=>[{id:"copy-link",label:"Copy Link",Icon:k.Z,onClick:()=>{r.onCopyLink(),r.closeDropdown()},condition:!0},{id:"rename",label:"Rename",Icon:j.Z,onClick:()=>{r.onRename(),r.closeDropdown()}},{id:"edit-description",label:"Edit Description",Icon:y.Z,onClick:()=>{var e;null===(e=r.onEditDescription)||void 0===e||e.call(r),r.closeDropdown()}},{id:"duplicate",label:"Duplicate",Icon:b.Z,onClick:()=>{r.onDuplicate(),r.closeDropdown()}},{id:"move-to-parent",label:"Move To Parent Folder",Icon:C.Z,onClick:()=>{r.onMoveToParent(),r.closeDropdown()}},{id:"move-to-workspace",label:"Move to Workspace",Icon:F.Z,onClick:()=>{r.onMoveToWorkspace(),r.closeDropdown()}},{id:"move-to-folder",label:"Move to Folder",Icon:T.Z,onClick:()=>{r.onMoveToFolder(),r.closeDropdown()}},{id:"create-template",label:"Create Template",Icon:N.Z,onClick:()=>{r.onCreateTemplate(),r.closeDropdown()}},{id:"delete",label:"Delete",Icon:I.Z,onClick:()=>{r.onDelete(),r.closeDropdown()},destructive:!0}],getFolderActions:(e,r)=>[{id:"rename",label:"Rename",Icon:j.Z,onClick:()=>{r.onRename(),r.closeDropdown()}},{id:"move-to-parent",label:"Move To Parent Folder",Icon:C.Z,onClick:()=>{r.onMoveToParent(),r.closeDropdown()}},{id:"delete",label:"Delete",Icon:I.Z,onClick:()=>{r.onDelete(),r.closeDropdown()},destructive:!0}]};var D=l(9962),O=l(61298),E=l(45966),M=l(97257),Z=l(45837),S=l(86453),R=l(69386),L=l(86180),P=l(85086),W=l(59100);(t=a||(a={})).ALL="All Workflows",t.ACTIVE="Has Active Trigger(s)",(o=n||(n={})).NODE="node",o.TRIGGER="trigger",o.CREATOR="creator";let B=[{key:"node",extractValue:e=>{if(e.type===L.B.FOLDER)return"";let r=null==e?void 0:e.keyOperators;return r?Object.keys(r).join(","):""},getOptions:e=>{let r=new Set;return e.forEach(e=>{e.type!==L.B.FOLDER&&e.keyOperators&&Object.keys(e.keyOperators).forEach(e=>{r.add(e)})}),Array.from(r).sort().map(e=>({value:e,label:e}))},label:"Node"},{key:"trigger",extractValue:e=>{var r,l;return e.data instanceof P.P&&(e.data.has_trigger||(null!==(l=null===(r=e.data.triggers)||void 0===r?void 0:r.length)&&void 0!==l?l:0)>0)?"Has Active Trigger(s)":"All Workflows"},getOptions:()=>[{value:"All Workflows",label:"All Workflows"},{value:"Has Active Trigger(s)",label:"Has Active Trigger(s)"}],label:"Trigger Status"},{key:"creator",extractValue:e=>e.data instanceof P.P&&e.data.creator_user_id?e.data.creator_user_id:"",getOptions:e=>{let r=new Map;return e.forEach(e=>{e.data instanceof P.P&&e.data.creatorDisplayName()&&e.data.creator_user_id&&r.set(e.data.creator_user_id,e.data.creatorDisplayName())}),Array.from(r.entries()).map(e=>{let[r,l]=e;return{value:r,label:l}}).sort((e,r)=>e.label.localeCompare(r.label))},label:"Creator"}],K={keys:["data.name","data.metadata.name"],threshold:.3,ignoreLocation:!0},z=e=>{let{workflowItems:r}=e,{updateParam:l,removeParams:t,currentParams:o}=(0,W.W)(),a=(0,u.useRef)(),[n,s]=(0,u.useState)(o.search||""),d=o.search||"";(0,u.useEffect)(()=>{s(d)},[d]);let i=(0,u.useMemo)(()=>{let e={};return o.node&&(e.node=o.node),o.trigger&&(e.trigger=o.trigger),o.creator&&(e.creator=o.creator),e},[o]),c=(0,u.useMemo)(()=>new R.Z(r,K),[r]),m=(0,u.useMemo)(()=>r.some(e=>{var r,l;return e.data instanceof P.P&&(e.data.has_trigger||(null!==(l=null===(r=e.data.triggers)||void 0===r?void 0:r.length)&&void 0!==l?l:0)>0)}),[r]),f=(0,u.useCallback)(e=>{s(e),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{e.trim()?l("search",e):t(["search"])},300)},[l,t]);(0,u.useEffect)(()=>()=>{a.current&&clearTimeout(a.current)},[]);let p=(0,u.useCallback)((e,r)=>{r&&"All Workflows"!==r?l(e,r):t([e])},[l,t]),g=(0,u.useCallback)(e=>{t([e])},[t]),x=(0,u.useCallback)(()=>{t(["node","trigger","creator"])},[t]),h=(0,u.useCallback)(e=>{let l=B.find(r=>r.key===e);return l?l.getOptions(r):[]},[r]);(0,u.useEffect)(()=>{m||"Has Active Trigger(s)"!==i.trigger||t(["trigger"])},[m,i,t]);let w=(0,u.useMemo)(()=>{let e=d.trim()?c.search(d).map(e=>e.item):r;return Object.keys(i).length>0?e.filter(e=>B.every(r=>{let{key:l,extractValue:t}=r,o=i[l];if(!o)return!0;let a=t(e);return"node"===l?a.includes(o):a===o})):e},[r,d,i,c]),_=(0,u.useMemo)(()=>Object.keys(i).filter(e=>i[e]).length,[i]);return{items:w,filters:{searchTerm:n,setSearchTerm:f,filters:i,setFilter:p,clearFilter:g,clearAllFilters:x,getFilterValues:h,activeFilterCount:_,filterDefinitions:B.reduce((e,r)=>(e[r.key]=r,e),{}),hasTriggers:m}}};var V=l(22495),H=l(51893);let G=()=>{let e=(0,V.TL)(),{userProfile:r,idTokenRef:l}=(0,Z.H)(),{currentProject:t,isCurrentProjectLoading:o}=(0,M.d2)(),{data:a,isLoading:n}=(0,d.Kb)({userProfile:r,idToken:l.current,projectId:null==t?void 0:t.project_id},{skip:r.isLoading()||o}),s=(0,u.useCallback)(r=>{e(d.KT.util.invalidateTags([{type:"FlowsFolders",id:r||"root"},{type:"FlowsFolders",id:"tree"}]))},[e]),i=(0,H.d)({folderTreeData:a,isFolderTreeLoading:n,onInvalidateTags:s}),{currentData:c,isLoading:m,isFetching:f}=(0,d.H_)({userProfile:r,idToken:l.current,folderId:i.currentFolderId,folderType:"FLOWBOOK",projectId:null==t?void 0:t.project_id},{skip:r.isLoading()||o}),p=r.isLoading()||o||m||!c&&f||null!==i.currentFolderId&&n;return{...i,folders:(null==c?void 0:c.folders)||[],flowbooks:(null==c?void 0:c.flowbooks)||[],isLoading:p,isFetching:f}};var q=l(26567),Y=l(55357),$=l(18998),J=l(98532),U=l(2689),X=l(5197),Q=l(98150),ee=e=>{var r;let{open:l,setOpen:t,workflows:o,onSuccess:a}=e,{bulkDelete:n}=(0,Y.i)(),d=async()=>{if(t(!1),0===o.length){h.Am.error("No workbooks selected");return}let e=h.Am.loading("Deleting ".concat(o.length," ").concat((0,X.Ri)(o.length,"workbook"),"..."));try{let r=await n(o);0===r.failed.length?h.Am.success("".concat(r.successful.length," ").concat((0,X.Ri)(r.successful.length,"workbook")," deleted successfully!"),{id:e}):r.successful.length>0?h.Am.success("".concat(r.successful.length," ").concat((0,X.Ri)(r.successful.length,"workbook")," deleted successfully. ").concat(r.failed.length," failed."),{id:e}):h.Am.error("Failed to delete ".concat((0,X.Ri)(r.failed.length,"workbook")),{id:e}),null==a||a()}catch(r){h.Am.error("Failed to delete workbooks: ".concat(r.message),{id:e})}};return 0===o.length?null:(0,s.jsx)(Q.Z,{open:l,setOpen:t,title:o.length>1?"Delete these workbooks?":"Delete this workbook?",description:o.length>1?"You are about to permanently delete ".concat(o.length," workbooks. This action cannot be undone."):'You are about to permanently delete "'.concat((null===(r=o[0])||void 0===r?void 0:r.name)||"Workbook",'". This action cannot be undone.'),onConfirm:d,onCancel:()=>t(!1),primaryActionButtonVariant:w.f1.DESTRUCTIVE,confirmButtonProps:{text:"Delete"},cancelButtonProps:{text:"Cancel"}})},er=l(26824),el=l(48819),et=l(69307),eo=l(9888),ea=l(92290);let en=(e,r,l)=>{let t=null==r?void 0:r.find(r=>r.target_id===e.flowbook_id),o=(null==t?void 0:t.creator_user_id)===l;return!!t&&(!!o||t.status===er.C.APPROVED)&&{template:t,isCreator:o,isMarketplaceTemplate:!t.organization_id}},es=(e,r,l,t,o,a,n)=>[{accessorKey:"name",header:"Workflows • ".concat(o),accessorFn:e=>e.name||"",enableSorting:!0,sortingFn:"text",meta:{columnClasses:"w-1/2"},cell:e=>{let{row:r}=e,l=r.original,o=en(l,t,a);return(0,s.jsx)("div",{className:"flex min-w-0 items-start gap-3",children:(0,s.jsxs)("div",{className:"my-auto flex min-w-0 flex-col items-start",children:[(0,s.jsx)("p",{className:"w-full truncate text-sm font-medium",children:l.name}),(0,s.jsxs)("div",{className:(0,$.cn)("flex w-full min-w-0 flex-row items-center gap-1",o&&"pt-0.5"),children:[o&&(0,s.jsx)(et.O,{status:o.template.status,isCreator:o.isCreator,isMarketplaceTemplate:o.isMarketplaceTemplate}),l.description&&(0,s.jsx)("p",{className:"text-muted-foreground min-w-0 flex-1 truncate text-sm",children:l.description})]})]})})}},{accessorKey:"nodes_used",header:"Nodes",meta:{columnClasses:"hidden md:table-cell"},enableSorting:!1,cell:e=>{let{row:r}=e,l=r.original.key_operators;return l?(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsx)(ea.Z,{keyOperators:l})}):null}},{accessorKey:"creator_user_id",header:"Creator",meta:{columnClasses:(0,$.cn)("hidden md:table-cell",!r&&"!hidden")},enableSorting:!1,cell:e=>{let{row:r}=e,l=r.original;return l.creator_user_id?(0,s.jsx)(el.Z,{name:l.creatorDisplayName(),src:l.creator_profile_picture,isSelf:l.creator_user_id===a}):(0,s.jsx)("span",{className:"text-border text-xs",children:"—"})}},{accessorKey:"created_ts",header:"Last Edited",accessorFn:e=>{let r=e.created_ts;return r?new Date(r):null},meta:{columnClasses:"hidden lg:table-cell"},enableSorting:!0,sortingFn:"datetime",cell:e=>{var r;let{row:l}=e,t=l.original;return(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsx)("span",{className:"text-muted-foreground flex-none text-sm",children:t.created_ts?(0,X.p6)((null===(r=t.created_ts)||void 0===r?void 0:r.toString())||""):""})})}},{id:"actions",header:"",cell:r=>{let{row:t}=r,o=t.original;return(0,s.jsx)("div",{className:"flex items-center justify-end gap-3",children:(0,s.jsx)(eo.Z,{workflow:o,projects:e,folderTree:l,onSuccess:n})})}}];var ed=l(3542),ei=l(85210),ec=l(36127),eu=l(1998),em=l(42171),ef=l(70384),ep=l(3002),eg=l(64127),ex=l(81687),eh=l(18272),ew=l(97387),e_=l(30671),ev=l(98692),ek=e=>{let{workflowFilters:{searchTerm:r,filters:{node:l,trigger:t,creator:o},setSearchTerm:d,setFilter:i,clearAllFilters:c,hasTriggers:m,filterDefinitions:f,getFilterValues:p},availableNodes:g}=e,x=p(n.CREATOR),h=(0,u.useMemo)(()=>{let e=0;return l&&e++,t===a.ACTIVE&&e++,o&&e++,e},[l,t,o]),_=(0,u.useMemo)(()=>x.length>1||(null==g?void 0:g.length)>0||m,[x.length,null==g?void 0:g.length,m]);return(0,s.jsxs)("div",{className:"xs:flex-nowrap flex w-full min-w-0 flex-wrap items-center gap-3 md:w-auto md:max-w-md md:flex-1 xl:max-w-none xl:flex-row",children:[(0,s.jsx)("div",{className:"relative min-w-0 flex-1",children:(0,s.jsx)(eg.I,{placeholder:"Search workflows and folders",LeadingIcon:ec.Z,className:"w-full min-w-0!",value:r,onChange:e=>d(e.target.value),shadow:!0})}),_&&(0,s.jsxs)(eh.J2,{children:[(0,s.jsx)(eh.xo,{asChild:!0,className:"group/popover-trigger",children:(0,s.jsxs)(w.zx,{variant:"outline",shadow:!0,className:"xs:w-fit w-full",children:[h>0?(0,s.jsx)("span",{className:"text-background bg-accent-foreground flex size-4 shrink-0 items-center justify-center rounded-full text-[10px]",children:h}):(0,s.jsx)(eu.Z,{}),(0,s.jsx)("span",{children:"Filters"}),(0,s.jsx)(em.Z,{className:"transition-[rotate] duration-200 group-data-[state=open]/popover-trigger:-rotate-180"})]})}),(0,s.jsxs)(eh.yk,{align:"end",className:"flex flex-col !p-0",children:[x.length>1&&(0,s.jsxs)("div",{className:"flex flex-row items-center gap-2 p-3",children:[(0,s.jsxs)(ex._,{className:"text-muted-foreground flex w-40 flex-row items-center gap-2 text-xs",children:[(0,s.jsx)(ef.Z,{className:"h-4 w-4"}),f[n.CREATOR].label]}),(0,s.jsx)(ev.N,{options:x,value:o,placeholder:"Select Creator",className:"flex !h-8 !w-48 rounded-sm text-xs shadow-xs",onSelect:e=>{e===o?i(n.CREATOR,void 0):i(n.CREATOR,e)}})]}),x.length>1&&(0,s.jsx)(ew.Z,{className:"bg-muted"}),(null==g?void 0:g.length)>0&&(0,s.jsxs)(u.Fragment,{children:[(0,s.jsx)(ew.Z,{className:"bg-muted"}),(0,s.jsxs)("div",{className:"flex flex-row items-center gap-2 p-3",children:[(0,s.jsxs)(ex._,{className:"text-muted-foreground flex w-40 flex-row items-center gap-2 text-xs",children:[(0,s.jsx)(ep.Z,{className:"h-4 w-4"}),"Contains Node"]}),(0,s.jsx)(ev.N,{options:g,value:l,placeholder:"Select Nodes",className:"flex !h-8 !w-48 rounded-sm text-xs shadow-xs",onSelect:e=>{e===l?i(n.NODE,void 0):i(n.NODE,e)}})]})]}),m&&(0,s.jsxs)(u.Fragment,{children:[(0,s.jsx)(ew.Z,{className:"bg-muted"}),(0,s.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 p-3",children:[(0,s.jsxs)(ex._,{className:"text-muted-foreground flex w-40 flex-row items-center gap-2 text-xs",children:[(0,s.jsx)(v.Z,{className:"h-4 w-4"}),"Has Trigger"]}),(0,s.jsx)(e_.r,{checked:t===a.ACTIVE,onCheckedChange:e=>i(n.TRIGGER,e?a.ACTIVE:a.ALL)})]})]}),h>0&&(0,s.jsxs)(u.Fragment,{children:[(0,s.jsx)(ew.Z,{className:"bg-muted"}),(0,s.jsx)("div",{className:"flex flex-row items-center justify-end gap-2 p-3",children:(0,s.jsx)(w.zx,{variant:"outline",size:"xs",onClick:()=>{c()},children:"Clear Filters"})})]})]})]})]})},ej=l(7597),ey=l.n(ej),eb=l(7161),eC=l(54178),eF=l(5980),eT=l(44194),eN=e=>{let{open:r,onOpenChange:l,children:t,parentFolderId:o,onSuccess:a}=e,[n,i]=(0,eC.P)({open:r,onOpenChange:l}),{userProfile:c,idTokenRef:m}=(0,u.useContext)(Z.f),{currentProject:f}=(0,u.useContext)(M.xI),{currentFolder:p}=(0,u.useContext)(eF.n),g=(0,x.I0)(),[_,{isLoading:v}]=(0,d.we)(),k=async e=>{let r=h.Am.loading("Creating folder...");try{let l=(null==f?void 0:f.project_id)||c.user_id,t=void 0!==o?o:(null==p?void 0:p.folder_id)||null,n=ey()().new();i(!1);let s=await _({userProfile:c,idToken:m.current,folderId:n,name:e,parentFolderId:t,authorId:l,folderType:"FLOWBOOK",projectId:null==f?void 0:f.project_id}).unwrap();h.Am.success("Folder ".concat(e," created successfully!"),{id:r}),g((0,E.Oe)(new eT.g({folder_id:s.folder_id,name:s.name,parent_folder_id:s.parent_folder_id,author_id:s.author_id,folder_type:s.folder_type,created_ts:new Date(s.created_ts)}))),null==a||a()}catch(e){h.Am.error("Error creating folder: ".concat(e.message),{id:r})}};return(0,s.jsxs)(eb.Vq,{open:n,onOpenChange:i,children:[t&&(0,s.jsx)(eb.hg,{asChild:!0,children:t}),(0,s.jsx)(eb.cZ,{children:(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),v||k(new FormData(e.target).get("folder-name"))},children:[(0,s.jsxs)(eb.a7,{children:[(0,s.jsx)(eb.fK,{children:(0,s.jsx)(eb.$N,{children:"Create a Folder For Your Workflows"})}),(0,s.jsx)("div",{children:(0,s.jsx)(eg.I,{id:"folder-name",name:"folder-name",required:!0})})]}),(0,s.jsxs)(eb.cN,{children:[(0,s.jsx)(eb.GG,{children:(0,s.jsx)(w.zx,{type:"button",variant:"ghost",disabled:v,children:"Cancel"})}),(0,s.jsx)(w.zx,{type:"submit",disabled:v,children:"Create"})]})]})})]})},eI=e=>{let{folder:r,open:l,setOpen:t,onSuccess:o}=e,{userProfile:a,idTokenRef:n}=(0,u.useContext)(Z.f),i=(0,x.I0)(),[c,{isLoading:m}]=(0,d.Kw)(),f=async e=>{let l=h.Am.loading("Renaming your folder...");try{await c({userProfile:a,idToken:n.current,folderId:r.folder_id,name:e,parentFolderId:r.parent_folder_id}).unwrap(),h.Am.success("Folder renamed successfully!",{id:l}),i((0,E.kA)({folderId:r.folder_id,newName:e})),t(!1),null==o||o()}catch(e){h.Am.error("".concat(e.message||"Failed to rename folder"),{id:l})}};return(0,s.jsx)(eb.Vq,{open:l,onOpenChange:t,children:(0,s.jsx)(eb.cZ,{onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),m||f(new FormData(e.target).get("folder-name"))},children:[(0,s.jsxs)(eb.a7,{children:[(0,s.jsx)(eb.fK,{children:(0,s.jsx)(eb.$N,{className:"text-lg font-semibold",children:"Rename Your Folder"})}),(0,s.jsx)("div",{children:(0,s.jsx)(eg.I,{id:"folder-name",name:"folder-name",placeholder:"Enter your new folder name",defaultValue:(null==r?void 0:r.name)||"",required:!0})})]}),(0,s.jsxs)(eb.cN,{children:[(0,s.jsx)(w.zx,{variant:"ghost",onClick:()=>{t(!1)},disabled:m,children:"Cancel"}),(0,s.jsx)(w.zx,{type:"submit",disabled:m,children:"Continue"})]})]})})})},eA=()=>{let{userProfile:e,idTokenRef:r}=(0,Z.H)(),{currentProject:l}=(0,M.d2)(),{bulkMoveToFolder:t}=(0,Y.i)(),[o,a]=(0,q.j)(),[n,p]=(0,u.useState)(null),{currentFolderId:v,currentPath:k,folders:j,flowbooks:y,isLoading:b,navigateToFolder:C,navigateToIndex:F,refetch:T}=G(),{deleteFolder:N,moveToParentFolder:I,moveToSiblingFolder:R}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{onSuccess:r}=e,{userProfile:l,idTokenRef:t}=(0,Z.H)(),{currentProject:o}=(0,M.d2)(),a=(0,x.I0)(),[n,{isLoading:s}]=(0,d.yC)(),[i,{isLoading:c}]=(0,d.m7)(),[m,{isLoading:f}]=(0,d.ms)(),[p,{isLoading:g}]=(0,d.Kw)(),w=(0,u.useCallback)(async e=>{try{await n({userProfile:l,idToken:t.current,folderId:e.folder_id,parentFolderId:e.parent_folder_id,projectId:null==o?void 0:o.project_id}).unwrap(),a((0,E.Su)(e.folder_id)),h.Am.success("Folder deleted"),null==r||r()}catch(e){throw h.Am.error(e.message||"Failed to delete folder"),e}},[n,l,t,null==o?void 0:o.project_id,a,r]);return{deleteFolder:w,moveToParentFolder:(0,u.useCallback)(async e=>{try{var n,s;let d=await i({userProfile:l,idToken:t.current,folderId:e.folder_id,currentParentFolderId:e.parent_folder_id,projectId:null==o?void 0:o.project_id,folderData:{folder_id:e.folder_id,name:e.name,parent_folder_id:e.parent_folder_id,author_id:null!==(n=e.author_id)&&void 0!==n?n:"",created_ts:e.created_ts?S.hT.toISO(e.created_ts):null,folder_type:null!==(s=e.folder_type)&&void 0!==s?s:""}}).unwrap();a((0,E.RF)({folderId:e.folder_id,newParentFolderId:d.parent_folder_id})),h.Am.success("Folder moved"),null==r||r()}catch(e){throw h.Am.error(e.message||"Failed to move folder"),e}},[i,l,t,null==o?void 0:o.project_id,a,r]),moveToSiblingFolder:(0,u.useCallback)(async(e,n)=>{try{var s,d;let i=await m({userProfile:l,idToken:t.current,folderId:e.folder_id,targetFolderId:n,currentParentFolderId:e.parent_folder_id,projectId:null==o?void 0:o.project_id,folderData:{folder_id:e.folder_id,name:e.name,parent_folder_id:e.parent_folder_id,author_id:null!==(s=e.author_id)&&void 0!==s?s:"",created_ts:e.created_ts?S.hT.toISO(e.created_ts):null,folder_type:null!==(d=e.folder_type)&&void 0!==d?d:""}}).unwrap();a((0,E.RF)({folderId:e.folder_id,newParentFolderId:i.parent_folder_id})),h.Am.success("Folder moved"),null==r||r()}catch(e){throw h.Am.error(e.message||"Failed to move folder"),e}},[m,l,t,null==o?void 0:o.project_id,a,r]),renameFolder:(0,u.useCallback)(async(e,n)=>{try{await p({userProfile:l,idToken:t.current,folderId:e.folder_id,name:n,projectId:null==o?void 0:o.project_id,parentFolderId:e.parent_folder_id}).unwrap(),a((0,E.kA)({folderId:e.folder_id,newName:n})),h.Am.success("Folder renamed"),null==r||r()}catch(e){throw h.Am.error(e.message||"Failed to rename folder"),e}},[p,l,t,null==o?void 0:o.project_id,a,r]),isDeleting:s,isMoving:c||f,isRenaming:g}}(),P=(0,x.v9)(i._I),W=(0,x.v9)(c.xC.selectAllTemplates),{data:B,isLoading:K}=(0,d.Kb)({userProfile:e,idToken:r.current,projectId:null==l?void 0:l.project_id},{skip:e.isLoading()}),V=(0,u.useMemo)(()=>{if(!(null==B?void 0:B.folderTree))return null;let e=r=>{var l;return{folder_id:r.folder_id,name:r.name,children:(null===(l=r.children)||void 0===l?void 0:l.map(e))||[]}};return e(B.folderTree)},[null==B?void 0:B.folderTree]),{items:H,filters:X}=z({workflowItems:(0,u.useMemo)(()=>(null==y?void 0:y.map(e=>{var r;return{id:e.flowbook_id,type:L.B.FLOWBOOK,data:e,keyOperators:null!==(r=e.key_operators)&&void 0!==r?r:void 0}}))||[],[y])}),Q=(0,u.useMemo)(()=>H.filter(e=>e.type===L.B.FLOWBOOK).map(e=>e.data),[H]),er=(0,u.useMemo)(()=>{let e=new Set;return y.forEach(r=>{r.key_operators&&Object.keys(r.key_operators).forEach(r=>e.add(r))}),Array.from(e).sort().map(e=>({label:e,value:e}))},[y]),el=(0,u.useMemo)(()=>es(P,l,null==B?void 0:B.folderTree,W,Q.length,e.user_id,T),[P,l,null==B?void 0:B.folderTree,W,Q.length,e.user_id,T]),et=(0,u.useCallback)(e=>{var r;return null!==(r=W.find(r=>r.target_id===e.flowbook_id))&&void 0!==r?r:null},[W]),eo=(0,u.useCallback)(e=>{C(e)},[C]),ea=(0,u.useCallback)(e=>{p(e)},[]),en=(0,u.useCallback)(async e=>{await N(e)},[N]),ec=(0,u.useCallback)(async e=>{await I(e)},[I]),eu=(0,u.useCallback)(async(e,r)=>{await R(e,r)},[R]),em=(0,u.useCallback)(e=>{F(e)},[F]),ef=(0,u.useCallback)(async(e,r)=>{let l=Array.isArray(e)?e:[e];await t(l,r),T()},[t,T]),ep=(0,u.useCallback)(async(e,r)=>{let l=h.Am.loading("Moving workflow...");try{(await t([e],r)).successful.length>0?h.Am.success('Moved "'.concat(e.name,'" to folder'),{id:l}):h.Am.error("Failed to move workflow",{id:l}),T()}catch(e){h.Am.error("Failed to move workflow",{id:l})}},[t,T]),eg=(0,u.useMemo)(()=>({title:"No workflows found",description:"Create your first workflow to get started",Icon:m.Z,action:(0,s.jsx)(w.zx,{shadow:!0,asChild:!0,children:(0,s.jsx)(g(),{href:"/pipeline",children:"Create Workflow"})})}),[]);return(0,s.jsxs)("main",{className:"flex h-fit w-full flex-col gap-6",children:[(0,s.jsx)(U.Z,{title:"Workflows",className:"px-2"}),(0,s.jsxs)("div",{className:"flex flex-col gap-4 px-2 md:flex-row md:items-end md:justify-between",children:[(0,s.jsx)(ek,{workflowFilters:X,availableNodes:er}),(0,s.jsxs)("div",{className:"flex w-full flex-wrap items-center gap-3 md:w-fit md:shrink-0 md:flex-nowrap",children:[(0,s.jsx)(J.x,{viewMode:o,onViewModeChange:a}),(0,s.jsx)(eN,{parentFolderId:v,children:(0,s.jsxs)(w.zx,{variant:"outline",shadow:!0,className:"hidden md:flex",children:[(0,s.jsx)(f.Z,{}),"Create Folder"]})}),(0,s.jsxs)(_.u,{children:[(0,s.jsx)(_.aJ,{asChild:!e.is_flow_modification_restricted,className:(0,$.cn)(e.is_flow_modification_restricted&&"cursor-not-allowed"),children:(0,s.jsx)(w.zx,{shadow:!0,asChild:!e.is_flow_modification_restricted,disabled:e.is_flow_modification_restricted,className:"w-full md:w-fit",children:(0,s.jsx)(g(),{href:"/pipeline",children:"Create Workflow"})})}),e.is_flow_modification_restricted&&(0,s.jsx)(_._v,{children:"Workflow creation has been restricted by your admin."})]})]})]}),(0,s.jsx)(O.X,{view:o,currentFolderPath:k,folders:j,entities:Q,adapter:A,onFolderClick:eo,onBreadcrumbNavigate:em,onFolderRename:ea,onFolderDelete:en,onFolderMoveToParent:ec,onMoveToFolder:ep,onFolderMoveToSibling:eu,renderEntityCard:e=>(0,s.jsx)(ed.te,{flowbook:e,template:et(e),projects:P,folderTree:null==B?void 0:B.folderTree}),entityColumns:el,currentFolderId:v,isLoading:b,emptyState:eg,searchTerm:X.searchTerm,renderBulkMoveToFolderDialog:e=>{let{open:r,onOpenChange:l,entities:t,onSuccess:o,currentFolderId:a}=e;return(0,s.jsx)(D.$,{rootName:"Workflows",open:r,onOpenChange:l,entities:t,entityName:"workbook",entityNamePlural:"workbooks",getEntityName:e=>e.name,getEntityFolderId:e=>{var r;return null!==(r=e.folder_id)&&void 0!==r?r:null},folderTree:V,isLoadingTree:K,currentFolderId:a,onMove:ef,onSuccess:()=>{o(),T()}})},renderBulkMoveToWorkspaceDialog:e=>{let{open:r,onOpenChange:l,entities:t,onSuccess:o}=e;return(0,s.jsx)(ei.Z,{open:r,setOpen:l,workflows:t,onSuccess:()=>{o(),T()}})},renderBulkDeleteDialog:e=>{let{open:r,onOpenChange:l,entities:t,onSuccess:o}=e;return(0,s.jsx)(ee,{open:r,setOpen:l,workflows:t,onSuccess:()=>{o(),T()}})}}),n&&(0,s.jsx)(eI,{folder:n,open:!!n,setOpen:e=>!e&&p(null)})]})}}}]);