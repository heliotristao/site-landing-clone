"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2365],{86680:function(e,s,r){r.d(s,{k:function(){return _}});var a=r(85893),n=r(67294),t=r(15432),l=r(42171),i=r(78865),c=r(23432),d=r(93461),o=r(43832),m=r(15928),u=r(92385),x=r(53645),h=r(64712),v=r(71424),j=r(29876),f=r(7161),p=r(64127),g=r(61857),N=r(28687),w=r(86330),b=r(49038),C=r(5197);let k=e=>{var s,r;let{server:c,projectId:d}=e,[o,m]=(0,n.useState)(!1),{data:u,isLoading:x}=(0,w.Z)({serverId:c.server_id,projectId:d}),{data:h,isLoading:f}=(0,N.wD)({serverId:c.server_id,projectId:d}),p=null!==(s=null==u?void 0:u.providers)&&void 0!==s?s:[],g=null!==(r=null==h?void 0:h.credentials)&&void 0!==r?r:[],b=g.length>0,C=c.name.charAt(0).toUpperCase();return(0,a.jsxs)("div",{className:"border-border rounded-xl border",children:[(0,a.jsxs)("div",{className:"flex cursor-pointer items-center justify-between p-4",onClick:()=>m(!o),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg text-lg font-semibold text-white ".concat((e=>{let s=["bg-blue-500","bg-purple-500","bg-green-500","bg-orange-500","bg-pink-500","bg-indigo-500","bg-teal-500","bg-cyan-500"];return s[e.split("").reduce((e,s)=>e+s.charCodeAt(0),0)%s.length]})(c.name)),children:C}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("h3",{className:"text-card-foreground text-base font-semibold",children:c.name}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:b?"".concat(g.length," credential(s) connected"):"Not connected"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[p.length>0&&(0,a.jsx)(j.zx,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),m(!o)},children:o?(0,a.jsx)(t.Z,{className:"h-5 w-5"}):(0,a.jsx)(l.Z,{className:"h-5 w-5"})}),b?(0,a.jsxs)(v.C,{variant:"success",className:"gap-1.5",children:[(0,a.jsx)(i.Z,{className:"h-3.5 w-3.5"}),"Connected"]}):(0,a.jsx)(j.zx,{variant:"default",onClick:e=>{e.stopPropagation(),m(!0)},children:"Connect"})]})]}),o&&(0,a.jsx)("div",{className:"border-border border-t",children:x||f?(0,a.jsxs)("div",{className:"flex flex-col divide-y",children:[(0,a.jsx)(I,{}),(0,a.jsx)(I,{})]}):0===p.length?(0,a.jsx)("div",{className:"text-muted-foreground p-4 text-center text-sm",children:"No auth providers configured for this server"}):(0,a.jsx)("div",{className:"flex flex-col divide-y",children:p.map(e=>(0,a.jsx)(y,{server:c,provider:e,credentials:g.filter(s=>s.provider===e.name),projectId:d},e.name))})})]})},y=e=>{let{server:s,provider:r,credentials:t,projectId:l}=e,[i,o]=(0,n.useState)(!1),{mutate:m,isPending:u}=(0,N.Hu)(),x=r.name.charAt(0).toUpperCase()+r.name.slice(1),v=t.length>0;return(0,a.jsxs)("div",{className:"bg-muted/30 p-4",children:[(0,a.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"border-border bg-muted flex h-10 w-10 items-center justify-center rounded-lg border text-sm font-semibold",children:r.name.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-medium",children:x}),(0,a.jsxs)("span",{className:"text-muted-foreground text-xs",children:[r.is_oauth?"OAuth":"API Key"," authentication"]})]})]}),!v&&(0,a.jsxs)(j.zx,{variant:"outline",size:"sm",onClick:()=>{if(r.is_oauth){let e=window.location.pathname;m({serverId:s.server_id,provider:r.name,redirectPath:e,projectId:l},{onSuccess:e=>{window.open(e.url,"_blank","noopener,noreferrer"),h.Am.info("Please complete ".concat(x," authentication in the new tab"))},onError:e=>{h.Am.error("Failed to start OAuth flow: ".concat(e.message))}})}else o(!0)},disabled:u,children:[u?(0,a.jsx)(c.Z,{className:"mr-1 h-4 w-4 animate-spin"}):(0,a.jsx)(d.Z,{className:"mr-1 h-4 w-4"}),u?"Connecting...":"Add credential"]})]}),t.length>0&&(0,a.jsx)("div",{className:"border-border mt-3 flex flex-col divide-y rounded-lg border",children:t.map(e=>(0,a.jsx)(S,{server:s,provider:r,credential:e,projectId:l},e.secret_id))}),!r.is_oauth&&(0,a.jsx)(_,{open:i,onOpenChange:o,server:s,provider:r,projectId:l})]})},_=e=>{var s;let{open:r,onOpenChange:t,server:l,provider:d,projectId:u}=e,{mutate:x,isPending:v}=(0,N.xp)(),[g,w]=(0,n.useState)(!1),[b,C]=(0,n.useState)(""),[k,y]=(0,n.useState)({}),_=d.name.charAt(0).toUpperCase()+d.name.slice(1),S=null!==(s=d.credential_fields)&&void 0!==s?s:[],Z=e=>{e&&(y({}),C(""),w(!1)),t(e)},I=(e,s)=>{y(r=>({...r,[e]:s}))};return(0,a.jsx)(f.Vq,{open:r,onOpenChange:Z,children:(0,a.jsxs)(f.cZ,{children:[(0,a.jsxs)(f.a7,{children:[(0,a.jsxs)(f.fK,{children:[(0,a.jsxs)(f.$N,{children:["Add ",_," Credential"]}),(0,a.jsx)(f.Be,{children:d.description||"Enter your ".concat(_," credentials to connect.")})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{htmlFor:"nickname",className:"text-muted-foreground text-sm font-medium",children:"Nickname"}),(0,a.jsx)(p.I,{id:"nickname",value:b,onChange:e=>C(e.target.value),placeholder:"My ".concat(_," Account"),disabled:v})]}),S.map(e=>{var s;return(0,a.jsx)(A,{field:e,value:null!==(s=k[e.name])&&void 0!==s?s:"",onChange:s=>I(e.name,s),showSecret:g,disabled:v},e.name)})]})]}),(0,a.jsxs)(f.cN,{className:"flex items-center",children:[(0,a.jsxs)(j.zx,{variant:"outline",onClick:()=>w(e=>!e),disabled:v,children:[g?(0,a.jsx)(o.Z,{className:"h-4 w-4"}):(0,a.jsx)(m.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:g?"Hide":"Show"})]}),(0,a.jsxs)(j.zx,{onClick:()=>{let e=S.filter(e=>{var s;return!(null===(s=k[e.name])||void 0===s?void 0:s.trim())});if(e.length>0){h.Am.error("Please fill in: ".concat(e.map(e=>e.label||e.name).join(", ")));return}x({serverId:l.server_id,provider:d.name,credentials:k,nickname:b.trim()||void 0,projectId:u},{onSuccess:e=>{h.Am.success("Successfully added ".concat(e.nickname||_," credential!")),Z(!1)},onError:e=>{h.Am.error("Failed to add credential: ".concat(e.message))}})},disabled:v,children:[v?(0,a.jsx)(c.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(i.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Save"})]})]})]})})},A=e=>{let{field:s,value:r,onChange:n,showSecret:t,disabled:l}=e,i=!1!==s.secret;return(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("label",{htmlFor:s.name,className:"text-muted-foreground text-sm font-medium",children:[s.label||s.name,(0,a.jsx)("span",{className:"ml-1 text-red-500",children:"*"})]}),s.description&&(0,a.jsx)("p",{className:"text-muted-foreground text-xs",children:s.description}),(0,a.jsx)(p.I,{id:s.name,type:i&&!t?"password":"text",value:r,onChange:e=>n(e.target.value),placeholder:s.placeholder||"",disabled:l,autoComplete:"off"})]})},S=e=>{var s;let{server:r,provider:t,credential:l,projectId:i}=e,[o,m]=(0,n.useState)(null!==(s=l.nickname)&&void 0!==s?s:""),{mutate:v,isPending:g}=(0,N.XA)(),{mutate:w,isPending:b}=(0,N.mV)(),{mutate:k,isPending:y}=(0,N.Hu)(),[_,A]=(0,n.useState)(!1),[S,Z]=(0,n.useState)(!1),I=t.name.charAt(0).toUpperCase()+t.name.slice(1),z=g||b||y;return(0,a.jsxs)("div",{className:"bg-background flex flex-col gap-4 p-3 lg:flex-row lg:items-center lg:p-4 ".concat(z?"opacity-50":""),children:[(0,a.jsx)("div",{className:"flex flex-grow items-center gap-3",children:(0,a.jsxs)("div",{className:"flex w-full flex-col gap-0.5",children:[(0,a.jsx)(p.I,{size:"sm",type:"text",value:o,disabled:z,onChange:e=>m(e.target.value),onKeyDown:e=>{("Enter"===e.key||"Escape"===e.key)&&e.target.blur()},onBlur:()=>{if(!o.trim()){var e;h.Am.error("Nickname cannot be empty"),m(null!==(e=l.nickname)&&void 0!==e?e:"");return}o!==l.nickname&&v({serverId:r.server_id,secretId:l.secret_id,nickname:o,projectId:i},{onError:e=>{var s;h.Am.error("Could not update nickname: ".concat(e.message)),m(null!==(s=l.nickname)&&void 0!==s?s:"")}})},className:"!h-7 !min-w-fit !py-0.5 !pr-0.5 not-focus-within:border-none not-focus-within:pl-1 focus-within:pl-2"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("div",{className:"text-muted-foreground pl-1 text-xs",title:l.created_ts?new Date(l.created_ts).toLocaleString():void 0,children:[t.is_oauth?"Last refreshed":"Created"," ",l.created_ts?(0,C.Sy)(new Date(l.created_ts),!0):"unknown"]})})]})}),(0,a.jsxs)("div",{className:"flex w-full flex-col items-center gap-2 sm:w-auto sm:flex-row",children:[(0,a.jsxs)(j.zx,{variant:"ghost",accent:"destructive",disabled:z,onClick:()=>A(!0),className:"w-full sm:w-auto",children:[(0,a.jsx)(d.Z,{className:"mr-0.5 h-4 w-4 rotate-45"}),"Revoke"]}),t.is_oauth&&(0,a.jsxs)(j.zx,{variant:"outline",className:"w-full rounded-md sm:w-auto",disabled:z,onClick:()=>{let e=window.location.pathname;k({serverId:r.server_id,provider:t.name,redirectPath:e,projectId:i},{onSuccess:e=>{window.open(e.url,"_blank","noopener,noreferrer"),h.Am.info("Please complete ".concat(I," reauthentication in the new tab"))},onError:e=>{h.Am.error("Failed to start reauthentication: ".concat(e.message))}})},children:[y?(0,a.jsx)(c.Z,{className:"mr-0.5 h-4 w-4 animate-spin"}):(0,a.jsx)(u.Z,{className:"mr-0.5 h-4 w-4"}),y?"Connecting...":"Reauthenticate"]}),(0,a.jsxs)(j.zx,{variant:"outline",className:"bg-muted hover:bg-muted/80 w-full rounded-md border-none text-nowrap transition-colors sm:w-auto",disabled:!!l.is_default||z,onClick:()=>Z(!0),children:[l.is_default&&(0,a.jsx)(x.Z,{className:"mr-1 h-4 w-4"}),l.is_default?"Default":"Set as default"]})]}),(0,a.jsx)(f.Vq,{open:_,onOpenChange:A,children:(0,a.jsxs)(f.cZ,{children:[(0,a.jsx)(f.a7,{children:(0,a.jsxs)(f.fK,{children:[(0,a.jsx)(f.$N,{children:"Revoke Credential?"}),(0,a.jsxs)(f.Be,{children:["Are you sure you want to revoke the ",o||I," credential? Any tools using this credential will stop working."]})]})}),(0,a.jsxs)(f.cN,{children:[(0,a.jsx)(j.zx,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),(0,a.jsxs)(j.zx,{variant:"destructive-gradient",onClick:()=>{w({serverId:r.server_id,secretId:l.secret_id,projectId:i},{onSuccess:()=>{h.Am.success("Successfully revoked ".concat(I," credential")),A(!1)},onError:e=>{h.Am.error("Failed to revoke credential: ".concat(e.message))}})},disabled:b,children:[b&&(0,a.jsx)(c.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Revoke"]})]})]})}),(0,a.jsx)(f.Vq,{open:S,onOpenChange:Z,children:(0,a.jsxs)(f.cZ,{children:[(0,a.jsxs)(f.a7,{children:[(0,a.jsx)(f.$N,{children:"Change Default Credential?"}),(0,a.jsx)("p",{children:"Are you sure you want to set this as the default credential?"}),(0,a.jsxs)("p",{children:["Any tools currently using the default credential for ",I," will start using this credential."]})]}),(0,a.jsxs)(f.cN,{children:[(0,a.jsx)(j.zx,{variant:"ghost",onClick:()=>Z(!1),children:"Cancel"}),(0,a.jsxs)(j.zx,{variant:"default",onClick:()=>{v({serverId:r.server_id,secretId:l.secret_id,isDefault:!0,projectId:i},{onSuccess:()=>{h.Am.success("Successfully set ".concat(o||I," as default!")),Z(!1)},onError:e=>{h.Am.error("Could not set as default: ".concat(e.message))}})},disabled:g,children:[g&&(0,a.jsx)(c.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirm"]})]})]})})]})},Z=()=>(0,a.jsx)("div",{className:"border-border rounded-xl border p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(g.O,{className:"h-12 w-12 rounded-lg"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(g.O,{className:"h-5 w-32"}),(0,a.jsx)(g.O,{className:"h-4 w-24"})]})]}),(0,a.jsx)(g.O,{className:"h-9 w-24 rounded-full"})]})}),I=()=>(0,a.jsx)("div",{className:"bg-muted/30 p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(g.O,{className:"h-10 w-10 rounded-lg"}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)(g.O,{className:"h-4 w-24"}),(0,a.jsx)(g.O,{className:"h-3 w-32"})]})]}),(0,a.jsx)(g.O,{className:"h-8 w-28 rounded-md"})]})});s.Z=e=>{var s;let{className:r,searchTerm:n="",showSectionDivider:t=!1,project:l}=e,{data:i,isLoading:c}=(0,b.Z)(),d=(null!==(s=null==i?void 0:i.servers)&&void 0!==s?s:[]).filter(e=>{var s;return"active"===e.status&&(null===(s=e.config)||void 0===s?void 0:s.auth_method)!=="none"&&(!n||!!e.name.toLowerCase().includes(n.toLowerCase()))});return c||0!==d.length?(0,a.jsxs)(a.Fragment,{children:[t&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"text-muted-foreground text-sm font-medium",children:"Gumstack Servers"}),(0,a.jsx)("div",{className:"bg-border h-px flex-1"})]}),(0,a.jsx)("div",{className:"flex flex-col gap-8 ".concat(null!=r?r:""),children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z,{}),(0,a.jsx)(Z,{})]}):d.map(e=>(0,a.jsx)(k,{server:e,projectId:null==l?void 0:l.project_id},e.server_id))})]}):null}},86330:function(e,s,r){var a=r(78551),n=r(45837),t=r(90273);s.Z=e=>{let{serverId:s,projectId:r,enabled:l=!0}=e,{userProfile:i,idTokenRef:c}=(0,n.H)();return(0,a.a)({queryKey:["gumstack-server-providers",s,r],queryFn:async e=>{let{signal:a}=e,n=r?"?project_id=".concat(r):"";return await (0,t.n9)("servers/".concat(s,"/providers").concat(n),i,c.current,"GET",null,a)},enabled:(null==i?void 0:i.isLoggedIn())&&!!s&&l})}},84547:function(e,s,r){r.d(s,{H:function(){return l}});var a=r(78551),n=r(45837),t=r(90273);let l=async(e,s,r,a)=>(0,t.n9)("servers/".concat(e),s,r,"GET",null,a);s.Z=e=>{let{serverId:s,enabled:r=!0}=e,{userProfile:t,idTokenRef:i}=(0,n.H)();return(0,a.a)({queryKey:["gumstack-server",s],queryFn:async e=>{let{signal:r}=e;return await l(s,t,i.current,r)},enabled:(null==t?void 0:t.isLoggedIn())&&!!s&&r})}}}]);