"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[768],{32578:function(e,a,i){i.d(a,{Z:function(){return Z}});var r=i(85893),s=i(67294),n=i(78865),t=i(18289),l=i(30202),o=i(98029),d=i(27379),c=i(11163),u=i(64712),m=i(29876),g=i(7161),h=i(97387),v=i(821),p=i(14142),_=i(54178),f=i(78244),y=i(38719),b=i(97257),w=i(24266),x=i(50855),C=i(41491),A=i(39514),k=i(58067),S=i(81687);let j=(0,s.memo)(e=>{var a,i,n;let{sharedUsers:t,setSharedUsers:o,searchableItemsLoading:c,agent:m,userProfile:g,idToken:h}=e,v=(0,d.useSearchParams)().get("share_email"),[p,_]=(0,s.useState)(!1),[f,b]=(0,s.useState)(!1),[w,C]=(0,s.useState)(""),[A,j]=(0,s.useState)(null),Z=(0,l.NL)(),E=(0,s.useMemo)(()=>{var e,a,i,r,s;return null!==(s=[...null!==(i=null==g?void 0:null===(e=g.organization)||void 0===e?void 0:e.members)&&void 0!==i?i:[],...null!==(r=null==g?void 0:null===(a=g.organization)||void 0===a?void 0:a.admins)&&void 0!==r?r:[]].map(e=>{var a,i;return{value:null!==(a=e.user_email)&&void 0!==a?a:"",label:null!==(i=e.user_email)&&void 0!==i?i:""}}))&&void 0!==s?s:[]},[null===(a=g.organization)||void 0===a?void 0:a.members,null===(i=g.organization)||void 0===i?void 0:i.admins]),N=(0,s.useMemo)(()=>m.creator_user_id===g.user_id,[m.creator_user_id,g.user_id]);return(0,s.useEffect)(()=>{v&&C(v)},[v]),(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsxs)(S._,{className:"text-muted-foreground",children:["Users â€¢ ",null!==(n=null==t?void 0:t.length)&&void 0!==n?n:0]}),(0,r.jsx)(k.Z,{searchableItems:E,searchableItemsLoading:c,onConfirm:{label:"Share",action:async e=>{let a=u.Am.loading("Adding user...");_(!0);try{await m.shareWithUser(g,h,e,"viewer"),C(""),j(null),o([{user_id:e,user_email:e,role:"viewer"},...t]),u.Am.success("User added",{id:a}),(0,x.rB)(y.Z.SHARED,{gummie_id:m.gummie_id,access_type:"user"}),Z.invalidateQueries({queryKey:["agent-share-dialog",m.gummie_id]}),Z.invalidateQueries({queryKey:["savedItemPermissionMismatch",m.gummie_id]})}catch(e){u.Am.error("".concat(e instanceof Error?e.message:String(e)),{id:a})}finally{_(!1)}},loading:p},entities:t.map(e=>{var a,i;return{id:null!==(a=e.user_email)&&void 0!==a?a:"",name:null!==(i=e.user_email)&&void 0!==i?i:"",badge:"owner"===e.role?{text:"Owner",variant:"default"}:{text:"Viewer",variant:"secondary"}}}),selectedValue:A,onSelectedValueChange:j,showEntityActions:e=>{var a;let i=e.name===g.user_email||N,r=null===(a=t.find(a=>a.user_email===e.name))||void 0===a?void 0:a.role;return i&&"owner"!==r},entityActions:[{label:"Remove",description:e=>e.name===g.user_email?"Remove yourself from the agent":"Don't allow this user to access this agent",action:async e=>{if(!m)return;let a=u.Am.loading("Removing ".concat(e,"..."));if(b(!0),t.find(a=>a.user_email===e))try{await m.removeUser(g,h,e),o(a=>a.filter(a=>a.user_email!==e)),u.Am.success("Successfully removed ".concat(e),{id:a})}catch(e){u.Am.error("".concat(e instanceof Error?e.message:String(e)),{id:a})}finally{b(!1),Z.invalidateQueries({queryKey:["agent-share-dialog",m.gummie_id]}),Z.invalidateQueries({queryKey:["savedItemPermissionMismatch",m.gummie_id]})}else b(!1),u.Am.error("".concat(e," is not a shared user!"),{id:a})},disabled:f,loading:f,destructive:!0}],searchValue:w,onSearchValueChange:C,placeholder:"Share with a user",requireSelection:!1})]})});j.displayName="AgentUserAccessManager";var Z=e=>{var a,i;let{gummie:k,open:S,onOpenChange:Z,children:E,userProfile:N,idToken:M}=e,[I,P]=(0,_.P)({open:S,onOpenChange:Z}),{currentProject:U}=(0,b.d2)(),q=(0,d.useSearchParams)(),K=(0,c.useRouter)(),O=q.get("share_email"),[R,T]=(0,s.useState)([]),{data:z,isLoading:L}=(0,v.DV)({path:"gummies/".concat(k.gummie_id,"/permissions"),method:v.J7.GET,queryKey:["agent-share-dialog",k.gummie_id],options:{enabled:!!I}}),{interaction_id:V}=K.query,Q=(0,l.NL)(),{handleCopyText:D,isCopied:B}=(0,p.Z)("".concat(window.location.origin,"/agents/").concat(k.gummie_id),{successMessage:"Copied to clipboard",errorMessage:"Failed to copy link"}),{handleCopyText:F,isCopied:G}=(0,p.Z)("".concat(window.location.origin,"/agents/").concat(k.gummie_id,"/chat/").concat(V),{successMessage:"Copied to clipboard",errorMessage:"Failed to copy link"}),{handleCopyText:H,isCopied:W}=(0,p.Z)("".concat(window.location.origin,"/agents/").concat(k.gummie_id,"/setup"),{successMessage:"Copied to clipboard",errorMessage:"Failed to copy link"});(0,s.useEffect)(()=>{(null==z?void 0:z.users)&&T(Object.entries(z.users).map(e=>{let[a,i]=e;return{user_id:a,user_email:a,role:i}}))},[null==z?void 0:z.users]);let J=(0,o.D)({mutationFn:async e=>{let{accessType:a,organizationId:i,currentUsers:r}=e,s={access_type:a,...a===f.ZI.ANYONE&&{public_access_type:"viewer"},...a===f.ZI.ORGANIZATION&&i?{organization_id:i}:{}},n={users:Object.fromEntries(r.map(e=>[e.user_email,e.role])),general_access:s};return k.updatePermissions(N,M,n)},onSuccess:()=>{u.Am.success("Agent access updated"),Q.invalidateQueries({queryKey:["agent-share-dialog",k.gummie_id]}),Q.invalidateQueries({queryKey:["savedItemPermissionMismatch",k.gummie_id]})},onError:e=>{u.Am.error("Unable to update agent access")}}),Y=async(e,a)=>{try{return await J.mutateAsync({accessType:e,organizationId:a,currentUsers:R}),(0,x.rB)(y.Z.SHARED,{gummie_id:k.gummie_id,access_type:e}),!0}catch(e){return!1}},$=[{label:B?"Copied to clipboard":"Copy agent link",Icon:B?n.Z:t.Z,onClick:D},{label:G?"Copied to clipboard":"Copy current chat link",Icon:G?n.Z:t.Z,onClick:F,hidden:!V},{label:W?"Copied to clipboard":"Copy setup link",Icon:W?n.Z:t.Z,onClick:H}],X=(0,s.useCallback)(()=>{if(!q)return;let e=new URLSearchParams(q.toString());e.delete("share_email"),window.history.replaceState({},"","?".concat(e))},[q]);return((0,s.useEffect)(()=>{O&&(P(!0),X())},[O,X,P]),(0,w.r)(null==U?void 0:U.project_id,k.author_id,N.user_id))?null:(0,r.jsxs)(g.Vq,{open:I,onOpenChange:P,children:[E&&(0,r.jsx)(g.hg,{asChild:!0,children:E}),(0,r.jsxs)(g.cZ,{onClick:e=>e.stopPropagation(),className:"gap-4! overflow-visible border-transparent bg-transparent shadow-none backdrop-blur-none",children:[(0,r.jsxs)(g.a7,{className:"shadow-md!",children:[(0,r.jsxs)(g.fK,{children:[(0,r.jsx)(g.$N,{children:"Share This Agent"}),(0,r.jsx)(g.Be,{children:"Sharing this agent will allow other users to chat with it and edit its configuration, settings, and view their chat history with it."})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,r.jsx)(j,{sharedUsers:R,setSharedUsers:T,searchableItemsLoading:L||!z,agent:k,userProfile:N,idToken:M}),(0,r.jsx)(h.Z,{}),(0,r.jsx)(C.Z,{label:"General Access",disabled:L||J.isPending,defaultValue:(null==z?void 0:null===(a=z.general_access)||void 0===a?void 0:a.access_type)||(U?"workspace":"restricted"),onCallback:Y,options:(0,A.K)(A.A.CUSTOM_AGENT,null==U?void 0:U.project_name,null==N?void 0:null===(i=N.organization)||void 0===i?void 0:i.organization_name,N.is_sharing_public_flows_and_interfaces_restricted)})]})]}),(null==$?void 0:$.filter(e=>!e.hidden).length)>0&&(0,r.jsx)("div",{className:"bg-muted flex flex-col gap-1 rounded-lg border p-1.5 shadow-md",children:null==$?void 0:$.filter(e=>!e.hidden).map(e=>(0,r.jsxs)(m.zx,{onClick:e.onClick,className:"hover:bg-background text-foreground flex h-10 w-full flex-grow items-center justify-start gap-2",variant:"muted",children:[(0,r.jsx)(e.Icon,{})," ",e.label]},e.label))})]})]})}},7145:function(e,a,i){var r=i(67294);let s=r.forwardRef(function(e,a){let{title:i,titleId:s,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":s},n),i?r.createElement("title",{id:s},i):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"}))});a.Z=s}}]);