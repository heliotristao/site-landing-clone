(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2231,1162],{55324:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pipeline",function(){return r(26666)}])},26666:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u8}});var a,s,n,l,o,i,d,c,u,m,p,x,h,g,f,v,j,b,_,y,w,N,k,C,I,T,S=r(85893),E=r(34849),M=r(23834),A=r(48491),O=r(53985),Z=r(69245),z=r(94364),P=r(79316),D=r(20313),L=r(62539),R=r(34376),F=r(69696),G=r(13526),U=r(62685),B=r(45966),V=r(7485),W=r(94843),H=r(93713),J=r(45788),q=r(50536),K=r(67294),Y=r(9008),$=r.n(Y),Q=r(41248),X=r(64712),ee=r(10198),et=r(16215),er=r(4270),ea=r(41664),es=r.n(ea),en=r(27379),el=r(29876),eo=r(42414),ei=r(35718),ed=r(90273),ec=r(45837),eu=r(18998),em=r(19079),ep=e=>{var t;let{adminEmails:r}=e,[a,s]=(0,K.useState)(null!==(t=null==r?void 0:r[0])&&void 0!==t?t:""),[n,l]=(0,K.useState)(!1),[o,i]=(0,K.useState)(!1),[d,c]=(0,K.useState)(null),{userProfile:u,idTokenRef:m}=(0,K.useContext)(ec.f),p=(0,en.useSearchParams)(),{setIsUserSignInModalOpen:x}=(0,ec.H)(),h=p.get("workbook_id"),g=async()=>{try{c(null),l(!0),await (0,ed.eN)("/request_flowbook_access",u,m.current,"POST",{flowbook_id:h,admin_email:a}),i(!0)}catch(e){c(e instanceof Error?e.message:String(e))}finally{l(!1)}},f=u.isLoggedIn()?o?ex.REQUEST_SENT:h?ex.HAS_FLOWBOOK_ID:ex.DEFAULT:ex.NOT_LOGGED_IN;return(0,S.jsx)(em.$,{title:eh[f].title,description:eh[f].subtitle,markHref:"/hub",children:h&&!o&&u.isLoggedIn()?(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)("div",{className:"flex w-full flex-col items-center gap-4",children:[r&&(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)("label",{htmlFor:"admin-email",children:"Request access from:"}),(0,S.jsx)(ei.Z,{options:r.map(e=>({label:e,value:e})),onChange:e=>s(e),value:a})]}),(0,S.jsx)(el.zx,{onClick:g,disabled:n,children:n?"Sending...":"Request Access"})]}),d&&(0,S.jsx)("p",{className:"text-destructive-foreground",children:d})]}):(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(el.zx,{asChild:!0,variant:"outline",size:"lg",className:"flex items-center gap-2",children:(0,S.jsxs)(es(),{href:"/hub",children:[(0,S.jsx)(et.Z,{className:"h-4 w-4"}),"Go to Hub"]})}),f===ex.NOT_LOGGED_IN?(0,S.jsx)(el.zx,{size:"lg",className:"flex items-center gap-2",onClick:()=>x(!0),children:"Get Started"}):(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!u.is_flow_modification_restricted,className:(0,eu.cn)(u.is_flow_modification_restricted&&"cursor-not-allowed"),children:(0,S.jsx)(el.zx,{asChild:!u.is_flow_modification_restricted,disabled:u.is_flow_modification_restricted,size:"lg",className:"flex items-center gap-2",children:(0,S.jsxs)(es(),{href:"/pipeline",className:"flex shrink-0 items-center gap-2",children:[(0,S.jsx)(er.Z,{className:"h-4 w-4"}),"Create Flow"]})})}),u.is_flow_modification_restricted&&(0,S.jsx)(eo._v,{children:"Flow creation has been restricted by your admin."})]})]})})};let ex={NOT_LOGGED_IN:"NOT_LOGGED_IN",REQUEST_SENT:"REQUEST_SENT",HAS_FLOWBOOK_ID:"HAS_FLOWBOOK_ID",DEFAULT:"DEFAULT"},eh={[ex.NOT_LOGGED_IN]:{title:"Please sign in to request access",subtitle:"You do not have the permissions to view this workflow."},[ex.REQUEST_SENT]:{title:"Your access request has been sent",subtitle:"Please wait for the owner to approve your request."},[ex.HAS_FLOWBOOK_ID]:{title:"Request access to this workflow",subtitle:"Request access from an owner, or switch to an account that has access."},[ex.DEFAULT]:{title:"No access to this workflow",subtitle:"Please switch to an account that has access."}};var eg=r(62266),ef=r(73793),ev=r(73920),ej=r(75669),eb=r(57939),e_=r(8698);let ey={AGENT_ID:"agent_id",FLOW_ID:"flow_id",FOLDER_ID:"folder_id",PUBLISH_TEMPLATE:"publish_template",RUN_ID:"run_id",TEMPLATE:"template",WORKBOOK_ID:"workbook_id",VERSION_ID:"version_id",TAB:"tab"};(a=f||(f={})).PREVIEW="preview",a.GUMMIE="gummie",a.DEFAULT="default",a.TEMPLATE="template";let ew=(0,e_.P1)([A.$g,R.Zy,R.$f],(e,t,r)=>(function(e){let{gummieActive:t,isViewingVersionHistory:r,isTemplateOpen:a}=e;return t?f.GUMMIE:r?f.PREVIEW:!0===a?f.TEMPLATE:f.DEFAULT})({gummieActive:e,isViewingVersionHistory:t,isTemplateOpen:r}));var eN=r(2164),ek=r(28691),eC=r(88212),eI=r(23279),eT=r.n(eI),eS=r(18446),eE=r.n(eS),eM=r(11163),eA=r(7597),eO=r.n(eA),eZ=r(90245),ez=r(22495),eP=r(41011),eD=r(12220),eL=r(92385),eR=r(78865),eF=r(18289),eG=r(71707),eU=r(71424),eB=r(14142),eV=r(41999),eW=r(16538),eH=r(61268),eJ=r(49838),eq=r(7161),eK=r(54178),eY=r(78244),e$=r(74598),eQ=r(98150),eX=r(30671),e0=r(97257);function e1(e){var t;return null!==(t=({[eY.ZI.RESTRICTED]:0,[eY.ZI.WORKSPACE]:1,[eY.ZI.ORGANIZATION]:2,[eY.ZI.ANYONE]:3})[e])&&void 0!==t?t:0}var e2=r(94356),e5=r(5197),e4=(0,K.memo)(e=>{var t,r;let{open:a,setOpen:s,impactData:n,onConfirm:l,onCancel:o,confirmButtonProps:i,cancelButtonProps:d}=e;return(0,S.jsx)(eQ.Z,{open:a,setOpen:s,title:"Delete ".concat(null!==(t=null==n?void 0:n.count)&&void 0!==t?t:0," ").concat((0,e5.Ri)(null!==(r=null==n?void 0:n.count)&&void 0!==r?r:0,"subscription"),"?"),description:(0,S.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,S.jsx)("p",{children:"Continuing will permanently delete subscriptions created by users who will lose access. This action cannot be undone."}),n&&n.users.length>0&&(0,S.jsxs)("ul",{className:"list-inside text-sm",children:[(0,S.jsx)("p",{className:"text-foreground pb-2 text-sm font-medium",children:"Impacted Users"}),n.users.map((e,t)=>(0,S.jsxs)("li",{className:"flex items-center gap-2",children:[(0,S.jsx)(e2.Z,{name:e.name,src:e.profile_picture,className:"size-5 flex-none rounded text-[10px]"})," ",e.email]},t))]})]}),onConfirm:l,onCancel:o,confirmButtonProps:{text:"Continue",variant:"destructive-gradient",...i},cancelButtonProps:{text:"Cancel",...d}})}),e3=r(41491),e9=r(39514),e6=(0,K.memo)(e=>{var t;let{data:{workbook:{general_access:r},interface:{general_access:a}},state:{isUpdating:s,interface:{isLoading:n}},actions:{interface:{updateGeneralAccess:l,checkAccessImpact:o,handleWorkflowAccess:i,refetch:d}}}=e,{currentProject:c}=(0,e0.d2)(),{userProfile:u}=(0,ec.H)(),m=(0,Q.v9)(R.AV),p=(0,Q.v9)(e=>(0,G.jy)(e,m)),x=(0,Q.v9)(G.J$),[h,g]=(0,K.useState)(!1),[f,v]=(0,K.useState)(null),[j,b]=(0,K.useState)(!1),[_,y]=(0,K.useState)(null),w=async(e,t)=>{var s;if(!p)return!1;let n=e1(a.access_type),i=e1(e),c=e1(r.access_type);if(x&&i>c&&!(n>c))return v({accessType:e,organizationId:t}),g(!0),!1;if(s=a.access_type,e1(e)<e1(s)){let r=await o(e,t);if(r&&r.impacted_users_count>0)return y({count:r.impacted_users_count,users:r.impacted_users}),v({accessType:e,organizationId:t}),b(!0),!1}try{return await l(e,t),d(),!0}catch(e){return X.Am.error(e.message||"Failed to update interface access"),!1}},N=async()=>{var e;if(!f||!p)return;g(!1);let{accessType:t,organizationId:r}=f;if(e=a.access_type,e1(t)<e1(e)){let e=await o(t,r);if(e&&e.impacted_users_count>0){y({count:e.impacted_users_count,users:e.impacted_users}),b(!0);return}}try{await l(t,r),null==d||d(),v(null)}catch(e){X.Am.error(e.message||"Failed to update interface access")}},k=async()=>{if(!f||!p)return;b(!1);let{accessType:e,organizationId:t}=f;try{await l(e,t),null==d||d(),v(null)}catch(e){X.Am.error(e.message||"Failed to update interface access")}};return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,S.jsx)(e3.Z,{label:"Interface Access",disabled:n||!!s.interfaceGeneralAccess||"interface"===s.checkingImpact,defaultValue:a.access_type,onCallback:w,options:(0,e9.K)(e9.A.INTERFACE,null==c?void 0:c.project_name,null==u?void 0:null===(t=u.organization)||void 0===t?void 0:t.organization_name,u.is_sharing_public_flows_and_interfaces_restricted)}),(0,S.jsxs)("div",{className:"flex w-full justify-between pt-2",children:[(0,S.jsxs)("div",{className:"flex items-center gap-1",children:[(0,S.jsx)("p",{className:"text-muted-foreground text-sm",children:"Allow workflow access from interface?"}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{children:(0,S.jsx)(e$.Z,{className:"text-muted-foreground ml-1 size-3"})}),(0,S.jsx)(eo._v,{children:"If enabled, there will be a 'View Flow' button on the interface, allowing users to see the contents of this flow."})]})]}),(0,S.jsx)(eX.r,{checked:null==p?void 0:p.allow_workflow_access,onCheckedChange:e=>i(e),disabled:n||!!s.interfaceWorkflowAccess})]}),(0,S.jsx)(eQ.Z,{open:h,setOpen:g,title:"Subscriptions may not work as expected",description:"You are setting interface access higher than workbook access. Users who do not have access to the workbook will not be able to use subscriptions.",onConfirm:N,onCancel:()=>{g(!1),v(null)},confirmButtonProps:{text:"Continue"},cancelButtonProps:{text:"Cancel"}}),(0,S.jsx)(e4,{open:j,setOpen:b,impactData:_,onConfirm:k,onCancel:()=>{b(!1),v(null)}})]})})}),e8=r(47084),e7=r(44046),te=r(11431),tt=r(30240),tr=r(4307),ta=r(97387),ts=e=>{let{savedItemId:t}=e,{userProfile:r}=(0,ec.H)(),a=(0,ez.TL)(),s=(0,ez.CG)(e=>(0,G.jy)(e,t)),n=(0,ez.CG)(R.aN),{isCopied:l,handleCopyText:o}=(0,eB.Z)(s?eV.Form.getShareableUrl(null==s?void 0:s.form_id,null==s?void 0:s.title):""),{isCopied:i,handleCopyText:d}=(0,eB.Z)(window.location.href),c=!n||n.creator_user_id===r.user_id;return(0,S.jsxs)("div",{className:"bg-muted flex flex-col gap-1 rounded-lg border p-1.5 shadow-md",children:[c&&(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(eq.GG,{asChild:!0,children:(0,S.jsx)(tn,{label:n?"Edit Template":"Create Template",Icon:e8.Z,onClick:()=>{a((0,D.wW)(!0))}})}),(0,S.jsx)(ta.Z,{})]}),(0,S.jsx)(tn,{label:i?"Copied to clipboard":"Copy Workbook Link",Icon:i?e7.Z:eF.Z,onClick:d,showChevron:!1}),s&&(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(ta.Z,{}),(0,S.jsx)(tn,{label:l?"Copied to clipboard":"Copy Interface Link",Icon:l?te.Z:tt.Z,onClick:o,showChevron:!1})]})]})};let tn=e=>{let{label:t,Icon:r,onClick:a,className:s,showChevron:n=!0,children:l,...o}=e;return(0,S.jsxs)(el.zx,{onClick:a,variant:"muted",className:(0,eu.cn)("hover:bg-background h-10 w-full items-center",s),...o,children:[(0,S.jsxs)("div",{className:"text-foreground flex flex-grow items-center gap-2",children:[(0,S.jsx)(r,{}),t]}),n&&(0,S.jsx)(tr.Z,{})]})};var tl=r(26824),to=r(42171),ti=r(19975),td=e=>{let{value:t,setValue:r,placeholder:a="Search users",className:s,showOwnEmail:n=!1,...l}=e,{userProfile:o}=(0,K.useContext)(ec.f),[i,d]=(0,K.useState)([]),[c,u]=(0,K.useState)(!1),m=(0,K.useRef)(null);(0,K.useEffect)(()=>{(null==o?void 0:o.organization)&&d(o.organization.members.concat(o.organization.admins).map(e=>e.user_email).filter(e=>!!n||e!==o.user_email))},[n,o]),(0,K.useEffect)(()=>{let e=e=>{m.current&&!m.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let p=i.filter(e=>e.toLowerCase().includes(t.toLowerCase()));return(0,S.jsxs)("div",{ref:m,className:"w-full ".concat(s||""),children:[(0,S.jsx)(ti.Z,{onSearch:r,placeholder:a,onChange:()=>u(!0),debounceTime:0,value:t,...l}),c&&p.length>0&&(0,S.jsx)("ul",{className:"border-border bg-background absolute right-0 left-0 z-50 mx-6 mt-1 max-h-60 overflow-auto rounded-lg border shadow-lg",children:p.map((e,t)=>(0,S.jsx)("li",{className:"hover:bg-muted cursor-pointer px-4 py-2",onClick:()=>{r(e),u(!1)},children:e},t+e))})]})},tc=r(30010),tu=r(61857);let tm=e=>{let{email:t,accessType:r,onRemove:a,isLoading:s}=e,{userProfile:n}=(0,ec.H)();return(0,S.jsxs)("div",{className:"group flex items-center justify-between gap-2 rounded-md py-1",children:[(0,S.jsxs)("div",{className:"flex items-center justify-center text-sm",children:[t,t===n.user_email?" (you)":""]}),r!==eY.nl.OWNER?(0,S.jsx)("div",{className:"ml-auto flex flex-row items-center gap-1",children:(0,S.jsxs)(tc.h_,{children:[(0,S.jsx)(tc.$F,{asChild:!0,children:(0,S.jsxs)(eU.C,{variant:"muted",className:"cursor-pointer",children:["Viewer",(0,S.jsx)(to.Z,{size:12})]})}),(0,S.jsxs)(tc.AW,{align:"end",className:"w-60 p-1",children:[(0,S.jsxs)(tc.Xi,{className:"text-foreground focus:text-foreground flex items-center justify-between",children:[(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("span",{children:"Viewer"}),(0,S.jsx)("span",{className:"text-muted-foreground text-xs",children:"Cannot edit or share with others."})]}),r===eY.nl.VIEWER&&(0,S.jsx)(eR.Z,{size:16})]}),(0,S.jsx)(tc.Xi,{onClick:a,className:"text-destructive-foreground focus:bg-destructive/50 focus:text-destructive-foreground",disabled:s,children:"Remove access"})]})]})}):(0,S.jsx)(eU.C,{variant:"accent",children:"Owner"})]})},tp=()=>(0,S.jsxs)("div",{className:"group flex h-fit items-center justify-between gap-2 rounded-md",children:[(0,S.jsx)("div",{className:"flex items-center justify-center text-sm",children:(0,S.jsx)(tu.O,{className:"h-5 w-48"})}),(0,S.jsx)("div",{className:"ml-auto flex flex-row items-center gap-2",children:(0,S.jsx)(tu.O,{className:"h-6 w-16"})})]});var tx=(0,K.memo)(e=>{var t;let{data:{workbook:r,interface:a},state:{isUpdating:s,workbook:{isLoading:n}},actions:{addSharedUser:l,removeSharedUser:o,workbook:{updateGeneralAccess:i,checkAccessImpact:d,refetch:c}},flowbookId:u}=e,m=(0,en.useSearchParams)(),{currentProject:p}=(0,e0.d2)(),{userProfile:x}=(0,ec.H)(),h=(0,ez.TL)(),g=(0,ez.CG)(R.AV),f=m.get("share_email"),[v,j]=(0,K.useState)(f||""),[b,_]=(0,K.useState)(!1),[y,w]=(0,K.useState)(null),[N,k]=(0,K.useState)(!1),[C,I]=(0,K.useState)(null),T=(0,Q.v9)(G.J$),E=(0,ez.CG)(R.aN),M=!!(null==E?void 0:E.status)&&E.status!==tl.C.DRAFT,A=!(null==E?void 0:E.organization_id),O=async(e,t)=>{var s;if(!u)return!1;let n=e1(r.general_access.access_type),l=e1(e),o=e1(a.general_access.access_type);if(T&&l<o&&!(n<o))return w({accessType:e,organizationId:t}),_(!0),!1;if(s=r.general_access.access_type,e1(e)<e1(s)){let r=await d(e,t);if(r&&r.impacted_users_count>0)return I({count:r.impacted_users_count,users:r.impacted_users}),w({accessType:e,organizationId:t}),k(!0),!1}try{return await i(e,t),c(),h(eN.UX.util.invalidateTags([{type:"Triggers",id:g}])),!0}catch(e){return X.Am.error(e.message||"Failed to update workbook access"),!1}},Z=async()=>{var e;if(!y||!u)return;_(!1);let{accessType:t,organizationId:a}=y;if(e=r.general_access.access_type,e1(t)<e1(e)){let e=await d(t,a);if(e&&e.impacted_users_count>0){I({count:e.impacted_users_count,users:e.impacted_users}),k(!0);return}}try{await i(t,a),c(),w(null)}catch(e){X.Am.error(e.message||"Failed to update workbook access")}},z=async()=>{if(!y||!u)return;k(!1);let{accessType:e,organizationId:t}=y;try{await i(e,t),c(),w(null)}catch(e){X.Am.error(e.message||"Failed to update workbook access")}};return(0,S.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,S.jsxs)(eq.fK,{className:"flex flex-col space-y-1",children:[(0,S.jsx)(eq.$N,{className:"leading-tight",children:"Share This Workbook"}),(0,S.jsx)(eq.Be,{children:"Control who can view this workbook."})]}),(0,S.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,S.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,S.jsx)(td,{placeholder:"Share with...",value:v,setValue:j,onKeyDown:async e=>{"Enter"===e.key&&await l(v)&&j("")},autoComplete:"off",disabled:n||"add"===s.action}),(0,S.jsx)(el.zx,{variant:"secondary",type:"submit",disabled:n||!v,onClick:async()=>{await l(v.trim())&&j("")},loading:"add"===s.action,children:"Add"})]}),n&&(0,S.jsx)(tp,{}),!n&&Object.entries(r.users).length>0&&(0,S.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,S.jsx)("p",{className:"text-sm font-medium",children:"Who has access"}),(0,S.jsx)("div",{className:"max-h-36 overflow-y-auto mask-y-from-95%",children:Object.entries(r.users).map(e=>{let[t,r]=e;return(0,S.jsx)(tm,{email:t,accessType:r,onRemove:()=>o(t),isLoading:s.email===t&&"remove"===s.action},t)})})]}),(0,S.jsx)(ta.Z,{className:"bg-muted"}),(0,S.jsx)(e3.Z,{label:"General Access",disabled:n||!!s.workbookGeneralAccess||"workbook"===s.checkingImpact,defaultValue:r.general_access.access_type,onCallback:O,options:(0,e9.K)(e9.A.WORKBOOK,null==p?void 0:p.project_name,null==x?void 0:null===(t=x.organization)||void 0===t?void 0:t.organization_name,x.is_sharing_public_flows_and_interfaces_restricted,M,A)})]}),(0,S.jsx)(eQ.Z,{open:b,setOpen:_,title:"Subscriptions may not work as expected",description:"You are setting workbook access lower than interface access. Users who do not have access to the workbook will not be able to subscribe to your flow.",onConfirm:Z,onCancel:()=>{_(!1),w(null)},confirmButtonProps:{text:"Continue"},cancelButtonProps:{text:"Cancel"}}),(0,S.jsx)(e4,{open:N,setOpen:k,impactData:C,onConfirm:z,onCancel:()=>{k(!1),w(null)},confirmButtonProps:{text:"Delete and Update"}})]})});let th=e=>{let{open:t,onOpenChange:r,children:a}=e,[s,n]=(0,eK.P)({open:t,onOpenChange:r}),l=(0,ez.CG)(R.LA),o=(0,ez.CG)(eb.ts),i=(0,eY.ZP)(l),d=(0,ez.CG)(e=>(0,G.jy)(e,o)),c=(0,en.useSearchParams)(),u=c.get("share_email"),m=(0,K.useCallback)(()=>{if(!c)return;let e=new URLSearchParams(c.toString());e.delete("share_email"),window.history.replaceState({},"","?".concat(e))},[c]);return(0,K.useEffect)(()=>{u&&(n(!0),m())},[u,m,n]),(0,S.jsxs)(eq.Vq,{open:s,onOpenChange:n,children:[a&&(0,S.jsx)(eq.hg,{asChild:!0,children:a}),(0,S.jsxs)(eq.cZ,{className:"max-w-xl! gap-4 overflow-visible border-transparent bg-transparent shadow-none backdrop-blur-none",children:[(0,S.jsxs)(eq.a7,{className:"shadow-md",children:[(0,S.jsx)(tx,{...i,flowbookId:null==l?void 0:l.flowbook_id}),d&&(0,S.jsx)(e6,{...i})]}),o&&(0,S.jsx)(ts,{savedItemId:o})]})]})};th.displayName="ShareDialog";var tg=(0,K.memo)(th),tf=r(52542),tv=r(54947),tj=r(97757),tb=r(23432),t_=r(62190),ty=r(25675),tw=r.n(ty),tN=r(86501),tk=r(72679);r(98563);var tC=r(87900),tI=r(45286),tT=r(1365),tS=r(85912);let tE={Abstract:["https://images.unsplash.com/photo-1541701494587-cb58502866ab","https://images.unsplash.com/photo-1550859492-d5da9d8e45f3","https://images.unsplash.com/photo-1567095761054-7a02e69e5c43","https://images.unsplash.com/photo-1579546929518-9e396f3cc809"],Nature:["https://images.unsplash.com/photo-1472214103451-9374bd1c798e","https://images.unsplash.com/photo-1501854140801-50d01698950b","https://images.unsplash.com/photo-1441974231531-c6227db76b6e","https://images.unsplash.com/photo-1426604966848-d7adac402bff"],Gradients:["https://images.unsplash.com/photo-1557682250-33bd709cbe85","https://images.unsplash.com/photo-1557682224-5b8590cd9ec5","https://images.unsplash.com/photo-1557682260-96773eb01377","https://images.unsplash.com/photo-1557682268-e3955ed5d83f"]},tM=e=>{let{isOpen:t,onClose:r,setHeaderImage:a}=e,{userProfile:s,idTokenRef:n}=(0,K.useContext)(ec.f),[l,o]=(0,K.useState)("search"),[i,d]=(0,K.useState)([]),[c,u]=(0,K.useState)(),[m,p]=(0,K.useState)(!1),[x,h]=(0,K.useState)(""),[g,f]=(0,K.useState)(null),[v,j]=(0,K.useState)(!1),[b,_]=(0,K.useState)(0);(0,K.useEffect)(()=>{let e;return v?(_(0),e=setInterval(()=>{_(t=>t>=100?(clearInterval(e),100):t+.5)},100)):_(0),()=>{e&&clearInterval(e)}},[v]);let y=(0,K.useCallback)(async e=>{if(!e){d([]);return}try{p(!0);let t=await (0,ed.eN)("get_header_image_search_results?query=".concat(encodeURIComponent(e)),s,n.current,"GET");d(t)}catch(e){tN.ZP.error(e.message)}finally{p(!1)}},[s,n]),w=(0,K.useCallback)(async e=>{try{(0,ed.eN)("use_unsplash_image?download_location=".concat(encodeURIComponent(e.download_location)),s,n.current,"GET"),a(e.photo_url)}catch(e){tN.ZP.error(e.message)}},[s,n,a]),N=(0,K.useCallback)(async()=>{if(x)try{j(!0);let e=await (0,ed.eN)("get_header_ai_image_results?query=".concat(encodeURIComponent(x)),s,n.current,"GET");f(e)}catch(e){tN.ZP.error(e.message)}finally{j(!1)}},[x,s,n]),k=(0,K.useMemo)(()=>(0,S.jsxs)("div",{className:"p-4",children:[(0,S.jsx)("h3",{className:"mb-2 text-sm font-medium",children:"Image generator"}),(0,S.jsxs)("div",{className:"flex gap-2 ".concat(!g||v?"":"mb-4"),children:[(0,S.jsx)(tC.I,{value:x,onChange:e=>h(e.target.value),placeholder:"Describe what you want to generate...",className:"flex-1",onKeyDown:e=>{"Enter"===e.key&&!v&&x&&N()}}),(0,S.jsx)("button",{onClick:N,disabled:v||!x,className:"flex items-center gap-2 rounded-lg bg-pink-600 px-4 py-2 text-white hover:bg-pink-700 disabled:opacity-50",children:v?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(tb.Z,{className:"h-4 w-4 animate-spin"}),"Generating"]}):"Generate"})]}),v&&(0,S.jsx)("div",{className:"mt-4",children:(0,S.jsx)("div",{className:"h-2.5 w-full rounded-full bg-gray-200",children:(0,S.jsx)("div",{className:"h-2.5 rounded-full bg-pink-600 transition-all duration-100",style:{width:"".concat(b,"%")}})})}),g&&!v&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("h3",{className:"mb-2 text-sm font-medium",children:"Generated image"}),(0,S.jsxs)("div",{className:"relative aspect-[16/9] cursor-pointer overflow-hidden rounded-lg bg-gray-100",onClick:()=>a(g),children:[(0,S.jsx)(tw(),{src:g,alt:"AI Generated",className:"h-full w-full object-cover",fill:!0}),(0,S.jsx)(el.zx,{variant:"outline",className:"absolute right-2 bottom-2",children:"Select as banner"})]})]})]}),[x,g,v,N,a,b]),C=(0,K.useMemo)(()=>(0,S.jsxs)("div",{className:"p-4",children:[(0,S.jsxs)("div",{className:"mb-4",children:[(0,S.jsx)("h3",{className:"mb-2 text-sm font-medium",children:"Search"}),(0,S.jsx)(ti.Z,{onSearch:y,placeholder:"Search for images from unsplash...",debounceTime:500})]}),(0,S.jsx)("div",{className:"mb-8 grid grid-cols-4 gap-3",children:m?Array.from({length:24}).map((e,t)=>(0,S.jsx)("div",{className:"aspect-[16/9]",children:(0,S.jsx)(tT.Z,{count:1,contentLines:0,className:"h-[4rem] w-[7rem]"})},t)):i.map((e,t)=>(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("div",{className:"group relative aspect-[16/9] cursor-pointer",onClick:()=>w(e),children:(0,S.jsx)("img",{src:e.photo_url,alt:"Search result",className:"h-full w-full rounded-lg object-cover transition-opacity hover:opacity-90"})}),(0,S.jsxs)("div",{className:"text-muted-foreground mt-1 text-xs",children:["By"," ",(0,S.jsx)("a",{href:e.user_profile_url,target:"_blank",rel:"noopener noreferrer",className:"text-muted-foreground underline hover:text-gray-900",children:e.user_name})]})]},t))}),(0,S.jsxs)("div",{children:[(0,S.jsx)("h3",{className:"mb-2 text-sm font-medium",children:"Or choose from gallery"}),Object.entries(tE).map(e=>{let[t,r]=e;return(0,S.jsxs)("div",{className:"mb-4",children:[(0,S.jsx)("h4",{className:"text-muted-foreground mb-2 text-xs",children:t}),(0,S.jsx)("div",{className:"grid grid-cols-4 gap-3",children:r.map((e,r)=>(0,S.jsx)("div",{className:"aspect-[16/9] cursor-pointer overflow-hidden rounded-lg bg-gray-100",onClick:()=>a(e),children:(0,S.jsx)(tk.LazyLoadImage,{src:e,alt:t,effect:"blur",className:"h-full w-full object-cover",threshold:100,placeholderSrc:"".concat(e,"?w=10")})},r))})]},t)})]})]}),[i,m,y,a]),I=(0,K.useMemo)(()=>(0,S.jsxs)("div",{className:"p-4",children:[(0,S.jsx)("h3",{className:"mb-2 text-sm font-medium",children:"Upload an image"}),(0,S.jsx)(tI.Z,{userProfile:s,existingFile:c,setFile:e=>{u(e),(null==e?void 0:e.file_url)&&a(e.file_url)},allowedFileTypes:tS.K,isDisabled:!1,returnFileLink:!0})]}),[s,c,a]),T=(0,K.useCallback)(()=>{switch(l){case"ai":return k;case"search":return C;case"upload":return I}},[l,k,C,I]);return t?(0,S.jsxs)("div",{className:"bg-background absolute top-20 left-1/2 z-50 w-3/4 -translate-x-1/2 rounded-lg border shadow-lg",style:{maxHeight:"80vh"},children:[(0,S.jsxs)("div",{className:"relative flex gap-2 border-b p-2",children:[(0,S.jsx)("button",{onClick:r,className:"hover:bg-muted absolute top-2 right-2 rounded-full p-1","aria-label":"Close menu",children:(0,S.jsx)(t_.Z,{className:"text-muted-foreground h-4 w-4"})}),(0,S.jsx)("button",{className:"rounded-full px-4 py-2 text-sm font-medium ".concat("search"===l?"bg-pink-50 text-pink-600":"text-muted-foreground hover:bg-gray-50"),onClick:()=>o("search"),children:"Search & Gallery"}),(0,S.jsx)("button",{className:"rounded-full px-4 py-2 text-sm font-medium ".concat("ai"===l?"bg-pink-50 text-pink-600":"text-muted-foreground hover:bg-gray-50"),onClick:()=>o("ai"),children:"Generate with AI"}),(0,S.jsx)("button",{className:"rounded-full px-4 py-2 text-sm font-medium ".concat("upload"===l?"bg-pink-50 text-pink-600":"text-muted-foreground hover:bg-gray-50"),onClick:()=>o("upload"),children:"Upload"})]}),(0,S.jsx)("div",{className:"overflow-y-auto",style:{maxHeight:"calc(80vh - 56px)"},children:T()})]}):null};var tA=r(82277);let tO=e=>{let{isOpen:t,onClose:r,setIcon:a}=e,{userProfile:s}=(0,K.useContext)(ec.f),[n,l]=(0,K.useState)("emoji"),[o,i]=(0,K.useState)();return t?(0,S.jsxs)("div",{className:"bg-background absolute top-full left-0 z-50 mt-2 w-[400px] rounded-lg border shadow-lg",children:[(0,S.jsxs)("div",{className:"relative flex gap-2 border-b p-2",children:[(0,S.jsx)("button",{onClick:r,className:"absolute top-2 right-2 rounded-full p-1 hover:bg-gray-100","aria-label":"Close menu",children:(0,S.jsx)(t_.Z,{className:"text-muted-foreground h-4 w-4"})}),(0,S.jsx)("button",{className:"rounded-full px-4 py-2 text-sm font-medium ".concat("emoji"===n?"bg-pink-50 text-pink-600":"text-muted-foreground hover:bg-gray-50"),onClick:()=>l("emoji"),children:"Emoji"}),(0,S.jsx)("button",{className:"rounded-full px-4 py-2 text-sm font-medium ".concat("upload"===n?"bg-pink-50 text-pink-600":"text-muted-foreground hover:bg-gray-50"),onClick:()=>l("upload"),children:"Upload"})]}),(0,S.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:"emoji"===n?(0,S.jsx)("div",{children:(0,S.jsx)(tA.ZP,{onEmojiClick:e=>{a(e.emoji),r()},autoFocusSearch:!1,width:"100%",height:350,searchPlaceholder:"Search emoji...",previewConfig:{showPreview:!1},skinTonesDisabled:!0,style:{border:"none"},className:"[--epr-active-category-label-bg-color:rgba(236,72,153,0.1)] [--epr-active-category-label-color:rgb(236,72,153)] [--epr-category-label-bg-color:white] [--epr-focus-bg-color:rgba(236,72,153,0.1)] [--epr-hover-bg-color:rgba(236,72,153,0.1)]"})}):(0,S.jsx)("div",{className:"p-4",children:(0,S.jsx)(tI.Z,{userProfile:s,existingFile:o,setFile:e=>{i(e),(null==e?void 0:e.file_url)&&(a(e.file_url),r())},allowedFileTypes:tS.K,isDisabled:!1,returnFileLink:!0})})})]}):null};var tZ=r(53334),tz=r(68262);function tP(e,t,r){let a=e.user_id===t,s=!!r&&e.project_id===r;return a||s}function tD(e,t,r){return e.filter(e=>!tP(e,t,r))}var tL=r(15581),tR=r(65322),tF=r(25085),tG=r(82851),tU=r(86691),tB=r(23346),tV=r(57251),tW=r(43283),tH=r(54197),tJ=r(27636),tq=r(97818),tK=r(3033);let tY=[{type:"TextField",label:"Text field",icon:tL.Z,category:"input"},{type:"SelectDropdown",label:"Select dropdown",icon:tR.Z,category:"input"},{type:"MultiSelectDropdown",label:"Multi-select dropdown",icon:tF.Z,category:"input"},{type:"Checkbox",label:"Checkbox",icon:tG.Z,category:"input"},{type:"Email",label:"Email",icon:tU.Z,category:"input"},{type:"Date",label:"Date",icon:tB.Z,category:"input"},{type:"Number",label:"Number",icon:tV.Z,category:"input"},{type:"FileUpload",label:"File upload",icon:tW.Z,category:"input"},{type:"Heading",label:"Heading",icon:tH.Z,category:"structure"},{type:"Description",label:"Description",icon:tJ.Z,category:"structure"},{type:"Divider",label:"Divider",icon:tq.Z,category:"structure"},{type:"TriggerConfiguration",label:"Trigger Configuration",icon:tK.Z,category:"triggers"}],t$={input:tY.filter(e=>"input"===e.category),structure:tY.filter(e=>"structure"===e.category),triggers:tY.filter(e=>"triggers"===e.category)},tQ=e=>{let t={input_name:"",helper_text:"",is_required:!1,default:""},r={helper_text:""};switch(e){case"TextField":return{...t,type:"TextField",min_characters:void 0,max_characters:void 0,placeholder:"Enter text..."};case"SelectDropdown":return{...t,type:"SelectDropdown",options:["Option 1","Option 2","Option 3"],default:"Option 1"};case"MultiSelectDropdown":return{...t,type:"MultiSelectDropdown",options:["Option 1","Option 2","Option 3"],default:["Option 1"]};case"Checkbox":return{...t,default:"false",type:"Checkbox"};case"Email":return{...t,type:"Email",placeholder:"name@example.com"};case"Date":return{...t,type:"Date"};case"Number":return{...t,type:"Number",min_value:void 0,max_value:void 0,placeholder:"Ex. 500"};case"FileUpload":return{...t,type:"FileUpload"};case"Heading":return{...r,type:"Heading",content:"New Heading"};case"Description":return{...r,type:"Description",content:"Add your description here"};case"Divider":return{...r,type:"Divider"};case"TriggerConfiguration":return{type:"TriggerConfiguration"};default:return null}},tX=(e,t)=>{if(e.description&&e.description.length>1024)return tN.ZP.error("Description is too long. Please shorten it to save your changes."),!1;let r=new Map,a=[];return e.form_elements.forEach((e,t)=>{if("is_required"in e){var s;if(!(null===(s=e.input_name)||void 0===s?void 0:s.trim())){a.push(t);return}let n=e.input_name.trim().toLowerCase();r.has(n)?(a.push(t),a.push(r.get(n))):r.set(n,t)}}),!(a.length>0)||(t(!0),tN.ZP.error(a.some(t=>{var r;return!(null===(r=e.form_elements[t].input_name)||void 0===r?void 0:r.trim())})?"Please add labels to all input elements":"Input element labels must be unique"),!1)},t0={"in-slice-only":"Disabled on next save","in-pipeline-only":"Enabled on next save","in-both":null,"time-based":null};var t1=r(27466),t2=e=>{let{savedItemId:t,hasTriggerConfigElement:r,onToggle:a}=e,{userProfile:s}=(0,ec.H)(),n=(0,ez.TL)(),l=(0,ez.CG)(e=>(0,tZ.K)(e,t)),{currentProject:o}=(0,e0.d2)(),i=(0,ez.CG)(R.Sy),d=(0,ez.CG)(e=>(0,R.NT)(e,t));(0,K.useEffect)(()=>{i&&requestAnimationFrame(()=>{n((0,ej.To)({savedItemId:t}))})},[]);let c=(0,K.useMemo)(()=>(function(e){let{allActiveTriggers:t,sliceTriggers:r,savedItemId:a}=e,s=new Map;return r.forEach(e=>{let r="time_based"===e.trigger_type?a:e.node_id||"",n=t[r];"time_based"===e.trigger_type?s.set(r,{nodeId:e.node_id||"",type:e.trigger_type,event:e.event,status:"time-based"}):n?s.set(r,{nodeId:e.node_id||"",type:e.trigger_type,event:e.event,status:"in-both"}):s.set(r,{nodeId:e.node_id||"",type:e.trigger_type,event:e.event,status:"in-slice-only"})}),Object.entries(t).forEach(e=>{let[t,{type:r,event:n}]=e,l="time_based"===r?a:t;s.has(l)||s.set(l,{nodeId:t,type:r,event:n,status:"in-pipeline-only"})}),Array.from(s.values())})({allActiveTriggers:d,sliceTriggers:l,savedItemId:t}),[d,l,t]),u=(0,K.useMemo)(()=>0!==c.length&&c.every(e=>"in-slice-only"===e.status),[c]);(0,K.useEffect)(()=>{u&&r&&a(!1)},[u,r,a]);let m=(0,K.useMemo)(()=>Object.keys(d).length>0||l.some(e=>(null==o?void 0:o.project_id)?e.user_id===s.user_id||e.project_id===(null==o?void 0:o.project_id):e.user_id===s.user_id),[d,l,s.user_id,null==o?void 0:o.project_id]),p=(0,K.useMemo)(()=>tD(l,s.user_id,null==o?void 0:o.project_id),[l,s.user_id,null==o?void 0:o.project_id]).length,x=(0,K.useMemo)(()=>m||p>0,[m,p]),h=(0,K.useCallback)(e=>{a(e)},[a]);return x?(0,S.jsx)("div",{className:"px-4",children:(0,S.jsxs)("div",{className:"bg-card bg-muted flex flex-col gap-4 rounded-lg p-4",children:[(0,S.jsxs)("label",{className:"flex items-center justify-between gap-8",htmlFor:"allow-trigger-subscriptions-switch",children:[(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("p",{className:"text-foreground text-sm font-medium",children:m?"Allow Flow Subscriptions":"Flow Subscriptions are currently enabled"}),(0,S.jsxs)("p",{className:"text-muted-foreground text-sm",children:["Allow users to subscribe to the flow's triggers. Values they input in the interface will be used in the flow for each triggered run."," ",(0,S.jsx)(es(),{href:" https://docs.gumloop.com/core-concepts/flow_subscriptions ",target:"_blank",className:"underline hover:no-underline",children:"Learn more"})]})]}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{children:(0,S.jsx)(eX.r,{id:"allow-trigger-subscriptions-switch",checked:r,onCheckedChange:e=>h(e),disabled:u})}),u&&(0,S.jsx)(eo._v,{children:(0,S.jsx)("p",{children:"You must have an active trigger, or one that is enabled on next save"})})]})]}),!r&&p>0&&(0,S.jsxs)("p",{className:"bg-warning/50 text-warning-foreground border-warning-foreground/20 rounded-lg border p-3 text-sm",children:["On next save, you will disable ",p," ",(0,e5.Ri)(p,"subscription")," created by other users. This action cannot be undone."," ",(0,S.jsx)(es(),{href:" https://docs.gumloop.com/core-concepts/flow_subscriptions ",target:"_blank",className:"hover:text-warning-foreground/50 underline hover:no-underline",children:"Learn more."})]}),(0,S.jsx)("div",{className:"flex flex-col gap-2",children:c.map(e=>{let{nodeId:t,type:r,event:a,status:s}=e,n=t0[s];return(0,S.jsxs)("div",{className:"border-border bg-background flex items-center justify-between gap-2 rounded-md border p-2",children:[(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)(t1.Z,{triggerType:r,className:(0,eu.cn)("size-8 bg-transparent p-0","in-slice-only"===s||"in-pipeline-only"===s?"border-warning-foreground/20 bg-warning text-warning-foreground":"")}),(0,S.jsx)("div",{className:"flex flex-col",children:(0,S.jsx)("p",{className:"text-sm font-medium",children:tz.ZP[r]})})]}),n&&(0,S.jsx)("p",{className:"text-muted-foreground pr-2 text-xs italic",children:n})]},"".concat(t,"-").concat(r))})})]})}):null},t5=r(73063);let t4=()=>{let[e,t]=(0,K.useState)(!1),[r,a]=(0,K.useState)(null),s=(0,K.useRef)(null);(0,K.useEffect)(()=>{if(!e)return;let r=e=>{let r=e.target;!s.current||s.current.contains(r)||r.closest('[data-toolbar="rich-text"]')||r.closest("[data-radix-select-content]")||r.closest("[data-radix-select-viewport]")||r.closest("[data-radix-select-trigger]")||r.closest("[data-radix-select-item]")||r.closest("[data-radix-popper-content-wrapper]")||t(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[e]);let n=(0,K.useCallback)(e=>{a(e);let r=()=>{t(!0)};return e.on("focus",r),()=>{e.off("focus",r)}},[a,t]);return{isInputFocused:e,inputEditor:r,setInputEditor:a,inputAreaRef:s,onEditorReady:n}};var t3=r(15620),t9=e=>{let{editor:t,activeFormats:r=["bold"],selectedHeader:a="P",onFormatToggle:s,onHeaderChange:n,color:l,onColorChange:o,portalDialogs:i=!0}=e;return(0,S.jsx)("div",{className:"border-border bg-background flex w-fit items-center gap-1 rounded-lg border p-1.5 shadow-md","data-toolbar":"rich-text",children:(0,S.jsx)(t3.Z,{editor:t,activeFormats:r,selectedHeader:a,onFormatToggle:s,onHeaderChange:n,color:l,onColorChange:o,portalDialogs:i})})},t6=r(25218),t8=e=>{let{form:t,onUpdate:r,onClose:a,isFormBuilderOpen:s}=e,n=(0,t5.Z)(),l=(0,ez.CG)(e=>(0,R.NT)(e,t.saved_item_id)),[o,i]=(0,K.useState)(!1),[d,c]=(0,K.useState)(!1),[u,m]=(0,K.useState)(t.title||""),[p,x]=(0,K.useState)(t.description||""),[h,g]=(0,K.useState)(!1),f=(0,K.useMemo)(()=>t.form_elements.some(e=>"TriggerConfiguration"===e.type),[t.form_elements]),{isInputFocused:v,inputEditor:j,inputAreaRef:b,onEditorReady:_}=t4(),y=(e,r)=>{var a;return!!o&&"is_required"in e&&(null===(a=e.input_name)||void 0===a||!a.trim()||t.form_elements.some((t,a)=>{var s,n;return a!==r&&"is_required"in t&&(null===(s=t.input_name)||void 0===s?void 0:s.trim().toLowerCase())===(null===(n=e.input_name)||void 0===n?void 0:n.trim().toLowerCase())}))},w=(0,K.useCallback)(e=>{r({...t,...e})},[t,r]),N=(0,K.useCallback)(e=>{w({header_image:e}),C(!1)},[w]),[k,C]=(0,K.useState)(!1),[I,T]=(0,K.useState)(!1),E=(0,K.useCallback)(e=>{w({icon:e}),T(!1)},[w]),M=e=>{let{type:a,label:s,icon:n,index:l}=e,o=()=>{let e=tQ(a);e&&r({...t,form_elements:[...t.form_elements,e]})};return(0,S.jsx)(tv._l,{draggableId:a,index:l,children:(e,t)=>{var r;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{ref:e.innerRef,...e.draggableProps,...e.dragHandleProps,className:"bg-card hover:bg-muted/50 flex w-full cursor-pointer items-center justify-between gap-3 px-2 py-3",style:{...e.draggableProps.style,transform:t.isDragging?null===(r=e.draggableProps.style)||void 0===r?void 0:r.transform:"translate(0, 0)",background:t.isDragging?"color-mix(in oklab, var(--muted) 50%, transparent)":void 0},onClick:o,children:[(0,S.jsxs)("div",{className:"flex items-center gap-3",children:[(0,S.jsx)("div",{className:"rounded-md bg-pink-200 p-2",children:(0,S.jsx)(n,{className:"h-5 w-5 text-pink-700"})}),(0,S.jsx)("span",{className:"text-sm font-semibold",children:s})]}),(0,S.jsx)(er.Z,{className:"text-muted-foreground mr-2 size-4"})]}),t.isDragging&&(0,S.jsxs)("div",{className:"bg-card flex w-full cursor-pointer items-center justify-between gap-3 px-2 py-3",children:[(0,S.jsxs)("div",{className:"flex items-center gap-3",children:[(0,S.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-md bg-pink-200",children:(0,S.jsx)(n,{className:"h-5 w-5 text-pink-700"})}),(0,S.jsx)("span",{className:"text-sm font-semibold",children:s})]}),(0,S.jsx)(er.Z,{className:"text-muted-foreground mr-2 size-4"})]})]})}})},A=e=>{let t=t$[e];return(0,S.jsx)(tv.bK,{droppableId:"".concat(e,"-list"),isDropDisabled:!0,children:e=>(0,S.jsx)("div",{ref:e.innerRef,...e.droppableProps,className:"gap-y-3",children:t.map((e,r)=>(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(M,{...e,index:r},e.type),r<t.length-1&&(0,S.jsx)("div",{className:"bg-muted h-px"})]}))})})},O=(0,K.useMemo)(()=>({isOpen:I,onClose:()=>T(!1),setIcon:E}),[I,E]),Z=(0,K.useCallback)(e=>{if(n){if(e){let e=t.form_elements.filter(e=>"TriggerConfiguration"!==e.type);r({...t,form_elements:[{type:"TriggerConfiguration"},...e]})}else{let e=t.form_elements.filter(e=>"TriggerConfiguration"!==e.type);r({...t,form_elements:e})}}},[t,r,n]),z=(0,K.useMemo)(()=>Object.keys(l).length>0,[l]);return(0,S.jsx)(eq.Vq,{open:s,onOpenChange:a,children:(0,S.jsx)(tv.Z5,{onDragStart:()=>{c(!0)},onDragEnd:e=>{var a;if(c(!1),!e.destination)return;let s=(null===(a=t.form_elements[0])||void 0===a?void 0:a.type)==="TriggerConfiguration";if("form-drop-area"===e.source.droppableId&&"form-drop-area"===e.destination.droppableId){if(s&&(0===e.source.index||0===e.destination.index))return;let a=Array.from(t.form_elements),[n]=a.splice(e.source.index,1);a.splice(e.destination.index,0,n),r({...t,form_elements:a});return}if("form-drop-area"===e.destination.droppableId){let a=e.draggableId,n=e.destination.index;s&&0===n&&(n=1);let l=tQ(a);if(!l)return;r({...t,form_elements:[...t.form_elements.slice(0,n),l,...t.form_elements.slice(n)]})}},children:(0,S.jsxs)(eq.cZ,{className:"min-w-[90svw]",onOpenAutoFocus:e=>e.preventDefault(),children:[(0,S.jsxs)(eq.a7,{className:"flex h-[90svh] flex-grow flex-row",children:[(0,S.jsxs)("div",{className:"w-96 max-w-md space-y-4 overflow-y-auto",children:[(0,S.jsxs)("div",{className:"space-y-2",children:[(0,S.jsx)("p",{className:"text-md text-foreground mb-2 font-medium",children:"Inputs"}),A("input")]}),(0,S.jsxs)("div",{className:"space-y-2",children:[(0,S.jsx)("p",{className:"text-md text-foreground mb-2 font-medium",children:"Structure"}),A("structure")]}),!f&&n&&!z&&(0,S.jsxs)("div",{className:"bg-background border-border flex flex-col gap-1 rounded-lg border p-4",children:[(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)(eD.Z,{className:"text-muted-foreground size-4"}),(0,S.jsx)("p",{className:"text-foreground text-sm font-medium",children:"Allow users to subscribe to this Flow"})]}),(0,S.jsxs)("p",{className:"text-muted-foreground text-sm",children:["Try adding a trigger to your flow to allow users to subscribe to it!"," ",(0,S.jsx)(es(),{href:" https://docs.gumloop.com/core-concepts/flow_subscriptions ",target:"_blank",className:"underline hover:no-underline",children:"Learn more"})]})]})]}),(0,S.jsx)("div",{className:"mx-auto flex h-full flex-grow flex-col overflow-y-auto",children:(0,S.jsxs)("div",{className:"mx-auto flex h-fit w-full max-w-3xl flex-col gap-4",children:[(0,S.jsx)("div",{className:"group relative h-52 cursor-pointer overflow-hidden rounded-2xl",onClick:()=>C(!0),children:t.header_image?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("img",{src:t.header_image,alt:"Form header",className:"h-full w-full object-cover"}),(0,S.jsxs)(el.zx,{variant:"outline",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:[(0,S.jsx)(eP.Z,{})," Change header image"]})]}):(0,S.jsxs)(el.zx,{variant:"ghost",className:"border-border absolute inset-0 h-full w-full rounded-2xl border border-dashed",children:[(0,S.jsx)(eP.Z,{})," Upload header image"]})}),(0,S.jsx)(tM,{isOpen:k,onClose:()=>C(!1),setHeaderImage:N}),(0,S.jsxs)("div",{className:"relative -mt-12 ml-12",children:[(0,S.jsx)("div",{className:(0,eu.cn)("group relative flex h-24 w-24 cursor-pointer items-center justify-center rounded-lg",t.icon?"bg-transparent":"bg-background hover:bg-muted border border-dashed transition-colors"),onClick:()=>T(!0),children:t.icon?(0,S.jsxs)(S.Fragment,{children:[t.icon.startsWith("http")?(0,S.jsx)("img",{src:t.icon,alt:"Interface icon",className:"h-24 w-24 rounded-lg object-cover"}):(0,S.jsx)("div",{className:"text-foreground text-[80px]",children:t.icon}),(0,S.jsx)("div",{className:"bg-foreground/30 dark:bg-background/30 absolute top-0 left-0 flex h-24 w-24 items-center justify-center rounded-lg opacity-0 transition-opacity group-hover:opacity-100",children:(0,S.jsx)("span",{className:"text-background dark:text-foreground text-xs",children:"Change icon"})})]}):(0,S.jsx)("button",{className:"text-muted-foreground text-xs",children:"Upload icon"})}),(0,S.jsx)(tO,{...O})]}),(0,S.jsxs)("div",{className:"px-6 py-0",children:[(0,S.jsx)(tC.I,{value:u,onChange:e=>{let t=e.target.value;m(t),w({title:t})},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"bg-card mt-4 block w-full rounded-md !border-0 px-4 pt-3 pb-2 text-4xl leading-normal font-semibold break-words whitespace-normal !ring-0 !outline-none focus:!border-0 focus:!ring-0 focus:!outline-none",style:{outline:"none",border:"none",resize:"none"},placeholder:"Interface title",multiline:!0,maxLines:5}),(0,S.jsxs)("div",{className:"relative",ref:b,children:[v&&(0,S.jsx)("div",{className:"sticky inset-x-0 top-15 z-20 h-0",children:(0,S.jsx)("div",{className:"absolute left-1/2 mb-2 w-full -translate-x-1/2 -translate-y-full",children:(0,S.jsx)(t9,{editor:j})})}),h&&(0,S.jsx)("div",{className:"sticky z-10 h-0 ".concat(v?"top-14":"top-0"),children:(0,S.jsx)("div",{className:"absolute top-10 left-1/2 mb-2 -translate-x-1/2 -translate-y-full",children:(0,S.jsxs)(eU.C,{variant:"destructive",children:[(0,S.jsx)(tf.Z,{}),"Description too long"]})})}),(0,S.jsx)(t6.Z,{initialContent:p,onUpdate:e=>{x(e),w({description:e})},maxCharacters:1024,placeholder:"Add descriptionâ€¦",onEditorReady:_,onOverLimitChange:e=>g(e)})]})]}),(0,S.jsxs)("div",{className:"min-h-[300px] rounded-lg px-6 py-4 pt-2",children:[n&&(0,S.jsx)(t2,{savedItemId:t.saved_item_id,hasTriggerConfigElement:f,onToggle:Z}),(0,S.jsx)(tv.bK,{droppableId:"form-drop-area",children:e=>(0,S.jsx)("div",{ref:e.innerRef,...e.droppableProps,className:(0,eu.cn)("rounded-2xl transition-colors duration-200","p-4",0===t.form_elements.filter(e=>"TriggerConfiguration"!==e.type).length&&["border-border! mt-2 border-2 border-dashed","flex items-center justify-center","min-h-[200px]"],d&&["border-2 border-dashed border-pink-200 bg-pink-50 dark:border-pink-100 dark:bg-pink-50/20","min-h-[200px]"]),children:0===t.form_elements.filter(e=>"TriggerConfiguration"!==e.type).length?(0,S.jsx)("p",{className:"text-muted-foreground",children:"Drag and drop interface elements here to get started"}):(0,S.jsxs)("div",{className:"w-full space-y-4",children:[t.form_elements.map((e,a)=>"TriggerConfiguration"===e.type?null:(0,S.jsx)(tv._l,{draggableId:"form-element-".concat(a),index:a,children:s=>(0,S.jsx)("div",{ref:s.innerRef,...s.draggableProps,children:(0,S.jsx)(tj.F,{element:e,index:a,onUpdate:(e,a)=>{let s=[...t.form_elements];s[e]=a,r({...t,form_elements:s})},onDelete:e=>{let a=t.form_elements.filter((t,r)=>r!==e);r({...t,form_elements:a})},isDisplayMode:!1,savedItemId:t.saved_item_id,hasValidationError:y(e,a),dragHandleProps:s.dragHandleProps})})},a)),e.placeholder]})})})]})]})})]}),(0,S.jsx)(eq.cN,{children:(0,S.jsx)(el.zx,{onClick:()=>{tX(t,i)&&a()},variant:"outline",children:"Return"})})]})})})},t7=r(26396),re=r(69394),rt=r(86762);let rr=(0,K.memo)(e=>{let{disabled:t=!1,onClick:r,Icon:a,label:s,disabledTooltip:n,className:l,accent:o}=e;return(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{children:(0,S.jsxs)(el.zx,{disabled:t,onClick:e=>{e.preventDefault(),r(e)},size:s?"default":"icon",variant:"ghost",accent:o,className:(0,eu.cn)("scale-100! rounded-none",l),children:[(0,S.jsx)(a,{}),s]})})}),t&&n&&(0,S.jsx)(eo._v,{children:n})]})});rr.displayName="OptionsMenuItem";var ra=(0,K.memo)(rr);let rs=(0,K.memo)(e=>{let{options:t,className:r,...a}=e;return(0,S.jsx)("div",{className:(0,eu.cn)("nodrag animate-in fade-in-0 slide-in-from-bottom-10 fade-in-0 absolute -top-20 left-1/2 z-50 hidden -translate-x-1/2 transform pb-14 duration-400 ease-in-out group-hover:flex",r),...a,children:(0,S.jsx)("div",{className:"bg-background divide-border flex divide-x overflow-hidden rounded-md border shadow-sm",children:t.map((e,t)=>(0,S.jsx)(ra,{...e},t))})})});rs.displayName="NodeMenu";let rn=(0,K.memo)(e=>{let{onRemove:t,onEditForm:r,onShareForm:a,flowbookId:s,...n}=e,l=[{Icon:t7.Z,label:"Edit Interface",onClick:e=>{e.preventDefault(),null==r||r(e)}},{Icon:re.Z,label:"Edit Interface Access",onClick:e=>{e.preventDefault(),null==a||a(e)},disabled:!s,disabledTooltip:"Save interface to share it"},{Icon:rt.Z,onClick:t,accent:"destructive",label:"Delete",className:"text-destructive-foreground"}];return(0,S.jsx)(rs,{options:l,...n})});rn.displayName="FormNodeMenu";var rl=r(37054),ro=r(5295),ri=r(75111),rd=r(4496);let rc=(0,K.memo)(e=>{let{isDisabled:t,parameter:r,declarationParameter:a,handleParameterChanges:s}=e,n=(null==r?void 0:r.value)||(null==r?void 0:r.default_value)||"";return r&&((null==r?void 0:r.value)===null||(null==r?void 0:r.value)===void 0)&&(null==r?void 0:r.default_value)&&s([{parameterName:a.name,newValue:r.default_value}]),(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(tC.I,{disabled:t,value:n,onChange:e=>{let t=e.target.value;s([{parameterName:a.name,newValue:t}])},className:"nodrag nowheel min-w-full ".concat(t?"bg-muted":""),type:a.data_type,placeholder:a.placeholder,multiline:!0,maxLines:16}),(null==r?void 0:r.error_message)&&(0,S.jsx)("p",{className:"text-destructive-foreground",children:r.error_message})]})});rc.displayName="FormTextInputElement";let ru=e=>"SelectDropdown"===e.type&&"options"in e?"enum(".concat(JSON.stringify(e.options),")"):"MultiSelectDropdown"===e.type&&"options"in e?"multi_select_enum(".concat(e.options.join(","),")"):(0,eV.Em)(e.type);var rm=(e,t)=>{var r;let a=e.data,s=a.declaration,n=null===(r=a.form)||void 0===r?void 0:r.form_elements,l=(0,K.useMemo)(()=>(e,r)=>{let a="".concat(e.input_name,"-").concat(r),n={name:e.input_name,data_type:ru(e),placeholder:"placeholder"in e?e.placeholder:"",error_message:"",value:e.value},l={name:e.input_name,data_type:ru(e),placeholder:"placeholder"in e?e.placeholder:"",description:"helper_text"in e?e.helper_text:"",is_optional:"is_required"in e&&!e.is_required},o=!!(null==n?void 0:n.disabled),i=null;if("boolean"===l.data_type){var d;i=(0,S.jsx)(ri.PT,{parameter:n,declarationParameter:l,handleParameterChanges:t,onColor:"".concat((null===(d=(0,ro.T2)(s.category))||void 0===d?void 0:d.medium)||"#fecdd3"),offColor:"#e5e7eb"})}else i=l.data_type.startsWith("enum(")?(0,S.jsx)(ri.gH,{isDisabled:o,parameter:n,declarationParameter:l,handleParameterChanges:t,error:null==n?void 0:n.error_message}):l.data_type.startsWith("multi_select_enum(")?(0,S.jsx)(ri.Q5,{isDisabled:o,parameter:n,declarationParameter:l,handleParameterChanges:t,error:null==n?void 0:n.error_message}):"File"===l.data_type?(0,S.jsx)(rl.Z,{isDisabled:o,handleParameterChanges:t,parameter:n,declarationParameter:l,error:null==n?void 0:n.error_message}):"Date"===l.data_type?(0,S.jsx)(ri.$5,{isDisabled:o,parameter:n,handleParameterChanges:t,error:null==n?void 0:n.error_message}):(0,S.jsx)(rc,{isDisabled:o,parameter:n,declarationParameter:l,handleParameterChanges:t});let c=["Date"],u=()=>{let e=l.display_name||l.name;return e=(e=(null!=e?e:"").replace(/_/g," ")).charAt(0).toUpperCase()+e.slice(1),(0,S.jsxs)("div",{className:(0,eu.cn)("flex w-4/5 items-center gap-x-2","boolean"!==l.data_type&&"pb-2"),children:[!c.includes(l.data_type)&&(0,S.jsx)("label",{className:"text-md truncate font-semibold",children:e}),l.description&&(0,S.jsx)(rd.Z,{description:l.description})]})};return(0,S.jsx)("div",{className:"relative",children:(0,S.jsx)("div",{className:"py-3",children:(0,S.jsx)("div",{className:(0,eu.cn)("boolean"===l.data_type?"relative flex flex-row justify-between":"pb-2"),children:c.includes(l.data_type)?(0,S.jsxs)("div",{className:"flex flex-row space-x-2",children:[i,u()]}):(0,S.jsxs)(S.Fragment,{children:[u(),i]})})})},a)},[n]),o=(0,K.useMemo)(()=>e=>{let t=e.map((e,t)=>l(e,t));return t=t.flatMap((e,r)=>[e,r<t.length-1?(0,S.jsx)("hr",{className:"my-1 opacity-50"},"spacer-".concat(r)):null]).filter(e=>null!==e)},[n]);return{renderParameter:l,renderParameters:o}},rp=(0,K.memo)(e=>{var t,r,a;let s=(0,Q.I0)(),n=(0,ez.CG)(R.a1),[l,o]=(0,K.useState)(!1),i=(0,Q.v9)(e=>e.forms.isFormBuilderOpen),d=e.data.form,c=(0,eC.Bn)(),u=(0,K.useMemo)(()=>!!e.parentId,[e.parentId]),{handleNodeDataChange:m}=(0,eJ.Z)(e.id),p=(0,K.useCallback)(e=>e.form_elements.filter(e=>"input_name"in e&&"is_required"in e).map(e=>({name:e.input_name,data_type:(0,eV.Em)(e.type),is_optional:!e.is_required})),[]),x=(0,K.useCallback)(e=>{s((0,G.Kn)(e)),m({form:e,outputs:p(e)})},[m,s,p]),{renderParameters:h}=rm(e,(0,K.useCallback)(e=>{if(!d)return;let t=d.form_elements.map(t=>{let r=e.find(e=>"input_name"in t&&e.parameterName===t.input_name);return r?{...t,value:r.newValue}:t});x(new eV.Form({...d,form_elements:t}))},[d,x])),g=(0,K.useCallback)(t=>{t&&t.preventDefault(),s((0,F.IK)(e.id))},[s,e.id]),f=(0,K.useCallback)(e=>{e&&e.preventDefault(),o(!0)},[]),v=(0,K.useCallback)(e=>{e.preventDefault(),s((0,G.de)(!0))},[s]),j=(0,K.useCallback)(()=>{s((0,G.de)(!1))},[s]);(0,K.useEffect)(()=>{c(e.id)},[e.data,d,c,e.id]);let b=(0,K.useMemo)(()=>{var e;return(null==d?void 0:null===(e=d.form_elements)||void 0===e?void 0:e.filter(e=>"input_name"in e&&"is_required"in e))||[]},[null==d?void 0:d.form_elements]);return((0,K.useEffect)(()=>{d||X.Am.error("Could not load interface node!",{id:"form-node-load-error"})},[d]),d)?(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)("div",{className:(0,eu.cn)("form-node group shadow-floating bg-elevated relative rounded-2xl border border-transparent","cursor-grab active:cursor-grabbing",e.selected&&"border-pink-500 ring-8 ring-pink-200","w-[500px]"),children:[(0,S.jsx)(rn,{onRemove:g,onEditForm:v,onShareForm:f,flowbookId:n}),(0,S.jsxs)("div",{className:"relative",id:"inner-operator-node-".concat(e.id),children:[(0,S.jsx)("div",{className:"relative h-32 overflow-hidden rounded-t-2xl",onClick:e=>{e.target.closest(".switch-container")||v(e)},children:d.header_image?(0,S.jsxs)("div",{className:"group relative h-full",children:[(0,S.jsx)("img",{src:d.header_image,alt:"Form header",className:"h-full w-full object-cover"}),(0,S.jsx)("div",{className:"bg-background/10 absolute inset-0 flex cursor-pointer items-center justify-center opacity-0 transition-opacity group-hover:opacity-100",children:(0,S.jsxs)(el.zx,{variant:"ghost",className:"text-primary-foreground dark:text-secondary-foreground hover:bg-foreground/20 flex !h-fit items-center",children:[(0,S.jsx)(eP.Z,{className:"h-8 w-8 stroke-[1.5]"}),(0,S.jsx)("span",{children:"Change header image"})]})})]}):(0,S.jsxs)("div",{className:"group bg-muted group-hover:text-muted-foreground flex h-full cursor-pointer items-center justify-center gap-2",children:[(0,S.jsx)(eP.Z,{className:"h-8 w-8 stroke-[1.5]"}),(0,S.jsx)("span",{className:"font-semibold",children:"Edit Interface"})]})}),(0,S.jsx)("div",{className:"group bg-background absolute bottom-0 left-6 z-20 flex h-14 w-14 translate-y-1/2 cursor-pointer items-center justify-center rounded-xl shadow-md",onClick:v,children:d.icon?(0,S.jsxs)(S.Fragment,{children:[d.icon.startsWith("http")?(0,S.jsx)("img",{src:d.icon,alt:"Interface icon",className:"h-14 w-14 rounded-xl object-cover"}):(0,S.jsx)("div",{className:"text-[40px]",children:d.icon}),(0,S.jsx)("div",{className:"absolute top-0 left-0 flex h-14 w-14 items-center justify-center rounded-xl bg-black/50 opacity-0 transition-opacity group-hover:opacity-100",children:(0,S.jsx)("span",{className:"text-primary-foreground dark:text-secondary-foreground text-center text-xs font-medium",children:"Change icon"})})]}):(0,S.jsx)("span",{className:"text-muted-foreground hover:text-muted-foreground/70 px-2 text-center text-xs font-medium",children:"Upload icon"})}),d&&d.form_elements.some(e=>"TriggerConfiguration"===e.type)&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsxs)(eU.C,{variant:"outline",className:"absolute right-4 bottom-0 translate-y-1/2",children:[(0,S.jsx)(eD.Z,{className:"text-muted-foreground mr-1 size-4"}),"Subscriptions Enabled"]})}),(0,S.jsx)(eo._v,{side:"right",className:"max-w-xs",children:(0,S.jsxs)("p",{children:["Allow users to subscribe to the flow's triggers. Values they input in the interface will be used in the flow for each triggered run."," ",(0,S.jsx)(es(),{href:" https://docs.gumloop.com/core-concepts/flow_subscriptions ",target:"_blank",className:"text-accent-foreground underline hover:no-underline",children:"Learn more"})]})})]})]}),(0,S.jsxs)("div",{className:"nowheel flex max-h-[800px] flex-col gap-4 overflow-y-auto p-6 pt-12 pb-8",children:[(0,S.jsxs)("div",{children:[(0,S.jsx)("h3",{className:"text-xl font-semibold break-words",children:d.title||"Interface title"}),d.description?(0,S.jsx)("div",{className:"text-muted-foreground text-sm break-words [&_a]:cursor-pointer [&_a]:text-pink-500 [&_a]:underline [&_a]:decoration-pink-500 [&_li]:my-1 [&_ol]:list-decimal [&_ol]:pl-6 [&_p]:min-h-[1.2em] [&_ul]:list-disc [&_ul]:pl-6",dangerouslySetInnerHTML:{__html:(0,eW.bb)(d.description)}}):(0,S.jsx)("p",{className:"text-muted-foreground text-sm break-words",children:"Add descriptionâ€¦"})]}),(0,S.jsx)("div",{children:h(b)}),(0,S.jsx)(rx,{form:d,flowbookId:n})]}),!u&&(0,S.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:(0,S.jsx)(eH.ZP,{connectionType:eH.Rj.OUTPUT,nodeId:e.id,isConnectable:e.isConnectable,connectionGroups:{DEFAULT:(null===(t=e.data.outputs)||void 0===t?void 0:t.length)||d.form_elements.some(e=>"TriggerConfiguration"===e.type)?Math.max(1,(null===(r=e.data.outputs)||void 0===r?void 0:r.length)||0):0},hideCount:!(null===(a=e.data.outputs)||void 0===a?void 0:a.length)})})]}),i&&(0,S.jsx)(t8,{isFormBuilderOpen:i,form:d,onUpdate:x,onClose:j}),(0,S.jsx)(tg,{open:l,onOpenChange:o})]}):null});let rx=(0,K.memo)(e=>{let{form:t,flowbookId:r}=e,a=eV.Form.getShareableUrl(t.form_id,t.title),s=(0,ez.CG)(R.lW),{isCopied:n,handleCopyText:l}=(0,eB.Z)(a,{errorMessage:"Failed to copy interface link",disabled:!r});(0,K.useMemo)(()=>s&&s.metadata.interfaces&&Object.keys(s.metadata.interfaces).includes(t.form_id),[s,t.form_id]);let o=!r;return(0,S.jsxs)("div",{className:"flex items-center gap-1 rounded-lg border p-1.5",children:[(0,S.jsx)("div",{className:"relative min-w-0 flex-1",children:(0,S.jsxs)("button",{onClick:l,className:(0,eu.cn)("group/copy-link relative flex h-10 w-full items-center overflow-hidden rounded-md px-3 whitespace-nowrap",o?"cursor-not-allowed":"cursor-pointer"),children:[(0,S.jsxs)("span",{className:"text-muted-foreground flex items-center gap-1.5 overflow-hidden text-sm",children:[(0,S.jsx)(eL.Z,{size:16,className:"shrink-0"}),(0,S.jsx)("span",{className:"truncate",children:a})]}),(0,S.jsxs)("span",{className:(0,eu.cn)("absolute inset-0 flex items-center justify-center gap-1.5 text-sm font-medium opacity-0 transition-opacity group-hover/copy-link:opacity-100",o?"bg-warning text-warning-foreground":n?"bg-success text-success-foreground":"bg-accent text-accent-foreground"),children:[o?null:n?(0,S.jsx)(eR.Z,{size:16}):(0,S.jsx)(eF.Z,{size:16}),(0,S.jsx)("span",{children:o?"Save Before Copying Link":"Copy Link"})]})]})}),!o&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-lg",className:"hover:bg-muted",children:(0,S.jsx)(es(),{href:a,target:"_blank",rel:"noopener noreferrer",children:(0,S.jsx)(eG.Z,{className:"text-muted-foreground h-4 w-4"})})})}),(0,S.jsx)(eo._v,{side:"right",children:"Open Interface in New Tab"})]})]})});rx.displayName="FormNodeCopyLink";var rh=r(13889),rg=r(8669),rf=r(82128),rv=r(92706),rj=r(88106),rb=r(50652),r_=r(20041),ry=r(96381),rw=r(79535),rN=r(94506),rk=r(66054),rC=r(18745),rI=r(15252),rT=r(60530),rS=r(92472);let rE=K.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,S.jsx)("textarea",{className:(0,eu.cn)("bg-background placeholder:text-muted-foreground flex max-h-[200px] min-h-[50px] w-full rounded-md border-slate-300 px-3 py-2 text-sm text-slate-600 transition-colors duration-300 outline-none focus:border-slate-400 focus:ring-0 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});rE.displayName="Textarea";var rM=e=>{let{parameters:t,handleParameterChanges:r,open:a,setIsOpen:s}=e,n=t.find(e=>"prompt_template"===e.name),[l,o]=(0,K.useState)((null==n?void 0:n.value)||"");return n&&Object.isExtensible(n)&&((null==n?void 0:n.value)===null||(null==n?void 0:n.value)===void 0)&&(null==n?void 0:n.default_value)&&(null==n?void 0:n.default_value)&&(n.value=n.default_value,o(n.value)),(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(rS.Vq,{open:a,onOpenChange:()=>s(e=>!e),children:(0,S.jsxs)(rS.cZ,{className:"p-5",children:[(0,S.jsx)(rS.fK,{children:(0,S.jsx)(rS.$N,{className:"text-lg font-semibold",children:"Change Prompt Template"})}),(0,S.jsx)("div",{children:(0,S.jsx)("div",{className:"mt-2",children:(0,S.jsx)(rE,{value:l,onChange:e=>o(e.target.value),rows:12})})}),(0,S.jsx)(rS.cN,{className:"flex items-center",children:(0,S.jsx)("div",{className:"flex justify-end space-x-4",children:(0,S.jsx)(rT.z,{onClick:()=>{r([{parameterName:null==n?void 0:n.name,newValue:l}]),s(!1)},disabled:l==(null==n?void 0:n.default_value),children:"Save"})})})]})})})};let rA=(e,t,r,a,s,n)=>{let{handleNodeDataChange:l}=(0,eJ.Z)(e),o=(0,K.useMemo)(()=>r.filter(e=>a.some(t=>t.name===e.name&&"both"!==e.attribute_type)),[r,a]),i=(0,K.useCallback)(e=>{let a={};o.find(t=>t.name===e.name)?(a.dynamic_inputs=r.filter(t=>t.name!==e.name),a.connectedInputBadges=s.filter(t=>t.inputName!==e.name)):a.dynamic_inputs=[...n?r:t,{name:e.name,attribute_type:"input",data_type:e.data_type,is_optional:!0,condition:e.condition}],l(a)},[o,s,r,l,t,n]),d=(0,K.useCallback)(()=>{l({dynamic_inputs:r.filter(e=>!o.some(t=>e.name===t.name)),connectedInputBadges:s.filter(e=>!o.some(t=>t.name===e.inputName))})},[l,s,o,r]);return{configuredInputs:o,handleToggleParameterAsInput:i,unconfigureAllParametersAsInput:d}};var rO=r(12667),rZ=(0,K.memo)(e=>{let{nodeId:t,parameters:r,inputs:a,dynamic_inputs:s,shouldUseDynamicInputs:n,open:l,setIsOpen:o,data:i}=e,{configuredInputs:d,handleToggleParameterAsInput:c}=rA(t,a,s,r,i.connectedInputBadges,n()),u=(0,K.useMemo)(()=>r.filter(e=>(0,rO.bu)(e)&&!(null==a?void 0:a.some(t=>t.name===e.name))),[a,r]);return(0,S.jsx)(eq.Vq,{open:l,onOpenChange:()=>o(e=>!e),children:(0,S.jsx)(eq.cZ,{children:(0,S.jsxs)(eq.a7,{children:[(0,S.jsxs)(eq.fK,{children:[(0,S.jsx)(eq.$N,{children:"Configure Inputs"}),(0,S.jsx)(eq.Be,{children:"Allow parameters to take inputs dynamically from other nodes."})]}),u.map(e=>(0,S.jsxs)("label",{className:"inline-flex cursor-pointer items-center",children:[(0,S.jsx)(eX.r,{checked:!!d&&!!d.find(t=>t.name===e.name),onCheckedChange:()=>c(e)}),(0,S.jsx)("span",{className:"text-foreground ms-3 text-sm font-medium",children:e.display_name||e.name})]},e.name))]})})})}),rz=r(31443),rP=r(94453),rD=r(14340),rL=r(66457);let rR=e=>{let{data:t,nodeId:r,handleMultipleParameterChanges:a}=e,s=(0,ez.TL)(),n=(0,K.useMemo)(()=>!!t.isInTestMode,[t.isInTestMode]),[l,o]=(0,K.useState)(null),i=(0,K.useRef)(n),d=(0,K.useCallback)(e=>e.map(e=>{if("string"==typeof e.value){let t=e.value.replace(/\{([^}]*)__NODE_ID__[^}]*\}/g,(e,t)=>"[INSERT YOUR ".concat((0,rL.PD)(t).toUpperCase()," HERE] "));return{...e,value:t}}return e}),[]),c=(0,K.useCallback)(()=>{l&&(a(t.parameters.map(e=>{let t=l.find(t=>t.name===e.name),r=null==t?void 0:t.value;return{parameterName:e.name,newValue:r}})),o(null))},[l,t.parameters,a]),u=(0,K.useCallback)(e=>{if(e!==n){if(e&&!n){o(JSON.parse(JSON.stringify(t.parameters))),s((0,F.L_)({id:r,testMode:!0})),a(d(t.parameters).map(e=>({parameterName:e.name,newValue:e.value})));return}if(!e&&n&&l){c(),s((0,F.L_)({id:r,testMode:!1}));return}s((0,F.L_)({id:r,testMode:e}))}},[s,r,n,t.parameters,c,a,d]);(0,K.useEffect)(()=>{i.current&&!n&&l&&c(),i.current=n},[n,l,c]);let{handleStartPipeline:m}=(0,rD.wL)();return{isTestMode:n,setIsTestMode:u,runTestNode:(0,K.useCallback)(()=>{m(!0)},[m])}},rF=(0,K.createContext)(null),rG=e=>{let{children:t}=e,[r,a]=(0,K.useState)(!1),s=(0,K.useMemo)(()=>({connectionInProgress:r,setConnectionInProgress:a}),[r,a]);return(0,S.jsx)(rF.Provider,{value:s,children:t})},rU=()=>(0,K.useContext)(rF);var rB=r(92416),rV=r(49230),rW=r(27801),rH=r(62496),rJ=r(7490),rq=r(93237),rK=r(48510),rY=r(71284),r$=r(6901),rQ=e=>{let{isFocused:t,handleParameterChanges:r,note:a,color:s}=e,[n,l]=(0,K.useState)(a),o=(0,eC.hR)(),i=(0,rY.jE)({extensions:[r$.Z.configure({bulletList:{keepMarks:!0,keepAttributes:!1},orderedList:{keepMarks:!0,keepAttributes:!1}}),rK.Z,rJ.Z.configure({levels:[1,2,3]}),rq.Z.configure({placeholder:"Add note here...",emptyEditorClass:"first:before:content-[attr(data-placeholder)] first:before:opacity-80 first:before:pointer-events-none first:before:float-left first:before:h-0 "})],editorProps:{attributes:{class:"prose prose-xl p-4  rounded-lg min-h-[200px] [&_*]:text-foreground focus:outline-none focus:ring-0",backgroundColor:"var(--background)",id:"note-editor-".concat(o)}},content:n,onUpdate:e=>{let{editor:t}=e,a=t.getHTML();l(a),r([{parameterName:"note",newValue:a}])}});return(0,K.useEffect)(()=>{i&&(t?i.commands.focus():i.commands.blur())},[t,i]),(0,S.jsxs)("div",{className:t?"nodrag":"pointer-events-none",children:[t&&(0,S.jsx)("div",{className:"absolute -top-13 left-0",children:(0,S.jsx)(t9,{editor:i,onColorChange:e=>{r([{parameterName:"color",newValue:e}])},color:s,portalDialogs:!1})}),(0,S.jsx)(rY.kg,{editor:i,className:(0,eu.cn)(t?"cursor-text":"")})]})},rX=(0,K.memo)(e=>{var t,r,a,s;let{className:n,data:l,onRemove:o,handleParameterChanges:i}=e,[d,c]=(0,K.useState)(!1),u=(0,K.useRef)(null),m=(0,rO.yp)(l.version,"v0_04"),p=m&&(null===(t=l.parameters.find(e=>"color"===e.name))||void 0===t?void 0:t.value)||"var(--muted)",x=(0,K.useRef)(m&&(null===(r=l.parameters.find(e=>"width"===e.name))||void 0===r?void 0:r.value)||"650px"),h=(0,K.useRef)(m&&(null===(a=l.parameters.find(e=>"height"===e.name))||void 0===a?void 0:a.value)||"auto"),g=null===(s=l.parameters.find(e=>"note"===e.name))||void 0===s?void 0:s.value;return(0,K.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e,{capture:!0}),()=>{document.removeEventListener("mousedown",e,{capture:!0})}},[]),(0,K.useEffect)(()=>{let e=new ResizeObserver(e=>{let t=e[0];t&&i([{parameterName:"width",newValue:t.contentRect.width},{parameterName:"height",newValue:t.contentRect.height}])});return u.current&&e.observe(u.current),()=>{e.disconnect()}},[]),(0,S.jsx)("div",{id:"Note",ref:u,className:(0,eu.cn)("group !text-foreground flex rounded-xl border p-2 shadow-md",d&&"nodrag",d&&m&&"resize",m?"nowheel overflow-auto":"overflow-none",n),style:{backgroundColor:p,width:x.current,height:h.current},onClick:()=>c(!0),children:(0,S.jsxs)("div",{className:"flex h-full w-full flex-col",children:[(0,S.jsx)(el.zx,{onClick:e=>o(e),variant:"ghost",size:"icon-sm",accent:"destructive",className:"absolute top-2 right-2 z-10 hidden group-hover:flex",children:(0,S.jsx)(t_.Z,{})}),(0,S.jsx)("div",{className:"p-2",children:(0,S.jsx)(rQ,{isFocused:d,handleParameterChanges:i,note:g,color:m?p:void 0})})]})})}),r0=r(77652),r1=r(50382),r2=e=>{let{note:t,handleParameterChanges:r}=e,a="Add note here... \n",[s,n]=(0,K.useState)(!1),[l,o]=(0,K.useState)(!0),[i,d]=(0,K.useState)(t||a),c=(0,K.useRef)(null);return(0,K.useEffect)(()=>{if(!s&&c.current&&c.current.blur(),s){var e;null===(e=c.current)||void 0===e||e.focus()}},[s]),(0,K.useEffect)(()=>{r([{parameterName:"note",newValue:i}])},[i]),s?(0,S.jsx)(r0.Z,{inputRef:c,className:"m-0 flex min-h-full w-full cursor-text rounded-md border-none p-3 pt-6 focus:outline-none",sx:{height:"auto",border:"0px",padding:"10px",paddingTop:"27px",paddingBottom:"25px",margin:"0px","&:hover":{border:"0px"},"&:focus":{border:"0px",boxShadow:"none",outline:"none"},"& .Mui-focused::before":{display:"none"},wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap"},value:i,placeholder:"Enter your note here...",onChange:e=>d(e.target.value),onBlur:()=>{n(!1)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(n(!1),e.preventDefault())},multiline:!0}):(0,S.jsx)("div",{className:"h-full w-full cursor-text rounded-md p-3 pt-6 break-words",onClick:()=>{n(!0),l&&i===a&&(d(""),o(!1))},children:(0,S.jsx)(r1.U,{className:"space-y-5 tracking-wide break-words",components:{p:e=>(0,S.jsx)("p",{style:{overflowWrap:"break-word",wordWrap:"break-word"},...e})},children:i})})},r5=(0,K.memo)(e=>{let{className:t,colors:r,data:a,onRemove:s,handleParameterChanges:n}=e;return(0,S.jsx)("div",{id:"Note",className:(0,eu.cn)("overflow-none border-warning-foreground/50 bg-warning-foreground/10 !text-foreground operator-node flex min-h-[100px] max-w-[600px] min-w-[300px] rounded-md border p-4 shadow-md",t),children:(0,S.jsxs)("div",{className:"operator-node flex h-full w-full flex-col",children:[(0,S.jsx)("div",{className:"absolute mr-7 flex w-full flex-row justify-end",style:{pointerEvents:"none"},children:(0,S.jsx)("button",{onClick:e=>s(e),style:{marginRight:30,pointerEvents:"auto"},children:(0,S.jsx)(t_.Z,{})})}),(0,S.jsx)(r2,{note:a.parameters[0].value,handleParameterChanges:n})]})})}),r4=r(4801),r3=r(50016),r9=r(46858),r6=r(28234),r8=r(65329),r7=e=>{let{missingSecretScopes:t,hasBannerAbove:r,declaration:a}=e,[s,n]=(0,K.useState)(!1);return(0,K.useEffect)(()=>{s&&0===Object.keys(t).length&&n(!1)},[s,t]),(0,S.jsx)("div",{className:(0,eu.cn)("mx-1 mt-1",r?"mb-1":""),children:(0,S.jsxs)(r8.bZ,{className:(0,eu.cn)("bg-destructive/50 dark:bg-destructive/75 flex flex-col gap-2.5 rounded-b-none border-none pr-2",r?"rounded-t-none":"rounded-t-[0.85rem]"),children:[(0,S.jsxs)("div",{className:"text-destructive-foreground dark:text-foreground flex flex-col gap-1",children:[(0,S.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,S.jsx)(r6.Z,{className:"shrink-0 !stroke-[2]",size:20}),(0,S.jsx)(r8.Cd,{className:"text-base font-semibold",children:"Missing credential(s) or scope(s)"})]}),(0,S.jsx)(r8.X,{className:"text-destructive-foreground dark:text-foreground text-sm",children:"This node may not work properly until you authenticate, switch credentials or attain the right scopes."})]}),(0,S.jsx)(ef.Z,{immediatePipelineEvaluationResult:t,immediateOnAuthSuccess:()=>{},open:s,onOpenChange:n,declaration:a,children:(0,S.jsxs)(el.zx,{variant:"outline",children:[Object.keys(t).map(e=>{var t;return null===(t=(0,rW.vw)(e))||void 0===t?void 0:t.image_path}).filter(e=>void 0!==e).map(e=>(0,S.jsx)(tw(),{src:e,alt:"Secret type",width:20,height:20},e)),"Authenticate credentials"]})})]})})},ae=r(43526),at=r(70452),ar=r(50285),aa=r(30429),as=r(37613),an=r(33058),al=r(21872),ao=(0,K.memo)(e=>{let{inputName:t,message:r,isMultiBadgeTextInput:a}=e,s=(0,eC.hR)(),n=(0,ez.TL)(),{handleTroubleshootPipelineNodeError:l}=(0,al.M)();return r?(0,S.jsxs)("div",{className:(0,eu.cn)("bg-warning text-warning-foreground absolute right-0 left-0 flex items-start justify-between rounded-b-md px-2 pt-3 pb-1.5 text-xs font-semibold",a?"top-[calc(100%-4px)]":"top-[calc(100%-8px)]"),children:[(0,S.jsx)("div",{className:"flex flex-wrap gap-y-1",children:(()=>{let e;let t=[],a=0,s=/List of List/g,n=[];for(;null!==(e=s.exec(r));)n.push({index:e.index,length:e[0].length});let l=Object.keys(rj.XK).sort((e,t)=>t.length-e.length),o=[];return l.forEach(e=>{let t=r.indexOf(e);for(;-1!==t;)n.some(e=>t>e.index&&t<e.index+e.length)||o.push({dataType:e,index:t}),t=r.indexOf(e,t+1)}),o.sort((e,t)=>e.index-t.index),o.forEach((e,s)=>{e.index>a&&t.push(r.substring(a,e.index)),t.push((0,S.jsxs)("span",{className:(0,eu.cn)("mx-0.5 inline-flex items-center",s>0&&"ml-2"),children:[(0,S.jsx)("span",{className:"mr-0.5 inline-flex items-center",children:rj.XK[e.dataType]}),e.dataType]},"".concat(e.dataType,"-").concat(e.index))),a=e.index+e.dataType.length}),a<r.length&&t.push(r.substring(a)),t})()}),(0,S.jsxs)("button",{className:"nodrag text-warning-foreground flex h-auto items-center gap-1 p-0 text-xs underline hover:no-underline hover:opacity-70",onClick:()=>{s&&(n((0,A.ym)(!0)),l(s))},children:[(0,S.jsx)("span",{className:"font-bold",children:"Ask Gummie for help"}),(0,S.jsx)(an.Z,{className:"!ml-0 size-3.5 shrink-0",color:"var(--warning-foreground)"})]})]}):null}),ai=r(56109),ad=r(50855);let ac=(e,t,r)=>{let a=t.find(t=>t.name===e);if(!a)return;let s=(0,ad.W7)(a.data_type);return r?"".concat(s,"[]"):s};var au=e=>{let{inputName:t,visibleInputs:r,batchMode:a}=e,s=ac(t,r,a);if(!s)return null;let n=s.endsWith("[]")&&!s.endsWith("[][]"),l=s.endsWith("[][]");return n||l?(0,S.jsxs)("div",{className:"text-foreground mb-2 flex items-center text-xs font-medium",children:[l?(0,S.jsxs)("div",{className:"relative mr-1",children:[(0,S.jsx)(ai.Z,{className:"text-foreground absolute top-0.5 left-0.5 h-4 w-4"}),(0,S.jsx)(ai.Z,{className:"text-foreground h-4 w-4"})]}):(0,S.jsx)(ai.Z,{className:"text-foreground mr-1 h-4 w-4"}),l?"Expects List of Lists":"Expects List"]}):null},am=r(69386),ap=r(67060),ax=r(64127),ah=r(18272);let ag=(0,K.memo)(e=>{let{sourceNodeId:t,sourceNodes:r,category:a,size:s=16}=e,n=r.find(e=>e.id===t),l=(0,eC.ZP)((null==n?void 0:n.data)&&"subNodeId"in n.data&&n.data.subNodeId||"");if(n){let e=n.data,t=(null==l?void 0:l.data.declaration)||e.declaration,r=(0,rj.Qq)(t,s);return r&&"string"!=typeof r?r:(0,S.jsx)("img",{src:(0,ro.F1)(a),alt:"",className:"size-4",style:{color:(0,ro.T2)(a).dark}})}return null}),af=e=>{let{sourceNodeInputsMap:t,sourceNodes:r,targetInputName:a,handleSelect:s}=e,[n,l]=(0,K.useState)(!1),[o,i]=(0,K.useState)(""),d=(0,eC._K)(),c=(0,K.useMemo)(()=>d.getNodes(),[d]),u=(0,K.useMemo)(()=>(0,as.$)(r,t,c),[r,t,c]),m=(0,K.useMemo)(()=>{let e=[];return u.forEach(t=>{let a=r.find(e=>e.id===t.sourceNodeId);t.inputs.forEach(r=>{let s=(0,rO.U9)(a,r.name);e.push({id:"".concat(t.sourceNodeId,"-").concat(r.name),categoryName:t.sourceNodeName,inputName:s,dataType:r.data_type,sourceNodeId:t.sourceNodeId,category:t.category,originalInput:r})})}),e},[u,r]),p=(0,K.useMemo)(()=>new am.Z(m,{keys:[{name:"categoryName",weight:.7},{name:"inputName",weight:.3}],threshold:.3,ignoreLocation:!0}),[m]),x=(0,K.useMemo)(()=>{if(!o.trim())return u;let e=p.search(o),t=new Map;return e.forEach(e=>{let{item:r}=e,a=r.sourceNodeId;if(!t.has(a)){let e=u.find(e=>e.sourceNodeId===a);e&&t.set(a,{sourceNodeId:e.sourceNodeId,sourceNodeName:e.sourceNodeName,category:e.category,inputs:[]})}let s=t.get(a);s&&!s.inputs.find(e=>e.name===r.inputName)&&s.inputs.push(r.originalInput)}),Array.from(t.values()).filter(e=>e.inputs.length>0)},[o,p,u]),h=(e,t)=>{s(a,e,t),l(!1)},g=x.length>0;return(0,S.jsxs)(ah.J2,{open:n,onOpenChange:l,children:[(0,S.jsx)(ah.xo,{asChild:!0,children:(0,S.jsxs)(el.zx,{variant:"ghost",className:"nodrag text-muted-foreground bg-background flex h-auto w-full cursor-pointer items-center justify-center gap-1 rounded-md p-3 text-sm font-semibold",onClick:e=>{e.stopPropagation()},children:[(0,S.jsx)(er.Z,{}),(0,S.jsx)("span",{className:"!ml-0",children:"Select Input"})]})}),(0,S.jsx)(ah.yk,{className:(0,eu.cn)("max-h-[400px] max-w-sm min-w-[350px] p-0"),children:(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("div",{className:"p-3 pb-0",children:(0,S.jsx)(ax.I,{placeholder:"Search for an input",value:o,onChange:e=>i(e.target.value),className:"h-9"})}),(0,S.jsx)("div",{className:"max-h-[320px] overflow-y-auto",children:g?(0,S.jsx)("div",{className:"py-2",children:x.map(e=>(0,S.jsxs)(ap.zF,{defaultOpen:!0,className:"transition-[height] duration-200",children:[(0,S.jsxs)(ap.wy,{className:"group/collapsible-trigger flex w-full flex-grow cursor-pointer items-center gap-2 px-3 py-2",style:(0,ro.J8)(e.category),children:[(0,S.jsxs)("div",{className:"flex flex-grow items-center gap-2",children:[(0,S.jsx)(ag,{sourceNodeId:e.sourceNodeId,sourceNodes:r,category:e.category}),(0,S.jsx)("span",{className:"truncate text-xs font-medium break-keep",children:e.sourceNodeName})]}),(0,S.jsx)(tr.Z,{className:"ml-auto size-3.5 duration-200 group-data-[state=open]/collapsible-trigger:rotate-90"})]}),(0,S.jsx)(ap.Fw,{className:"flex cursor-default flex-wrap gap-x-2 gap-y-1.5 overflow-x-hidden p-3 pt-0 transition-all duration-200",children:e.inputs.map((t,a)=>{let s=r.find(t=>t.id===e.sourceNodeId),n=(0,rO.U9)(s,t.name);return(0,S.jsx)(rL.$R,{className:"cursor-pointer",name:t.name,displayName:n,dataType:(0,as.ku)(t.data_type,e.sourceNodeId,r),nodeCategory:e.category,onClick:()=>h(t.name,e.sourceNodeId)},"".concat(t.name,"-").concat(a))})})]},e.sourceNodeId))}):(0,S.jsx)("div",{className:"p-3",children:(0,S.jsx)(r3.Z,{title:"No inputs found",description:"Drag outputs from other nodes to use them dynamically in this node!"})})})]})})]})},av=(e,t)=>e.find(e=>e.name===t),aj=e=>{let{input:t,children:r,visibleInputs:a,operatorNodeProps:s,handleSingleBadgeSelect:n,declarationParameters:l,className:o="",errorMessage:i=""}=e,d=av(l,t.name);return(0,S.jsxs)("div",{className:"relative mb-4",children:[(0,S.jsxs)("div",{className:"flex items-center justify-between",children:[(0,S.jsx)("div",{className:"flex-1",children:d?(0,at.W)(d):(0,at.W)({name:t.name,display_name:t.name,description:void 0,is_optional:t.is_optional,data_type:t.data_type})}),(0,S.jsx)(au,{inputName:t.name,visibleInputs:a,batchMode:s.data.batch})]}),(0,S.jsx)("div",{className:"relative z-10",children:(0,S.jsx)("div",{className:(0,eu.cn)("flex items-center justify-start rounded-md border border-dashed p-2",i?"!border-destructive-foreground mb-10 border-2 border-solid":"border-border",o),onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault();let r=e.dataTransfer.getData("name"),a=e.dataTransfer.getData("sourceNodeId");r&&a&&n(t.name,r,a)},children:r})}),(0,S.jsx)(ao,{inputName:t.name,message:i})]},"".concat(t.name,"-").concat(t.data_type,"-").concat(t.is_optional))},ab=e=>{var t;let{input:r,data:a,visibleInputs:s,operatorNodeProps:n,declarationParameters:l,selectedInputBadges:o,sourceNodes:i,sourceNodeInputsMap:d,handleSingleBadgeSelect:c,handleSingleBadgeDelete:u,handleParameterChanges:m,isTestMode:p}=e,x=o[r.name],h=(null===(t=a.parameters.find(e=>e.name===r.name))||void 0===t?void 0:t.value)||"",g=(0,K.useCallback)((e,t)=>{m([{parameterName:r.name,newValue:t}])},[r.name,m]),f=a.input_errors?a.input_errors[r.name]:"";if(p)return(0,S.jsx)(aa.Z,{input:{...r,value:h},handleInputValueChange:g,hideLabel:!0});if(!x)return(0,S.jsx)(aj,{input:r,className:"p-0",visibleInputs:s,operatorNodeProps:n,declarationParameters:l,handleSingleBadgeSelect:c,errorMessage:f,children:(0,S.jsx)(af,{sourceNodeInputsMap:d,sourceNodes:i,targetInputName:r.name,handleSelect:c})});let[v,j]=x,b=i.find(e=>e.id===v),_=(0,rO.U9)(b,j);return(0,S.jsx)(aj,{input:r,className:"bg-background border !border-solid",visibleInputs:s,operatorNodeProps:n,declarationParameters:l,handleSingleBadgeSelect:c,errorMessage:f,children:(0,S.jsx)(rL.$R,{name:j,displayName:_,nodeCategory:(e=>{let t=o[e];if(!t)return;let[r]=t,a=i.find(e=>e.id===r);return(0,as.qR)(null==a?void 0:a.data)})(r.name),dataType:(e=>{var t;let r=o[e];if(!r)return;let[a,s]=r,n=i.find(e=>e.id===a);if(!n)return;let l=d[a],c=null==l?void 0:null===(t=l.find(e=>e.name===s))||void 0===t?void 0:t.data_type;return(0,as.tK)(n)?"".concat(c,"[]"):c})(r.name),onRemove:()=>u(r.name),hasError:!!f})})};var a_=(0,K.memo)(e=>{let{operatorNodeProps:t,visibleInputs:r,sourceNodeInputsMap:a,handleParameterChanges:s,sourceNodes:n,handleNodesDataChange:l,isTestMode:o}=e,i=t.data,d=i.declaration,c=i.connectedInputBadges,u=(0,K.useMemo)(()=>{let e={};return c.forEach(t=>{t.isMultiBadgeTextInput||(e[t.inputName]=[t.sourceNodeId,t.sourceNodeOutputName])}),e},[c]),m=(0,K.useCallback)((e,r,a)=>{let s=n.find(e=>e.id===a),o={[t.id]:{connectedInputBadges:[...c,{inputName:e,sourceNodeId:a,sourceNodeOutputName:r,isMultiBadgeTextInput:!1}]}};Object.entries((0,ar.xO)(s,t,r,e)).forEach(e=>{let[r,a]=e;r===t.id?o[r]={...o[r],...a}:o[r]=a}),l(o)},[c,n,l,t]),p=(0,K.useCallback)(e=>{let r=c.filter(t=>!(t.inputName===e&&!t.isMultiBadgeTextInput));l({[t.id]:{connectedInputBadges:r}})},[c,t.id,l]),x=(0,K.useMemo)(()=>[...(null==d?void 0:d.parameters)||[],...(null==d?void 0:d.additional_parameters)||[]],[null==d?void 0:d.parameters,null==d?void 0:d.additional_parameters]);if(!r||0===r.length||"Router"===i.name)return null;let h=r.filter(e=>(0,rL.XB)(e,x));return(0,S.jsx)("div",{children:h.length>0&&(0,S.jsx)("div",{children:h.map(e=>(0,S.jsx)(ab,{isTestMode:o,input:e,data:i,visibleInputs:r,operatorNodeProps:t,declarationParameters:x,selectedInputBadges:u,sourceNodes:n,sourceNodeInputsMap:a,handleSingleBadgeSelect:m,handleSingleBadgeDelete:p,handleParameterChanges:s},e.name))})})}),ay=r(30217),aw=e=>{let{setShowExtraSettings:t,children:r,className:a}=e;return(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)("div",{className:"dark:bg-elevated/75 bg-muted/75 absolute top-[-10px] right-[-10px] z-[-1] h-[calc(100%+20px)] w-[calc(100%+340px)] rounded-3xl backdrop-blur-md"}),(0,S.jsxs)("div",{className:(0,eu.cn)("absolute top-0 bottom-0 left-[-320px] flex h-full w-[320px] flex-col overflow-hidden rounded-r-3xl pr-3 pl-1",a),children:[(0,S.jsxs)("div",{className:"border-muted-foreground/10 flex items-center justify-between",children:[(0,S.jsx)("h5",{className:"text-muted-foreground text-sm font-medium",children:"More Options"}),(0,S.jsx)(el.zx,{variant:"ghost",size:"icon",onClick:()=>t(!1),className:"hover:bg-background hover:border",children:(0,S.jsx)(ay.Z,{className:"text-muted-foreground"})})]}),(0,S.jsx)("div",{className:(0,eu.cn)("nowheel h-full overflow-y-auto pt-1",a),children:r})]})]})},aN=r(82014),ak=e=>{let{parameters:t,declaration:r,effectiveSecretTypes:a,handleParameterChanges:s,missingSecretTypes:n,hasBannerAbove:l,inputs:o,dynamicInputs:i,connectedInputBadges:d,shouldUseDynamicInputs:c}=e,u=(0,ez.TL)(),m=(0,eC.hR)(),p=(0,ez.CG)(R.AV),x=(0,ez.CG)(R.ZA),{currentProject:h}=(0,e0.d2)(),{userProfile:g}=(0,ec.H)(),f=!!(0,ez.CG)(e=>(0,tZ.TM)(e,{nodeId:m,savedItemId:p,userId:null==g?void 0:g.user_id,projectId:null==h?void 0:h.project_id})),[v,j]=(0,K.useState)(!1),{configuredInputs:b,unconfigureAllParametersAsInput:_}=rA(null!=m?m:"",o,i,t,d,c),y=(0,K.useCallback)(e=>{e&&(_(),u((0,F.vd)(e=>e.filter(e=>e.target!==m)))),s([{parameterName:"_is_trigger_enabled",newValue:e?"true":"false"}]),u((0,ej.To)({savedItemId:p}))},[p,u,s,m,_]),w=(0,K.useMemo)(()=>{var e;return(null===(e=t.find(e=>"_is_trigger_enabled"===e.name))||void 0===e?void 0:e.value)==="true"},[t]),N=(0,K.useMemo)(()=>{let e=r.trigger_description||"";return w&&!f&&(e+="<br /><br />To enable this trigger, you have to ".concat(x?"save your workbook.":"make this checkpoint live.")),f&&!w&&(e+="<br /><br />To disable this trigger, you have to ".concat(x?"save your workbook.":"make this checkpoint live.")),e},[w,f,r.trigger_description,x]),k=(0,K.useMemo)(()=>f!==w,[f,w]),C=(0,K.useMemo)(()=>k?"bg-warning text-warning-foreground":f||w?"bg-success text-success-foreground":"bg-muted text-muted-foreground",[f,w,k]);return(0,S.jsxs)("div",{className:(0,eu.cn)("flex items-center justify-between px-4 py-2 transition-colors duration-100",l?"mx-1 mb-1":"m-1 rounded-t-[0.85rem]",C),children:[(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)("span",{className:"text-md font-semibold transition-colors duration-100",children:"Activate as flow trigger"}),r.trigger_description&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(e$.Z,{className:"size-4"})}),(0,S.jsx)(eo._v,{children:(0,S.jsx)("p",{dangerouslySetInnerHTML:{__html:(0,eW.bb)(N)},className:"whitespace-pre-wrap"})})]})]}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{children:(0,S.jsx)(aN.Z,{checked:w,onChange:e=>{if(!a){X.Am.error("User credentials are not loaded. Please try again.");return}b.length?j(!0):y(e.target.checked)},offColor:k?"var(--warning-foreground)":"var(--border)",onColor:k?"var(--warning-foreground)":"var(--success-foreground)",disabled:!!n.length,textSize:k?"text-warning-foreground":"",disabledMessage:"You must have a linked credential to enable triggers"})}),!f&&w&&(0,S.jsxs)(eo._v,{children:["To enable this trigger, you have to"," ",x?"save your workbook.":"make this checkpoint live."]})]}),(0,S.jsx)(eQ.Z,{open:v,setOpen:j,title:"Configured input(s) detected",description:"Turning on the trigger for this node will clear all parameters that are configured to take values dynamically. Are you sure you want to continue?\n\nCurrently configured inputs: ".concat(b.map(e=>e.name).join(", ")),onConfirm:()=>y(!0)})]})},aC=r(52840),aI=()=>{let{userProfile:e,idTokenRef:t}=(0,ec.H)(),{currentProject:r}=(0,e0.d2)(),a=(0,ez.TL)();return{handleNodeUpgrade:(0,K.useCallback)(s=>{var n;let{props:l,handleDynamicAttributeChange:o,shouldUseDynamicOutputs:i,shouldUseDynamicInputs:d,parentName:c}=s;a((0,aC.FH)({props:l,shouldUseDynamicOutputs:i,shouldUseDynamicInputs:d,parentName:c,shouldHandleDynamicAttributeChange:!!o,userProfile:e,idToken:null!==(n=t.current)&&void 0!==n?n:"",currentProject:r}))},[a,e,t,r])}},aT=r(95436);let aS=(e,t)=>{let{handleNodeDataChange:r}=(0,eJ.Z)(e);return{handleRenameOutputNickname:(0,K.useCallback)((e,a)=>{let s={...t||{}};""===a.trim()?delete s[e]:s[e]=a,r({outputNicknames:Object.keys(s).length?s:void 0})},[t,r])}};var aE=e=>{var t;let{input:r,inputIndex:a,group:s,sourceNodes:n}=e,{handleRenameOutputNickname:l}=aS(s.sourceNodeId,null===(t=n.find(e=>e.id===s.sourceNodeId))||void 0===t?void 0:t.data.outputNicknames),o=n.find(e=>e.id===s.sourceNodeId),i=(0,rO.U9)(o,r.name);return(0,S.jsx)("div",{className:"overflow-hidden",children:(0,S.jsx)(rL.$R,{name:r.name,displayName:i,dataType:(0,as.ku)(r.data_type,s.sourceNodeId,n),nodeCategory:s.category,onDragStart:e=>{e.dataTransfer.setData("text/plain",r.name),e.dataTransfer.setData("id",String(a+1)),e.dataTransfer.setData("name",r.name),e.dataTransfer.setData("dataType",(0,as.ku)(r.data_type,s.sourceNodeId,n)),e.dataTransfer.setData("nodeCategory",s.category),e.dataTransfer.setData("sourceNodeId",s.sourceNodeId)},onRename:e=>l(r.name,e),draggable:!0})},"".concat(r.name,"-").concat(a))};let aM=(0,K.memo)(e=>{let{group:t,sourceNodes:r}=e;return(0,S.jsxs)(ap.zF,{defaultOpen:!0,className:"transition-[height] duration-200",children:[(0,S.jsxs)(ap.wy,{className:"group/collapsible-trigger flex w-full flex-grow cursor-pointer items-center gap-2 px-3 py-2",style:(0,ro.J8)(t.category),children:[(0,S.jsxs)("div",{className:"flex flex-grow items-center gap-2",children:[(0,S.jsx)(ag,{sourceNodeId:t.sourceNodeId,sourceNodes:r,category:t.category}),(0,S.jsx)("span",{className:"truncate text-xs font-medium break-keep",children:t.sourceNodeName})]}),(0,S.jsx)(tr.Z,{className:"ml-auto size-3.5 duration-200 group-data-[state=open]/collapsible-trigger:rotate-90"})]}),(0,S.jsx)(ap.Fw,{className:"flex cursor-default flex-wrap gap-x-2 gap-y-1.5 overflow-x-hidden p-3 pt-0 transition-all duration-200",children:t.inputs.map((e,a)=>(0,S.jsx)(aE,{input:e,inputIndex:a,group:t,sourceNodes:r},a))})]},t.sourceNodeId)});aM.displayName="InputGroup";let aA=()=>(0,S.jsxs)("div",{className:"p-4",children:[(0,S.jsx)("p",{className:"text-md mb-1.5 font-semibold",children:"Connect an input"}),(0,S.jsx)("p",{className:"text-muted-foreground text-xs",children:"Drag outputs from other nodes to use them in this node"})]});var aO=(0,K.memo)(e=>{let{sourceNodes:t,sourceNodeInputsMap:r,nodeHeight:a}=e,s=(0,eC._K)(),n=(0,K.useMemo)(()=>s.getNodes(),[s]),l=(0,K.useMemo)(()=>(0,as.$)(t,r,n),[t,r,n]),o=(0,K.useMemo)(()=>l.reduce((e,t)=>e+t.inputs.length,0),[l]),i=(0,K.useMemo)(()=>0===l.length?"none":a&&a<300?"200px":a?"".concat(Math.floor(.65*a),"px"):"400px",[l,a]);return(0,S.jsx)("div",{className:"animate-in fade-in-0 slide-in-from-left-10 pointer-events-auto ml-8 hidden h-max w-88 cursor-grab flex-col duration-400 ease-in-out group-hover:flex active:cursor-grabbing",children:(0,S.jsx)("div",{className:"nodrag nowheel bg-background shadow-floating flex h-max cursor-default flex-col rounded-xl border",style:{maxHeight:i},children:0===l.length?(0,S.jsx)(aA,{}):(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)("div",{className:"flex flex-grow flex-row items-center gap-4 p-3 pb-0",children:[(0,S.jsxs)("p",{className:"flex-none text-sm font-medium break-keep",children:[o," ",1===o?"Input":"Inputs"]}),(0,S.jsxs)(eo.u,{children:[(0,S.jsxs)(eo.aJ,{className:"text-muted-foreground ml-auto flex flex-none cursor-help items-center gap-1 text-sm font-medium",children:[(0,S.jsx)(aT.Z,{className:"mr-1 size-3.5"}),"Drag into node fields"]}),(0,S.jsx)(eo._v,{side:"top",className:"p-1",align:"start",children:(0,S.jsx)(tw(),{src:"/images/warnings/drag-badge.gif",alt:"Drag into node fields",width:250,height:250,className:"aspect-auto size-64 w-auto rounded-sm"})})]})]}),(0,S.jsx)("hr",{className:"border-muted mx-3 mt-3"}),(0,S.jsx)("div",{className:"flex w-full flex-col overflow-x-hidden overflow-y-auto mask-b-from-98% pt-2 pb-0.5",children:l.map((e,r)=>(0,S.jsx)(aM,{group:e,sourceNodes:t},"".concat(e.sourceNodeId,"-").concat(r)))})]})})})});let aZ=(0,K.memo)(e=>{let{totalOutputCount:t}=e;return(0,S.jsxs)(eo.u,{children:[(0,S.jsxs)(eo.aJ,{className:"flex flex-grow flex-row items-center gap-4 p-3 pb-0",children:[(0,S.jsxs)("p",{className:"flex-none text-sm font-medium break-keep",children:[t," ",1===t?"Output":"Outputs"]}),(0,S.jsx)(e$.Z,{className:"text-muted-foreground ml-auto size-3.5 cursor-help"})]}),(0,S.jsx)(eo._v,{children:"Use these outputs in a following node!"})]})});aZ.displayName="OutputCountTooltip";var az=(0,K.memo)(e=>{let{props:t,outputs:r,nodeHeight:a}=e,[s,n]=(0,K.useState)(null),{handleRenameOutputNickname:l}=aS(t.id,t.data.outputNicknames);(0,K.useEffect)(()=>{if(!r||0===r.length){s&&n(null);return}n({nodeId:t.id,category:(0,as.qR)(t.data)||"Flow Basics",outputs:r,expanded:!0})},[t.id,t.data.declaration.category,r,n]);let o=(0,K.useMemo)(()=>{var e;return(null==s?void 0:null===(e=s.outputs)||void 0===e?void 0:e.length)||0},[s]),i=e=>(0,as.tK)(t)?"".concat(e,"[]"):e;return(0,S.jsx)("div",{className:"nowheel nodrag fade-out-0 animate-in fade-in-0 slide-in-from-left-10 pointer-events-auto ml-8 hidden w-88 cursor-default duration-400 ease-in-out group-focus-within:block group-hover:block",children:(0,S.jsxs)("div",{className:"bg-background shadow-floating flex flex-col overflow-hidden rounded-xl border",children:[(0,S.jsx)(aZ,{totalOutputCount:o}),(0,S.jsx)("hr",{className:"border-muted mx-3 mt-3"}),(0,S.jsx)("div",{className:"flex flex-wrap gap-x-2 gap-y-1.5 overflow-x-hidden overflow-y-auto px-3 pt-3 pb-3",style:{maxHeight:a?"".concat(Math.floor(.2*a),"px"):"200px"},children:null==s?void 0:s.outputs.map((e,r)=>(0,S.jsx)(rL.$R,{name:e.name,displayName:(0,rO.U9)(t,e.name),dataType:i(e.data_type),nodeCategory:(null==s?void 0:s.category)||"Flow Basics",onRename:t.parentId?void 0:t=>l(e.name,t),disabled:!!t.parentId},"".concat(e.name,"-").concat(r)))})]})})}),aP=r(55264),aD=r(53695),aL=r(41949),aR=r(41095),aF=r(29606),aG=r(20852),aU=r(94383),aB=r(12951),aV=r(95727),aW=r(88870),aH=r(73935),aJ=r(358),aq=r(5447),aK=r(90829),aY=r(69769),a$=r(82222),aQ=r(45917),aX=r(83001),a0=r(63764),a1=r(1571),a2=r(821);let a5=e=>{let{declaration:t,isOpen:r,setIsOpen:a}=e,{resolvedTheme:s}=(0,a1.F)(),{data:n,isLoading:l}=(0,a2.DV)({path:"custom_operator?operator_id=".concat(t.operator_id,"&version=").concat(t.version),method:a2.J7.GET,queryKey:["custom-operator",t.operator_id,t.version],options:{enabled:!!(t.operator_id&&t.version&&r)}});return(0,S.jsx)(eq.Vq,{open:r,onOpenChange:a,children:(0,S.jsx)(eq.cZ,{className:"max-h-[90vh] !max-w-5xl",children:(0,S.jsxs)(eq.a7,{className:"flex flex-col gap-4",children:[(0,S.jsx)(eq.fK,{children:(0,S.jsx)(eq.$N,{children:"View Custom Operator Code"})}),(0,S.jsx)("div",{className:"min-h-[500px] flex-1 overflow-hidden rounded-md border",children:(0,S.jsx)(a0.ML,{height:"500px",defaultLanguage:"python",value:l?"Loading code...":(null==n?void 0:n.code)||"// No code available",theme:"dark"===s?"vs-dark":"light",options:{readOnly:!0,minimap:{enabled:!0},scrollBeyondLastLine:!1,fontSize:14,lineNumbers:"on",automaticLayout:!0}})})]})})})};var a4=(0,K.memo)(e=>{let{reactFlowNodeId:t,name:r,positionAbsoluteX:a,positionAbsoluteY:s,declaration:n,version:l,latest_version:o,subNodeId:i,isSuperNode:d,hasPromptTemplate:c,canConfigureInputs:u,customOperator:m,onRemove:p,onUpgrade:x,setIsOpenConfigureInputsModal:h,setIsOpenPromptTemplateModal:g,setIsOpenPublishCustomNodeModal:f,isTestMode:v,setIsTestMode:j,setIsRenaming:b}=e,_=(0,eC.ZP)(i||""),y=(0,eC.$P)(t),w=n.saved_item_id,N=(0,ez.TL)(),{userProfile:k,idTokenRef:C}=(0,ec.H)(),{currentProject:I}=(0,e0.d2)(),{isSuperAdmin:T}=(0,aq.p)(),[E,M]=(0,K.useState)(!1),[Z,z]=(0,K.useState)(!1),P=(0,Q.v9)(eb.Me),D=(0,Q.v9)(R.HA),{addNewNode:L}=(0,rg.A)(P),{editAgent:G}=(0,aY.J)(),U=(0,K.useMemo)(()=>!["Router","Join Paths"].includes(r)&&!d,[r,d]),{data:B}=(0,aJ.o)(n.operator_id,k,C.current),V=(0,K.useMemo)(()=>!!n.operator_id,[n.operator_id]),W=(0,ez.CG)(rb.ps),H=(0,K.useMemo)(()=>!!(n.operator_id&&W.has(n.operator_id)),[n.operator_id,W]),J=(0,K.useMemo)(()=>!!V&&(!!H||!!(null==B?void 0:B.can_edit)),[null==B?void 0:B.can_edit,V,H]),q=(0,K.useMemo)(()=>!H&&J,[H,J]),Y=(0,K.useMemo)(()=>T&&V,[T,V]),$=(0,K.useMemo)(()=>(0,as.C6)(o,n.category),[o,n.category]),ee=(0,K.useMemo)(()=>D.ordering.includes(w),[D.ordering,w]),et=(0,K.useMemo)(()=>{if("Agent"!==n.name||!(null==y?void 0:y.data.parameters))return null;let e=y.data.parameters.find(e=>"gummie_id"===e.name);if(!(null==e?void 0:e.value))return null;let t=y.data.parameters.find(e=>"gummies_map"===e.name);return((null==t?void 0:t.value)||{})[e.value]||e.value},[n.name,null==y?void 0:y.data.parameters]),er=(0,K.useCallback)(async()=>{if(ee){N((0,ej.hw)({newActiveTab:w,userProfile:k,idToken:C.current,projectId:null==I?void 0:I.project_id}));return}let e=X.Am.loading("Loading workbook link...");try{let{flowbook_id:t}=await a$.g.getFlowbookId(n.saved_item_id,k,C.current),r="pipeline";t?r+="?workbook_id="+t:r+="?flow_id="+n.saved_item_id,X.Am.dismiss(e),window.open(r,"_blank")}catch(t){X.Am.error("Failed to load flowbook link!",{id:e})}},[w,n.saved_item_id,k,C,N,ee]),ea=(0,K.useCallback)(()=>{N((0,F.NO)(t))},[t,N]),es=(0,K.useCallback)(()=>{i&&N((0,F.Z6)(i))},[i,N]),en=(0,K.useMemo)(()=>{let e=[];if("automation"===n.category&&e.push({Icon:ee?rw.Z:eG.Z,label:ee?"Open Subflow":"View",onClick:er,className:"bg-pink-50 hover:bg-pink-100! text-pink-500",highlight:!0}),et){let r=String(et);e.push({Icon:eG.Z,label:"Open Agent",onClick:()=>window.open("/agents/".concat(r),"_blank"),highlight:!0}),e.push({Icon:aP.Z,label:"Edit Agent",onClick:()=>{G({gummieId:r,nodeId:t})},highlight:!0})}if(d&&_||e.push({Icon:aD.Z,label:"Duplicate",onClick:ea}),$||e.push({Icon:aL.Z,label:"Rename",onClick:()=>{b(!0)}}),J){let t={Icon:aP.Z,label:"Edit",onClick:()=>M(!0)};e.push(t)}return Y&&e.push({Icon:aR.Z,label:"View Code",onClick:()=>z(!0)}),q&&e.push({Icon:tW.Z,label:"Share",onClick:()=>{f(!0)}}),(0,rO.$S)(l,o,r)&&e.push({Icon:aF.Z,label:(0,S.jsxs)("p",{children:["Upgrade Version"," ",(0,S.jsxs)("span",{className:"my-auto text-xs!",children:["(",(0,e5.V9)(l)," to ",(0,e5.V9)(o),")"]})]}),onClick:x,accent:"accent"}),u&&e.push({Icon:aG.Z,label:"Configure Inputs",onClick:()=>h(!0)}),c&&e.push({Icon:aU.Z,label:"Prompt Template",onClick:()=>g(!0)}),d&&_&&e.push({Icon:aB.Z,label:"Separate Nodes",onClick:es}),U&&(v?e.push({Icon:aV.Z,label:"Stop Testing",onClick:()=>{j(!1)}}):e.push({Icon:aW.Z,label:"Test",onClick:()=>{j(!0)}})),e.push({Icon:rt.Z,onClick:p,accent:"destructive",label:"Delete",className:"text-destructive-foreground"}),e},[n.category,et,d,_,$,J,Y,q,l,o,r,u,c,U,p,ee,er,G,t,ea,b,f,x,h,g,es,v,j]),el=(0,K.useCallback)(async()=>{var e,t,r;if(void 0===a||void 0===s||void 0===m)return;let l={x:a,y:s};(0,aH.flushSync)(()=>{L(n,l,rf.Jq.CustomNodeBuilder)}),(0,aX.$g)();let o=null==y?void 0:null===(e=y.data.parameters.find(e=>"credentials_to_use"===e.name))||void 0===e?void 0:e.value;await Promise.all([N((0,A.oV)(m)),N((0,A.oB)(o)),N((0,A.E7)({messageId:"INITIAL_MESSAGE_ID",customOperator:m})),N((0,A.rZ)((null===(t=m.operator_declaration)||void 0===t?void 0:t.category)===aQ.H.MEGA_OPERATOR?aQ.g.MEGA_OPERATOR:aQ.g.CUSTOM_OPERATOR)),N((0,A.yg)(O.IG.EDIT_CUSTOM_NODE)),N((0,A.pj)({mode:O.Cn.CUSTOM_NODE_CONFIG})),N((0,A.p8)((0,aK.Hh)().msgs)),N((0,A.p1)(null===(r=m.operator_declaration)||void 0===r?void 0:r.metadata))]),N((0,F.VQ)({nodeId:m.operator_id})),N((0,A.ym)(!0))},[a,s,m,null==y?void 0:y.data.parameters,N,L,n]),eo=(0,K.useMemo)(()=>({open:E,setOpen:M,onConfirm:el,confirmButtonProps:{text:"Continue"},onCancel:()=>M(!1),cancelButtonProps:{text:"Cancel"},title:H?"Editing this node will create your own copy":"Editing a custom node does not update workflows already using it. You're making a new version!",description:H?"This is a default node. When you save your changes, a personal copy will be created that you can customize and use in your workflows.":"If this custom node is used within other workflows, you will need to update each one manually to use this new version. Iterating on this custom node will not break your existing workflows."}),[E,M,el,H]);return(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(rs,{options:en,onClick:e=>e.stopPropagation()}),(0,S.jsx)(eQ.Z,{...eo}),Y&&(0,S.jsx)(a5,{declaration:n,isOpen:Z,setIsOpen:z})]})},(e,t)=>e.reactFlowNodeId===t.reactFlowNodeId&&e.name===t.name&&e.positionAbsoluteX===t.positionAbsoluteX&&e.positionAbsoluteY===t.positionAbsoluteY&&e.declaration===t.declaration&&e.version===t.version&&e.latest_version===t.latest_version&&e.subNodeId===t.subNodeId&&e.isSuperNode===t.isSuperNode&&e.hasPromptTemplate===t.hasPromptTemplate&&e.canConfigureInputs===t.canConfigureInputs&&e.customOperator===t.customOperator&&e.onRemove===t.onRemove&&e.onUpgrade===t.onUpgrade&&e.setIsOpenConfigureInputsModal===t.setIsOpenConfigureInputsModal&&e.setIsOpenPromptTemplateModal===t.setIsOpenPromptTemplateModal&&e.setIsOpenPublishCustomNodeModal===t.setIsOpenPublishCustomNodeModal&&e.setIsRenaming===t.setIsRenaming&&e.isTestMode===t.isTestMode&&e.setIsTestMode===t.setIsTestMode),a3=e=>{let{isHoveredDuringConnection:t,operatorId:r}=e;return(0,S.jsx)(K.Fragment,{children:(0,S.jsx)(eC.HH,{type:"target",position:ek.Ly.Left,style:{position:"absolute",width:"100%",height:"100%",borderRadius:"inherit",border:"0px transparent",background:"transparent",transform:"translateY(0%)",inset:0,zIndex:t?1e3:-100,pointerEvents:t?"all":"none"},id:"left-".concat(r),isConnectableStart:!1})})},a9=r(77739),a6=r(13895),a8=(0,K.memo)(e=>{let{item:t,size:r=18,operatorDeclarations:a=[],isExpanded:s=!1,className:n="",viewMode:l="",maxDisplayCount:o}=e,i=null;if("key_operators"in t&&t.key_operators)i=t.key_operators;else if("saved_item_plconfigs"in t){var d;i=(null===(d=t.saved_item_plconfigs)||void 0===d?void 0:d.reduce((e,t)=>{let r=t.savedItem.key_operators;return r&&Object.entries(r).forEach(t=>{let[r,a]=t,[s,n]=a;e[r]||(e[r]=[s,0]),e[r][1]+=n}),e},{}))||null}if(!i)return null;let c=Object.entries(i).reduce((e,t)=>{let[r,[a,s]]=t,n=(0,ro.F1)(a);return n&&"form"!==a&&(e[n]||(e[n]={names:[],count:0}),e[n].names.push(r),e[n].count+=s),e},{}),u=e=>{let t=a.find(t=>t.name===e);return t&&t.documentation_url?t.documentation_url:"https://docs.gumloop.com/getting-started"},m=Object.entries(i).some(e=>{let[t,[r]]=e;return"form"===r}),p=Object.entries(c),x=o&&p.length>o,h=x?p.slice(0,o):p,g=x?p.slice(o):[];return(0,S.jsx)("div",{className:"".concat(s?"flex flex-wrap gap-2":"flex flex-nowrap gap-2"," ").concat(n).trim(),children:Object.entries(c).length>0||m?(0,S.jsxs)(S.Fragment,{children:[h.map((e,t)=>{let[a,{names:n,count:l}]=e;return s?(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("a",{href:u(n[0]),target:"_blank",rel:"noopener noreferrer",className:"mr-2 flex flex-shrink-0 items-baseline",children:(0,S.jsxs)("div",{className:"border-border bg-background text-muted-foreground flex items-center justify-center rounded-md border p-2 px-4 shadow-sm",style:{height:r+18,width:r+18},children:[(0,rj.hY)(a,r,n.join(", ")),(0,S.jsx)("span",{className:"text-overflow-ellipsis text-card-foreground ml-1 overflow-hidden text-lg whitespace-nowrap",children:n.join(", ")})]})})}),(0,S.jsx)(eo._v,{children:"View Docs"})]},t):(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsxs)("div",{className:"relative flex flex-shrink-0 items-baseline",children:[(0,S.jsx)("div",{className:"border-border bg-background text-muted-foreground flex items-center justify-center rounded-md border p-2",style:{height:r+18,width:r+18},children:(0,rj.hY)(a,r,n.join(", "))}),l>1&&(0,S.jsxs)("span",{className:"bg-background text-muted-foreground absolute -right-2 -bottom-2 rounded-lg px-1 text-xs",children:["x",l]})]})}),(0,S.jsx)(eo._v,{children:n.join(", ")})]},a)}),x&&g.length>0&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{className:"relative flex flex-shrink-0 items-baseline",children:(0,S.jsx)("div",{className:"border-border bg-muted flex items-center justify-center rounded-md border p-2",style:{height:r+18,width:r+18},children:(0,S.jsxs)("span",{className:"text-muted-foreground text-xs font-medium",children:["+",g.length]})})})}),(0,S.jsx)(eo._v,{children:(0,S.jsx)("div",{className:"flex flex-col gap-1",children:g.map(e=>{let[t,{names:r}]=e;return(0,S.jsx)("span",{children:r.join(", ")},r.join(", "))})})})]}),m?(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{className:"relative flex flex-shrink-0 items-baseline",children:(0,S.jsx)("div",{className:"border-border bg-muted rounded-xl border p-2 shadow-sm",children:(0,S.jsxs)("span",{className:"flex items-center gap-1 text-pink-500",children:[(0,rj.hY)("FilePen",r,"Interface"),"Interface"]})})})}),(0,S.jsx)(eo._v,{children:"Flow contains Gumloop interface"})]}):null]}):"minimal"===l?(0,S.jsx)("div",{className:"mr-2 flex flex-shrink-0 items-center justify-center",children:(0,S.jsx)("div",{className:"border-border flex items-center justify-center overflow-hidden rounded-full border bg-transparent shadow-md",style:{width:"".concat(r+16,"px"),height:"".concat(r+16,"px")},children:(0,S.jsx)(tw(),{src:"/images/gumloop_logo_transparent.png",alt:"Gumloop",width:r,height:r,style:{objectFit:"contain"}})})}):null})}),a7=r(28900);let se=K.memo(e=>{let{declaration:t}=e;return(0,S.jsx)("div",{className:"relative flex items-center",children:(0,S.jsxs)(eo.u,{delayDuration:300,children:[(0,S.jsx)(eo.aJ,{asChild:!0,id:"operator-tooltip-button",className:"cursor-pointer text-[var(--node-color-dark)]",children:(0,S.jsx)(a7.Z,{size:18})}),(0,S.jsxs)(eo._v,{variant:"outline",className:"flex min-w-48 flex-col gap-2 !p-3 !text-sm",children:[(null==t?void 0:t.base_credit_cost)&&(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)("div",{className:"flex flex-col items-start justify-center gap-6 pr-4",children:(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("p",{className:"font-semibold",children:"Base Credit Cost:"}),(0,S.jsx)("p",{children:(e=>{if(!e)return null;let t=/(https?:\/\/[^\s]+)/g;return e.split("\n").map((r,a)=>(0,S.jsxs)("span",{children:[r.split(t).map((e,r)=>t.test(e)?(0,S.jsx)("a",{className:"text-pink-400 hover:text-pink-500",href:e,target:"_blank",rel:"noopener noreferrer",children:e},r):e),a!==e.split("\n").length-1&&(0,S.jsx)("br",{})]},a))})(t.base_credit_cost)})]})}),(0,S.jsx)("hr",{})]}),(0,S.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[(null==t?void 0:t.documentation_url)&&(0,S.jsx)(es(),{href:t.documentation_url,target:"_blank",rel:"noopener noreferrer",className:"text-accent-foreground underline hover:no-underline hover:opacity-80",children:"View Docs"}),(null==t?void 0:t.version)&&(0,S.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,S.jsx)(eU.C,{variant:"outline",size:"sm",children:(0,e5.V9)(t.version)})})]})]})]})})});se.displayName="OperatorTooltip";var st=r(5357),sr=r(51455),sa=r(78666),ss=e=>{let{declaration:t,batchModeEnabled:r,isSuperNode:a,handleNodeDataChange:s,toggleCollapse:n,isCollapsed:l}=e;return(0,S.jsxs)("div",{id:"batch-mode-selector",className:"nodrag flex gap-2",children:[t.allow_batch&&(0,S.jsxs)("div",{className:"flex items-center whitespace-nowrap",children:[(0,S.jsx)("span",{className:"mr-2 text-sm font-medium text-[var(--node-color-dark)]",children:"Loop Mode"}),(0,S.jsx)(eX.r,{checked:r,onCheckedChange:e=>{s({batch:e})},className:"data-[state=checked]:bg-[var(--node-color-medium)]"})]}),!a&&(0,S.jsx)("div",{className:"flex items-center",style:{color:"color-mix(in srgb, var(--node-color-black), transparent 40%)"},children:(0,S.jsx)(el.zx,{variant:"ghost",onClick:n,size:"icon-xs",className:"bg-transparent p-0 transition-colors duration-100 hover:bg-[var(--node-color-light)]/50 hover:text-[var(--node-color-dark)]",children:l?(0,S.jsx)(sr.Z,{className:"hover:text-muted-foreground transition-colors duration-100"}):(0,S.jsx)(sa.Z,{className:"hover:text-muted-foreground transition-colors duration-100"})})})]})},sn=(0,K.memo)(e=>{var t;let{nodeId:r,declaration:a,nickname:s,name:n,isCollapsed:l,noVisibleParams:o,batch:i,latestVersion:d,isSuperNode:c,hasBannerAbove:u,isRenaming:m,setIsRenaming:p,hasMissingSecrets:x,version:h}=e,g=(0,Q.v9)(rb.tY),f=(0,Q.v9)(R.z4),v=(0,Q.v9)(e=>(0,a9.gk)(e,(null==f?void 0:f.saved_item_id)||"")),j=(0,Q.v9)(e=>(0,a9.vj)(e,(null==f?void 0:f.saved_item_id)||"")),[b,_]=(0,K.useState)(void 0);(0,K.useEffect)(()=>{_(s||n)},[s,n]);let{handleNodeDataChange:y}=(0,eJ.Z)(r),w=(0,K.useCallback)(e=>{_(e.target.value),p(!0)},[_,p]),N=(0,K.useCallback)(e=>{("Enter"===e.key||"Escape"===e.key)&&(y({nickname:b}),p(!1))},[y,b,p]),k=(0,K.useCallback)(()=>{y({nickname:b}),p(!1)},[y,b,p]),C=(0,K.useCallback)(()=>{y({is_collapsed:!l})},[y,l]),I=(0,K.useMemo)(()=>{if(a.category===aQ.H.MEGA_OPERATOR){let e=a.metadata;return(null==e?void 0:e.category)||a.category}return s&&s!==n?n:"automation"===a.category?"Subflow":a.category},[s,n,a.category,a.metadata]),T=(0,K.useMemo)(()=>(a.category===aQ.H.MEGA_OPERATOR||a.category===aQ.H.CUSTOM_OPERATOR)&&a.short_description||a.description,[a.category,a.description,a.short_description]),E=(0,K.useMemo)(()=>!!g.find(e=>e.operator_id===a.operator_id)&&(0,as.C6)(d,a.category),[d,a.category,g,a.operator_id]),M=(null===(t=a.notice)||void 0===t?void 0:t.split(/(<a.*?<\/a>)/))||[],A=(0,K.useMemo)(()=>a.category===aQ.H.CUSTOM_OPERATOR||a.category===aQ.H.MEGA_OPERATOR,[a.category]),O=(0,K.useMemo)(()=>"automation"===a.category,[a.category]),Z=(0,K.useMemo)(()=>(0,rj.Fp)(a.icon),[a.icon]),z=!!v&&j,P=(0,K.useCallback)(e=>{var t;if(!z)return;let a=null===(t=e.target)||void 0===t?void 0:t.id;m||(null==a?void 0:a.includes("nickname-input"))||(null==a?void 0:a.includes("nickname-div"))||(e.stopPropagation(),(0,as.A2)(r))},[m,r,z]),D=(0,K.useMemo)(()=>{let e=(0,ro.F1)(a.category);return e.includes("gumloop")?null:e},[a.category]);return(0,S.jsx)("div",{className:"flex h-full w-full flex-col",children:(0,S.jsxs)("div",{className:(0,eu.cn)("node-header flex flex-col gap-2 rounded-b-2xl px-5 pt-5",u?"mx-1 mb-1":x?"m-1":"m-1 rounded-t-[0.75rem]",l?"pb-4":"pb-1",!l&&o&&"pb-6"),style:{background:c?"transparent":"linear-gradient(to bottom, color-mix(in srgb, var(--node-color-medium), transparent 80%), var(--elevated))"},title:z?"Double click to zoom into node in action feed":void 0,onDoubleClick:P,children:[(0,S.jsxs)("div",{className:"flex w-full items-center",children:[(Z||a.icon&&"circle.png"!=a.icon)&&(0,S.jsx)(sl,{declaration:a,isSuperNode:c,nodeId:r,shouldZoomToLog:z}),(0,S.jsxs)("div",{className:"flex w-full flex-col",children:[(0,S.jsxs)("div",{className:"flex w-full flex-row justify-between gap-1.5 pt-1.5",children:[(0,S.jsxs)("div",{className:"flex items-center justify-center gap-1.5",children:[E?(0,S.jsxs)(eo.u,{delayDuration:300,children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(eU.C,{size:"sm",variant:"outline",className:"uppercase",children:"Archived"})}),(0,S.jsx)(eo._v,{children:"This node can no longer be updated."})]}):(0,rO.$S)(h,d,n)&&(A||O)?(0,S.jsxs)(eo.u,{delayDuration:300,children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(eU.C,{size:"sm",variant:"pink",children:"Update Available"})}),(0,S.jsx)(eo._v,{children:"A new version of this node is available."})]}):(0,S.jsxs)(K.Fragment,{children:[D&&(0,S.jsx)(tw(),{src:D,alt:"Category Icon",width:20,height:20}),(0,S.jsx)("span",{className:(0,eu.cn)("text-foreground/80 truncate text-sm",!D&&"ml-1.75"),children:I})]}),(0,S.jsx)(se,{declaration:a})]}),(0,S.jsx)("div",{className:"flex items-center",children:(0,S.jsx)(ss,{declaration:a,batchModeEnabled:i||!1,isSuperNode:c,handleNodeDataChange:y,toggleCollapse:C,isCollapsed:l})})]}),m?(0,S.jsx)(ax.I,{type:"text",id:"nickname-input-".concat(r),className:(0,eu.cn)("text-foreground! nodrag mt-1 border-none bg-transparent !px-1.5 !py-0.25 !text-xl !font-medium ring-0 !ring-[var(--node-color-medium)] !outline-[var(--node-color-medium)] outline-none hover:bg-[var(--node-color-light)]/30 focus:bg-[var(--node-color-light)]/30"),value:b,onChange:w,onKeyDown:N,onBlur:k,maxLength:25,autoFocus:!0}):(0,S.jsx)("div",{id:"nickname-div-".concat(r),className:(0,eu.cn)("text-foreground! flex min-h-9 items-center rounded-md border-none bg-transparent !px-1.5 !text-xl !font-medium ring-0 !ring-[var(--node-color-medium)] !outline-[var(--node-color-medium)] outline-none",!E&&"hover:bg-[var(--node-color-light)]/30 focus:bg-[var(--node-color-light)]/30"),onDoubleClick:()=>{E||p(!0)},children:b})]})]}),a.key_operators&&Object.keys(a.key_operators).length>0&&(0,S.jsx)("div",{className:"flex",children:(0,S.jsx)(a8,{item:a||{},size:30,className:"space-x-0",maxDisplayCount:7})}),a.description&&!l&&(0,S.jsx)("div",{className:"text-muted-foreground pt-2 text-sm",style:{color:"color-mix(in srgb, var(--node-color-black), transparent 20%)",fontWeight:400,lineHeight:"normal"},children:T}),!l&&(0,S.jsx)("p",{className:"text-muted-foreground text-sm italic",children:M.map((e,t)=>{if(e.startsWith("<a")&&e.endsWith("</a>")){let r=e.match(/href="(.*?)"/),a=e.match(/>(.+?)</);if(r&&a)return(0,S.jsx)("a",{href:r[1],target:"_blank",rel:"noopener noreferrer",className:"underline",children:a[1]},t)}return e})})]})})});let sl=e=>{let{declaration:t,isSuperNode:r,nodeId:a,shouldZoomToLog:s}=e,n=(0,K.useMemo)(()=>(0,ro.T2)(t.category).dark,[t.category]),l=(0,K.useMemo)(()=>(0,rj.Fp)(t.icon),[t.icon]),o=(0,rj.Qq)(t),i="string"==typeof o,d=(0,K.useCallback)(e=>{s&&(e.stopPropagation(),(0,as.A2)(a))},[s,a]);return l?(0,S.jsx)("div",{className:"bg-background mr-4 flex aspect-square size-[72px] shrink-0 items-center justify-center overflow-hidden rounded-md",children:(0,S.jsx)(st.Z,{iconUrl:t.icon,alt:t.name,size:"lg"})}):(0,S.jsx)("div",{className:"mr-4 flex-shrink-0",children:(0,S.jsx)("div",{className:(0,eu.cn)("group/icon relative rounded-lg p-2.5",s&&"cursor-pointer"),style:{backgroundColor:r?"transparent":"color-mix(in srgb, var(--node-color-medium), transparent 60%)"},onClick:d,children:i?(0,S.jsxs)("div",{className:"bg-background flex size-[52px] items-center justify-center rounded-md",children:[(0,S.jsx)(tw(),{src:o,alt:t.name,width:36,height:36,style:{objectFit:"contain"},className:(0,eu.cn)(s&&"group-hover/icon:hidden")}),s&&(0,S.jsx)("div",{className:"absolute inset-0 hidden items-center justify-center group-hover/icon:flex",children:(0,S.jsx)(a6.Z,{size:36,style:{color:n}})})]}):(0,S.jsxs)("div",{className:"relative flex size-[52px] items-center justify-center",children:[(0,S.jsx)("div",{className:(0,eu.cn)("text-foreground",s&&"group-hover/icon:hidden"),children:(0,rj.Qq)(t,36,"","black")}),s&&(0,S.jsx)("div",{className:"absolute inset-0 hidden items-center justify-center group-hover/icon:flex",children:(0,S.jsx)(a6.Z,{size:36,style:{color:n}})})]})})})};var so=e=>{let{id:t}=e,{handleResumeRunFromNode:r}=(0,rD.wL)();return(0,S.jsx)(el.zx,{onClick:()=>r(t),size:"lg",className:"nodrag animate-border-pulse absolute -top-4 left-0 z-60 w-full max-w-1/2 -translate-y-full",children:"Run From Here"})},si=()=>(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)("div",{className:"shadow-floating bg-background absolute top-[6%] left-0 -z-[1] my-auto h-[90%] w-12 -translate-x-[0.6rem] rounded-l-xl border transition-transform ease-in-out",children:(0,S.jsx)("div",{className:"absolute inset-1 rounded-l-xl"})}),(0,S.jsx)("div",{className:"shadow-floating bg-background absolute top-[12%] left-0 -z-[2] my-auto h-[80%] w-12 -translate-x-[1.2rem] rounded-l-xl border transition-transform ease-in-out",children:(0,S.jsx)("div",{className:"absolute inset-1 rounded-l-xl"})})]}),sd=(0,K.memo)(e=>{let{nodeId:t}=e;return(0,S.jsx)(eC.HH,{type:"target",position:ek.Ly.Top,id:"".concat(t,"-input-SUBSCRIPTION"),className:"subscription-handle",style:{backgroundColor:"var(--background)",width:"60px",height:"12px",borderRadius:"9999px",top:"-6px",left:"50%",transform:"translateX(-50%)",border:"2px solid var(--muted-foreground)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},isConnectable:!1,"data-handleid":"".concat(t,"-input-SUBSCRIPTION"),"data-handlepos":"top","data-nodeid":t})}),sc=e=>{let{id:t}=e,r=(0,ez.TL)();return(0,S.jsx)(el.zx,{onClick:()=>{let e=new CustomEvent("template-checklist-select",{detail:{id:t}});document.dispatchEvent(e),r((0,F.fL)(e=>e.map(e=>({...e,data:{...e.data,canSelectForChecklist:!1}}))))},variant:"secondary",size:"lg",className:"nodrag outline-accent-foreground/20 absolute -top-4 left-0 z-60 w-full max-w-1/2 -translate-y-full outline-4",children:"Select Node"})};let su=(0,K.memo)(()=>(0,S.jsx)("div",{className:(0,eu.cn)("m-1 flex items-center justify-between rounded-t-[0.85rem] px-4 py-2 transition-colors duration-100","bg-muted text-muted-foreground"),children:(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)("span",{className:"text-md font-semibold transition-colors duration-100",children:"âš ï¸ This node is in Test Mode, any edits will not be saved"}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(e$.Z,{className:"size-4"})}),(0,S.jsx)(eo._v,{className:"w-96 whitespace-pre-wrap",children:'This node is in Test Mode, which lets you test the node in isolation without worrying about the rest of the flow. You can edit any of the fields below, and then click "Run Test" to run this node. You can stop testing by clicking the "Stop Testing" button at the bottom of the node.'})]})]})}));su.displayName="TestModeHeader";var sm=r(93513),sp=e=>{let t,r,{hasDynamicAttributes:a,dynamicAttributes:s,selectOptionalAttributeParameter:n,parentName:l,parameterName:o,oldValue:i,connectedInputBadges:d}=e;if(a&&s&&n&&(0,ad.iU)(n,l,o)){let e=s.findIndex(e=>e.name===i);-1!==e&&(t=(0,sm.Uy)(s,t=>{t.splice(e,1)}),d&&(r=d.filter(e=>e.inputName!==i)))}return{updatedDynamicAttributes:t,updatedConnectedInputBadges:r}},sx=r(15261),sh=(e,t,r,a,s,n,l)=>{let o=e.data,i=(0,eC.ZP)((null==o?void 0:o.subNodeId)||""),d=(0,eC.ZP)((null==o?void 0:o.parentNodeId)||""),{handleNodeDataChange:c,handleNodesDataChange:u}=(0,eJ.Z)(e.id);return(0,K.useCallback)((n,o,m,p,x,h,g,f,v,j)=>(0,sx.xi)({props:e,hasDynamicAttributes:n,selectOptionalAttributeParameter:o,dynamicAttributeDependentParameter:m,parameterName:p,newValue:x,attributes:h,dynamic_attributes:g,newParams:f,isOutputs:v,parentName:j,userProfile:l,idToken:a.current,currentProject:s,isSubNode:t,isSuperNode:r,parentNode:d,subNode:i,handleNodeDataChange:c,handleNodesDataChange:u}),[e,t,r,a,s,l,c,u,d,i])},sg=e=>{let{operatorNodeProps:t,isSubNode:r,isSuperNode:a,userProfile:s,idTokenRef:n,shouldUseDynamicOutputs:l,currentProject:o,subNode:i}=e,{handleNodeDataChange:d}=(0,eJ.Z)(t.id),c=sh(t,r,a,n,o,l,s);return{handleMultipleParameterChanges:(0,K.useCallback)(e=>{if(0===e.length)return;let s=E.Z.getState().flow.nodes.find(e=>e.id===t.id).data,n=s.declaration,l=sv(s),o=l.parameters,u=l.dynamic_outputs,m=l.dynamic_inputs,p=l.connectedInputBadges,x=l.input_errors,h=!1;for(let{parameterName:t,newValue:l,parentName:d}of e){if(!sf(s.name,t,l))continue;let e=o.find(e=>e.name===(d||t));if(e){let r=e=>d&&d===e.name?(0,sm.Uy)(e,e=>{e.value&&"string"!=typeof e.value||(e.value=[]);let r=e.value,a=r.find(e=>void 0!==e[t]);if(a){if("string"==typeof l){var o,i,c,x;let e=a[t],r=sp({hasDynamicAttributes:s.has_dynamic_outputs,dynamicAttributes:u,selectOptionalAttributeParameter:n.select_optional_outputs_parameter,parentName:d,parameterName:t,oldValue:e,connectedInputBadges:p}),h=sp({hasDynamicAttributes:s.has_dynamic_inputs,dynamicAttributes:m,selectOptionalAttributeParameter:n.select_optional_inputs_parameter,parentName:d,parameterName:t,oldValue:e,connectedInputBadges:p});u=null!==(o=r.updatedDynamicAttributes)&&void 0!==o?o:u,m=null!==(i=h.updatedDynamicAttributes)&&void 0!==i?i:m,p=null!==(x=null!==(c=r.updatedConnectedInputBadges)&&void 0!==c?c:h.updatedConnectedInputBadges)&&void 0!==x?x:p,a[t]=l}}else{let e={};"string"==typeof l&&(e[t]=l),r.push(e)}}):e.name===t?(0,sm.Uy)(e,e=>{e.value=l,e.error_message=""}):e;o=o.map(e=>r(e)),"boolean"===e.data_type&&(h=!0)}else o=[...o,{name:t,value:l,data_type:"",placeholder:"",error_message:""}];x&&x[t]&&delete x[t];let f=o.findIndex(e=>"credentials_to_use"===e.name);if("credentials_to_use"!==t&&-1!==f){var g;let e=null===(g=o[f])||void 0===g?void 0:g.value,t=(0,rW.Cg)(null!=e?e:{},n,o,a,i);o[f]={...o[f],value:t}}let v=c(s.has_dynamic_outputs,n.select_optional_outputs_parameter,n.dynamic_outputs_dependent_parameter,t,l,s.outputs,u,o,!0,d),j=c(s.has_dynamic_inputs,n.select_optional_inputs_parameter,n.dynamic_inputs_dependent_parameter,t,l,s.inputs,m,o,!1,d);!r&&v&&"updated"!==v&&(u=v),j&&"updated"!==j&&(m=j)}let f={parameters:o},v=(0,rO.NQ)(s.outputNicknames,u);h?(r||(f.dynamic_outputs=[...u],f.outputNicknames=v),f.dynamic_inputs=[...m]):(r||JSON.stringify(u)===JSON.stringify(s.dynamic_outputs)||(f.dynamic_outputs=u,f.outputNicknames=v),JSON.stringify(m)!==JSON.stringify(s.dynamic_inputs)&&(f.dynamic_inputs=m)),JSON.stringify(p)!==JSON.stringify(s.connectedInputBadges)&&(f.connectedInputBadges=p),JSON.stringify(x)!==JSON.stringify(s.input_errors)&&(f.input_errors=x),d(f)},[c,d,r,a,t.id,i])}};let sf=(e,t,r)=>!(Array.isArray(r)&&r.some(e=>"object"==typeof e)&&!("Router"===e&&("routes"===t||"AI_Routes"===t))),sv=e=>({parameters:[...e.parameters||[]],dynamic_outputs:[...e.dynamic_outputs||[]],dynamic_inputs:[...e.dynamic_inputs||[]],connectedInputBadges:[...e.connectedInputBadges||[]],input_errors:{...e.input_errors||{}}});function sj(e,t){if(null===e||null===t)return!1;let r=Array.isArray(e)?e:[e],a=Array.isArray(t)?t:[t];if(r.length!==a.length)return!1;for(let e=0;e<r.length;e++)if(r[e].id!==a[e].id||r[e].type!==a[e].type||!Object.is(r[e].data,a[e].data))return!1;return!0}var sb=r(29020),s_=(e,t)=>{var r;let a=(0,eC.vA)({id:t}),s=(0,K.useMemo)(()=>a.filter(e=>e.source!==t),[a,t]),n=(0,K.useMemo)(()=>[...new Set(s.map(e=>{let{source:t}=e;return t}))],[s]),l=(0,eC.$P)(n),o=(r=s.map(e=>{let{edgeId:t}=e;return t}),(0,eC.oR)((0,K.useCallback)(e=>{var t;let a=[],s=Array.isArray(r);for(let t of s?r:[r]){let r=e.edgeLookup.get(t);r&&a.push({id:r.id,type:r.type,data:r.data})}return s?a:null!==(t=a[0])&&void 0!==t?t:null},[r]),sj)),i=(0,K.useMemo)(()=>Array.from(new Set(l.reduce((e,t)=>{let r=t.data.subNodeId;return r&&e.push(r),e},[]))),[l]),d=(0,eC.$P)(i),c=(0,K.useMemo)(()=>[...l,...d],[l,d]),u=(0,K.useMemo)(()=>sN(c),[c]),m=(0,K.useCallback)(t=>{let r=sy(e,t);if(r)return r;let a=sw(l,t);if(a)return a;let n=sC(c,o,s,u);return sI(t,n,c)?{sourceNodes:l,sourceNodeInputsMap:n}:t},[l,o,s,e,d]),[p,x]=(0,K.useState)(m({sourceNodes:null,sourceNodeInputsMap:null}));return(0,K.useEffect)(()=>{x(m)},[m]),p};let sy=(e,t)=>e&&e.length?null:t.sourceNodeInputsMap?{sourceNodes:null,sourceNodeInputsMap:null}:t,sw=(e,t)=>e.length?null:!t.sourceNodeInputsMap||Object.keys(t.sourceNodeInputsMap).length?{sourceNodes:[],sourceNodeInputsMap:{}}:t,sN=e=>{let t=new Map;return e.forEach(e=>t.set(e.id,e)),t},sk=(e,t)=>{let r=[];return t.forEach(t=>{var a;if((null===(a=t.data)||void 0===a?void 0:a.connectionGroupType)&&"DEFAULT"!==t.data.connectionGroupType){let a=t.data.connectionGroupType,s=e.filter(e=>(0,eH.vK)(e.name)===a);r=[...r,...s]}else{let t=e.filter(e=>"DEFAULT"===(0,eH.vK)(e.name));r=[...r,...t]}}),r},sC=(e,t,r,a)=>{let s={};return e.forEach(e=>{let n=t.filter((t,a)=>r[a].source===e.id),l=e.data,o=l.subNodeId?a.get(l.subNodeId):void 0,i=sk((0,sb.w_)(l,o)||[],n).filter((e,t,r)=>t===r.findIndex(t=>t.name===e.name));s[e.id]=i}),s},sI=(e,t,r)=>{var a,s,n;let l=new Set((null===(a=e.sourceNodes)||void 0===a?void 0:a.map(e=>e.data.nickname).filter(e=>void 0!==e))||[]),o=new Set(r.map(e=>e.data.nickname).filter(e=>void 0!==e)),i=new Set((null===(s=e.sourceNodes)||void 0===s?void 0:s.map(e=>(0,as.tK)(e)))||[]),d=new Set(r.map(e=>(0,as.tK)(e))),c=(null===(n=e.sourceNodes)||void 0===n?void 0:n.map(e=>e.data.outputNicknames))||[],u=r.map(e=>e.data.outputNicknames);return!eE()(e.sourceNodeInputsMap,t)||!eE()(l,o)||!eE()(i,d)||!eE()(c,u)};var sT=e=>({shouldUseDynamicInputs:(0,K.useCallback)(()=>(0,sb.XP)(e),[e]),shouldUseDynamicOutputs:(0,K.useCallback)(()=>(0,sb.T4)(e),[e])}),sS=(e,t,r,a)=>{let s=e.data,n=s.declaration,l=s.parameters,o=(0,eC.ZP)((null==s?void 0:s.subNodeId)||""),{handleNodeDataChange:i}=(0,eJ.Z)(e.id),d=(0,K.useCallback)((e,n)=>{let d=null==e?void 0:e.condition;if(!d)return;let c="inputs"===n?r()?s.dynamic_inputs:s.inputs:a()?s.dynamic_outputs:s.outputs,u=t(d,l,o)?e.true:e.false;if(!c||c.every(e=>e.data_type===u))return;let m=c.map(e=>({...e,data_type:e.data_type!==u?u:e.data_type}));r()&&"inputs"===n?i({dynamic_inputs:m}):"inputs"===n?i({inputs:m}):a()&&"outputs"===n?i({dynamic_outputs:m}):i({outputs:m})},[s,r,a,t,l,o,i]);(0,K.useEffect)(()=>{d(n.dynamic_input_types_condition,"inputs"),d(n.dynamic_output_types_condition,"outputs")},[l,d,n.dynamic_input_types_condition,n.dynamic_output_types_condition])},sE=r(14908),sM=r(32782),sA=r(98143),sO=r(82244),sZ=r(20997),sz=r(99998),sP=r(11355),sD=r(91478);let sL=e=>{var t;let{parameter:r,declarationParameter:a,parentName:s,handleParameterChanges:n,isDisabled:l=!1,parameters:o,className:i}=e,d=(0,K.useMemo)(()=>{let e=(0,rO.B8)(a.data_type);return Array.isArray(e)&&e.length>0&&"object"==typeof e[0]?e:[]},[a.data_type]),c=(0,K.useMemo)(()=>{var e;let t=o.find(e=>"model_preference"===e.name);return null!==(e=null==t?void 0:t.value)&&void 0!==e?e:null==t?void 0:t.placeholder},[o]),u=(0,K.useMemo)(()=>(0,sP.E)(c,d),[d,c]),m=null!==(t=r.value)&&void 0!==t?t:[];return(0,S.jsx)(sD.Z,{value:m,onChange:e=>{n([{parameterName:a.name,newValue:e,parentName:s}])},modelGroups:d,primaryModelProvider:u,disabled:l,className:i})};sL.displayName="FallbackModelPickerElement";var sR=(0,K.memo)(sL);let sF=e=>{let{declarationParameter:t,index:r,isDisabled:a,handleRemoveChild:s,renderParameters:n}=e,l=t.structure.map((e,t)=>{let a="".concat(e.name,"-").concat(r,"-").concat(t);return{...e,name:a}}),o=l.map(e=>e.name),i=1===l.length,d=n(l,r,t.name,i);return(0,S.jsxs)("div",{"data-testid":"child-".concat(t.name.toLowerCase().replaceAll(" ","-"),"-").concat(r),className:(0,eu.cn)("flex",i?"w-full flex-row-reverse justify-stretch gap-2":"border-muted bg-muted/30 relative mb-3 flex-col rounded-xl border-2 px-3 py-2",a&&"pointer-events-none opacity-50"),children:[(0,S.jsx)(el.zx,{className:i?"mt-2.5":"absolute top-2 right-2 z-10",onClick:()=>s(t.name,o),"aria-label":"remove child",disabled:a,size:"icon-xs",variant:"ghost",children:(0,S.jsx)(t_.Z,{})}),d.map((e,t)=>(0,S.jsx)("div",{className:"grow",children:e},t))]})};var sG=e=>{let{objChildrenCount:t,declarationParameter:r,isDisabled:a,handleAddChild:s,handleRemoveChild:n,renderParameters:l,parameter:o,handleParameterChanges:i}=e,d=t[r.name]||0;(0,K.useEffect)(()=>{if(!o||void 0!==o.value)return;let e=null==r?void 0:r.default_value;if(!Array.isArray(e)||0===e.length)return;let t=r.structure||[],a=[];e.forEach((e,s)=>{t.forEach((t,n)=>{var l;let o="".concat(t.name,"-").concat(s,"-").concat(n),i=null!==(l=e[t.name])&&void 0!==l?l:"";a.push({parameterName:o,newValue:i,parentName:r.name})})}),a.length&&i(a)},[null==o?void 0:o.value,r,i]);let c="add-button-".concat(r.name.toLowerCase().replaceAll(" ","-"));return(0,S.jsxs)("div",{className:"flex flex-col gap-1",children:[Array.from({length:d}).map((e,t)=>(0,S.jsx)(sF,{declarationParameter:r,index:t,isDisabled:a,handleRemoveChild:n,renderParameters:l},"child-".concat(r.name.toLowerCase().replaceAll(" ","-"),"-").concat(t))),(0,S.jsx)("div",{className:"flex w-full justify-start",children:(0,S.jsxs)(el.zx,{className:c,variant:"outline",onClick:()=>s(r.name),"aria-label":"add children",disabled:a,children:[(0,S.jsx)(er.Z,{className:"h-4 w-4"}),(0,S.jsxs)("span",{children:["Add ",r.name]})]})})]})},sU=r(80686);let sB=e=>{let{parameter:t,declarationParameter:r,parentName:a,handleParameterChanges:s,isDisabled:n=!1,error:l,className:o}=e,i=(0,rO.B8)(r.data_type),d=t?t.value||r.placeholder||"":r.placeholder||"",c=(0,K.useMemo)(()=>Array.isArray(i)&&i.length>0&&"object"==typeof i[0]?i:[],[i]);return(0,S.jsx)(sU.Z,{options:c,value:d,onChange:e=>s([{parameterName:r.name,newValue:e,parentName:a}]),disabled:n,triggerProps:{className:o},error:l})};sB.displayName="AIModelPickerElement";var sV=(0,K.memo)(sB),sW=e=>{let{parameter:t,data:r,visibleInputs:a,operatorNodeProps:s,declarationParameters:n,sourceNodes:l,sourceNodeInputsMap:o,handleParameterChanges:i,handleNodeDataChange:d,handleNodesDataChange:c,connectedInputBadges:u,isTestMode:m,isExtraSettings:p}=e,x=n.find(e=>e.name===t.name),h=(0,K.useCallback)((e,t)=>{var r;i([{parameterName:null!==(r=null==x?void 0:x.name)&&void 0!==r?r:"",newValue:t}])},[null==x?void 0:x.name,i]),g=(0,K.useMemo)(()=>{var e;return Array.isArray(t.value)?t.value.map(e=>e.toString()):(null!==(e=t.value)&&void 0!==e?e:"").toString()},[t.value]);if(!t||!x)return null;if(!t.value){let e=u.find(e=>e.inputName===x.name&&e.isMultiBadgeTextInput);e&&!m&&i([{parameterName:x.name,newValue:"${".concat(e.sourceNodeOutputName,"__NODE_ID__:").concat(e.sourceNodeId,"}")}])}let{message:f,fullNames:v}=(()=>{if(!r.parameter_input_errors||!r.parameter_input_errors[x.name])return{message:"",fullNames:[]};let e=[],t=[],a=r.parameter_input_errors[x.name];return Object.keys(a).forEach(r=>{let s=a[r];Object.keys(s).forEach(a=>{let n=s[a];n&&(e.push(n),t.push("".concat(a,"__NODE_ID__:").concat(r)))})}),{message:e.length>0?e[0]:"",fullNames:t}})();return(0,S.jsxs)("div",{className:"relative",children:[(0,S.jsxs)("div",{className:"flex items-center justify-between",children:[(0,S.jsx)("div",{className:"flex-1",children:(0,at.W)(x,void 0,p)}),(0,S.jsx)(au,{inputName:x.name,visibleInputs:a,batchMode:s.data.batch})]}),(0,S.jsx)("div",{className:"relative z-10 ".concat(f?"mb-10":""),onClick:e=>e.stopPropagation(),children:m?(0,S.jsx)(aa.Z,{input:{...x,value:g},handleInputValueChange:h,hideLabel:!0}):(0,S.jsx)(ri.tc,{isDisabled:!1,parameter:t,declarationParameter:x,handleParameterChanges:i,showBadgePalette:!1,sourceNodeInputsMap:o,sourceNodes:l,operatorNode:s,handleNodeDataChange:d,handleNodesDataChange:c,errors:v})}),(0,S.jsx)(ao,{inputName:x.name,message:f,isMultiBadgeTextInput:!0})]},x.name)},sH=e=>{let t=e.data,{handleNodeDataChange:r}=(0,eJ.Z)(e.id),a=e=>{var r;let a="input"===e?"dynamic_inputs":"dynamic_outputs",s="input"===e?"inputs":"outputs",n=(null===(r=t[a])||void 0===r?void 0:r.length)?t[a]:t[s],l=n.map(t=>t.name.match(new RegExp("^".concat(e,"(\\d+)$")))).filter(Boolean).map(e=>parseInt(e[1])),o=null==n?void 0:n.find(t=>t.name.includes(e)),i=(null==o?void 0:o.data_type)||"string",d=l.length>0?Math.max(...l):0,c={name:"".concat(e).concat(d+1),data_type:i,attribute_type:e,is_optional:!0};return(0,sm.Uy)(n,e=>{e.push(c)})};return(0,S.jsxs)(el.zx,{className:"nodrag",onClick:()=>{let e=a("input");if("OUTPUT_BUTTON"==t.declaration.select_optional_outputs_parameter){r({dynamic_inputs:e,dynamic_outputs:a("output")});return}r({dynamic_inputs:e})},"aria-label":"add inputs",variant:"outline",children:[(0,S.jsx)(er.Z,{}),"Add Input"]},"add-input-handle-".concat(e.id))},sJ=r(83951),sq=e=>{let{props:t,objChildrenCount:r,isSubNode:a,currentProject:s,handleParameterChanges:n,visibleInputs:l,canConfigureInputs:o,setIsOpenConfigureInputsModal:i,showExtraSettings:d,setShowExtraSettings:c,effectiveSecretTypes:u,currentFlowbook:m,sourceNodeInputsMap:p,sourceNodes:x}=e,h=t.data,g=h.declaration,f=h.parameters,v=(0,eC.ZP)((null==h?void 0:h.subNodeId)||""),j=(0,eC.ZP)((null==h?void 0:h.parentNodeId)||""),b=sH(t),{shouldUseDynamicInputs:_}=sT(h),{handleNodeDataChange:y,handleNodesDataChange:w}=(0,eJ.Z)(t.id),{shouldRenderAttribute:N}=(0,sJ.Z)(h,t.id),k=(e,t,r,a,s,n,l)=>{let o;let i=e.dynamic_options_parameter_key,d={handleNodeDataChange:n};if(i){let t=(e=>{let t=(0,aX.KQ)(e.data_type),r=aX.$T[t];return r?{component:r,additionalProps:{optionsParameterName:e.dynamic_options_parameter_key,dependencyParameterName:e.dynamic_options_parameter_dependents,endpoint:"dynamic_gumcp_attributes"}}:null})(e);if(!t)return null;o=t.component,d={...d,...t.additionalProps}}else{var c,m;let r;(r=null===(c=sO.e_[t.name])||void 0===c?void 0:c[e.name])||(r=sO.Xc[e.name]);let a="component"in(m=r)?{component:m.component,additionalProps:m.props||{}}:{component:m,additionalProps:{}};o=a.component,d={...d,...a.additionalProps}}return(0,K.createElement)(o,{parameter:r,parameters:a,declarationParameter:e,handleParameterChanges:l,isDisabled:s,error:null==r?void 0:r.error_message,subNode:v,data:t,className:"w-full",effectiveSecretTypes:u,...d})},C=(0,K.useMemo)(()=>(e,a,s,o,i,d)=>{let c;let u=void 0!==s?"".concat(e.name,"-").concat(s,"-").concat(a):"".concat(e.name,"-").concat(a);if(o){let t=f.find(e=>e.name===o),r=null==t?void 0:t.value;if(r){let t=r.find(t=>t.hasOwnProperty(e.name)),a=t?t[e.name]:"";c=(0,sM.A)(e,a)}}else c=f.find(t=>t.name===e.name);let m=!!(null==c?void 0:c.disabled),v=l.some(t=>t.name===e.name)&&e.data_type.startsWith("string"),j=null;if((e.is_dynamic||e.dynamic_options_parameter_key)&&!v)j=k(e,h,c,f,m,y,n);else if("boolean"===e.data_type){var b;j=(0,S.jsx)(ri.PT,{parameter:c,declarationParameter:e,parentName:o,handleParameterChanges:n,onColor:"".concat((null===(b=(0,ro.T2)(g.category))||void 0===b?void 0:b.medium)||"var(--destructive)"),offColor:"var(--muted)"})}else j=e.data_type.startsWith("ai_model_picker(")?(0,S.jsx)(sV,{isDisabled:m,parameter:c,declarationParameter:e,parentName:o,handleParameterChanges:n,error:null==c?void 0:c.error_message,className:"w-full!"}):e.data_type.startsWith("fallback_model_picker(")?(0,S.jsx)(sR,{isDisabled:m,parameter:c,declarationParameter:e,parentName:o,handleParameterChanges:n,error:null==c?void 0:c.error_message,parameters:f}):e.data_type.startsWith("enum(")||e.data_type.startsWith("grouped_enum(")?(0,S.jsx)(ri.nj,{isDisabled:m,parameter:c,declarationParameter:e,parentName:o,handleParameterChanges:n,error:null==c?void 0:c.error_message,className:"w-full!"}):e.data_type.startsWith("multi_select_enum(")?(0,S.jsx)(ri.Q5,{isDisabled:m,parameter:c,declarationParameter:e,parentName:o,handleParameterChanges:n,error:null==c?void 0:c.error_message,className:"w-full!"}):"File"===e.data_type?(0,S.jsx)(rl.Z,{isDisabled:m,handleParameterChanges:n,parameter:c,declarationParameter:e,error:null==c?void 0:c.error_message}):"GoogleDrive"===e.data_type?(0,S.jsx)(sE.Z,{isDisabled:m,handleParameterChanges:n,parameter:c,parameters:f,declaration:g,declarationParameter:e,error:null==c?void 0:c.error_message,foldersOnly:"Folder"===e.name||"Parent Folder"===e.name,sheetsOnly:"Select Sheet"===e.name,presentationsOnly:"Template Presentation"===e.name||"Presentation"===e.name,formsOnly:"Form"===e.name}):"CodeEditor"===e.data_type?(0,S.jsx)(ri.cS,{isDisabled:m,handleParameterChanges:n,parameters:f,error:null==c?void 0:c.error_message}):"Date"===e.data_type?(0,S.jsx)(ri.$5,{isDisabled:m,parameter:c,handleParameterChanges:n,error:null==c?void 0:c.error_message}):"datetime"===e.data_type?(0,S.jsx)(ri.UD,{isDisabled:m,parameter:c,handleParameterChanges:n,error:null==c?void 0:c.error_message}):"RelativeDate"===e.data_type?(0,S.jsx)(ri.VL,{isDisabled:m,parameter:c,handleParameterChanges:n,error:null==c?void 0:c.error_message}):"object[]"===e.data_type?(0,S.jsx)(sG,{objChildrenCount:r,declarationParameter:e,isDisabled:m,handleAddChild:I,handleRemoveChild:T,renderParameters:M,parameter:c,handleParameterChanges:n}):"object_field"===e.data_type?(0,S.jsx)(ri.WB,{isDisabled:m,parameter:c,handleParameterChanges:n,error:null==c?void 0:c.error_message}):"draggable_badge_inputs"==e.data_type?(0,S.jsx)(ri.tc,{isDisabled:m,inputs:_()?h.dynamic_inputs:h.inputs,parameter:c,declarationParameter:e,parentName:o,handleParameterChanges:n}):"CredentialsPicker"===e.data_type?(0,S.jsx)(sZ.ZP,{parameter:c,parameters:f,declarationParameter:e,handleParameterChanges:n,error:null==c?void 0:c.error_message,declaration:g}):"EnvironmentVariablesPicker"===e.data_type?(0,S.jsx)(sz.Z,{parameter:c,declaration:g,declarationParameter:e,handleParameterChanges:n,error:null==c?void 0:c.error_message,isDisabled:m}):v?(0,S.jsx)(sW,{isTestMode:!!h.isInTestMode,parameter:c,data:h,visibleInputs:l,operatorNodeProps:t,declarationParameters:[...g.parameters,...g.additional_parameters],sourceNodes:x||[],sourceNodeInputsMap:p||{},handleParameterChanges:n,handleNodeDataChange:y,handleNodesDataChange:w,connectedInputBadges:h.connectedInputBadges,isExtraSettings:!!d}):(0,S.jsx)(ri.Z4,{isDisabled:m,parameter:c,declarationParameter:e,parentName:o,handleParameterChanges:n});let N=["Date"],C=()=>(0,at.W)(e,o,d,N);return(0,S.jsx)("div",{className:(0,eu.cn)("relative",d&&"nowheel bg-background border-border mb-2 rounded-md border p-2"),children:(0,S.jsx)("div",{className:(0,eu.cn)(!d&&(o?"py-1":"py-2")),children:(0,S.jsx)("div",{className:(0,eu.cn)("boolean"===e.data_type?"relative flex flex-row items-center justify-between":"pb-2"),onClick:e=>e.stopPropagation(),children:N.includes(e.data_type)?(0,S.jsxs)("div",{className:"flex flex-row space-x-2",children:[j,!(i||v)&&C()]}):(0,S.jsxs)(S.Fragment,{children:[!(i||v)&&C(),j]})})})},u)},[f,r,v,n,x,p]),I=e=>{var t;let r=f.findIndex(t=>t.name===e),a=g.parameters.find(t=>t.name===e);-1!==r&&(null==a?void 0:null===(t=a.structure)||void 0===t?void 0:t[0])&&y({parameters:(0,sm.Uy)(f,e=>{let t=e[r].value||[],s=t.reduce((e,t)=>Math.max(e,parseInt(Object.keys(t)[0].split("-")[1])),-1)+1,n=a.structure[0].name;t.push({["".concat(n,"-").concat(s,"-0")]:""}),e[r].value=t})})},T=(e,r)=>{let s=f.findIndex(t=>t.name===e);if(-1==s)return;let n=!1,l=[...h.dynamic_inputs],o=[...h.dynamic_outputs],i=[...h.connectedInputBadges||[]],d=f[s].value||[];r.forEach(t=>{let r=d.findIndex(e=>void 0!==e[t]);if(-1!==r){let a=Object.values(d[r])[0],s=sp({hasDynamicAttributes:h.has_dynamic_outputs,dynamicAttributes:o,selectOptionalAttributeParameter:g.select_optional_outputs_parameter,parentName:e,parameterName:t,oldValue:a,connectedInputBadges:i}),c=sp({hasDynamicAttributes:h.has_dynamic_inputs,dynamicAttributes:l,selectOptionalAttributeParameter:g.select_optional_inputs_parameter,parentName:e,parameterName:t,oldValue:a,connectedInputBadges:i});s.updatedDynamicAttributes&&(o=s.updatedDynamicAttributes,n=!0),c.updatedDynamicAttributes&&(l=c.updatedDynamicAttributes,n=!0),s.updatedConnectedInputBadges&&(i=s.updatedConnectedInputBadges,n=!0),c.updatedConnectedInputBadges&&(i=c.updatedConnectedInputBadges,n=!0)}});let c=(0,sm.Uy)(f,e=>{let t=e[s],a=[...t.value||[]],n=e=>{let t=a.findIndex(t=>void 0!==t[e]);-1!==t&&a.splice(t,1)};r.forEach(e=>{n(e)}),(()=>{let e=parseInt(r[0].split("-")[1]);a=a.map(t=>{let r={...t};return Object.keys(r).forEach(t=>{let a=t.split("-"),s=parseInt(a[1]);s>e&&(a[1]=(s-1).toString(),r[a.join("-")]=r[t],delete r[t])}),r})})(),t.value=a});if(n){if(a){let{dynamic_outputs:e,batch:r}=(0,sA.ce)(j,{...t,data:{...h,dynamic_outputs:o,dynamic_inputs:l}}),a=(0,rO.D_)({superNodeId:j.id,subNodeId:t.id});w({[t.id]:{parameters:c,dynamic_outputs:o,dynamic_inputs:l,connectedInputBadges:i,position:a},[j.id]:{batch:r,dynamic_outputs:e}})}else console.log("[RP1] Updating node data with dynamic attributes:",{parameters:c,dynamic_outputs:o,dynamic_inputs:l,connectedInputBadges:i}),y({parameters:c,dynamic_outputs:o,dynamic_inputs:l,connectedInputBadges:i})}else y({parameters:c,connectedInputBadges:i})},E=()=>{if(o)return(0,S.jsx)(rT.z,{onClick:()=>i(!0),className:"nodrag bg-background w-full rounded-md border text-sm !normal-case",variant:"outline",children:"Configure Inputs"})},M=(0,K.useMemo)(()=>function(e,t,r,a,s){let n=e.filter(e=>N(e,h.parameters,v,r,t));if(!r){let e=Object.fromEntries((null==l?void 0:l.map(e=>[e.name,e]))||[]);n=n.filter(t=>!e[t.name]||!!t.data_type.startsWith("string"))}let o=n.map((e,n)=>C(e,n,t,r,a,s));return h.has_dynamic_inputs&&"INPUT_BUTTON"===g.select_optional_inputs_parameter&&o.push(b),s?o=[...o,E()]:r||(o=o.flatMap((e,t)=>[e,t<o.length-1?(0,S.jsx)("hr",{className:"bg-border my-1"},"spacer-".concat(t)):null]).filter(Boolean)),o},[null==m?void 0:m.flowbook_id,g.parameters,f,g.additional_parameters,h.is_collapsed,h.inputs,h.outputs,v,r,o,d,c,C]);return{renderParameter:C,renderParameters:M}},sK=(0,K.memo)(e=>{var t,r,a,s,n,l,o,i,d;let c=e.data,u=c.declaration,m=c.parameters,p=(0,K.useMemo)(()=>!!e.parentId,[e.parentId]),x=(0,K.useMemo)(()=>!!u.is_super_node,[u.is_super_node]),h=(0,eC.ZP)(e.parentId||""),g=null==h?void 0:h.data.name,f=(0,eC.ZP)(c.subNodeId||""),v=(0,K.useMemo)(()=>!!c.is_collapsed,[c.is_collapsed]),{userProfile:j,idTokenRef:b}=(0,K.useContext)(ec.f),{currentProject:_}=(0,K.useContext)(e0.xI),[y,w]=(0,K.useState)(void 0),[N,k]=(0,K.useState)(!1),[C,I]=(0,K.useState)(!1),[T,E]=(0,K.useState)(!1),[M,A]=(0,K.useState)(!1),[O,Z]=(0,K.useState)(!1),[z,P]=(0,K.useState)(!1),[D,L]=(0,K.useState)(!1),[G,U]=(0,K.useState)(void 0),B=(0,K.useRef)(null),V=(0,K.useRef)(null),W=(0,ez.TL)(),H=(0,rC.Z)(),q=(0,Q.v9)(R.LA),Y=(0,Q.v9)(e=>(0,rb.Kf)(e,r_.u.ORGANIZATION,r_.N.INCLUSIVE,!0)),{data:$}=(0,J.jL)({userProfile:j,idToken:b.current,projectId:null==_?void 0:_.project_id}),{data:X}=(0,J.jL)({userProfile:j,idToken:b.current,projectId:void 0},{skip:!(null==_?void 0:_.project_id)}),{data:ee}=(0,ry.zg)({userProfile:j,idToken:b.current},{skip:!j.isLoggedIn()}),{connectionInProgress:et}=rU(),er=(0,eC.Bn)(),{shouldRenderAttribute:ea,evaluateCondition:es}=(0,sJ.Z)(c,e.id),{shouldUseDynamicInputs:en,shouldUseDynamicOutputs:eo}=sT(c),ei=(0,eC.vA)({id:e.id}),{isCopied:ed,handleCopyText:em}=(0,eB.Z)(e.id),{isCopied:ep,handleCopyText:ex}=(0,eB.Z)(null!==(o=null==u?void 0:u.operator_id)&&void 0!==o?o:""),{isCopied:eh,handleCopyText:eg}=(0,eB.Z)(null!==(i=null==u?void 0:u.saved_item_id)&&void 0!==i?i:""),ef=(0,K.useMemo)(()=>{var e;return"mega_node"===u.category&&(null===(e=u.metadata)||void 0===e?void 0:e.category)?u.metadata.category:u.category},[u.category,u.metadata]),{data:ev,isLoading:ej}=(0,rP.pN)(),e_=null!==(d=null==ev?void 0:ev.categories)&&void 0!==d?d:[],{data:ey}=(0,rz.D)(ef,{enabled:!!ef&&e_.includes(ef)&&!ej});sS(e,es,en,eo);let{handleMultipleParameterChanges:ew}=sg({operatorNodeProps:e,isSubNode:p,isSuperNode:x,userProfile:j,idTokenRef:b,shouldUseDynamicOutputs:eo,currentProject:_}),eN=sh(e,p,x,b,_,eo,j),{handleNodeDataChange:ek,handleNodesDataChange:eI}=(0,eJ.Z)(e.id),{handleNodeUpgrade:eT}=aI(),{isTestMode:eS,setIsTestMode:eM,runTestNode:eA}=rR({data:c,nodeId:e.id,handleMultipleParameterChanges:ew}),eO=(0,rH.TV)(H.palette.mode),eZ=(0,ro.J8)((0,as.qR)(e.data)),eP=!!u.is_trigger_node,eD=(0,K.useMemo)(()=>"Router"===c.name,[c.name]),eL=null==m?void 0:null===(t=m.find(e=>"credentials_to_use"===e.name))||void 0===t?void 0:t.value,eR=null==m?void 0:null===(r=m.find(e=>"environment_variables_to_use"===e.name))||void 0===r?void 0:r.value,eF=_?X:$,eG=(0,K.useMemo)(()=>{if(!_)return $;let e=$,t=eL?Object.keys(eL).filter(e=>{var t;return null===(t=eL[e])||void 0===t?void 0:t.is_personal_credential}):[];return(null==t?void 0:t.length)&&X?[...e=(e||[]).filter(e=>!t.includes(e.secret_type)),...X.filter(e=>t.includes(e.secret_type))]:e},[_,eL,X,$]),{missingSecretScopes:eU,missingSecretTypes:eV}=(0,K.useMemo)(()=>{let e=(0,rV.b)({declaration:u,userSecretTypes:eF||[],projectSecretTypes:_?$:void 0,credentialsToUse:eL,projectId:null==_?void 0:_.project_id,parameters:m,isSuperNode:x,subNode:f});return{missingSecretScopes:e,missingSecretTypes:Object.keys(e)}},[u,$,eL,m,x,f,_,eF]),eW=(0,K.useMemo)(()=>{if(!(null==ey?void 0:ey.scopes))return[];let e=new Set,t=new Map(ey.scopes.filter(e=>e.warning).map(e=>[e.name,e.warning]));return Object.values(u.secrets||{}).forEach(r=>{(Array.isArray(r)?r:[r]).forEach(r=>{let a=t.get(r);a&&e.add(a)})}),Array.from(e)},[u.secrets,ey]),eq=c.input_errors&&Object.keys(c.input_errors).length>0,eK=m.some(e=>e.error_message),eY=(0,K.useMemo)(()=>u.additional_parameters.some(e=>m.some(t=>t.name===e.name&&ea(e,m,f))),[u.additional_parameters,m,ea,f]),e$=(0,K.useMemo)(()=>{var e;return u.is_trigger_node&&(null===(e=m.find(e=>"_is_trigger_enabled"===e.name))||void 0===e?void 0:e.value)==="true"},[m,u.is_trigger_node]),eQ=(0,Q.v9)(eP&&e$?eb.vl:()=>!1),eX=(0,K.useMemo)(()=>{let e;return"automation"!=u.category&&!e$&&(m.filter(e=>ea(e,m,f)).filter(e=>(0,rO.bu)(e)).length>0||(e=u.additional_parameters).filter(t=>ea(t,e,f)).filter(e=>(0,rO.bu)(e)).length>0)},[u.parameters,u.additional_parameters,e$,m,f,u.category,ea]),e1=(0,K.useMemo)(()=>u.parameters.some(e=>"prompt_template"===e.name&&!0===e.is_hidden),[u.parameters]),e2=(0,K.useMemo)(()=>{var e,t;return en()?null===(e=c.dynamic_inputs)||void 0===e?void 0:e.filter(e=>ea(e,m,f)):null===(t=c.inputs)||void 0===t?void 0:t.filter(e=>ea(e,m,f))},[en,ea,c.dynamic_inputs,c.inputs,m,f]),e5=(0,K.useMemo)(()=>{var e,t;return eo()?null===(e=c.dynamic_outputs)||void 0===e?void 0:e.filter(e=>ea(e,m,f)):null===(t=c.outputs)||void 0===t?void 0:t.filter(e=>ea(e,m,f))},[eo,ea,c.dynamic_outputs,c.outputs,m,f]),e4=(0,K.useMemo)(()=>u.operator_id?Y.get(u.operator_id):void 0,[Y,u.operator_id]),{sourceNodeInputsMap:e3,sourceNodes:e9}=s_(e2,e.id),e6=(0,K.useMemo)(()=>{if(null===e3&&!eD)return null;let e=e3?Object.values(e3).flat():[];return(0,eH.kC)(e,!0)},[e3,eD]),e8=(0,K.useMemo)(()=>(0,eH.kC)(e5),[e5]);(0,K.useEffect)(()=>{if(eD){let t=c.dynamic_outputs,r=c.connectedInputBadges,a=ei.filter(t=>t.source!==e.id),{dynamic_outputs:s,connectedInputBadges:n}=(0,rB.lJ)(e,e9||[],a.map(e=>({source:e.source,connectionGroupType:(0,rO.nf)(e.sourceHandle)}))),l=!!(null==s?void 0:s.some(e=>e.data_type.endsWith("[]")))||c.batch,o=!eE()(t,s),i=!eE()(r,n),d=c.batch!==l;(o||i||d)&&ek({dynamic_outputs:s,connectedInputBadges:n,batch:l})}},[eD,e9,e3,ei,JSON.stringify(m)]),(0,K.useEffect)(()=>{if(!eD||!e9||0===e9.length)return;let e={...c.outputNicknames||{}},t=!1;e5.forEach(r=>{let{nodeId:a}=(0,rO.lv)(r.name),s=e9.find(e=>e.id===a);if(!s)return;let n=(0,rO.a8)({originalOutputName:r.name,existingNickname:e[r.name],sourceNode:s});n&&(e[r.name]=n,t=!0)}),t&&ek({outputNicknames:Object.keys(e).length?e:void 0})},[c.outputNicknames,ek,eD,e9,e5]);let e7=(0,K.useMemo)(()=>eP&&e$&&eQ&&!p,[eP,e$,eQ,p]);(0,K.useEffect)(()=>{er(e.id)},[c.inputs,c.outputs,c.dynamic_inputs,c.dynamic_outputs,e6,e8,e.id,er,e7]);let te=(0,K.useCallback)(t=>{t.preventDefault(),x&&(null==f?void 0:f.id)?W((0,F.IK)(f.id)):W((0,F.IK)(e.id))},[x,null==f?void 0:f.id,e.id,W]),tt=(0,K.useCallback)(t=>{t.preventDefault(),eT({props:e,handleDynamicAttributeChange:eN,shouldUseDynamicOutputs:eo,shouldUseDynamicInputs:en,parentName:g})},[e,eT,eN,eo,en,g]),tr=(0,K.useMemo)(()=>(0,as._x)({declaration:u,parameters:m}),[u,m]);(0,K.useEffect)(()=>{if(e$){let e=(0,as.Gq)(m,eL,u,eG,_,X);e.length&&ew(e)}},[eL,eG,ew,e$,X,u,_,m]);let{renderParameters:ta}=sq({props:e,objChildrenCount:tr,isSubNode:p,currentProject:_,handleParameterChanges:ew,visibleInputs:e2,canConfigureInputs:eX,setIsOpenConfigureInputsModal:A,showExtraSettings:z,setShowExtraSettings:P,effectiveSecretTypes:eG||[],currentFlowbook:q,sourceNodeInputsMap:e3,sourceNodes:e9}),ts=(0,K.useMemo)(()=>x&&f?"560px":"500px",[x,f]);(0,K.useEffect)(()=>{if(!x||!(null==f?void 0:f.id)){U(void 0);return}let t=document.querySelector('div[data-id="'.concat(f.id,'"]')),r=document.querySelector("#inner-operator-node-".concat(e.id));if(!t||!r){U(void 0);return}let a=new ResizeObserver(()=>{let e=r.offsetHeight||375;U((t.offsetHeight||375)+e+60)});a.observe(t),a.observe(r);let s=r.offsetHeight||375;return U((t.offsetHeight||375)+s+60),()=>{a.disconnect()}},[x,null==f?void 0:f.id,e.id]),(0,K.useEffect)(()=>{if(f){let t=(0,rO.D_)({superNodeId:e.id,subNodeId:f.id});eI({[f.id]:{position:t}})}},[null==f?void 0:f.id,null==f?void 0:f.parentId,null==f?void 0:f.width,null==f?void 0:f.data.batch,null===(a=c.dynamic_outputs)||void 0===a?void 0:a.length,G]),(0,K.useEffect)(()=>{if(!eL||!eG)return;let e=!1,t={...eL};Object.keys(eL).forEach(r=>{let a=eL[r];if(!(a.secret_id&&eG.some(e=>e.secret_type===r&&e.secret_id===a.secret_id))&&eG.some(e=>e.secret_type===r)){let s=eG.find(e=>e.secret_type===r&&!0===e.is_default),n=a.is_personal_credential;(null==_?void 0:_.project_id)||n||(n=!0),t[r]={secret_id:null==s?void 0:s.secret_id,is_personal_credential:n,is_default:!0},e=!0}}),e&&ew([{parameterName:"credentials_to_use",newValue:t}])},[eG,eL,ew,_]),(0,K.useEffect)(()=>{if(!eR||!ee)return;let e=!1,t={...eR};Object.keys(eR).forEach(r=>{let a=eR[r];a&&!ee.some(e=>e.variable_id===a)&&(t[r]="",e=!0)}),e&&ew([{parameterName:"environment_variables_to_use",newValue:t}])},[ee,eR,ew]);let tn=(0,K.useMemo)(()=>[...u.parameters.filter(e=>ea(e,m,f)),...u.additional_parameters.filter(e=>ea(e,m,f))],[u.parameters,u.additional_parameters,ea,m,f]),tl=(0,K.useMemo)(()=>{var e,t;return!v&&(!!u.parameters&&u.parameters.length>0||!!u.additional_parameters&&u.additional_parameters.length>0||"INPUT_BUTTON"===u.select_optional_inputs_parameter||"OUTPUT_BUTTON"===u.select_optional_outputs_parameter||(null===(e=u.inputs)||void 0===e?void 0:e.length)>0||(null===(t=c.dynamic_inputs)||void 0===t?void 0:t.length)>0)},[v,c.dynamic_inputs,u.inputs,u.parameters,u.additional_parameters,u.select_optional_inputs_parameter,u.select_optional_outputs_parameter]);if((0,K.useEffect)(()=>{let e=()=>{V.current&&k(V.current.scrollHeight>V.current.clientHeight)},t=new ResizeObserver(e);return V.current&&t.observe(V.current),e(),()=>{t.disconnect()}},[V,tl]),(0,K.useEffect)(()=>{if(B.current){let e=new ResizeObserver(e=>{var t;let r=null===(t=e[0])||void 0===t?void 0:t.contentRect.height;r&&w(r)});return e.observe(B.current),w(B.current.clientHeight),()=>{e.disconnect()}}},[]),"Note"===u.name)return"v0_01"===c.version?(0,S.jsx)(r5,{className:"operator-node cursor-grab active:cursor-grabbing",colors:eO,data:c,onRemove:te,handleParameterChanges:ew}):(0,S.jsx)(rX,{className:"operator-node group cursor-grab active:cursor-grabbing",data:c,onRemove:te,handleParameterChanges:ew});let to=eq||eK;return(0,S.jsxs)(rI.Z,{id:c.name.replace(/\s+/g,"-"),ref:B,className:(0,eu.cn)("operator-node group shadow-floating relative rounded-2xl border border-transparent",x?"from-muted/10 dark:from-muted/50 dark:to-border/50 to-muted/30 bg-gradient-to-b pb-3 backdrop-blur-xs":"bg-elevated",to&&"border-destructive-foreground ring-destructive animate-border-pulse-error ring-8",e.selected&&!to&&["border-[var(--node-color-light)] ring-8 ring-[var(--node-color-light)]/50 dark:border-[var(--node-color-light)] dark:ring-[var(--node-color-dark)]/25",x&&"border-3"],x&&!e.selected&&!to&&"border-border border-3 border-dashed shadow-xs",!e.selected&&!to&&!x&&"border-border border",!x&&C&&et&&!!(null==e2?void 0:e2.length)&&"outline-accent-foreground outline-2",eS&&"animate-border-pulse-with-category-color border-2 border-dotted [box-shadow:none]"),style:{...eZ,width:ts,height:G?"".concat(G,"px"):"auto",position:"relative"},onMouseEnter:()=>{et&&!x&&I(!0)},onMouseLeave:()=>{C&&!x&&I(!1)},children:[!x&&et&&!!(null==e2?void 0:e2.length)&&(0,S.jsx)(a3,{isHoveredDuringConnection:C,operatorId:e.id}),c.batch&&!x&&(0,S.jsx)(si,{}),c.canResume&&!x&&(0,S.jsx)(so,{id:e.id}),c.canSelectForChecklist&&!x&&(0,S.jsx)(sc,{id:e.id}),(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)("div",{className:(0,eu.cn)(v?"hidden":"absolute top-0 right-0 flex flex-grow translate-x-full flex-col justify-between"),style:{height:"".concat(y,"px")},onMouseDown:e=>{if("flyout-spacer"===e.target.dataset.role){var t;e.stopPropagation(),e.preventDefault();let r=e.currentTarget;r.style.pointerEvents="none";let a=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:e.clientX,clientY:e.clientY,button:e.button,buttons:e.buttons,view:window});null===(t=document.elementFromPoint(e.clientX,e.clientY))||void 0===t||t.dispatchEvent(a);let s=()=>{r.style.pointerEvents="",document.removeEventListener("mouseup",s),document.removeEventListener("dragend",s),document.removeEventListener("mousemove",s),document.removeEventListener("mouseleave",s)};document.addEventListener("mouseup",s),document.addEventListener("dragend",s),document.addEventListener("mousemove",s),document.addEventListener("mouseleave",s)}},children:[!x&&(0,S.jsx)(aO,{sourceNodes:e9||[],sourceNodeInputsMap:e3,nodeHeight:y}),(0,S.jsx)("div",{"data-role":"flyout-spacer",className:"nodrag flex flex-grow flex-col"}),!!(null==e5?void 0:e5.length)&&(0,S.jsx)(az,{props:e,outputs:e5,nodeHeight:y})]}),(0,S.jsx)(a4,{reactFlowNodeId:e.id,name:c.name,positionAbsoluteX:e4?e.positionAbsoluteX:void 0,positionAbsoluteY:e4?e.positionAbsoluteY:void 0,declaration:c.declaration,version:c.version,latest_version:c.latest_version,subNodeId:c.subNodeId,isSuperNode:x,hasPromptTemplate:e1,canConfigureInputs:eX,customOperator:e4,onRemove:te,onUpgrade:tt,setIsOpenConfigureInputsModal:A,setIsOpenPromptTemplateModal:E,setIsOpenPublishCustomNodeModal:Z,setIsRenaming:L,isTestMode:null!=eS&&eS,setIsTestMode:eM})]}),(0,S.jsxs)("div",{id:"inner-operator-node-".concat(e.id),className:(0,eu.cn)("rounded-xl",p&&"cursor-grab active:cursor-grabbing"),onContextMenu:e=>{e.preventDefault()},children:[e7&&(0,S.jsx)(sd,{nodeId:e.id}),eS&&(0,S.jsx)(su,{}),eP&&(0,S.jsx)(ak,{parameters:m,declaration:u,effectiveSecretTypes:eG,handleParameterChanges:ew,missingSecretTypes:eV,hasBannerAbove:eS,inputs:e2,dynamicInputs:c.dynamic_inputs,connectedInputBadges:c.connectedInputBadges,shouldUseDynamicInputs:en()}),(0,rW.sz)(eV)&&(0,S.jsx)(r7,{missingSecretScopes:eU,hasBannerAbove:eP||eS,declaration:u}),eW.length>0&&(0,S.jsx)(ae.Z,{warnings:eW,hasBannerAbove:eP||eS||(0,rW.sz)(eV)}),!1,(0,S.jsx)(sn,{nodeId:e.id,declaration:u,nickname:c.nickname,name:c.name,isCollapsed:v,noVisibleParams:!(null===(s=c.inputs)||void 0===s?void 0:s.length)&&!(null===(n=c.dynamic_inputs)||void 0===n?void 0:n.length)&&!(null===(l=c.parameters)||void 0===l?void 0:l.length),batch:c.batch,latestVersion:c.latest_version,isSuperNode:x,hasBannerAbove:eP||eS,isRenaming:D,setIsRenaming:L,hasMissingSecrets:eV.length>0,version:c.version}),!(eP&&e$&&eQ)&&(0,S.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:(0,S.jsx)(eH.ZP,{connectionType:eH.Rj.INPUT,nodeId:e.id,isConnectable:e.isConnectable,connectionGroups:e6})}),tl&&(0,S.jsx)("div",{id:"div-container-".concat(e.id),className:"space-y-2 rounded-b-xl px-3",style:{backgroundColor:"transparent"},children:(0,S.jsxs)("div",{className:(0,eu.cn)("max-h-[1000px] overflow-y-scroll mask-y-from-99% px-3 pt-1.5 pb-3",N?"nowheel":"",eV.length&&eY?"flex flex-col":""),ref:V,children:[x&&!f?(0,S.jsx)("div",{className:"bg-muted/50 flex min-h-[250px] flex-col items-center justify-center rounded-lg border-2 border-dashed",children:(0,S.jsx)(r3.Z,{title:"Drag a node here to get started",variant:"outline",Icon:rw.Z})}):(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(a_,{operatorNodeProps:e,visibleInputs:e2,sourceNodeInputsMap:e3||{},handleParameterChanges:ew,sourceNodes:e9||[],handleNodesDataChange:eI,isTestMode:null!=eS&&eS}),ta(u.parameters)]}),eY&&(0,S.jsx)(el.zx,{className:"nodrag text-muted-foreground mt-2 w-fit",variant:"outline",onClick:e=>{e.stopPropagation(),P(!z)},children:z?(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(rN.Z,{}),"Hide More Options"]}):(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(rk.Z,{}),"Show More Options"]})})]})}),eS&&(0,S.jsxs)("div",{className:"flex justify-end gap-2 rounded-b-xl p-5",children:[(0,S.jsx)(el.zx,{onClick:()=>eM(!1),variant:"outline",size:"sm",className:"h-8",children:"Exit Test Mode"}),(0,S.jsx)("div",{className:"flex h-8 items-center",children:(0,S.jsx)(r4.Z,{startPipelineRun:eA,size:"sm",className:"h-8"})})]}),z&&(0,S.jsx)(aw,{nodeHeight:y||0,setShowExtraSettings:P,children:ta(u.additional_parameters,void 0,void 0,void 0,!0)}),!p&&(0,S.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:(0,S.jsx)(eH.ZP,{connectionType:eH.Rj.OUTPUT,nodeId:e.id,isConnectable:e.isConnectable,connectionGroups:e8})})]}),e1&&(0,S.jsx)(rM,{parameters:m,handleParameterChanges:ew,open:T,setIsOpen:E}),eX&&(0,S.jsx)(rZ,{nodeId:e.id,parameters:tn,inputs:c.inputs,dynamic_inputs:c.dynamic_inputs,shouldUseDynamicInputs:en,open:M,setIsOpen:A,data:c}),O&&e4&&(0,S.jsx)(r9.Z,{open:O,onOpenChange:Z,customOperator:e4,userProfile:j,idToken:b.current})]})},(e,t)=>e.id===t.id&&e.isConnectable===t.isConnectable&&e.positionAbsoluteX===t.positionAbsoluteX&&e.positionAbsoluteY===t.positionAbsoluteY&&e.selected===t.selected&&e.dragging===t.dragging&&eE()(e.data,t.data)),sY=r(6230),s$=r.n(sY),sQ=r(426),sX=r(60291),s0=e=>{let{text:t,variant:r="default",hideTextBar:a=!1,className:s}=e,n=(0,K.useContext)(sQ.Xq),l=(0,K.useCallback)(()=>Array(10).fill(null).map(()=>Array(20).fill(null).map(()=>({value:Math.random()>.5?1:0,colorClass:"text-muted-foreground/20"}))),[10,20]),[o,i]=(0,K.useState)([]);(0,K.useEffect)(()=>{i(l())},[]),(0,K.useEffect)(()=>{let e=setInterval(()=>{i(e=>e.map(e=>e.map(e=>{if(Math.random()>=.05)return e;let t=Math.random(),r="text-muted-foreground/20";return t>=.9?r=n?"text-[var(--node-color-medium)]":"text-pink-500":t>=.6&&(r="text-muted-foreground"),{...e,colorClass:r}})))},100),t=setInterval(()=>{i(e=>e.map(e=>e.map(e=>.02>Math.random()?{...e,value:e.value?0:1}:e)))},2e3);return()=>{clearInterval(e),clearInterval(t)}},[]);let d=(0,K.useCallback)((e,t,r)=>{let a=((.1*t+.05*r)%2).toFixed(1);return(0,S.jsx)("div",{className:"flex size-3.5 w-full flex-none items-center justify-center text-sm font-medium ".concat(e.colorClass),style:{animation:"3s infinite ease-in-out",animationDelay:"".concat(a,"s")},children:e.value},"".concat(t,"-").concat(r))},[]);return(0,S.jsxs)("div",{className:"jsx-22d8b31d0bea8e6 "+((0,eu.cn)("thinking-binary-grid-top-gradient relative flex flex-grow flex-col",s)||""),children:[(0,S.jsxs)("div",{className:"jsx-22d8b31d0bea8e6 "+((0,eu.cn)("thinking-binary-grid-bottom-gradient relative flex flex-grow flex-col")||""),children:[!a&&(0,S.jsx)("div",{className:"jsx-22d8b31d0bea8e6 "+((0,eu.cn)("bg-background from-elevated absolute top-1/2 left-1/2 flex h-10 -translate-x-1/2 -translate-y-2/3 transform items-center justify-center gap-2 rounded-full border pr-4 pl-2 shadow")||""),children:(0,S.jsx)(sX.ZP,{className:"text-foreground text-sm! font-medium text-nowrap",text:t})}),(0,S.jsx)("div",{className:"jsx-22d8b31d0bea8e6 grid w-full grid-cols-[repeat(20,1fr)] content-center gap-1.5 select-none",children:o.map((e,t)=>e.map((e,r)=>d(e,t,r)))})]}),(0,S.jsx)(s$(),{id:"22d8b31d0bea8e6",children:".thinking-binary-grid-top-gradient{mask-image:-webkit-linear-gradient(bottom,rgba(255,255,255,.9)-webkit-calc(100% - 48px),rgba(255,255,255,0));mask-image:-moz-linear-gradient(bottom,rgba(255,255,255,.9)-moz-calc(100% - 48px),rgba(255,255,255,0));mask-image:-o-linear-gradient(bottom,rgba(255,255,255,.9)calc(100% - 48px),rgba(255,255,255,0));mask-image:linear-gradient(to top,rgba(255,255,255,.9)calc(100% - 48px),rgba(255,255,255,0));-webkit-mask-image:-webkit-linear-gradient(bottom,rgba(255,255,255,.9)-webkit-calc(100% - 48px),rgba(255,255,255,0));-webkit-mask-image:-moz-linear-gradient(bottom,rgba(255,255,255,.9)-moz-calc(100% - 48px),rgba(255,255,255,0));-webkit-mask-image:-o-linear-gradient(bottom,rgba(255,255,255,.9)calc(100% - 48px),rgba(255,255,255,0));-webkit-mask-image:linear-gradient(to top,rgba(255,255,255,.9)calc(100% - 48px),rgba(255,255,255,0));background-position:top;background-repeat:no-repeat}.thinking-binary-grid-bottom-gradient{mask-image:-webkit-linear-gradient(top,rgba(255,255,255,.9)-webkit-calc(100% - 48px),rgba(255,255,255,0));mask-image:-moz-linear-gradient(top,rgba(255,255,255,.9)-moz-calc(100% - 48px),rgba(255,255,255,0));mask-image:-o-linear-gradient(top,rgba(255,255,255,.9)calc(100% - 48px),rgba(255,255,255,0));mask-image:linear-gradient(to bottom,rgba(255,255,255,.9)calc(100% - 48px),rgba(255,255,255,0));-webkit-mask-image:-webkit-linear-gradient(top,rgba(255,255,255,.9)-webkit-calc(100% - 48px),rgba(255,255,255,0));-webkit-mask-image:-moz-linear-gradient(top,rgba(255,255,255,.9)-moz-calc(100% - 48px),rgba(255,255,255,0));-webkit-mask-image:-o-linear-gradient(top,rgba(255,255,255,.9)calc(100% - 48px),rgba(255,255,255,0));-webkit-mask-image:linear-gradient(to bottom,rgba(255,255,255,.9)calc(100% - 48px),rgba(255,255,255,0));background-position:bottom;background-repeat:no-repeat}"})]})},s1=r(16653),s2=r(84179),s5=r(83989),s4=r(12950),s3=r(20479),s9=r(42330),s6=r(38384);let s8=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=(0,ez.TL)(),{data:a,id:s}=(0,sQ.Gt)(),{userProfile:n}=(0,ec.H)(),l=(0,Q.v9)(A.zd),o=(0,Q.v9)(A.IW),i=null==l?void 0:l.operator_id,d=!(null==l?void 0:l.operator_id)||(null==l?void 0:l.operator_id)===e;return(0,K.useEffect)(()=>{i&&d&&setTimeout(()=>{r((0,F.VQ)({nodeId:e}))},50)},[i,d,r,e,null==l?void 0:l.operator_declaration,o]),{canCreateCustomNode:d,hasActiveCreation:i,initializeCustomOperator:e=>((0,aX.$g)(),r((0,s6.mM)({id:s,data:a,declaration:null==e?void 0:e.declaration,code:null==e?void 0:e.code,hasMCPServerDeclaration:t,userProfile:n})).unwrap()),zoomToNode:()=>r((0,F.VQ)({nodeId:e}))}};var s7=r(80109);(s=v||(v={})).PERSONAL="personal",s.PROJECT="project";let ne=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,a=[];if(!e)return a;let s=new Set((null==r?void 0:r.map(e=>e.secret_type))||[]),n=new Set(t||[]);for(let t of e)if(!n.has(t)&&!s.has(t)){let e=(0,rW.Qm)(t);a.push({secretType:t,provider:e})}return a},nt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,{userProfile:a,idTokenRef:s}=(0,ec.H)(),{currentProject:n}=(0,e0.d2)(),{data:l,isLoading:o}=(0,J.jL)({userProfile:a,idToken:s.current}),{data:i,isLoading:d}=(0,J.jL)({userProfile:a,projectId:null==n?void 0:n.project_id,idToken:s.current},{skip:!(null==n?void 0:n.project_id)}),c=[];for(let t of e){let e=null==r?void 0:r[t];if(e){let r=!1!==e.is_personal_credential?l:i,a=null==r?void 0:r.find(e=>e.secret_type===t);a&&c.push(a)}else{let e=null==l?void 0:l.find(e=>e.secret_type===t);e&&c.push(e)}}let u=ne(e,t,c);return{allUserSecrets:l,effectiveSecrets:c,secretsPendingAuthorization:u,hasPendingSecrets:u.length>0,isLoadingSecrets:o||d}};var nr=r(73587),na=r(14212);let ns=(0,K.createContext)({showCustomNodesMcpGuide:!1,setShowCustomNodesMcpGuide:()=>{}}),nn=e=>{let{children:t}=e,{userProfile:r,idTokenRef:a}=(0,ec.H)(),[s,n]=(0,K.useState)(!1),[l,o]=(0,K.useState)(!1);return(0,K.useEffect)(()=>{s||(async()=>{if(!r.user_id)return;let e=l?null:await r.fetchUserMetadata(na.m.CUSTOM_NODES_MCP_GUIDE_SEEN,a.current);l||null!==e&&"false"!==e||o(!0),n(!0)})()},[r,l]),(0,S.jsx)(ns.Provider,{value:{showCustomNodesMcpGuide:l,setShowCustomNodesMcpGuide:o},children:t})},nl=()=>{let e=(0,K.useContext)(ns);if(!e)throw Error("usePipelineUserGuidanceContext must be used within a PipelineUserGuidanceProvider");return e};var no=r(44079),ni=r(3115),nd=r(82606),nc=r(57632),nu=r(95470);let nm=(0,K.memo)(e=>{let{requiredSecrets:t,hasGuMCPApiKey:r,isLoadingSecrets:a}=e,{userProfile:s,idTokenRef:n}=(0,ec.H)(),[l,{isLoading:o,isError:i,error:d}]=(0,J.Ve)(),c=async()=>{let e=(0,nc.Z)().replace(/-/g,"");await l({secret:{secret_type:"gumcp_api_key",value:e},userProfile:s,idToken:n.current})};return(0,K.useEffect)(()=>{r||a||!n.current||c()},[r,a,n]),(0,S.jsxs)("div",{className:"flex w-full flex-grow flex-col items-center justify-center gap-2 py-2",children:[t.map(e=>{let{secretType:t,provider:r}=e;return(0,S.jsx)(nu.Z,{provider:r,credentialsToUse:{[t]:{is_personal_credential:!0}},secretType:t},t)}),!r&&o&&(0,S.jsxs)("div",{className:"text-muted-foreground flex gap-2 p-2 text-sm",children:[(0,S.jsx)(nd.Z,{size:16,className:"text-muted-foreground animate-spin"}),"Generating guMCP API Key"]}),i&&(0,S.jsxs)("div",{className:"text-muted-foreground p-2 text-sm",children:["Error generating guMCP API Key",d.data?": ".concat(d.data):""]})]})});nm.displayName="MegaNodeSecretAuthorizationPanel";var np=r(18910),nx=r(89427),nh=e=>{var t,r,a,s,n;let{open:l,setOpen:o,customNodeDeclaration:i,megaNodeId:d,disabled:c=!1}=e;return!l||(null===(t=i.mcp_server_declaration)||void 0===t?void 0:t.example_prompts)&&(null===(a=i.mcp_server_declaration)||void 0===a?void 0:null===(r=a.example_prompts)||void 0===r?void 0:r.length)<1?null:(0,S.jsx)(nx.E.ul,{className:"flex flex-col overflow-x-clip px-3 pt-2 pb-2",initial:{opacity:0,height:0},animate:{opacity:l?1:0,height:l?"auto":0},transition:{duration:.2},children:null==i?void 0:null===(n=i.mcp_server_declaration)||void 0===n?void 0:null===(s=n.example_prompts)||void 0===s?void 0:s.map((e,t)=>(0,S.jsxs)(nx.E.button,{onClick:()=>{if(c)return;let t=document.getElementById("custom-node-creation-form-prompt-".concat(d));t.value=e,t.focus(),o(!1)},initial:{opacity:0,x:-10,filter:"blur(5px)"},animate:{opacity:l?1:0,x:l?0:-10,filter:l?"blur(0px)":"blur(5px)"},whileHover:c?{}:{x:5,transition:{duration:.05,delay:0}},transition:{duration:.1,delay:.05*t},className:"text-muted-foreground hover:text-foreground flex items-start gap-1.5 py-1.5 text-[13px] ".concat(c?"cursor-not-allowed opacity-50":"cursor-pointer"),disabled:c,children:[(0,S.jsx)(np.Z,{size:14,className:"py-0.5"}),(0,S.jsx)("span",{className:"text-left",children:e})]},e))})},ng=r(93495),nf=e=>{let{open:t,setOpen:r,title:a,description:s,videoSrc:n,learnMoreLink:l,learnMoreText:o="Learn more",buttonText:i="Continue",onMetadataSet:d,metadataKey:c}=e;return K.useEffect(()=>{if(t&&d&&c)try{d(c,"true")}catch(e){console.error("Error saving ".concat(c," metadata:"),e)}},[t,d,c]),(0,S.jsx)(eq.Vq,{open:t,onOpenChange:e=>null==r?void 0:r(e),children:(0,S.jsx)(eq.cZ,{className:"max-w-3xl !gap-0 overflow-hidden px-0 py-0 md:min-w-2xl",onClick:e=>e.stopPropagation(),onOpenAutoFocus:e=>e.preventDefault(),children:(0,S.jsxs)("div",{className:"relative",children:[(0,S.jsx)(ng.Z,{videoSrc:n,title:a}),(0,S.jsx)(eq.a7,{className:"rounded-none",children:(0,S.jsxs)(eq.fK,{className:"pb-2",children:[(0,S.jsx)(eq.$N,{children:a}),(0,S.jsx)(eq.Be,{children:s})]})}),(0,S.jsxs)(eq.cN,{children:[(0,S.jsx)(eq.GG,{children:(0,S.jsx)(el.zx,{variant:el.f1.OUTLINE,children:i})}),l&&(0,S.jsxs)(el.zx,{onClick:()=>{l&&window.open(l,"_blank","noopener,noreferrer")},variant:el.f1.DEFAULT,children:[(0,S.jsx)(eG.Z,{}),o]})]})]})})})},nv=e=>{let{open:t,setOpen:r}=e,{userProfile:a,idTokenRef:s}=(0,ec.H)();return(0,S.jsx)(nf,{open:t,setOpen:r,title:"How to Prompt Like an MCP Pro",description:"Learn how to write great prompts for MCP nodes and unlock more powerful automations, in under 2 minutes.",videoSrc:"https://player.vimeo.com/video/1088215785?h=b475691440",buttonText:"Close",onMetadataSet:(e,t)=>{a.setUserMetadata(e,t,s.current)},metadataKey:na.m.CUSTOM_NODES_MCP_GUIDE_SEEN})},nj=()=>{let[e,t]=(0,K.useState)(!1),{userProfile:r,idTokenRef:a}=(0,ec.H)(),{setShowCustomNodesMcpGuide:s}=nl();return(0,S.jsxs)("div",{className:"bg-background/50 flex w-full flex-col items-center gap-5 rounded-lg border-2 border-dashed border-[var(--node-color-medium)]/50 p-8 pb-5",children:[(0,S.jsxs)("div",{className:"flex max-w-5/6 flex-col gap-0.5",children:[(0,S.jsx)("span",{className:"text-center text-base font-medium",children:"Learn How to Prompt MCP Nodes"}),(0,S.jsx)("span",{className:"text-muted-foreground text-center text-xs",children:"Learn how to write great prompts for MCP nodes and unlock more powerful automations, in under 2 minutes."})]}),(0,S.jsxs)("div",{className:"flex w-full flex-col gap-1.5",children:[(0,S.jsxs)(el.zx,{variant:"unstyled",onClick:()=>t(!0),className:"gumloop-button-shadow text-background dark:text-foreground border border-[var(--node-color-dark)] bg-[var(--node-color-dark)]/85 shadow-sm dark:border-none dark:bg-[var(--node-color-medium)]",children:[(0,S.jsx)(aW.Z,{}),"Watch Guide"]}),(0,S.jsx)(el.zx,{variant:"ghost",onClick:()=>{s(!1),r.setUserMetadata(na.m.CUSTOM_NODES_MCP_GUIDE_SEEN,"true",a.current)},className:"text-muted-foreground hover:bg-transparent hover:text-[var(--node-color-dark)]",size:"sm",children:"Skip (Not Recommended)"})]}),(0,S.jsx)(nv,{open:e,setOpen:t})]})},nb=e=>{let{showExtraSettings:t,setShowExtraSettings:r,nodeHeight:a,handleParameterChanges:s,variant:n="default"}=e,{data:l}=(0,sQ.Gt)(),o=(0,K.useMemo)(()=>({name:"credentials_to_use",data_type:"CredentialsPicker",description:"The credentials to use for this node. You can add additional credentials by going to the credentials page."}),[]),i={name:"credentials_to_use",data_type:"CredentialsPicker",placeholder:"",value:l.credentialsToUse,error_message:""};return(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(el.zx,{className:"text-muted-foreground gap-1.5 text-xs hover:bg-transparent hover:text-[var(--node-color-dark)]",variant:"unstyled",size:"unset",color:"primary",onClick:()=>r(!t),children:t?(0,S.jsxs)(K.Fragment,{children:["minimal"===n?(0,S.jsx)(t_.Z,{className:"size-3.5"}):(0,S.jsx)(rN.Z,{className:"size-3.5"}),"minimal"===n?"Close":"Hide More Options"]}):(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(rk.Z,{className:"size-3.5"}),"minimal"===n?"Options":"Show More Options"]})}),t&&l.declaration.mcp_server_declaration&&(0,S.jsx)(aw,{nodeHeight:a,setShowExtraSettings:r,className:"overflow-visible!",children:(0,S.jsxs)("div",{className:"bg-background rounded-lg border p-3",children:[(0,at.W)(o,void 0,!0),(0,S.jsx)(sZ.ZP,{declaration:l.declaration.mcp_server_declaration,declarationParameter:o,parameter:i,handleParameterChanges:s})]})})]})};let n_={name:"My Custom Node",short_description:"This is a custom node that I created",parameters:[{name:"parameter_1",data_type:"string",is_hidden:!1,is_optional:!1,attribute_type:"both",error_message:""}],outputs:[{name:"output_1",data_type:"string",is_hidden:!1,is_optional:!1}]};var ny=e=>{var t,r,a,s,n,l,o,i,d,c,u,m,p,x,h;let{nodeHeight:g}=e,f=(0,ez.TL)(),{id:v,data:j,setCredentialsToUse:b}=(0,sQ.Gt)(),_=(0,ez.CG)(A.IW),y=(0,ez.CG)(A.P9),w=(0,ez.CG)(A.bc),[N,k]=(0,K.useState)(null!=j&&null!==(r=j.declaration)&&void 0!==r&&null!==(t=r.mcp_server_declaration)&&void 0!==t&&!!t.example_prompts&&(null==j?void 0:null===(n=j.declaration)||void 0===n?void 0:null===(s=n.mcp_server_declaration)||void 0===s?void 0:null===(a=s.example_prompts)||void 0===a?void 0:a.length)>0),[C,I]=(0,K.useState)(!1),[T,E]=(0,K.useState)(!1),[M,Z]=(0,K.useState)(null),z=!!(null==j?void 0:null===(o=j.declaration)||void 0===o?void 0:null===(l=o.mcp_server_declaration)||void 0===l?void 0:l.server_id),{secretsPendingAuthorization:P,hasPendingSecrets:D,allUserSecrets:L,isLoadingSecrets:R}=nt(null===(i=j.declaration.mcp_server_declaration)||void 0===i?void 0:i.secret_types,null===(d=j.declaration.mcp_server_declaration)||void 0===d?void 0:d.optional_secrets,j.credentialsToUse),{initializeCustomOperator:G}=s8(v,z),U=(0,ez.CG)(eb.lF),{handleSubmitCustomNodeConfigMessage:B}=(0,s7.Z)(),{showCustomNodesMcpGuide:V}=nl(),{userProfile:W,setIsUserSignInModalOpen:H}=(0,ec.H)(),J=!!(null==L?void 0:L.some(e=>"gumcp_api_key"===e.secret_type)),q=D||!J,Y=e=>{let t=e.find(e=>"credentials_to_use"===e.parameterName);t&&b(t.newValue)},$=(0,K.useCallback)(()=>{let e=U.filter(e=>e.type===rf.Jq.CustomNodeBuilder&&e.id!==v).map(e=>e.id);return e.length>0&&f((0,F._l)(e)),e},[v,U,f]),Q=(0,K.useCallback)(async e=>{var t;let r=null===(t=e.get("prompt"))||void 0===t?void 0:t.trim();if((0,no.gW)(nr.z.OPERATOR_BUILDER.PROMPT_SUBMITTED,{node_id:v,mcpServerDeclaration:j.declaration.mcp_server_declaration,chat_id:null==y?void 0:y.id,prompt_text:r}),!r){X.Am.error("Please enter a prompt");return}$(),B({messageContent:r,contextOverride:{custom_operator:await G(),custom_operator_type:z?aQ.g.MEGA_OPERATOR:aQ.g.CUSTOM_OPERATOR,credentials_to_use:j.credentialsToUse}})},[v,j,G,B,$,y,z]),ee=async e=>{var t;e.preventDefault();let r=new FormData(e.currentTarget);if(!W.isLoggedIn()){H(!0);return}if((null==y?void 0:null===(t=y.msgs)||void 0===t?void 0:t.length)!==1){Z(r),I(!0);return}await Q(r)},et=async()=>{if(!W.isLoggedIn()){H(!0);return}$();let e=await G({declaration:n_});f((0,A.pj)({mode:O.Cn.MANUAL_CUSTOM_NODE})),f((0,A.ym)(!0)),e&&(0,s9.zY)(f,e,{...j.declaration,...n_},j.parameters),(0,no.gW)(nr.z.OPERATOR_BUILDER.MANUAL_MODE_ENTERED,{chat_id:w,customOperator:e,node_id:v,mcpServerDeclaration:j.declaration.mcp_server_declaration})};(0,K.useEffect)(()=>{(async()=>{1===y.msgs.length&&M&&(await Q(M),Z(null))})()},[y.msgs.length,M,Q]);let er=null!==(h=null==j?void 0:null===(u=j.declaration)||void 0===u?void 0:null===(c=u.mcp_server_declaration)||void 0===c?void 0:c.example_prompts)&&void 0!==h?h:[];return q&&z?(0,S.jsxs)("div",{className:"flex flex-col gap-3 p-2",children:[(0,S.jsx)(nm,{requiredSecrets:P,hasGuMCPApiKey:J,isLoadingSecrets:R}),(0,S.jsx)(nb,{showExtraSettings:T,setShowExtraSettings:E,nodeHeight:g,handleParameterChanges:Y})]}):V&&z?(0,S.jsx)("div",{className:"flex flex-col gap-3 p-2",children:(0,S.jsx)(nj,{})}):(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)("form",{className:"flex flex-col gap-3 p-2",onSubmit:ee,children:[(0,S.jsxs)("div",{className:"nodrag flex flex-col gap-2",children:[(0,S.jsx)("p",{className:"px-1 text-sm font-medium",children:"Describe what you want this node to do"}),(0,S.jsxs)("div",{className:(0,eu.cn)("bg-background relative flex flex-col rounded-md transition-all",N&&"outline-border overflow-clip outline"),children:[(0,S.jsx)(s3.g,{id:"custom-node-creation-form-prompt-".concat(v),className:(0,eu.cn)("nowheel field-sizing-content max-h-96 !min-h-24 w-full overflow-y-auto shadow-none! !ring-[var(--node-color-medium)] !outline-[var(--node-color-medium)]",N&&"rounded-none border-x-0 border-t-0 !border-b"),name:"prompt",placeholder:(null===(p=j.declaration)||void 0===p?void 0:null===(m=p.mcp_server_declaration)||void 0===m?void 0:m.placeholder)||"Describe what you want this node to do...",autoFocus:!0,required:!0,disabled:_===O.IG.PROCESSING||_===O.IG.APPROVAL_REQUIRED,onKeyDown:e=>{if("Enter"===e.key&&(e.metaKey||e.ctrlKey)){var t;e.preventDefault(),null===(t=e.currentTarget.form)||void 0===t||t.requestSubmit()}else"z"===e.key&&(e.metaKey||e.ctrlKey)&&e.stopPropagation()}}),(null==er?void 0:er.length)>0&&(0,S.jsx)(nh,{open:N,setOpen:k,megaNodeId:v,customNodeDeclaration:j.declaration,disabled:_===O.IG.PROCESSING||_===O.IG.APPROVAL_REQUIRED})]})]}),(0,S.jsxs)("div",{className:"flex !cursor-pointer flex-row items-center justify-between",children:[(0,S.jsxs)("div",{className:"flex items-center gap-3",children:[!z&&(0,S.jsxs)(el.zx,{variant:"unstyled",size:"unset",className:"text-muted-foreground gap-1.5 text-xs hover:bg-transparent hover:text-[var(--node-color-dark)]",onClick:et,children:[(0,S.jsx)(aP.Z,{})," Create Manually"]}),z&&(0,S.jsx)(nb,{showExtraSettings:T,setShowExtraSettings:E,nodeHeight:g,handleParameterChanges:Y,variant:"minimal"}),!V&&(null==er?void 0:er.length)>0&&(0,S.jsx)(el.zx,{variant:"unstyled",size:"unset",onClick:()=>k(!N),className:"text-muted-foreground gap-1.5 text-xs hover:bg-transparent hover:text-[var(--node-color-dark)]",children:N?(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(s1.Z,{className:"size-3.5"})," Collapse Prompts"]}):(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(s2.Z,{className:"size-3.5"})," Example Prompts"]})}),z&&(0,S.jsx)(ni.Z,{serverId:null===(x=j.declaration.mcp_server_declaration)||void 0===x?void 0:x.server_id,children:(0,S.jsxs)(el.zx,{variant:"unstyled",size:"unset",className:"text-muted-foreground gap-1.5 text-xs hover:bg-transparent hover:text-[var(--node-color-dark)]",children:[(0,S.jsx)(e$.Z,{className:"size-3.5"})," MCP Tools"]})})]}),(!V||!z)&&(0,S.jsxs)(el.zx,{variant:"unstyled",size:"sm",type:"submit",className:"group/submit text-background gumloop-button-shadow relative !gap-1.5 overflow-clip border border-[var(--node-color-dark)] bg-[var(--node-color-dark)]/85 pl-1.75 shadow-sm transition-[padding-right,transform] duration-300 ease-in-out hover:pr-7.5 dark:border-none dark:bg-[var(--node-color-medium)]/85",disabled:_===O.IG.PROCESSING||_===O.IG.APPROVAL_REQUIRED,children:[(0,S.jsx)(s4.Z,{className:"text-background dark:text-foreground shrink-0 rounded-[3px] border-none bg-[var(--node-color-light)]/35 !p-0.5 text-xs",children:"âŒ˜"}),(0,S.jsx)(s4.Z,{className:"text-background dark:text-foreground shrink-0 rounded-[3px] border-none bg-[var(--node-color-light)]/35 !p-0.5 text-xs",children:"â†µ"}),(0,S.jsx)("span",{className:"dark:text-foreground text-sm font-medium",children:"Generate"}),(0,S.jsx)(s5.Z,{className:"dark:text-foreground absolute top-1/2 right-3 flex-shrink-0 -translate-x-1 -translate-y-1/2 opacity-0 transition-all duration-200 ease-out group-hover/submit:flex group-hover/submit:translate-x-1 group-hover/submit:opacity-100"})]})]})]}),(0,S.jsx)(eQ.Z,{open:C,setOpen:I,title:"Reset Gummie Chat",description:"Starting this process will reset your Gummie chat history. All current conversation and progress will be lost. Do you want to continue?",onConfirm:()=>{f((0,A.nz)(O.Cn.CUSTOM_NODE_CONFIG)),I(!1)},onCancel:()=>{I(!1),Z(null)},confirmButtonText:"Continue & Reset",cancelButtonText:"Cancel"})]})},nw=r(35510),nN=e=>{let{nodeHeight:t}=e,r=(0,ez.CG)(A.zd),a=(0,ez.CG)(A.bc),{data:s,id:n}=(0,sQ.Gt)(),{canCreateCustomNode:l}=s8(n),o=(0,ez.CG)(A.IW),i=(0,ez.CG)(A.d5),d=(0,K.useRef)(!0),c=(0,K.useRef)(void 0);return((0,K.useEffect)(()=>{d.current&&(c.current=Date.now(),(0,no.gW)(nr.z.OPERATOR_BUILDER.BUILDER_ADDED_TO_PIPELINE,{node_id:n,chat_id:a,mcpServerDeclaration:s.declaration.mcp_server_declaration}),d.current=!1)},[]),l)?o===O.IG.PROCESSING?(0,S.jsx)("div",{className:"p-2",children:(0,S.jsx)(s0,{})}):o==O.IG.EDIT_CUSTOM_NODE||r||i===O.Cn.MANUAL_CUSTOM_NODE?(0,S.jsx)(nw.Z,{customOperator:r}):(0,S.jsx)(ny,{nodeHeight:t}):(0,S.jsx)("div",{className:"text-muted-foreground flex flex-grow flex-col items-center justify-center gap-2 p-2 text-center text-sm transition-all duration-300",children:"You are already creating a node, please finish creating that node first"})},nk=r(61632),nC=()=>{var e,t;let r=(0,Q.v9)(A.zd),{colorShades:a}=(0,sQ.Gt)(),s=(null==r?void 0:null===(t=r.operator_declaration)||void 0===t?void 0:null===(e=t.inputs)||void 0===e?void 0:e.length)||0;return s?(0,S.jsx)(eC.HH,{type:"target",position:ek.Ly.Top,className:'z-10 font-medium tabular-nums before:content-[""]',style:{backgroundColor:"var(--background)",width:"36px",height:"36px",borderRadius:"50%",top:"-18px",left:"50%",transform:"translateX(-50%)",border:"2px solid ".concat(a.medium),boxShadow:"0 0 0 8px color-mix(in srgb, ".concat(a.light,", transparent 20%)"),display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",color:"var(--muted-foreground)",cursor:"pointer"},children:s>0?s:null}):null},nI=()=>{var e,t;let r=(0,Q.v9)(A.zd),a=(null==r?void 0:null===(t=r.operator_declaration)||void 0===t?void 0:null===(e=t.outputs)||void 0===e?void 0:e.length)||0,{colorShades:s}=(0,sQ.Gt)();return a?(0,S.jsx)("div",{children:(0,S.jsx)(eC.HH,{type:"source",position:ek.Ly.Bottom,className:'z-10 font-medium tabular-nums before:content-[""]',style:{backgroundColor:"var(--background)",width:"36px",height:"36px",borderRadius:"50%",border:"2px solid ".concat(s.medium),boxShadow:"0 0 0 8px color-mix(in srgb, ".concat(s.light,", transparent 20%)"),display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",color:"var(--muted-foreground)"},children:a>0?a:null})}):null},nT=()=>(0,S.jsxs)("div",{className:(0,eu.cn)("absolute -top-8 left-1/2 z-50 flex max-w-[500px] min-w-[340px] -translate-x-1/2 -translate-y-full","bg-background divide-border flex flex-col overflow-hidden rounded-md border p-2 shadow-sm","transition-opacity duration-300"),children:[(0,S.jsx)("span",{className:"text-center text-xs font-medium",children:"Preview Only"}),(0,S.jsx)("span",{className:"text-muted-foreground text-center text-xs text-balance",children:"You cannot interact with the node while it is being created or edited. Request changes via the chat."})]}),nS=r(56696);let nE=(0,K.memo)(()=>{var e;let{userProfile:t,idTokenRef:r}=(0,ec.H)(),{colorShades:a,cssVariables:s,id:n,data:l,setCredentialsToUse:o}=(0,sQ.Gt)(),{hasActiveCreation:i}=s8(n),[d,c]=(0,K.useState)(0),u=(0,K.useRef)(null),m=(0,Q.v9)(A.zd),{data:p}=(0,J.jL)({userProfile:t,idToken:r.current},{skip:!(null==t?void 0:t.isLoggedIn())});return(0,K.useEffect)(()=>{if(u.current){let e=new ResizeObserver(e=>{var t;let r=null===(t=e[0])||void 0===t?void 0:t.contentRect.height;r&&c(r)});return e.observe(u.current),c(u.current.clientHeight),()=>{e.disconnect()}}},[]),(0,K.useEffect)(()=>{var e;let t=(null===(e=l.declaration.mcp_server_declaration)||void 0===e?void 0:e.secret_types)||[];t&&p&&!l.credentialsToUse&&o(t.reduce((e,t)=>{var r;return e[t]={secret_id:null==p?void 0:null===(r=p.find(e=>e.secret_type===t))||void 0===r?void 0:r.secret_id,is_personal_credential:!0,is_default:!0},e},{}))},[null===(e=l.declaration.mcp_server_declaration)||void 0===e?void 0:e.secret_types,p,l.credentialsToUse,o]),(0,S.jsxs)(nS.Z,{ref:u,colorShades:a,cssVariables:s,children:[i&&(0,S.jsx)(nT,{}),(0,S.jsx)(nC,{}),(0,S.jsx)(nk.Z,{customOperator:m,customNodeData:l,customNodeId:n,colorShades:a,hasActiveCreation:!!i}),(0,S.jsx)(nN,{nodeHeight:d}),(0,S.jsx)(nI,{})]})});nE.displayName="CustomNodeBuilder";var nM=(0,K.memo)(e=>{let{id:t,sourceX:r,sourceY:a,targetX:s,targetY:n,data:l,config:o}=e,{userProfile:i}=(0,ec.H)(),[d,c]=(0,K.useState)(!1),u=(0,K.useRef)(null),m=(0,Q.I0)(),[p,x,h]=(i.uses_default_edges?ek.OW:ek.OQ)({sourceX:r,sourceY:a,targetX:s,targetY:n,borderRadius:20}),g=(0,K.useCallback)(()=>{u.current&&clearTimeout(u.current),u.current=window.setTimeout(()=>{c(!0)},150)},[]),f=(0,K.useCallback)(()=>{u.current&&clearTimeout(u.current),u.current=window.setTimeout(()=>{c(!1)},150)},[]),v=()=>{m((0,F.DF)(t))},j="function"==typeof o.stroke?o.stroke(l):o.stroke,b="function"==typeof o.opacity?o.opacity(l):o.opacity;return(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)("g",{onMouseEnter:g,onMouseLeave:f,children:[(0,S.jsx)(eC.u5,{id:t,path:p,style:{strokeWidth:o.strokeWidth,stroke:j,strokeDasharray:o.strokeDasharray,opacity:b,animation:o.animation,strokeLinecap:"round"}}),o.showAnimatedArrow&&(0,S.jsx)("g",{children:(0,S.jsx)("path",{d:"M0,-7 L14,0 L0,7 Z",fill:o.animatedArrowColor||"var(--pink-200)",transform:"scale(2.5)",className:"!animate-move-along-path",style:{offsetPath:'path("'.concat(p,'")'),offsetRotate:"auto"}})})]}),d&&(o.edgeLabelRenderer?(0,S.jsx)(eC.XQ,{children:o.edgeLabelRenderer(l,x,h,g,f,v)}):(0,S.jsx)(eC.XQ,{children:(0,S.jsx)("button",{className:"absolute",style:{transform:"translate(-50%, -50%) translate(".concat(x,"px,").concat(h,"px)"),pointerEvents:"all"},onMouseEnter:g,onMouseLeave:f,onClick:v,children:(0,S.jsx)("div",{className:"bg-destructive rounded-full p-1",children:(0,S.jsx)(t_.Z,{className:"text-destructive-foreground h-6 w-6"})})})})),o.cssKeyframes&&(0,S.jsx)("style",{dangerouslySetInnerHTML:{__html:o.cssKeyframes}})]})}),nA=(0,K.memo)(e=>{let t=(0,K.useMemo)(()=>({strokeWidth:10,stroke:"var(--color-gray-300)",opacity:.6,animation:"none",strokeDasharray:"0 24",edgeLabelRenderer:(e,t,r,a,s,n)=>(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{className:"absolute",style:{transform:"translate(-50%, -50%) translate(".concat(t,"px,").concat(r,"px)"),pointerEvents:"all"},onMouseEnter:a,onMouseLeave:s,onClick:n,children:(0,S.jsx)(es(),{href:" https://docs.gumloop.com/core-concepts/flow_subscriptions ",target:"_blank",className:"bg-background border-border hover:text-muted-foreground pointer-events-auto flex size-9 items-center justify-center rounded-full border",children:(0,S.jsx)(e$.Z,{className:"size-5"})})})}),(0,S.jsx)(eo._v,{children:"The interface allows users to subscribe to this flow, which allows them to create their own copy of this trigger. Click to learn more."})]})}),[]);return(0,S.jsx)(nM,{...e,config:t})}),nO=r(44614),nZ=r(38444),nz=e=>{let{nodes:t,edges:r,currentSavedItem:a}=e,s=(0,ez.TL)(),n=(0,K.useRef)({nodes:[],edges:[]});return{copy:(0,K.useCallback)(()=>{let e=(0,nZ.d$)({nodes:t,edges:r});n.current=e},[t,r]),paste:(0,K.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nZ.ws.INTERNAL;if(!a)return;let{nodes:l,edges:o}=(0,nZ.Fu)({copiedNodes:n.current.nodes,copiedEdges:n.current.edges,currentNodes:t,currentEdges:r,currentSavedItemId:null==a?void 0:a.saved_item_id,preserveConnections:e});s((0,F.fL)(l)),s((0,F.vd)(o))},[t,r,a,s])}},nP=r(84977),nD=r(73645);r(86746);var nL=r(20132),nR=r(88953);(n=j||(j={})).FLOW="flow",n.FLOW_MANAGER="flow-manager",n.PLRUN_MANAGER="pl-run-manager",n.GUMMIE="gummie";let nF=e=>{let{label:t,value:r,type:a,actions:s=[]}=e,{handleCopyText:n,isCopied:l}=useCopyText("json"===a?JSON.stringify(r,null,2):r);return _jsxs(Dialog,{children:[_jsxs("div",{className:"flex flex-row justify-between py-0.75",children:[_jsx("span",{className:"text-foreground max-w-1/3 text-sm",children:t}),"json"===a?_jsx(DialogTrigger,{asChild:!0,children:_jsxs("div",{className:"text-foreground flex cursor-pointer flex-row items-center gap-2",children:[_jsx("span",{className:"text-sm",children:"View more"}),_jsx(Expand,{size:12})]})}):r?_jsx("div",{className:"text-foreground max-w-1/3 truncate text-sm uppercase",children:String(r)}):"-"]}),_jsxs(DialogContent,{className:"min-w-2xl",children:[_jsxs(DialogBody,{className:"gap-0! p-0!",children:[_jsx(DialogHeader,{className:"border-b p-6",children:_jsx(DialogTitle,{children:t})}),_jsxs("div",{className:"",children:["json"===a?_jsx("pre",{className:"max-h-[60vh] overflow-x-hidden overflow-y-auto p-6 text-sm wrap-break-word",children:nU(r)}):_jsx("div",{className:"text-sm",children:String(r)}),s.length>0&&_jsx("div",{className:"mt-4 flex justify-end gap-2",children:s.map((e,t)=>_jsx(Button,{onClick:e.callbackHandler,children:e.label},t))})]})]}),_jsxs(DialogFooter,{children:[_jsxs("div",{className:"text-muted-foreground mr-auto flex flex-row items-center gap-2 text-xs",children:[_jsx(Link,{href:"https://jsondiff.com/",target:"_blank",children:"Diff Checker"})," â€¢ ",_jsx(Link,{href:"https://jsonformatter.org/json-pretty-print",target:"_blank",children:"Pretty Print"})]}),_jsx(MotionConfig,{transition:{duration:.1},children:_jsx(Button,{variant:"outline",size:"icon",onClick:n,children:_jsx(AnimatePresence,{mode:"popLayout",children:l?_jsx(motion.span,{initial:{opacity:0,scale:0,filter:"blur(2px)"},animate:{opacity:1,scale:1,filter:"blur(0px)"},exit:{opacity:0,scale:0,filter:"blur(2px)"},children:_jsx(Check,{})},"copied"):_jsx(motion.span,{initial:{opacity:0,scale:0,filter:"blur(2px)"},animate:{opacity:1,scale:1,filter:"blur(0px)"},exit:{opacity:0,scale:0,filter:"blur(2px)"},children:_jsx(Clipboard,{})},"copy")})})})]})]})]})},nG=e=>{let{testingListItems:t}=e;return _jsx("div",{className:"flex flex-col gap-2",children:t.map(e=>{let{label:t,value:r,type:a,actions:s}=e;return _jsx(nF,{label:t,value:r,type:a,actions:null!=s?s:[]},t)})})},nU=e=>{var t;return _jsx("div",{dangerouslySetInnerHTML:{__html:escapeHtml(null!==(t=JSON.stringify(e,null,2))&&void 0!==t?t:"").replace(/(&quot;(?:[^&]|&(?!quot;))*?&quot;)\s*:/g,'<span class="text-blue-700 font-medium">$1</span>:').replace(/:\s*(&quot;(?:[^&]|&(?!quot;))*?&quot;)/g,': <span class="text-pink-700">$1</span>').replace(/:\s*(true|false)/g,': <span class="text-purple-600 font-medium">$1</span>').replace(/:\s*(null)/g,': <span class="text-gray-700 italic">$1</span>').replace(/:\s*(-?\d+(?:\.\d+)?)/g,': <span class="text-orange-600">$1</span>').replace(/([{}[\]])/g,'<span class="text-gray-500 font-bold">$1</span>')},className:"font-mono text-xs leading-relaxed break-words whitespace-pre-wrap"})};var nB=r(80807),nV=(0,K.memo)(e=>{var t;let r=(0,K.useMemo)(()=>{var t,r;return(null===(r=e.data)||void 0===r?void 0:null===(t=r.warnings)||void 0===t?void 0:t.some(e=>e===nB.e.NO_DOWNSTREAM_BADGES))?{strokeWidth:8,stroke:"var(--amber-300)",strokeDasharray:"none",showAnimatedArrow:!0,animatedArrowColor:"var(--amber-300)"}:{strokeWidth:8,stroke:"var(--pink-200)",strokeDasharray:"none",showAnimatedArrow:!0}},[null===(t=e.data)||void 0===t?void 0:t.warnings]);return(0,S.jsx)(nM,{...e,config:r})}),nW=(0,K.memo)(e=>{var t;let r=(0,K.useMemo)(()=>{var t,r;return(null===(r=e.data)||void 0===r?void 0:null===(t=r.warnings)||void 0===t?void 0:t.some(e=>e===nB.e.NO_DOWNSTREAM_BADGES))?{strokeWidth:8,stroke:"var(--amber-400)",opacity:.5,animation:"none",strokeDasharray:"14 14",showAnimatedArrow:!1}:{strokeWidth:8,stroke:"var(--color-gray-300)",opacity:.6,animation:"none",strokeDasharray:"14 14"}},[null===(t=e.data)||void 0===t?void 0:t.warnings]);return(0,S.jsx)(nM,{...e,config:r})}),nH=(0,K.memo)(e=>(0,S.jsx)(nM,{...e,config:{strokeWidth:3,stroke:e=>(null==e?void 0:e.label)?"var(--destructive)":"var(--muted-foreground)",animation:"none"}})),nJ=r(61929),nq=r(30740),nK=r(78341),nY=r(72130),n$=e=>{let{open:t,setOpen:r,operatorId:a,children:s,onOpen:n}=e,[l,o]=(0,K.useState)(!1),[i,d]=(0,eK.P)({open:t,onOpenChange:r}),c=(0,ez.CG)(rb.tY),{userProfile:u,idTokenRef:m}=(0,ec.H)(),p=(0,ez.TL)(),x=async()=>{await (0,nY.Zo)({operatorId:a,dispatch:p,userProfile:u,idToken:m.current,customOperators:c})};return(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)(tc.h_,{open:i,onOpenChange:e=>{null==n||n(),d(e)},children:[(0,S.jsx)(tc.$F,{asChild:!0,children:s||(0,S.jsx)("span",{})}),(0,S.jsx)(tc.AW,{className:"p-1",onClick:e=>{e.stopPropagation(),e.preventDefault()},children:(0,S.jsxs)(tc.Xi,{destructive:!0,onClick:e=>{e.preventDefault(),d(!1),o(!0)},children:[(0,S.jsx)(nK.Z,{}),"Archive"]})})]}),(0,S.jsx)(eQ.Z,{title:"Are you sure you want to archive this node?",description:"This will remove it from your library.",confirmButtonProps:{text:"Archive",variant:"destructive-gradient"},onConfirm:x,open:l,setOpen:o})]})};let nQ=(0,K.memo)(e=>{var t,r,a;let{isDraggable:s=!0,Icon:n,IconContainerClassName:l,IconClassName:o,iconSize:i=22,hasMCP:d,sharedCustomOperatorsMap:c,operatorDeclaration:u,isMCP:m,keyboardShortcut:p,pinnedNodeMenu:x,onlyMCP:h,clampDescription:g,category:f,isDefaultCustomOperator:v,...j}=e,b=v?null!==(r=null==u?void 0:null===(t=u.metadata)||void 0===t?void 0:t.category)&&void 0!==r?r:"mega_node":f;return(0,S.jsxs)("button",{style:(0,ro.J8)(null!=b?b:""),className:(0,eu.cn)("group flex w-full flex-grow cursor-pointer items-start gap-2.5 text-start active:cursor-grabbing",j.isAvatarOnly&&"w-fit"),...j,children:[(0,S.jsxs)("div",{id:"icon-container",className:(0,eu.cn)("flex size-12 flex-none items-center justify-center rounded-md border",l,m?"text-background bg-[var(--node-color-dark)]":"bg-[var(--node-color-light)]/20 text-[var(--node-color-dark)]"),children:[s&&(0,S.jsx)(nJ.Z,{size:i,className:(0,eu.cn)("hidden",!h&&"group-hover:block")}),(0,S.jsx)("span",{className:(0,eu.cn)(!h&&s&&"group-hover:hidden"),children:n?(0,S.jsx)(n,{size:i,className:o}):(0,rj.Fp)(j.icon)?(0,rj.Zu)(j.icon,i):(0,rj.hY)(v?"Box":null!==(a=j.icon)&&void 0!==a?a:"",i)})]}),!j.isAvatarOnly&&(0,S.jsxs)("div",{className:"my-auto flex w-full flex-col items-start gap-0.5 overflow-hidden",children:[(0,S.jsxs)("div",{className:"flex w-full flex-row items-center gap-1.5",children:[(0,S.jsx)("span",{className:"line-clamp-2 flex-grow text-sm font-medium",children:j.title}),(m||d||v||p)&&(0,S.jsxs)("div",{className:"ml-auto flex flex-wrap items-center gap-1.5",children:[(m||d||v)&&(0,S.jsx)(eU.C,{size:"sm",className:(0,eu.cn)("flex-shrink-0 !rounded-sm font-medium",m&&"text-background bg-[var(--node-color-dark)]",(d||v)&&"bg-[var(--node-color-light)] text-[var(--node-color-dark)]"),children:"MCP"}),p&&p.map(e=>(0,S.jsx)(s4.Z,{className:"bg-background !rounded-sm",children:e},e))]}),null==u||!u.operator_id||(null==c?void 0:c.has(u.operator_id))||v?(null==u?void 0:u.operator_id)&&(null==c?void 0:c.has(u.operator_id))?(0,S.jsx)(eU.C,{size:"sm",className:"group-hover:bg-background group-hover:text-foreground group-hover:border-border",children:"Shared"}):null:(0,S.jsx)(n$,{operatorId:u.operator_id,onOpen:()=>{if(!x){var e;null===(e=j.actions)||void 0===e||e.togglePin()}},children:(0,S.jsx)(el.zx,{size:"icon-xs",variant:"ghost",className:"hover:bg-background hover:text-foreground hover:border",children:(0,S.jsx)(nq.Z,{size:14})})})]}),(null==j?void 0:j.description)&&(0,S.jsx)("span",{className:(0,eu.cn)("text-muted-foreground text-xs",g?"line-clamp-1":"line-clamp-2"),children:null==j?void 0:j.description})]})]})});nQ.displayName="NodeLibraryBaseListItem";let nX={name:"Create a Custom Node",description:"Tell AI what you want this node to do"},n0=(0,K.memo)(e=>{let{onNodeClickToAdd:t,onNodeDragStart:r,description:a,hideShortcut:s,minimal:n,iconContainerClassName:l,iconSize:o=22,keyboardIndex:i}=e;return(0,S.jsx)("div",{draggable:!!r,onClick:e=>{e.stopPropagation(),t(nX,rf.Jq.CustomNodeBuilder)},onDragStart:e=>{e.stopPropagation(),null==r||r(e,nX,rf.Jq.CustomNodeBuilder)},className:(0,eu.cn)("rounded-md px-2 py-1.5 focus-within:bg-blue-100/70 hover:bg-blue-100/70",!1,!n&&"bg-blue-100/60 !text-blue-800"),children:(0,S.jsx)(nQ,{title:"Create a Custom Node",description:null!=a?a:"Didn't find what you're looking for? Create a custom node to automate anything!",IconContainerClassName:(0,eu.cn)("border-accent-foreground/25 !bg-blue-100/90 !text-blue-800",l),keyboardShortcut:s?void 0:["âŒ˜","â‡§","G"],isDraggable:!!r,iconSize:o,"data-kb-index":i})})});n0.displayName="CustomNodeListItem";var n1=r(89600),n2=r(60887),n5=r(45587),n4=r(60745),n3=r(85086);let n9=()=>{let[e,t]=(0,K.useState)(!1),[r,a]=(0,K.useState)({isOpen:!1,savedItemId:null}),s=(0,ez.TL)(),n=(0,ez.CG)(R.L2),l=(0,ez.CG)(R.HA).ordering,o=(0,ez.CG)(R.LA),{currentProject:i}=(0,e0.d2)(),{userProfile:d,idTokenRef:c}=(0,ec.H)(),u=(0,ez.CG)(G.P$),m=async e=>{let r=X.Am.loading("Creating flow...");try{t(!0),await s((0,ej.gG)({tabName:e,userProfile:d,idToken:c.current,currentProject:i})).unwrap(),X.Am.success("Flow created successfully!",{id:r})}catch(e){X.Am.error("Unable to create flow",{id:r})}finally{t(!1)}},p=async e=>{let t=X.Am.loading("Deleting flow...");try{await s((0,ej.Px)({savedItemId:e,userProfile:d,idTokenRef:c,currentProject:i,currentFlowbook:o})).unwrap(),X.Am.success("Flow deleted successfully!",{id:t})}catch(e){X.Am.error("Unable to delete flow",{id:t})}};return{isAddingTab:e,setIsAddingTab:t,handleAddTab:m,handleDelete:p,handleDuplicate:(0,K.useCallback)(e=>{let t=n[e],r=eO().generate(),a=t.savedItem.clone();a.saved_item_id=r,a.name="Copy of ".concat(t.savedItem.name),a.declaration=void 0,a.created_ts=null;let m=t.plConfig.clone();m.reset_node_ids();let p={savedItem:a,plConfig:m};for(let e of p.plConfig.pipeline)if(e.parameters&&e.parameters.hasOwnProperty("_is_trigger_enabled")&&(e.parameters._is_trigger_enabled="false"),"form"===e.category){let a=u[t.savedItem.saved_item_id],n=eV.Form.duplicate(a,r);e.parameters.__form_id__=n.form_id,e.parameters.__form_hash__=eV.Form.calculate_hash(n),s((0,G.addLocalForm)(n))}s((0,B.w5)({flowbook:o,savedItem:p.savedItem,plConfig:p.plConfig})),s((0,D.IE)({savedItemId:r,flow:p})),s((0,ej.hw)({newActiveTab:r,userProfile:d,idToken:c.current,projectId:null==i?void 0:i.project_id}));let x=l.indexOf(e);s((0,D.lj)({index:l.length,moveTo:x+1}))},[n,s,o,d,l,u,c,i]),handleRename:(0,K.useCallback)((e,t)=>{if(!t)return;let r=n[e];if(!r)return;let a=r.savedItem.clone();a.name=t,s((0,D.IE)({savedItemId:a.saved_item_id,flow:{...r,savedItem:a}}));let l=(0,B.ks)(a,r.plConfig);s((0,B.Fr)(l))},[n,s]),handleCopyTo:(0,K.useCallback)(async(e,t)=>{let r=X.Am.loading("Copying...");a&&a({isOpen:!1,savedItemId:null});let{flowbook:l}=await n3.P.loadSavedItemAndPlConfigs(t,d,c.current,null==i?void 0:i.project_id);if(!l){X.Am.error("Flowbook not found.",{id:r});return}let o=n[e],m=eO().generate(),p=o.savedItem.clone();p.saved_item_id=m,p.name="Copy of ".concat(o.savedItem.name),p.declaration=void 0,p.created_ts=null,p.author_id=l.author_id;let x=o.plConfig.clone();x.reset_node_ids();let h={savedItem:p,plConfig:x},g=[];for(let e of h.plConfig.pipeline){if(e.parameters&&e.parameters.hasOwnProperty("_is_trigger_enabled")&&(e.parameters._is_trigger_enabled="false"),"form"===e.category){let t=u[o.savedItem.saved_item_id];if(!t){X.Am.error("Form not found.",{id:r});return}let a=eV.Form.duplicate(t,m);e.parameters.__form_id__=a.form_id,e.parameters.__form_hash__=eV.Form.calculate_hash(a),s((0,G.addLocalForm)(a))}"Browser Extension Input"==e.operator&&g.push({saved_item_id:h.savedItem.saved_item_id,author_id:h.savedItem.author_id,action:e.parameters.Action})}h.plConfig.update_hash(),h.savedItem.saved_item_ref=h.plConfig.pl_config_hash;try{await h.savedItem.update_saved_item_only(d,c.current,null==i?void 0:i.project_id),l.saved_item_plconfigs||(l.saved_item_plconfigs=[]),l.saved_item_plconfigs.push({savedItem:h.savedItem,plConfig:h.plConfig}),s((0,B.w5)({flowbook:l,savedItem:h.savedItem,plConfig:h.plConfig})),await l.saveFlowbookSavedItemPlConfigs(d,c.current,null==i?void 0:i.project_id);let e=E.Z.getState().forms.forms,t=Object.values(e).map(e=>s((0,n4.saveForm)({form:e,userProfile:d,idToken:c.current,projectId:null==i?void 0:i.project_id})).unwrap());for(let e of(await Promise.all(t),g))try{await (0,ed.eN)("/replay_flows",d,c.current,"POST",e)}catch(e){X.Am.error(e.message)}X.Am.success("Copy successful!",{id:r})}catch(e){X.Am.error("Error copying: ".concat(e.message),{id:r})}},[s,n,null==i?void 0:i.project_id,d,c,a,u]),copyToModalState:r,setCopyToModalState:a}};var n6=r(10200);let n8=(0,K.createContext)(null),n7=()=>{let e=(0,K.useContext)(n8);if(!e)throw Error("useFlowTabRename must be used within a FlowTabRenameProvider");return e},le=e=>{let{children:t}=e,[r,a]=(0,K.useState)(null),[s,n]=(0,K.useState)(""),l=(0,K.useCallback)((e,t)=>{a(e),n(t)},[]),o=(0,K.useCallback)(e=>{n(e)},[]),i=(0,K.useCallback)(e=>{r&&(e(s),a(null),n(""))},[r,s]),d=(0,K.useCallback)(()=>{a(null),n("")},[]);return(0,S.jsx)(n8.Provider,{value:{editingTabId:r,draftText:s,startEditing:l,updateDraft:o,finishEditing:i,cancelEditing:d},children:t})};var lt=r(35152),lr=r(6859),la=r(29762),ls=r(18591);let ln=e=>{let{selectedFlowbookId:t,setSelectedFlowbookId:r}=e,a=(0,Q.v9)(B.xQ),s=(0,Q.v9)(R.LA),{currentProject:n}=(0,e0.d2)(),{userProfile:l}=(0,ec.H)(),o=(0,K.useMemo)(()=>a.filter(e=>{var t;return e.flowbook_id!==s.flowbook_id&&e.author_id===(null!==(t=null==n?void 0:n.project_id)&&void 0!==t?t:l.user_id)}),[a,s.flowbook_id,null==n?void 0:n.project_id,l.user_id]),i=(0,K.useCallback)((e,t,r)=>r?(0,la.f9)(r[0],t,r.slice(1)):0,[]);return(0,S.jsxs)(ls.mY,{className:"rounded-lg border",filter:i,children:[(0,S.jsx)(ls.sZ,{placeholder:"Search workbooks..."}),(0,S.jsxs)(ls.e8,{children:[(0,S.jsx)(ls.rb,{children:(0,S.jsx)("span",{className:"text-muted-foreground",children:"No workbooks found."})}),o.map(e=>{var a;return(0,S.jsxs)(ls.di,{value:e.flowbook_id,keywords:[e.name,null!==(a=e.description)&&void 0!==a?a:""],onSelect:()=>r(e.flowbook_id),className:"flex gap-2 rounded-none p-3 ".concat(t===e.flowbook_id?"bg-blue-50":"border-2 border-transparent"),children:[(0,S.jsx)("div",{className:"rounded-md border p-2 ".concat(t===e.flowbook_id?"border-blue-300 bg-blue-100":""),children:t===e.flowbook_id?(0,S.jsx)(eR.Z,{className:"h-4 w-4 text-blue-600"}):(0,S.jsx)(rw.Z,{className:"h-4 w-4"})}),(0,S.jsxs)("div",{className:"flex grow flex-col md:flex-row md:items-center md:justify-between",children:[(0,S.jsx)("div",{className:"flex items-center gap-2 text-sm",children:(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("span",{className:"font-medium",children:e.name}),(0,S.jsx)("span",{className:"text-muted-foreground line-clamp-1 text-xs",children:e.description})]})}),e.created_ts&&(0,S.jsxs)("div",{className:"text-muted-foreground text-xxs shrink-0 md:text-xs",children:["Last edited"," ",new Date(e.created_ts).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]})]},e.flowbook_id)})]})]})};var ll=(0,K.memo)(e=>{let{open:t,onClose:r,onCopy:a}=e,[s,n]=(0,K.useState)("");return(0,S.jsx)(eq.Vq,{open:t,onOpenChange:r,children:(0,S.jsxs)(eq.cZ,{className:"max-w-3xl!",children:[(0,S.jsxs)(eq.a7,{children:[(0,S.jsx)(eq.fK,{children:(0,S.jsxs)(eq.$N,{className:"flex items-center gap-2",children:[(0,S.jsx)(eF.Z,{className:"h-5 w-5"}),"Copy to Workbook"]})}),(0,S.jsx)(ln,{selectedFlowbookId:s,setSelectedFlowbookId:n})]}),(0,S.jsxs)(eq.cN,{children:[(0,S.jsx)(el.zx,{variant:"ghost",onClick:r,children:"Cancel"}),(0,S.jsx)(el.zx,{onClick:()=>a(s),disabled:!s,children:"Copy"})]})]})})}),lo=r(24285),li=r(59111);function ld(e){let{...t}=e;return(0,S.jsx)(li.fC,{"data-slot":"context-menu",...t})}function lc(e){let{...t}=e;return(0,S.jsx)(li.xz,{"data-slot":"context-menu-trigger",...t})}function lu(e){let{className:t,...r}=e;return(0,S.jsx)(li.Uv,{children:(0,S.jsx)(li.VY,{"data-slot":"context-menu-content",className:(0,eu.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-context-menu-content-available-height) min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...r})})}function lm(e){let{className:t,inset:r,variant:a="default",...s}=e;return(0,S.jsx)(li.ck,{"data-slot":"context-menu-item","data-inset":r,"data-variant":a,className:(0,eu.cn)("focus:bg-muted focus:text-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}let lp=e=>{let{placeholder:t="",initialValue:r="",autoFocus:a=!1,className:s="",onChange:n,onKeyDown:l,onBlur:o,minWidth:i=50,buffer:d=80,disabled:c=!1}=e,[u,m]=(0,K.useState)(r),[p,x]=(0,K.useState)(0),h=(0,K.useRef)(null);return(0,K.useEffect)(()=>{h.current&&x(Math.max(h.current.offsetWidth+d,i))},[u]),(0,S.jsxs)("div",{style:{display:"inline-block",minWidth:"50px"},children:[(0,S.jsx)("span",{ref:h,style:{visibility:"hidden",position:"absolute",whiteSpace:"pre"},className:"text-foreground",children:u||t}),(0,S.jsx)("input",{type:"text",value:u,placeholder:t,autoFocus:a,onChange:e=>{let t=e.target.value;m(t),n&&n(t)},onKeyDown:l,onBlur:o,style:{width:"".concat(p,"px")},className:(0,eu.cn)("text-foreground! bg-background border-border placeholder:text-muted-foreground",s),disabled:c})]})};lp.displayName="DynamicallySizedInput";var lx=e=>{let{id:t,label:r,onClick:a,onDelete:s,onDuplicate:n,onRename:l,isSelected:o=!1,onCopyTo:i,onEditStateChange:d,tabCount:c}=e,u=!!(0,ez.CG)(A.zd),m=(0,ez.CG)(ew),{editingTabId:p,draftText:x,startEditing:h,updateDraft:g,finishEditing:v,cancelEditing:j}=n7(),b=p===t,_=(0,K.useCallback)(e=>{e.stopPropagation(),h(t,r)},[t,r,h]),y=()=>{v(l)};(0,K.useEffect)(()=>{null==d||d(b)},[b,d]);let w=c<=1,N=(0,K.useMemo)(()=>[{label:"Rename",Icon:aL.Z,onClick:_},{label:"Duplicate",Icon:aD.Z,onClick:n},{label:"Copy To",Icon:eF.Z,onClick:i},{label:"Delete",Icon:rt.Z,onClick:s,className:"text-destructive-foreground hover:bg-destructive",destructive:!0,disabled:w,disabledTooltip:"Workbooks must have at least one workflow"}],[s,n,i,_,w]);return(0,S.jsxs)(ld,{modal:!1,children:[(0,S.jsxs)(lc,{disabled:m!==f.DEFAULT,onClick:a,className:(0,eu.cn)("group flex h-12 cursor-pointer items-center gap-2 overflow-hidden rounded-t-xl border border-x border-t border-transparent px-5 select-none active:scale-100! active:cursor-grabbing!",o&&"border-border bg-elevated border-x border-t shadow-xs",u&&"pointer-events-none opacity-50"),children:[(0,S.jsx)("div",{className:"flex h-full w-auto items-center gap-2",children:b?(0,S.jsx)("div",{children:(0,S.jsx)(lp,{initialValue:x,autoFocus:!0,onChange:g,onKeyDown:e=>{"Enter"===e.key&&y(),"Escape"===e.key&&j()},onBlur:y,className:"flex-grow rounded-md text-xs font-semibold",buffer:24})}):(0,S.jsx)("div",{className:(0,eu.cn)("text-muted-foreground/75 flex items-center gap-2 truncate text-[.875rem] font-semibold",o?"text-foreground":"hover:text-muted-foreground"),onDoubleClick:e=>{e.stopPropagation(),h(t,r)},children:r})}),m===f.DEFAULT&&(0,S.jsxs)(tc.h_,{modal:!1,children:[(0,S.jsx)(tc.$F,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-xs",className:"hover:bg-muted rounded-sm p-0.5",onClick:e=>{e.stopPropagation()},children:(0,S.jsx)(to.Z,{className:(0,eu.cn)("text-muted-foreground/25",o&&"text-muted-foreground")})})}),(0,S.jsx)(tc.AW,{className:(0,eu.cn)("p-1"),children:N.map(e=>e.disabled&&e.disabledTooltip?(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{children:(0,S.jsxs)(tc.Xi,{disabled:!0,className:e.className,destructive:e.destructive,children:[(0,S.jsx)(e.Icon,{})," ",e.label]})})}),(0,S.jsx)(eo._v,{side:"right",children:e.disabledTooltip})]},e.label):(0,S.jsxs)(tc.Xi,{onClick:e.onClick,className:e.className,destructive:e.destructive,children:[(0,S.jsx)(e.Icon,{})," ",e.label]},e.label))})]})]}),(0,S.jsx)(lu,{className:(0,eu.cn)("-translate-y-5 p-1",m!==f.DEFAULT&&"hidden"),children:N.map(e=>e.disabled&&e.disabledTooltip?(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{children:(0,S.jsxs)(lm,{disabled:!0,className:(0,eu.cn)(e.className),children:[(0,S.jsx)(e.Icon,{})," ",e.label]})})}),(0,S.jsx)(eo._v,{side:"right",children:e.disabledTooltip})]},e.label):(0,S.jsxs)(lm,{onClick:e.onClick,className:(0,eu.cn)(e.className),children:[(0,S.jsx)(e.Icon,{})," ",e.label]},e.label))})]})},lh=e=>{let{id:t,className:r,...a}=e,[s,n]=(0,K.useState)(!1),{attributes:l,listeners:o,setNodeRef:i,transform:d,transition:c,isDragging:u}=(0,n5.nB)({id:t,disabled:s}),m={transform:lo.ux.Transform.toString(d),transition:c,opacity:u?.5:1},{onContextMenu:p,...x}=o||{};return(0,S.jsx)("div",{ref:i,style:m,...l,...x,className:r,children:(0,S.jsx)(lx,{id:t,...a,onEditStateChange:e=>n(e)})})},lg=()=>{let e=(0,ez.TL)(),t=(0,ez.CG)(R.Wp),r=(0,ez.CG)(R.HA),{userProfile:a,idTokenRef:s}=(0,ec.H)(),{currentProject:n}=(0,e0.d2)(),[l,o]=(0,K.useState)({isOpen:!1,savedItemId:null,flowName:null}),i=t=>{t!==r.active&&e((0,ej.hw)({newActiveTab:t,userProfile:a,idToken:s.current,projectId:null==n?void 0:n.project_id}))},{handleDelete:d,handleDuplicate:c,handleRename:u,handleCopyTo:m,copyToModalState:p,setCopyToModalState:x}=n9(),h=(0,K.useRef)(null),g=(0,K.useCallback)(()=>{x({isOpen:!1,savedItemId:null})},[]),f=(0,K.useCallback)(e=>t=>{null!==e&&m(e,t)},[m]),v=(0,K.useCallback)(()=>{l.savedItemId&&(d(l.savedItemId),o({isOpen:!1,savedItemId:null,flowName:null}))},[l.savedItemId,d]),j=(0,K.useCallback)((e,t,r)=>{e.stopPropagation(),o({isOpen:!0,savedItemId:t,flowName:r})},[]);return(0,K.useEffect)(()=>{if(h.current){let e=h.current.children[t.findIndex(e=>e.savedItem.saved_item_id===r.active)];e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}},[t,r.active]),(0,S.jsxs)("div",{className:"flex",ref:h,children:[t.map(e=>(0,S.jsx)("div",{children:(0,S.jsx)(lh,{id:e.savedItem.saved_item_id,label:e.savedItem.name,onClick:()=>i(e.savedItem.saved_item_id),onDelete:t=>j(t,e.savedItem.saved_item_id,e.savedItem.name),onDuplicate:t=>{t.stopPropagation(),c(e.savedItem.saved_item_id)},onRename:t=>u(e.savedItem.saved_item_id,t),onCopyTo:t=>{t.stopPropagation(),x({isOpen:!0,savedItemId:e.savedItem.saved_item_id})},isSelected:e.savedItem.saved_item_id===r.active,tabCount:t.length},e.savedItem.saved_item_id)},"div-".concat(e.savedItem.saved_item_id))),(0,S.jsx)(ll,{open:p.isOpen,onClose:g,onCopy:f(p.savedItemId)}),(0,S.jsx)(eQ.Z,{open:l.isOpen,setOpen:e=>o({isOpen:e,savedItemId:null,flowName:null}),title:"Delete Workflow",description:'Are you sure you want to delete "'.concat(l.flowName,'"? You will not be able to undo this action.'),onConfirm:v,primaryActionButtonVariant:el.f1.DESTRUCTIVE,confirmButtonProps:{text:"Delete Forever"},cancelButtonProps:{text:"Keep Workflow"}})]})},lf=r(33243),lv=()=>{let e=(0,ez.TL)(),t=(0,ez.CG)(R.Wp),r=(0,ez.CG)(R.HA),a=t.findIndex(e=>e.savedItem.saved_item_id===r.active),s=!!(0,ez.CG)(A.zd),{userProfile:n,idTokenRef:l}=(0,ec.H)(),{currentProject:o}=(0,e0.d2)(),i=r=>{let a=t[r];a&&e((0,ej.hw)({newActiveTab:a.savedItem.saved_item_id,userProfile:n,idToken:l.current,projectId:null==o?void 0:o.project_id}))};return s||t.length<=1?null:(0,S.jsxs)(tc.h_,{children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(tc.$F,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-foreground border-border flex items-center gap-2",children:(0,S.jsx)(lf.Z,{})})})}),(0,S.jsx)(eo._v,{children:"View all tabs"})]}),(0,S.jsx)(tc.AW,{side:"top",align:"end",className:"max-h-[300px] min-w-[200px] overflow-y-auto p-1",children:t.map((e,t)=>(0,S.jsxs)(tc.Xi,{onClick:()=>i(t),className:(0,eu.cn)("flex items-center justify-between",t===a&&"bg-accent text-accent-foreground"),children:[(0,S.jsx)("span",{className:"truncate",children:e.savedItem.name}),t===a&&(0,S.jsx)(eR.Z,{className:"h-4 w-4"})]},e.savedItem.saved_item_id))})]})},lj=r(61258),lb=()=>{let e=!!(0,Q.v9)(A.zd),t=(0,K.useRef)(null),r=(0,K.useRef)(null),a=(0,K.useCallback)(()=>{let e=document.querySelector("#flowtab");e&&e.scrollBy({left:-8})},[]),s=(0,K.useCallback)(()=>{let e=document.querySelector("#flowtab");e&&e.scrollBy({left:8})},[]),n=(0,K.useCallback)(()=>{a(),t.current=setInterval(a,16)},[a]),l=(0,K.useCallback)(()=>{s(),r.current=setInterval(s,16)},[s]),o=(0,K.useCallback)(()=>{t.current&&(clearInterval(t.current),t.current=null)},[]),i=(0,K.useCallback)(()=>{r.current&&(clearInterval(r.current),r.current=null)},[]);return e?null:(0,S.jsxs)("div",{className:"flex items-center justify-center",children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"ghost",size:"icon",className:"rounded-full",onMouseDown:n,onMouseUp:o,onMouseLeave:o,onTouchStart:n,onTouchEnd:o,children:(0,S.jsx)(lj.Z,{className:"text-muted-foreground h-5 w-5"})})}),(0,S.jsx)(eo._v,{children:"Scroll Left"})]}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"ghost",size:"icon",className:"rounded-full",onMouseDown:l,onMouseUp:i,onMouseLeave:i,onTouchStart:l,onTouchEnd:i,children:(0,S.jsx)(tr.Z,{className:"text-muted-foreground h-5 w-5"})})}),(0,S.jsx)(eo._v,{children:(0,S.jsx)("p",{children:"Scroll Right"})})]})]})};let l_=(0,K.memo)(()=>(0,S.jsxs)("div",{className:"flex items-center pl-2",children:[(0,S.jsx)(lv,{}),(0,S.jsx)(lb,{}),(0,S.jsx)("span",{className:"hidden sm:flex",children:(0,S.jsx)(lr.Z,{variant:lr.$.PIPELINE,size:28,className:"h-fit"})})]}));l_.displayName="FlowTabBarRight";var ly=(0,K.memo)(()=>{let e=(0,ez.TL)(),t=(0,ez.CG)(R.HA),r=t.ordering.findIndex(e=>e===t.active),a=(0,ez.CG)(eb.ST),s=(0,ez.CG)(ew),n=(0,n6.d)(),{isAddingTab:l,handleAddTab:o}=n9(),{userProfile:i,idTokenRef:d}=(0,ec.H)(),{currentProject:c}=(0,e0.d2)(),u=(0,n2.Dy)((0,n2.VT)(n2.we,{activationConstraint:{distance:5}})),m=(0,K.useMemo)(()=>e=>{let{transform:t}=e;return{...t,y:0}},[]),p=(0,K.useCallback)(a=>{if(a.metaKey||a.ctrlKey){if(a.altKey)switch(a.code){case"BracketRight":if(t.ordering.length){let a=(r+1)%t.ordering.length;e((0,ej.hw)({newActiveTab:t.ordering[a],userProfile:i,idToken:d.current,projectId:null==c?void 0:c.project_id}))}break;case"BracketLeft":if(t.ordering.length){let a=r-1<0?t.ordering.length-1:r-1;e((0,ej.hw)({newActiveTab:t.ordering[a],userProfile:i,idToken:d.current,projectId:null==c?void 0:c.project_id}))}}a.shiftKey&&"="===a.key&&(a.preventDefault(),o())}},[t.ordering.length,o,r,e,i,d]);return(0,K.useEffect)(()=>(window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)),[p]),(0,K.useEffect)(()=>{0===r?(0,lt.vu)({},["tab"]):-1!==r&&(0,lt.vu)({tab:r.toString()})},[r]),(0,S.jsxs)("div",{className:(0,eu.cn)("bg-background flex h-[var(--pipeline-tab-bar-height)] w-full shrink-0 items-center gap-2 overflow-hidden border-t pl-2 shadow-sm sm:relative",s!==f.DEFAULT?"max-w-[calc(100dvw-var(--gummie-container-width)-3*var(--radius))] shadow-none":"max-w-dvw rounded-t-xl border-x"),children:[s===f.DEFAULT&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsxs)(el.zx,{size:"icon",onClick:()=>o(),className:(0,eu.cn)("group bg-elevated text-muted-foreground hover:text-foreground px-4",a?"w-fit pr-4":"hover:w-fit sm:hover:pr-4"),disabled:l,children:[(0,S.jsx)(er.Z,{}),a?(0,S.jsx)("span",{className:"animate-pulse font-semibold",children:"Make Subflow!"}):(0,S.jsx)("span",{className:"hidden font-semibold sm:group-hover:block",children:"New Subflow"})]})}),(0,S.jsxs)(eo._v,{className:"flex flex-row items-center gap-x-2",align:"start",children:["New Subflow",(0,S.jsx)(s4.Z,{children:(0,s4.V)()?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"Shift"})," + ",(0,S.jsx)(s4.Z,{children:"+"})]})]}),(0,S.jsx)("div",{id:"flowtab",className:"scrollbar-hide bg-background flex h-full w-full items-end overflow-x-auto",children:(0,S.jsx)(le,{children:n?(0,S.jsx)(lg,{}):(0,S.jsx)(n2.LB,{sensors:u,collisionDetection:n2.pE,onDragEnd:r=>{document.body.classList.remove("!cursor-move");let{active:a,over:s}=r;if(s&&a.id!==s.id){let r=t.ordering.findIndex(e=>e===a.id),n=t.ordering.findIndex(e=>e===s.id);-1!==r&&-1!==n&&e((0,D.lj)({index:r,moveTo:n}))}},onDragStart:()=>{document.body.classList.add("!cursor-move")},modifiers:[m],children:(0,S.jsx)(n5.Fo,{items:t.ordering,children:(0,S.jsx)(lg,{})})})})}),(0,S.jsx)(l_,{})]})}),lw=r(12003),lN=r(36127),lk=r(78719),lC=r(13114);let lI={stiffness:500,damping:35,mass:.6},lT={stiffness:400,damping:30,mass:.8},lS={stiffness:500,damping:35,mass:.6},lE={stiffness:600,damping:35,mass:.4},lM=ro.PE.map(e=>e.name);var lA=()=>{let[e,t]=(0,K.useState)(0),[r,a]=(0,K.useState)(0),[s,n]=(0,K.useState)(!1),[l,o]=(0,K.useState)(()=>lM[1%lM.length]);(0,K.useEffect)(()=>{let r=setInterval(()=>{let r=(e+2)%lM.length;o(lM[r]),a(1),n(!1),setTimeout(()=>{t(e=>(e+1)%lM.length),n(!0)},500)},1500);return()=>clearInterval(r)},[e]);let i=(0,K.useCallback)(()=>{s&&(a(0),n(!1))},[s]),d=(0,K.useMemo)(()=>Array.from({length:5},(t,r)=>({name:lM[(e+r)%lM.length],id:"".concat(e+r)})),[e]),c=(0,K.useMemo)(()=>(0,ro.J8)(l),[l]);return(0,S.jsxs)("div",{className:"pointer-events-none relative flex w-full flex-col divide-y overflow-clip",children:[(0,S.jsxs)(nx.E.div,{className:"pointer-events-none absolute inset-0 z-20",style:{height:"56px",...c},animate:{y:(1+r)*56},transition:{type:"spring",...lI},children:[(0,S.jsx)("div",{className:"absolute inset-0 -z-1 bg-gradient-to-r from-[var(--node-color-light)]/40 via-transparent to-transparent"}),(0,S.jsx)("div",{className:"absolute inset-0 border-2 border-[var(--node-color-dark)]/50",style:{"--s":"10px","--t":"2px","--g":"3px",padding:"calc(var(--g) + var(--t))",outline:"var(--t) solid var(--node-color)",outlineOffset:"calc(-1 * var(--t))",mask:"\n              conic-gradient(at var(--s) var(--s), #0000 75%, #000 0)\n              0 0/calc(100% - var(--s)) calc(100% - var(--s)),\n              conic-gradient(#000 0 0) content-box\n            "}}),(0,S.jsx)("div",{className:"absolute top-1/2 right-3 -translate-y-1/2",children:(0,S.jsx)(nd.Z,{className:"size-5 shrink-0 animate-spin text-[var(--node-color-dark)]/50"})})]}),(0,S.jsx)(lC.M,{mode:"sync",initial:!1,children:d.map((e,t)=>(0,S.jsx)(lO,{category:e.name,index:t,onLayoutAnimationStart:1===t?i:void 0,isActive:l===e.name},e.id))})]})};let lO=(0,K.memo)(e=>{let{category:t,index:r,onLayoutAnimationStart:a,isActive:s}=e,n=(0,ro.F1)(t),l=(0,ro.J8)(t);return(0,S.jsxs)(nx.E.div,{layout:!0,onLayoutAnimationStart:a,initial:{opacity:0,y:40,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-40,scale:.9},transition:{type:"spring",...lT,layout:{type:"spring",...lS}},className:(0,eu.cn)("relative z-50 flex h-14 w-full shrink-0 flex-row items-center gap-2.5 px-3","transition-colors duration-".concat(200," ease-out"),0===r&&"border-t-[0.5px]"),style:l,children:[(0,S.jsx)(nx.E.span,{className:"relative z-10",animate:{scale:1},transition:{type:"spring",...lE},children:(0,rj.hY)(n,28,t)}),(0,S.jsx)("span",{className:(0,eu.cn)("relative z-10 w-full text-start font-mono text-sm font-medium uppercase",s?"text-[var(--node-color-dark)]":"text-foreground/60"),children:t})]})}),lZ=e=>{let{isActive:t,isCompleted:r}=e;return(0,S.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2",children:[(0,S.jsx)("div",{className:(0,eu.cn)("grid place-items-center rounded-md border transition-all duration-500 ease-out","bg-muted/30",r&&"bg-success-foreground/10 border-success-foreground/20",t||r?"h-12 w-12":"h-12 w-full"),children:r?(0,S.jsx)(eR.Z,{className:"text-success-foreground size-6"}):t?(0,S.jsx)(nd.Z,{className:"text-muted-foreground size-5 animate-spin"}):null}),(0,S.jsxs)("div",{className:(0,eu.cn)("flex flex-col gap-2 transition-all duration-300 ease-out",t||r?"flex-1 opacity-100":"w-0 overflow-hidden opacity-0"),children:[(0,S.jsx)(tu.O,{className:(0,eu.cn)("h-3 w-1/2 rounded-sm transition-colors duration-300","bg-muted-foreground/12",r&&"bg-success-foreground/20 animate-none")}),(0,S.jsx)(tu.O,{className:(0,eu.cn)("h-3 w-full rounded-sm transition-colors duration-300","bg-muted-foreground/12",r&&"bg-success-foreground/20 animate-none")})]})]})};var lz=()=>{let[e,t]=(0,K.useState)(0),[r,a]=(0,K.useState)(new Set);return(0,K.useEffect)(()=>{let r=setTimeout(()=>{e<4&&(e<3?(a(t=>new Set([...t,e])),setTimeout(()=>t(e+1),200)):(a(t=>new Set([...t,e])),setTimeout(()=>{t(0),a(new Set)},800)))},1500);return()=>clearTimeout(r)},[e]),(0,S.jsx)("div",{className:"h-full w-full space-y-1",children:Array.from({length:4},(t,a)=>(0,S.jsx)(lZ,{isActive:a===e,isCompleted:r.has(a)},a))})};let lP=[O.B3.PIPELINE_BUILDER_INTEGRATIONS,O.B3.PIPELINE_BUILDER_PLAN],lD={[O.B3.PIPELINE_BUILDER_INTEGRATIONS]:{label:"Finding relevant integrations",icon:(0,S.jsx)(lN.Z,{size:16}),order:1},[O.B3.PIPELINE_BUILDER_PLAN]:{label:"Generating Plan",icon:(0,S.jsx)(lk.Z,{size:16}),order:2}};var lL=()=>{var e;let t=(0,ez.CG)(A.B7);if(!t||!lP.includes(t))return null;let r=null==lD?void 0:null===(e=lD[t])||void 0===e?void 0:e.icon;return(0,S.jsx)("div",{className:"absolute inset-0 z-10 flex h-full w-full flex-col items-center justify-center gap-0",children:(0,S.jsxs)("div",{id:"animated-worflow-plan",className:"bg-background shadow-floating border-muted flex !h-79 w-86 shrink-0 flex-col overflow-hidden rounded-lg border p-[0.125px]",children:[(0,S.jsxs)("div",{className:"bg-muted/50 text-muted-foreground flex w-full flex-row items-center justify-center gap-2 border-b px-3 py-3.5",children:[r,(0,S.jsxs)("span",{className:"text-center font-mono text-xs font-medium uppercase",children:["(",null==lD?void 0:lD[t].order,"/",Object.values(lD).length,")"," ",lD[t].label,(0,S.jsx)(sX.iV,{})]})]}),t===O.B3.PIPELINE_BUILDER_INTEGRATIONS&&(0,S.jsx)(lA,{}),t===O.B3.PIPELINE_BUILDER_PLAN&&(0,S.jsx)(lz,{})]})})},lR=r(86193),lF=r(37112),lG=r(76344),lU=r(69819),lB=r(81162),lV=r(14891),lW=r(25294),lH=()=>{let[e,t]=(0,K.useState)(!1),r=(0,ez.TL)(),a=(0,ez.CG)(A.d5),s=(0,ez.CG)(A.zd),n=(0,ez.CG)(A.$g),l=(0,K.useCallback)(()=>{r((0,A.ym)(!1))},[r]),o=(0,K.useCallback)(()=>{s?t(!0):l()},[s,l]);return((0,K.useEffect)(()=>{let e=e=>{"g"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),o())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[o]),n)?(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)(el.zx,{variant:"outline",size:"sm",onClick:o,children:[a===O.Cn.AGENT?(0,S.jsx)(rk.Z,{}):(0,S.jsx)(t_.Z,{}),(0,S.jsx)("span",{children:"Exit Gummie"})]}),(0,S.jsx)(nY.vP,{isOpen:e,setIsOpen:t,setGummieActive:l})]}):null},lJ=r(36573),lq=(0,K.memo)(()=>{let e=(0,nO.J)(),t=(0,ez.TL)(),r=(0,ez.CG)(A.d5),a=(0,ez.CG)(A.zd),{userProfile:s,idTokenRef:n}=(0,ec.H)(),l=(0,K.useCallback)(async()=>{if(r===O.Cn.MANUAL_CUSTOM_NODE){if(null==a?void 0:a.code)try{var l,o;let e=await (0,lB.Ww)(a.code,s,n.current);if(e.length>0||(null===(o=a.operator_declaration)||void 0===o?void 0:null===(l=o.required_environment_variables)||void 0===l?void 0:l.length)){let r={...a.operator_declaration,required_environment_variables:e},s=new lV.p(a.operator_id,a.version,a.creator_user_id,r,a.code,a.metadata);t((0,A.oV)(s))}}catch(e){console.error("Failed to extract environment variables:",e)}window.dispatchEvent(new Event("customNodeTestOverride"))}else r===O.Cn.CUSTOM_NODE_CONFIG&&(null==a?void 0:a.operator_id)&&(e.abortCoreGummieCompletions(),await t((0,s6.ox)({customOperator:a})))},[r,e,t,a,s,n]),o=(0,K.useCallback)(async()=>{r===O.Cn.MANUAL_CUSTOM_NODE?window.dispatchEvent(new Event("customNodeSaveOverride")):r===O.Cn.CUSTOM_NODE_CONFIG&&(null==a?void 0:a.operator_id)&&(e.abortCoreGummieCompletions(),await t((0,s6.gy)({customOperator:a})))},[r,e,t,a]);return(0,S.jsxs)("div",{className:"flex items-center gap-2 px-4 pt-2 pb-4",children:[(0,S.jsx)("div",{className:"flex-1",children:(0,S.jsx)(es(),{href:"/hub",children:(0,S.jsx)(lW.Z,{size:26,noLink:!0})})}),r!==O.Cn.AGENT&&(0,S.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,S.jsxs)(el.zx,{fit:!0,onClick:l,variant:"outline",size:"sm",disabled:!(null==a?void 0:a.hasValidCode()),children:[(0,S.jsx)(aW.Z,{}),"Run"]}),r!==O.Cn.MANUAL_CUSTOM_NODE&&(0,S.jsxs)(el.zx,{fit:!0,onClick:o,variant:"outline",size:"sm",disabled:!(null==a?void 0:a.hasValidCode()),children:[(0,S.jsx)(lU.Z,{}),"Save"]})]}),r!==O.Cn.CUSTOM_NODE_CONFIG&&(0,S.jsx)(lJ.Z,{}),(0,S.jsx)(lH,{})]})}),lK=r(56034),lY=r(92761),l$=r(50515),lQ=r(29261),lX=r(18118),l0=r(73846),l1=r(95183),l2=r(32888);(l=b||(b={})).DECLARATION="declaration",l.TESTING="testing";var l5=()=>{let e=(0,Q.I0)(),t=(0,Q.v9)(A.zd),r=(0,Q.v9)(A.IW),[a,s]=(0,K.useState)(b.DECLARATION),[n,l]=(0,K.useState)(null),o=(0,K.useMemo)(()=>(0,l2.Yu)(),[]),i=(0,K.useMemo)(()=>(0,l2.Yu)(),[]);return((0,K.useEffect)(()=>{let e=()=>{s(b.TESTING)},t=()=>{s(b.DECLARATION)};return window.addEventListener("customNodeTestOverride",e),window.addEventListener("customNodeSaveOverride",t),()=>{window.removeEventListener("customNodeTestOverride",e),window.removeEventListener("customNodeSaveOverride",t)}},[]),t)?(0,S.jsxs)("div",{className:"mx-2 flex h-full flex-col overflow-y-auto mask-b-from-99% pt-4",children:[(0,S.jsxs)("div",{className:"border-b px-2 pb-4",children:[(0,S.jsx)("p",{className:"text-lg font-medium",children:"Create a Custom Node Manually"}),(0,S.jsx)("p",{className:"text-muted-foreground text-sm",children:"Complete control over your custom node by editing the node's inputs, outputs, parameters and code."})]}),(0,S.jsx)("div",{className:"flex flex-col overflow-y-auto px-2",children:(0,S.jsxs)("div",{className:"flex flex-col gap-4 py-5",children:[a===b.DECLARATION&&(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(lQ.Z,{messageId:t.operator_id,isMostRecentMessage:!0,part:{toolCallState:nR.n.COMPLETED}}),(0,S.jsxs)(l1.Jp,{children:[(0,S.jsx)(l1.Ex,{title:"Node Setup",Icon:lK.Z}),(0,S.jsx)(l1.aA,{children:(0,S.jsx)(l$.Z,{customOperator:t,status:r,isMostRecentMessage:!0,messageId:t.operator_id})})]})]}),a===b.TESTING&&(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)(el.zx,{variant:"ghost",size:"xs",className:"text-muted-foreground w-fit",onClick:()=>s(b.DECLARATION),children:[(0,S.jsx)(lY.Z,{}),"Back to Node Details"]}),!n&&(0,S.jsx)(l0.Z,{isMostRecentMessage:!0,messageId:t.operator_id,part:{toolCallState:nR.n.COMPLETED,id:i},onTestComplete:e=>{l(e)}}),n&&(0,S.jsx)(lX.Z,{message:n,isMostRecentMessage:!0,part:{toolCallState:nR.n.COMPLETED,id:o},onTestNewValues:()=>{l(null)}})]})]})})]}):(e((0,A.nz)()),null)},l4=(0,K.memo)(()=>{let e=(0,ez.CG)(A.$g),t=(0,ez.CG)(A.d5),r=(0,ez.CG)(A.uB),a=(0,K.useMemo)(()=>{switch(t){case O.Cn.CUSTOM_NODE_CONFIG:case O.Cn.MANUAL_CUSTOM_NODE:return"Node Builder";default:return"Workflow Builder"}},[t]);return(0,S.jsxs)("div",{className:(0,eu.cn)(e?"mx-auto flex h-full w-full max-w-3xl flex-col px-0 py-2 transition-transform ease-in-out sm:px-2 lg:max-w-[var(--gummie-container-width)] lg:min-w-[var(--gummie-container-width)] lg:px-0":"!h-full !w-0 overflow-hidden"),children:[(0,S.jsx)(lq,{}),t===O.Cn.MANUAL_CUSTOM_NODE?(0,S.jsx)(l5,{}):(0,S.jsxs)("div",{className:(0,eu.cn)(r?"flex flex-1 flex-col justify-end overflow-hidden":"flex h-fit flex-col justify-start gap-5 pt-[24svh]"),children:[!r&&t!==O.Cn.GUMSTACK&&(0,S.jsx)(lG.Z,{}),(0,S.jsx)(lF.Z,{className:(0,eu.cn)(!r&&"h-fit"),assistantMessageProps:{avatar:{name:a}}}),!r&&(0,S.jsx)(lR.Z,{})]})]})}),l3=r(76095),l9=r(35577),l6=r(56312),l8=r(87536),l7=r(49200),oe=r(83592),ot=r(26346),or=r(59496),oa=r(21473),os=r(91814);let on=new Set(["string"]),ol=new Set(["both","parameter"]);function oo(e){if(!e||!on.has(e.data_type))return!1;let t=e.attribute_type;return!!t&&!!ol.has(t)&&!e.children&&!e.structure&&!e.is_hidden&&!e.is_not_configurable_input}let oi=e=>{let{selectedNode:t,hasEligibleParameters:r,isEditingParameters:a,onEditClick:s,onCancelEdit:n,onSave:l,onRemove:o}=e;return t?a?(0,S.jsxs)("div",{className:"flex gap-0.5",children:[(0,S.jsx)(el.zx,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),e.preventDefault(),n()},className:"text-muted-foreground h-7 px-2",children:"Cancel"}),(0,S.jsx)(el.zx,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),e.preventDefault(),l()},className:"h-7 px-2",children:"Save"})]}):(0,S.jsx)(S.Fragment,{children:(0,S.jsx)("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),o()},className:"hover:text-destructive-foreground",children:(0,S.jsx)(t_.Z,{size:16})})}):null};var od=r(47849);let oc=e=>{var t,r,a,s;let{selectedNode:n,hasSelectedNode:l,onClick:o}=e;return(0,S.jsxs)("div",{onClick:o,className:(0,eu.cn)("hover:text-muted-foreground flex h-10 w-full grow items-center gap-2",n?"justify-start":"justify-center"),children:[l?n?(0,rj.hY)((0,ro.F1)(null!==(a=n.data.declaration.category)&&void 0!==a?a:null===(t=n.data.declaration.metadata)||void 0===t?void 0:t.category),16):(0,S.jsx)(eR.Z,{size:16}):(0,S.jsx)(od.Z,{size:16}),(0,S.jsx)("span",{className:(0,eu.cn)("text-sm",n?"flex flex-grow justify-start":"w-fit justify-center"),children:l?n?"".concat(null!==(s=null==n?void 0:null===(r=n.data)||void 0===r?void 0:r.nickname)&&void 0!==s?s:null==n?void 0:n.data.name):"Selected on another tab":"Select a node from the canvas"})]})};var ou=e=>{let{index:t,selectedNode:r,nodeSelectionCallback:a,form:s,activeChecklistIndex:n,setActiveChecklistIndex:l}=e,o=(0,ez.CG)(eb.lF),i=n===t,d=s.watch("checklist.".concat(t,".node_id")),c=(0,K.useMemo)(()=>!!(r||d),[r,d]),u=(0,l8.qo)({control:s.control,name:"checklist.".concat(t,".configurable_parameters")}),m=(0,K.useMemo)(()=>{var e,t,a;return(null==(e=null==r?void 0:r.data.declaration)?void 0:e.category)!=="form"&&e?[null!==(t=e.parameters)&&void 0!==t?t:[],null!==(a=e.additional_parameters)&&void 0!==a?a:[]].flat().filter(oo).map(e=>({name:e.name})):[]},[null==r?void 0:r.data.declaration]).length>0;u&&u.length;let[p,x]=(0,K.useState)(!1),[h,g]=(0,K.useState)([]);(0,K.useEffect)(()=>{p&&g(u||[])},[p,u]),function(e){let{activeChecklistIndex:t,form:r,setActiveChecklistIndex:a,nodes:s}=e;(0,K.useEffect)(()=>{let e=e=>{var n,l,o;if(null===t||!(null===(n=e.detail)||void 0===n?void 0:n.id))return;let i=s.find(t=>t.id===e.detail.id);i&&(r.setValue("checklist.".concat(t,".node_id"),e.detail.id),(null===(l=i.data.declaration)||void 0===l?void 0:l.category)&&r.setValue("checklist.".concat(t,".category"),i.data.declaration.category),r.setValue("checklist.".concat(t,".configurable_parameters"),(null===(o=e.detail)||void 0===o?void 0:o.configurable_parameters)||[]),a(null))};return document.addEventListener("template-checklist-select",e),()=>{document.removeEventListener("template-checklist-select",e)}},[t,r,a,s])}({activeChecklistIndex:n,form:s,setActiveChecklistIndex:l,nodes:o});let{handleNodeClick:f,handleRemoveNode:v}=function(e){let{index:t,selectedNode:r,isCurrentIndexSelected:a,form:s,handleNodeSelectionClick:n}=e,l=(0,eC._K)();return{handleNodeClick:(0,K.useCallback)(()=>{if(a){n(t);return}r?l.fitView({nodes:[r],padding:.6,duration:700}):n(t)},[a,t,r,l,n]),handleRemoveNode:(0,K.useCallback)(()=>{s.setValue("checklist.".concat(t,".node_id"),""),s.setValue("checklist.".concat(t,".category"),""),s.setValue("checklist.".concat(t,".configurable_parameters"),[])},[s,t])}}({index:t,selectedNode:r,isCurrentIndexSelected:i,form:s,handleNodeSelectionClick:(0,K.useCallback)(e=>{l(t=>(a(t!==e),t===e?null:e))},[l,a])}),j=(0,K.useCallback)(()=>{(!c||r)&&f()},[c,r,f]),b=(0,K.useCallback)(()=>{s.setValue("checklist.".concat(t,".configurable_parameters"),h),x(!1)},[s,t,h]),_=(0,K.useCallback)(()=>{x(!1)},[]),y=(0,K.useCallback)(()=>{x(!0)},[]);return(0,S.jsx)("div",{className:"flex flex-col gap-1",children:(0,S.jsx)("div",{className:(0,eu.cn)("bg-background hover:text-foreground text-muted-foreground flex w-full cursor-pointer flex-col items-center rounded-md px-3 font-medium",{"border-accent-foreground/50 text-accent-foreground hover:text-accent-foreground bg-accent-foreground/5 justify-center border-[1.5px] border-dashed":i,"text-foreground justify-start border":r&&!i,"justify-center border-[1.5px] border-dashed":!r&&!i,"pointer-events-none":c&&!r}),children:(0,S.jsxs)("div",{className:"flex h-10 w-full grow items-center gap-2",children:[(0,S.jsx)(oc,{selectedNode:r,hasSelectedNode:c,onClick:j}),(0,S.jsx)(oi,{selectedNode:r,hasEligibleParameters:m,isEditingParameters:p,onEditClick:y,onCancelEdit:_,onSave:b,onRemove:v})]})})})};let om=e=>{let{id:t,index:r,form:a,selectedNode:s,activeChecklistIndex:n,setActiveChecklistIndex:l,nodeSelectionCallback:o,canRemove:i,onRemove:d,onInsert:c}=e,{attributes:u,listeners:m,setNodeRef:p,transform:x,transition:h,isDragging:g}=(0,n5.nB)({id:t}),f={transform:lo.ux.Transform.toString(x),transition:h,opacity:g?.5:1};return(0,S.jsxs)("div",{ref:p,style:f,className:(0,eu.cn)("group/checklist-item flex flex-col gap-2",g&&"opacity-50"),children:[(0,S.jsxs)("div",{className:"flex items-center justify-between gap-2 px-1",children:[(0,S.jsxs)("div",{className:"text-muted-foreground/50 hover:text-muted-foreground relative flex flex-grow items-center gap-0.5 hover:cursor-grab active:cursor-grabbing",...u,...m,"aria-label":"Drag to reorder step ".concat(r+1),children:[(0,S.jsx)("button",{className:"-ml-1.5 cursor-grab p-0.5",children:(0,S.jsx)(nJ.Z,{size:14})}),(0,S.jsxs)("div",{className:(0,eu.cn)("text-foreground text-sm font-medium"),children:["Step ",r+1]})]}),(0,S.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"ghost",onClick:()=>c(r+1),size:"icon-xs",className:"text-muted-foreground hidden group-hover/checklist-item:flex",children:(0,S.jsx)(er.Z,{})})}),(0,S.jsxs)(eo._v,{side:"top",align:"end",children:[" ","Add a step right after this one"]})]}),i&&(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-xs",onClick:e=>{e.stopPropagation(),e.preventDefault(),d(r)},disabled:!i,accent:"destructive",className:"text-muted-foreground",children:(0,S.jsx)(rt.Z,{})})]})]}),(0,S.jsxs)("div",{className:"flex flex-grow flex-col gap-2",children:[(0,S.jsx)(l7.Wi,{control:a.control,name:"checklist.".concat(r,".title"),render:e=>{let{field:t}=e;return(0,S.jsxs)(l7.xJ,{children:[(0,S.jsx)(l7.NI,{children:(0,S.jsx)(ax.I,{...t,placeholder:"You should do this...",onBlur:()=>{a.trigger("checklist.".concat(r,".description"),{shouldFocus:!0}),a.trigger("checklist.".concat(r,".title"))}})}),(0,S.jsx)(l7.zG,{})]})}}),(0,S.jsx)(l7.Wi,{control:a.control,name:"checklist.".concat(r,".description"),render:e=>{let{field:t}=e;return(0,S.jsxs)(l7.xJ,{children:[(0,S.jsx)(l7.NI,{children:(0,S.jsx)(s3.g,{...t,placeholder:"".concat(0===r?"In order to...":"Then, do..."),className:"field-sizing-content"})}),(0,S.jsx)(l7.zG,{})]})}}),(0,S.jsx)(ou,{index:r,selectedNode:s,activeChecklistIndex:n,setActiveChecklistIndex:l,nodeSelectionCallback:o,form:a})]})]})},op=e=>{let{form:t,nodeSelectionCallback:r,isGeneratingAiDetails:a}=e,[s,n]=(0,K.useState)(null),l=(0,ez.CG)(eb.lF),o=(0,l8.Dq)({control:t.control,name:"checklist",rules:{minLength:1}}),i=(0,l8.qo)({control:t.control,name:"checklist"}),d=(0,K.useMemo)(()=>o.fields.filter((e,t)=>{let r=null==i?void 0:i[t];return!(null==r?void 0:r.is_trigger_recommendation)}),[o.fields,i]),c=d.length>1,u=(0,n2.Dy)((0,n2.VT)(n2.we),(0,n2.VT)(n2.Lg,{coordinateGetter:n5.is})),m=(0,K.useCallback)(e=>{let r=t.getValues("checklist")||[],a=r[e];if(r.filter(e=>!(null==e?void 0:e.is_trigger_recommendation)).length<=1&&!(null==a?void 0:a.is_trigger_recommendation)){X.Am.error("You must have at least one checklist item");return}o.remove(e)},[o,t]),p=(0,K.useCallback)(()=>{o.append({title:"",description:"",node_id:"",category:"",configurable_parameters:[]})},[o]),x=(0,K.useCallback)(e=>{o.insert(e,{title:"",description:"",node_id:"",category:"",configurable_parameters:[]})},[o]),h=(0,K.useCallback)(e=>{let{active:t,over:r}=e;if(r&&t.id!==r.id){let e=o.fields.findIndex(e=>e.id===t.id),a=o.fields.findIndex(e=>e.id===r.id);o.move(e,a)}},[o]);return(0,K.useCallback)(e=>{let r=t.getValues("checklist")||[];if(e)r.some(e=>(null==e?void 0:e.is_trigger_recommendation)===!0)||t.setValue("checklist",[...r,{is_trigger_recommendation:!0}]);else{let e=r.filter(e=>(null==e?void 0:e.is_trigger_recommendation)!==!0);t.setValue("checklist",e)}},[t]),a?(0,S.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,S.jsx)(os.Z,{title:"Set-up Checklist",description:"General instructions to get started with this workflow",Icon:e8.Z,children:(0,S.jsxs)(el.zx,{variant:"ghost",size:"sm",className:"text-muted-foreground",disabled:!0,children:[(0,S.jsx)(er.Z,{}),"Add Step"]})}),[,,,].fill(null).map((e,t)=>(0,S.jsx)(ox,{index:t},"skeleton-".concat(t)))]}):(0,S.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,S.jsx)(os.Z,{title:"Set-up Checklist",description:"General instructions to get started with this workflow",Icon:e8.Z,children:(0,S.jsxs)(el.zx,{variant:"ghost",size:"sm",className:"text-muted-foreground",onClick:p,children:[(0,S.jsx)(er.Z,{}),"Add Step"]})}),(0,S.jsx)(n2.LB,{sensors:u,collisionDetection:n2.pE,onDragEnd:h,children:(0,S.jsx)(n5.Fo,{items:d.map(e=>e.id),strategy:n5.qw,children:d.map(e=>{let a=o.fields.findIndex(t=>t.id===e.id),i=t.watch("checklist.".concat(a,".node_id")),d=l.find(e=>e.id===i);return(0,S.jsx)(K.Fragment,{children:(0,S.jsx)(om,{id:e.id,index:a,form:t,selectedNode:d,activeChecklistIndex:s,setActiveChecklistIndex:n,nodeSelectionCallback:r,canRemove:c,onRemove:m,onInsert:x})},e.id)})})})]})},ox=e=>{let{index:t}=e;return(0,S.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,S.jsxs)("div",{className:"flex items-center justify-between gap-2 px-1 pt-1",children:[(0,S.jsxs)("div",{className:"text-muted-foreground/50 flex flex-grow items-center gap-0.5",children:[(0,S.jsx)("button",{className:"-ml-1.5 p-0.5",disabled:!0,children:(0,S.jsx)(nJ.Z,{size:14})}),(0,S.jsxs)("div",{className:"text-foreground text-sm font-medium",children:["Step ",t+1]})]}),(0,S.jsx)("div",{className:"flex items-center gap-1",children:t>0&&(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-xs",className:"text-muted-foreground",disabled:!0,children:(0,S.jsx)(rt.Z,{})})})]}),(0,S.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,S.jsx)(tu.O,{className:"h-9 w-full rounded-md"}),(0,S.jsx)(tu.O,{className:"min-h-[60px] w-full rounded-md"}),(0,S.jsx)(tu.O,{className:"h-10 w-full rounded-md"})]})]})};var oh=r(43229),og=r(23229),of=r(81687),ov=r(98692),oj=r(56674);let ob=e=>{let{form:t,isGeneratingAiDetails:r}=e,{userProfile:a,idTokenRef:s}=(0,ec.H)(),n=(0,ez.CG)(R.$f),{data:l}=(0,oh.c4)({userProfile:a,idToken:s.current},{skip:!(null==a?void 0:a.user_id)||!s.current||!n}),o=(0,K.useCallback)(e=>{let r=t.getValues("categories")||[];if(r.some(t=>(null==t?void 0:t.template_category_id)===e)){t.setValue("categories",r.filter(t=>(null==t?void 0:t.template_category_id)!==e));return}let a=null==l?void 0:l.find(t=>t.template_category_id===e);if(!a)return;let s=[...r,a];t.setValue("categories",s)},[t,l]);return(0,S.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,S.jsx)(os.Z,{Icon:og.Z,title:"General Information",description:"Help users understand how to use your template."}),r?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,S.jsx)(of._,{htmlFor:"name",children:"Title"}),(0,S.jsx)(tu.O,{className:"h-9 w-full rounded-md"})]}),(0,S.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,S.jsx)(of._,{htmlFor:"body",children:"Description"}),(0,S.jsxs)("div",{className:"bg-background rounded-md border",children:[(0,S.jsx)("div",{className:"flex w-full justify-start p-1",children:(0,S.jsx)(t3.Z,{editor:null,portalDialogs:!0})}),(0,S.jsx)("div",{className:"border-t px-3 py-2",children:(0,S.jsx)(tu.O,{className:"h-35.5 w-full rounded-sm"})})]})]}),(0,S.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,S.jsx)(of._,{htmlFor:"categories",children:"Categories"}),(0,S.jsx)(tu.O,{className:"h-9 w-full rounded-md"})]})]}):(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,S.jsx)(of._,{htmlFor:"name",children:"Title"}),(0,S.jsx)(l7.Wi,{control:t.control,name:"name",render:e=>{let{field:t}=e;return(0,S.jsxs)(l7.xJ,{children:[(0,S.jsx)(l7.NI,{children:(0,S.jsx)(ax.I,{...t,placeholder:"What is the name of this template? Should be short yet descriptive!"})}),(0,S.jsx)(l7.zG,{})]})}})]}),(0,S.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,S.jsx)(of._,{htmlFor:"body",children:"Description"}),(0,S.jsx)(l7.Wi,{control:t.control,name:"body",render:e=>{let{field:t}=e;return(0,S.jsxs)(l7.xJ,{children:[(0,S.jsx)(l7.NI,{children:(0,S.jsx)(t6.Z,{format:"markdown",containerClassName:"!p-0 border bg-background group-focus-within:ring-ring group-focus-within:!ring-2 group-focus-within:ring-offset-background group-focus-within:ring-offset-2",inputClassName:"px-3 py-2 min-h-40 text-base md:text-sm border-t cursor-text",initialContent:t.value||"",onUpdate:e=>{t.onChange(e)},maxCharacters:1024,placeholder:"Detailed description of the template.",showToolbar:!0,toolbarHeaderOptions:oj.U})}),(0,S.jsx)(l7.zG,{})]})}})]}),(0,S.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,S.jsx)(of._,{htmlFor:"categories",children:"Categories"}),(0,S.jsx)(l7.Wi,{control:t.control,name:"categories",render:()=>{var e;return(0,S.jsx)(l7.xJ,{children:(0,S.jsx)(l7.NI,{children:(0,S.jsx)(ov.N,{options:(null==l?void 0:l.map(e=>({value:e.template_category_id||e.slug,label:e.name,BadgeElement:e.organization_id?(0,S.jsx)(eU.C,{size:"xs",variant:"accent",children:"Organization"}):void 0})))||[],onSelect:o,values:(null===(e=t.watch("categories"))||void 0===e?void 0:e.map(e=>null==e?void 0:e.template_category_id))||[],placeholder:"Select template categories",className:"w-full",multiple:!0})})})}})]})]})]})};var o_=r(77561),oy=r(80466);let ow=()=>{let e=new URL(window.location.href);e.searchParams.delete(ey.VERSION_ID),window.location.href=e.toString()};var oN=r(26239),ok=r(77532),oC=r(59100),oI=()=>{let e=(0,ez.TL)(),{userProfile:t,idTokenRef:r}=(0,ec.H)(),a=(0,en.useSearchParams)(),s=a.get(ey.WORKBOOK_ID),n=a.get(ey.RUN_ID),l=a.get(ey.AGENT_ID)||a.get(ey.FLOW_ID),o=a.get(ey.FOLDER_ID),i="true"===a.get(ey.TEMPLATE),d=a.get(ey.VERSION_ID),c=a.get(ey.TAB),u="true"===a.get(ey.PUBLISH_TEMPLATE),[m,p]=(0,K.useState)(null),[x,h]=(0,K.useState)(!1),g=(0,ez.CG)(R.Vj),f=(0,ez.CG)(eb.Me),v=(0,ez.CG)(R.Zy),j=(0,ez.CG)(R.wo),{removeParams:b,updateParam:_,updateSearchParams:y}=(0,oC.W)();return(0,K.useEffect)(()=>{d&&(d===j&&b([ey.VERSION_ID]),e((0,D.ZY)(d)))},[d,e]),(0,K.useEffect)(()=>{f&&f.fitView({padding:.4,duration:0})},[g,v,f]),(0,K.useEffect)(()=>{u&&!x&&(e((0,D.wW)(!0)),b([ey.PUBLISH_TEMPLATE]))},[u,x,e,b]),{loadPipelineData:async a=>{let{projectId:u,versionId:m}=a;if(t.user_id){p(null),h(!0);try{let a={};if(s){let n=[];if({newFlows:a,tabOrdering:n}=await e((0,ej.Qu)({flowbookId:s,projectId:u,isTemplate:i,versionId:m,userProfile:t,idToken:r.current,tabIndex:c?parseInt(c):void 0,savedItemId:l||void 0})).unwrap(),Object.keys(a).length){if(l){let e=n.indexOf(l);-1!==e&&y({[ey.TAB]:e.toString(),[ey.AGENT_ID]:null,[ey.FLOW_ID]:null})}}else{let{flows:a,tabs:s}=(0,oN.ld)();e((0,D.ki)({flows:a,tabOrdering:s.ordering,active:s.active})),await e((0,ej.hw)({newActiveTab:s.active,userProfile:t,idToken:r.current,projectId:u})),await e((0,ej.zV)())}}if(n&&!d){let l=await e((0,ej.Kb)({runId:n,newFlows:a,userProfile:t,idToken:r.current,versionId:m,projectId:u,isTemplate:i,...s?{flowbookId:s}:{}})).unwrap();!s&&l.flowbookId&&_(ey.WORKBOOK_ID,l.flowbookId),a=l.flows}if(!s&&l){let a=await e((0,ej.N8)({agentId:l,runId:n,isTemplate:i,userProfile:t,idToken:r.current,projectId:u,versionId:m})).unwrap();a.flowbookId&&y({[ey.WORKBOOK_ID]:a.flowbookId,[ey.AGENT_ID]:null,[ey.FLOW_ID]:null})}if(!o||s||l||e((0,D.VZ)(e=>{let t=e.clone();return t.folder_id=o,t})),!s&&!l&&!n){if(E.Z.getState().flow.savedItemId)return;let{flows:a,tabs:s}=(0,oN.ld)();e((0,D.ki)({flows:a,tabOrdering:s.ordering,active:s.active})),await e((0,ej.hw)({newActiveTab:s.active,userProfile:t,idToken:r.current,projectId:u})),await e((0,ej.zV)())}}catch(o){var x;let a=null!==(x=null==o?void 0:o.message)&&void 0!==x?x:o instanceof Error?o.message:String(o),s=null==o?void 0:o.errorBody;a!==ok.Z.unauthorized_flowbook_view&&X.Am.error(a,{id:"load-pipeline-error"}),s&&"object"==typeof s?p(s):p(a);let{flows:n,tabs:l}=(0,oN.ld)();e((0,D.ki)({flows:n,tabOrdering:l.ordering,active:l.active})),await e((0,ej.hw)({newActiveTab:l.active,userProfile:t,idToken:r.current,projectId:u})),await e((0,ej.zV)())}finally{h(!1)}}},loadPipelineError:m,isLoadingPipelineData:x,searchParams:{flowbookId:s,runId:n,agentId:l,folderId:o,isTemplate:i,versionId:d,tab:c}}},oT=r(48435);(o=_||(_={})).DEPLOY="flow_version_deploy",o.RESTORE="flow_version_restore",o.EDIT="flow_version_edit",o.PREVIEW="flow_version_preview",o.CREATE="flow_version_create";var oS=e=>{let{flowbookId:t}=e,r=(0,ez.TL)(),{loadPipelineData:a,searchParams:s}=oI(),{showSplashScreen:n,hideSplashScreen:l}=(0,eg.NN)(),{currentProject:o}=(0,e0.d2)(),[i,{isLoading:d}]=(0,L.Bh)(),[c,{isLoading:u}]=(0,L.wx)(),[m,{isLoading:p}]=(0,L.kh)(),[x,{isLoading:h}]=(0,L.TK)(),{userProfile:g,idTokenRef:f}=(0,ec.H)(),v=(0,Q.v9)(R.rI),j=(0,Q.v9)(R.Vj),b=(0,Q.v9)(R.Uw),_=(0,Q.v9)(R.zN),y=(0,Q.v9)(R.v9),{updateParam:w,removeParams:N}=(0,oC.W)(),{isLoading:k,refetch:C}=(0,L.F2)({flowbookId:t,userProfile:g,idToken:f.current},{skip:!t}),{handleSaveFlowbook:I}=(0,oT.M)(),T=(0,K.useCallback)(async e=>{if(d||!j)return!1;X.Am.loading("Making this checkpoint live...",{id:"deploy-version"});try{let r=await i({flowbookId:t,versionId:e,userProfile:g,idToken:f.current});if("error"in r)return X.Am.error("string"==typeof r.error?r.error:"Failed to make this checkpoint live",{id:"deploy-version"}),!1;return N([ey.VERSION_ID,ey.RUN_ID]),X.Am.success("".concat(null==b?void 0:b.name," is now live"),{id:"deploy-version"}),(0,ad.rB)("flow_version_deploy",{flowbook_id:t,version_id:e}),!0}catch(e){return X.Am.error(e instanceof Error?e.message:"Failed to make this checkpoint live",{id:"deploy-version"}),!1}},[t,g,f,j,N,i,d,b]),S=(0,K.useCallback)(async e=>{let{versionId:s}=e;if(u)return!1;X.Am.loading("Restoring this checkpoint...",{id:"restore-version"});try{let e=await c({flowbookId:t,versionId:s,userProfile:g,idToken:f.current});if("error"in e)return X.Am.error("string"==typeof e.error?e.error:"Failed to restore this checkpoint",{id:"restore-version"}),!1;let{restored_version:l}=e.data,i=v.find(e=>e.version_id===s);N([ey.RUN_ID,ey.VERSION_ID]),r((0,D.ZY)(l.version_id)),X.Am.success("".concat(null==i?void 0:i.name," restored"),{id:"restore-version"}),(0,ad.rB)("flow_version_restore",{flowbook_id:t,version_id:s,restored_version_id:l.version_id}),n();try{await a({versionId:l.version_id,projectId:null==o?void 0:o.project_id})}catch(e){X.Am.error(e instanceof Error?e.message:"Failed to load flowbook checkpoint",{id:"restore-version"})}return!0}catch(e){return X.Am.error(e instanceof Error?e.message:"Failed to restore this checkpoint",{id:"restore-version"}),!1}finally{l()}},[t,g,f,c,u,v,r,N,a,n,l,o]),E=(0,K.useCallback)(async e=>{let{name:r,description:a,versionId:s}=e;if(p)return!1;try{let e=await m({flowbookId:t,versionId:s,userProfile:g,idToken:f.current,name:r,description:a});if("error"in e)return X.Am.error("string"==typeof e.error?e.error:"Failed to edit flowbook checkpoint"),!1;let n=v.find(e=>e.version_id===s);return X.Am.success("".concat(null==n?void 0:n.name," edited successfully")),(0,ad.rB)("flow_version_edit",{flowbook_id:t,version_id:s}),!0}catch(e){return X.Am.error(e instanceof Error?e.message:"Failed to edit flowbook checkpoint"),!1}},[t,g,f,m,p,v]),M=(0,K.useCallback)(async e=>{if(h)return!1;e||X.Am.loading("Creating checkpoint...",{id:"create-version"});try{await I({hideSuccessToast:!0});let r=await x({flowbookId:t,userProfile:g,idToken:f.current});if("error"in r)return X.Am.error("string"==typeof r.error?r.error:"Failed to create checkpoint",{id:"create-version"}),!1;e||X.Am.success("Checkpoint created successfully",{id:"create-version"}),(0,ad.rB)("flow_version_create",{flowbook_id:t})}catch(e){return X.Am.error(e instanceof Error?e.message:"Failed to create checkpoint",{id:"create-version"}),!1}return!0},[t,g,f,x,h,I]),A=(0,K.useCallback)(e=>{e!==j&&(r((0,D.ZY)(e)),w(ey.VERSION_ID,e),(0,ad.rB)("flow_version_preview",{flowbook_id:t,version_id:e}))},[r,j,w,t]);return(0,K.useEffect)(()=>{let e=s.versionId;!k&&e&&v.length>0&&!v.some(t=>t.version_id===e)&&(r((0,D.ZY)(null==_?void 0:_.version_id)),X.Am.error("This is not a valid version. Returning to draft."))},[v,k,s.versionId,r,_]),{versions:v,activeVersion:b,draftVersion:_,isActiveVersionDraft:y,states:{isLoading:k,isDeploying:d,isRestoring:u,isEditing:p,isCreating:h},actions:{deploy:T,restore:S,edit:E,preview:A,refetch:C,returnToDraft:ow,create:M}}},oE=r(53839),oM=e=>{var t,r;let{form:a,disabled:s}=e,n=(0,oy.r)(),{currentProject:l}=(0,e0.d2)(),{userProfile:o}=(0,ec.H)(),i=(0,ez.CG)(R.aN),{data:d}=(0,a2.DV)({path:"/creator_profile",method:a2.J7.GET,queryKey:["creator_profile"],options:{retry:!1,refetchOnWindowFocus:!1}}),[c,u]=(0,K.useState)(!1),{submitTemplate:m,submitAfterProfileSuccess:p,isSubmitting:x,submissionType:h}=function(e){let{form:t,creatorProfile:r,onPublicProfileRequired:a}=e,s=(0,ez.TL)(),n=(0,ez.CG)(R.LA),{userProfile:l}=(0,ec.H)(),o=(0,oy.r)(),{handleSaveFlowbook:i}=(0,oT.M)(),{draftVersion:d,actions:c}=oS({flowbookId:n.flowbook_id}),{data:{workbook:{general_access:u}},actions:{workbook:{updateGeneralAccess:m}}}=(0,eY.ZP)(n),[p,x]=(0,K.useState)(null),h=(0,K.useRef)(null),{mutate:g,isPending:f}=(0,a2.QH)({path:"template_versions",method:a2.J7.POST,options:{onSuccess:async(e,r)=>{if("publish"===p&&(null==u?void 0:u.access_type)===eY.ZI.RESTRICTED)try{let e=r.template.organization_id;if(!o||e){var a;await m(eY.ZI.ORGANIZATION,null===(a=l.organization)||void 0===a?void 0:a.organization_id,!0)}else await m(eY.ZI.ANYONE,void 0,!0)}catch(t){let e=r.template.organization_id;X.Am.warning("Template created but permissions could not be updated to ".concat(e?"organization":"public"," sharing"))}e.template_page.status===tl.C.SUBMITTED?X.Am.success("Template submitted for review",{id:"submit-template",description:"An admin must approve the template before it appears in the template library."}):X.Am.success("Template saved",{id:"submit-template",description:""}),s((0,D.pZ)(e.template_page)),t.reset(e.template_page),s((0,D.wW)(!1)),x(null)},onError:e=>{X.Am.error(e.message,{id:"submit-template",description:""}),x(null)}}}),v=(0,K.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;if(null==e||e.preventDefault(),null==e||e.stopPropagation(),!i&&s&&o&&!d&&!(null==r?void 0:r.username)){h.current={isPublish:s,organizationId:d},null==a||a();return}let c=t.getValues();x(s?"publish":"save"),X.Am.loading("Submitting template...",{id:"submit-template",description:""});try{let e=s?tl.C.SUBMITTED:tl.C.DRAFT;g({target_id:n.flowbook_id,template_type:"FLOWBOOK",template:{...c,organization_id:d,status:e,checklist:c.checklist||[],creator_user_id:l.user_id}})}catch(e){X.Am.error("Failed to submit template",{id:"submit-template",description:""}),x(null)}},[t,n.flowbook_id,l,null==d?void 0:d.version_id,i,c,g,o,a]),j=(0,K.useCallback)(()=>{let e=h.current;e&&(h.current=null,v(void 0,e.isPublish,!0,e.organizationId))},[v]);return{submitTemplate:v,submitAfterProfileSuccess:j,isSubmitting:f||null!==p,submissionType:p}}({form:a,creatorProfile:d,onPublicProfileRequired:()=>u(!0)}),g=(0,K.useCallback)(()=>{u(!1),p()},[p]),f=!!((null==l?void 0:l.organization_id)&&(null==l?void 0:l.organization_id)!==(null==o?void 0:null===(t=o.organization)||void 0===t?void 0:t.organization_id)),v=(null==i?void 0:i.status)===tl.C.REJECTED||!!(null==i?void 0:i.is_rejected),j=!v||!!(null==i?void 0:i.organization_id),b=(a.watch("categories")||[]).some(e=>null==e?void 0:e.organization_id),_=n?"outline":"secondary";return(0,S.jsxs)(S.Fragment,{children:[i&&(null==i?void 0:i.status)!==tl.C.DRAFT?(0,S.jsxs)(oO,{organizationMismatchWarning:f,children:[j&&(0,S.jsx)(el.zx,{variant:"secondary",disabled:!!x||s,loading:x&&"save"===h,onClick:e=>m(e,!0,!1,null==i?void 0:i.organization_id),children:ot.xh.includes(i.status)?"Resubmit for Review":"Save & Submit Edits for Review"}),(0,S.jsx)(el.zx,{variant:"outline",disabled:!!x||s,onClick:e=>m(e,!1,!1,null==i?void 0:i.organization_id),children:"Save & Delist Template"})]}):(0,S.jsxs)(oO,{organizationMismatchWarning:f,children:[n&&!v&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("span",{className:"w-full",children:(0,S.jsx)(el.zx,{variant:"secondary",className:"w-full",disabled:!!x||s||b,onClick:e=>m(e,!0),children:(0,S.jsxs)("span",{className:"flex flex-row items-center gap-2",children:["Submit to Community Templates",(0,S.jsx)(eU.C,{variant:"accent",size:"sm",className:"absolute top-1/2 right-2 -translate-y-1/2",children:"New"})]})})})}),b&&(0,S.jsx)(eo._v,{children:"Cannot submit a template with an organization-specific category to Community Templates"})]}),!!(null===(r=o.organization)||void 0===r?void 0:r.organization_id)&&(0,S.jsx)(el.zx,{variant:_,className:"grow",disabled:!!x||s,onClick:e=>{var t;return m(e,!0,!1,null===(t=o.organization)||void 0===t?void 0:t.organization_id)},children:"Submit Template to Organization"}),(0,S.jsx)(el.zx,{variant:"outline",disabled:!!x||s,onClick:e=>m(e,!1,!1,null==i?void 0:i.organization_id),children:"Save & Keep Unlisted"})]}),n&&(null==o?void 0:o.isLoggedIn())&&!(null==d?void 0:d.username)&&(0,S.jsx)(oE.a,{isOpen:c,onClose:()=>u(!1),onSuccess:g})]})};let oA=()=>(0,S.jsxs)("div",{className:"bg-warning text-warning-foreground flex flex-row items-center gap-2 rounded-md p-3 pr-4 text-sm",children:[(0,S.jsxs)("div",{children:[(0,S.jsx)("p",{className:"font-medium",children:"This flow was created in another organization."}),(0,S.jsx)("p",{children:"Members of your organization may not have access to this flow."})]}),(0,S.jsx)(tf.Z,{className:"ml-auto size-5 flex-none"})]}),oO=e=>{let{children:t,organizationMismatchWarning:r=!1}=e;return(0,S.jsxs)("div",{className:"flex flex-col gap-2 p-5 pt-2 pb-0",children:[r&&(0,S.jsx)(oA,{}),t]})};var oZ=(0,K.memo)(()=>{let{userSecretTypes:e,projectSecretTypes:t}=(0,rD.wL)(),r=(0,ez.CG)(R.$f),a=(0,ez.CG)(z.X3),s=(0,ez.CG)(z.iZ),n=(0,ez.CG)(R.LA),l=(0,ez.CG)(eb.ts),o=(0,ez.CG)(R.L2),i=(0,ez.CG)(eb.lF),{currentProject:d}=(0,e0.d2)(),c=(0,ez.TL)(),u=(0,ez.CG)(R.aN),m=(0,ez.CG)(e=>(0,tZ.K)(e,l||""));null==m||m.find(e=>e.is_active&&"time_based"===e.trigger_type);let p=(0,K.useMemo)(()=>(0,nD.uL)(i),[i]),{pipelineSecretsRequired:x,allPipelineSecretDeclarations:h}=(0,oe._)({pipeline:p,flows:o,operatorDeclarations:a,outdatedOperatorDeclarations:s,currentProjectId:null==d?void 0:d.project_id,userSecretTypes:e||[],projectSecretTypes:t||[]}),g=(0,K.useMemo)(()=>{var e;return{version_id:null==u?void 0:u.version_id,template_page_id:null==u?void 0:u.template_page_id,source_version_id:null==u?void 0:u.source_version_id,name:(null==u?void 0:u.name.trim())||n.name.trim()||"",description:(null==u?void 0:u.description)||n.description||"",body:(null==u?void 0:u.body)||"",categories:(null==u?void 0:u.categories)||[],checklist:u&&(null==u?void 0:null===(e=u.checklist)||void 0===e?void 0:e.length)>0?null==u?void 0:u.checklist:[{title:"Step 1",description:"Step 1 description"}],organization_id:null==u?void 0:u.organization_id,project_id:null==d?void 0:d.project_id}},[u,n,null==d?void 0:d.project_id]),f=(0,l8.cI)({defaultValues:g,resolver:(0,l6.F)(oa.Zv),mode:"onChange",reValidateMode:"onBlur"});(0,K.useEffect)(()=>{u&&f.reset(g)},[u,f,g]);let{mutate:v,isPending:j}=(0,a2.QH)({path:"template_versions/".concat(n.flowbook_id,"/generate_details"),method:a2.J7.POST,options:{onSuccess:e=>{f.setValue("name",e.title),f.setValue("body",e.description),f.setValue("checklist",e.checklist)},onError:e=>{X.Am.error("Could not generate template details with AI.")}}}),b=(0,K.useCallback)(()=>{n.flowbook_id&&v({flowbook_id:n.flowbook_id})},[n.flowbook_id,v]);(0,K.useEffect)(()=>{r&&!u&&b()},[b,r,u]);let{label:_,Icon:y,description:w}=(0,or.wp)((null==u?void 0:u.is_rejected)?tl.C.REJECTED:null==u?void 0:u.status);return(0,S.jsxs)("div",{className:"flex flex-grow flex-col overflow-hidden",children:[(0,S.jsx)("div",{className:"flex flex-grow flex-col overflow-y-auto mask-t-from-98% mask-b-from-98%",children:(0,S.jsx)(l7.l0,{...f,children:(0,S.jsxs)("div",{className:"flex flex-grow flex-col gap-6 overflow-y-auto px-5 py-4",children:[u&&(ot.xh.includes(u.status)||u.is_rejected)&&(0,S.jsxs)(r8.bZ,{variant:ot.zK.includes(u.status)||u.is_rejected?"destructive":"default",children:[y&&(0,S.jsx)(y,{className:"size-4"}),(0,S.jsx)(r8.Cd,{children:_}),(0,S.jsxs)(r8.X,{className:"text-xs",children:[!!w&&(0,S.jsx)("p",{children:w}),!!u.comment&&(0,S.jsxs)("p",{children:["Comment: ",u.comment]})]})]}),(0,S.jsx)(ob,{form:f,isGeneratingAiDetails:j}),(h.personal.length>0||h.project.length>0)&&(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(ta.Z,{className:"bg-border/75"}),(0,S.jsx)(o_.Z,{allPipelineSecretDeclarations:h,pipelineSecretsRequired:x})]}),(0,S.jsx)(ta.Z,{className:"bg-border/75"}),(0,S.jsx)(op,{form:f,isGeneratingAiDetails:j,nodeSelectionCallback:e=>{c((0,F.fL)(t=>t.map(t=>({...t,data:{...t.data,canSelectForChecklist:e}}))))}})]})})}),(0,S.jsx)(oM,{form:f,disabled:j})]})}),oz=r(93809),oP=r(15649),oD=r(70563),oL=r(92437),oR=r(26659),oF=r(6919);let oG=(0,K.memo)((0,K.forwardRef)((e,t)=>{let{disabled:r,onClone:a,children:s}=e,n=(0,Q.v9)(H._I),{currentProject:l}=(0,e0.d2)(),{userProfile:o}=(0,ec.H)(),i=(0,ez.CG)(R.LA),{suggestedAuthorId:d,suggestedProjectName:c}=(0,K.useMemo)(()=>l&&i.author_id===o.user_id?{suggestedAuthorId:l.project_id,suggestedProjectName:l.project_name}:{suggestedAuthorId:o.user_id,suggestedProjectName:"Personal Workspace"},[l,i.author_id,o.user_id]),[u,m]=(0,K.useState)(d),p=n.filter(e=>e.project_id!==d),[x,h,g,f]=(0,oR.X)(p,{searchKeys:["project_name"]});return 0===n.length?(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{id:"save-button",disabled:r,variant:"outline",shadow:!0,ref:t,size:s?"default":"icon-sm",onClick:()=>a(o.user_id),asChild:!!s,children:s||(0,S.jsx)(aD.Z,{})})}),(0,S.jsx)(eo._v,{side:"bottom",children:"Make a Copy"})]}):(0,S.jsxs)(eq.Vq,{children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(eq.hg,{asChild:!0,children:s||(0,S.jsx)(el.zx,{id:"save-button",disabled:r,variant:"outline",shadow:!0,ref:t,size:"icon-sm",children:(0,S.jsx)(aD.Z,{})})})}),(0,S.jsx)(eo._v,{side:"bottom",children:"Make a Copy"})]}),(0,S.jsxs)(eq.cZ,{className:"!max-w-2xl",children:[(0,S.jsxs)(eq.a7,{children:[(0,S.jsxs)(eq.fK,{children:[(0,S.jsx)(eq.$N,{children:"You're making a copy, where do you want to save it?"}),(0,S.jsx)(eq.Be,{children:"Choose a workspace to copy the workbook into. Anyone in the workspace can edit the workbook."})]}),(0,S.jsxs)(oL.E,{className:"flex flex-col items-center gap-2",onValueChange:e=>m(e),value:u,children:[(0,S.jsx)(oF.Z,{value:d,label:c,checked:u===d,description:"Suggested",disabled:!1,className:"w-full"}),(0,S.jsxs)("div",{className:"my-2 flex w-full flex-row items-center gap-2",children:[(0,S.jsx)("hr",{className:"border-border w-full border-dashed"}),(0,S.jsx)("p",{className:"text-muted-foreground font-mono text-sm",children:"OR"}),(0,S.jsx)("hr",{className:"border-border w-full border-dashed"})]}),(0,S.jsxs)("div",{className:"flex h-90 w-full flex-col gap-3",children:[(0,S.jsx)(ax.I,{placeholder:"Search workspaces",value:x,className:"flex-none",type:"search",onChange:e=>h(e.target.value)}),f?(0,S.jsx)(r3.Z,{title:"No workspaces found",description:"Try a different search",Icon:oD.Z}):(0,S.jsx)("div",{className:"grid w-full grid-cols-1 gap-2 overflow-y-auto md:grid-cols-2",children:g.map(e=>(0,S.jsx)(oF.Z,{value:e.project_id,label:e.project_name,checked:u===e.project_id,description:"".concat(e.members.length," members")},e.project_id))})]})]})]}),(0,S.jsxs)(eq.cN,{children:[(0,S.jsx)(eq.GG,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"outline",children:"Cancel"})}),(0,S.jsx)(eq.GG,{asChild:!0,children:(0,S.jsx)(el.zx,{onClick:()=>a(u),children:"Copy"})})]})]})]})}));var oU=(0,K.memo)(e=>{let{template:t,shouldCloneTriggers:r}=e,{handleSaveFlowbook:a}=(0,oT.M)(),s=(0,ez.CG)(H._I),{handleProjectSwitch:n}=(0,oP.W)(),{currentProject:l}=(0,e0.d2)(),o=(0,ez.CG)(R.LA),i=(0,ez.CG)(R.aN),d=(null==i?void 0:i.target_id)!==o.flowbook_id,c=async e=>{await a({name:t.name,description:t.description,forceClone:!0,newAuthorId:e,shouldCloneTriggers:r,afterSave:()=>{e!==(null==l?void 0:l.project_id)&&n(s.find(t=>t.project_id===e))}})};return d?null:(0,S.jsx)("div",{className:"mt-auto flex flex-col gap-2",children:(0,S.jsx)(oG,{onClone:c,children:(0,S.jsx)(el.zx,{variant:"secondary",size:"lg",className:"shrink-0",children:"Copy Template & Get Started"})})})}),oB=r(30995),oV=e=>{var t,r;let{item:a,node:s,index:n,reactflowInstance:l}=e;return(0,S.jsxs)("div",{onClick:()=>{s&&l.fitView({nodes:[s],padding:.6,duration:700})},className:(0,eu.cn)("border-muted hover:bg-muted/30 hover:border-border/75 group/checklist-item flex snap-center flex-row gap-3 rounded-md border p-3.5 text-sm",s&&"cursor-pointer"),children:[s?(0,S.jsx)("div",{className:"bg-background flex size-7 flex-none items-center justify-center rounded-sm border",children:(0,rj.hY)((0,ro.F1)(null!==(r=s.data.declaration.category)&&void 0!==r?r:null===(t=s.data.declaration.metadata)||void 0===t?void 0:t.category),16)}):(0,S.jsx)("div",{className:"bg-muted group-hover/checklist-item:bg-background flex size-7 flex-none items-center justify-center rounded-sm border",children:(0,S.jsx)("p",{className:"text-foreground text-sm font-medium",children:n+1})}),(0,S.jsxs)("div",{className:"flex flex-grow flex-col gap-0.5",children:[(0,S.jsx)("p",{className:"text-foreground line-clamp-1 text-base font-medium",children:a.title}),(0,S.jsx)("p",{className:"text-muted-foreground whitespace-pre-wrap",children:a.description})]}),s&&(0,S.jsx)(oB.Z,{size:16,className:"text-muted-foreground shrink-0"})]})},oW=(0,K.memo)(e=>{let{template:t}=e,r=(0,ez.TL)(),a=(0,ez.CG)(z.X3),s=(0,ez.CG)(z.iZ),n=(0,ez.CG)(R.L2),l=(0,ez.CG)(eb.lF),{userProfile:o}=(0,ec.H)(),{currentProject:i}=(0,e0.d2)(),{userSecretTypes:d,projectSecretTypes:c}=(0,rD.wL)(),u=(0,eC._K)(),m=(0,ez.CG)(R.QB),p=(0,K.useMemo)(()=>(0,nD.uL)(l),[l]),{pipelineSecretsRequired:x,allPipelineSecretDeclarations:h}=(0,oe._)({pipeline:p,flows:n,operatorDeclarations:a,outdatedOperatorDeclarations:s,currentProjectId:null==i?void 0:i.project_id,userSecretTypes:d,projectSecretTypes:c,skip:t.creator_user_id===(null==o?void 0:o.user_id)}),g=(0,K.useMemo)(()=>{var e,r;return null!==(r=null===(e=t.checklist)||void 0===e?void 0:e.filter(e=>!(null==e?void 0:e.is_trigger_recommendation)))&&void 0!==r?r:[]},[t.checklist]),f=g.length>0;return(0,S.jsxs)("div",{className:"pointer-events-auto z-100 flex h-full flex-col overflow-hidden",children:[(0,S.jsxs)("div",{className:"flex flex-grow flex-col gap-6 overflow-y-auto mask-t-from-98% mask-b-from-98% p-5 py-4",children:[(0,S.jsxs)("div",{className:"flex flex-none flex-col gap-1",children:[(0,S.jsx)("span",{className:"pt-1 pr-5 text-2xl font-semibold",children:t.name}),t.creator_user_email&&(0,S.jsxs)("p",{className:"text-muted-foreground truncate text-sm",children:["Created by"," ",(0,S.jsxs)("a",{className:"text-accent-foreground hover:text-accent-foreground text-sm underline hover:no-underline",href:"mailto:".concat(t.creator_user_email),children:[t.creator_first_name," ",t.creator_last_name]})]}),(0,S.jsx)(r1.U,{remarkPlugins:[oz.Z],className:(0,eu.cn)("text-foreground overflow-wrap pt-2 text-sm wrap-break-word lg:max-w-2xl","*:tabular-nums","[&_h1]:text-xl [&_h2]:text-lg [&_h3]:text-base [&_li]:text-sm [&_ol]:text-sm [&_p]:text-sm [&_ul]:text-sm","[&_h1]:font-semibold [&_h2]:font-semibold [&_h3]:font-medium [&_li]:font-normal [&_ol]:font-normal [&_p]:font-normal [&_strong]:font-semibold [&_ul]:font-normal","[&_h1]:my-2 [&_h2]:my-2 [&_h3]:my-2 [&_p]:my-0 [&_strong]:my-0","[&_li]:ml-6 [&_ol]:my-0 [&_ol>li]:my-0 [&_ol>li]:list-decimal [&_ul]:mb-2 [&_ul]:list-disc [&_ul>li]:my-0 [&_ul>li]:list-disc","[&_code]:bg-muted-foreground/10 [&_code]:text-muted-foreground [&_code]:rounded-sm [&_code]:px-1 [&_code]:py-0.5 [&_code]:font-mono [&_code]:text-sm [&_code]:whitespace-pre-wrap","[&_pre]:bg-muted-foreground/7.5 [&_pre]:text-muted-foreground [&_pre>code]:text-muted-foreground [&_pre]:my-2 [&_pre]:rounded-sm [&_pre]:px-3 [&_pre]:py-2 [&_pre]:font-mono [&_pre]:text-sm [&_pre>code]:rounded-none [&_pre>code]:bg-transparent [&_pre>code]:px-0 [&_pre>code]:py-0 [&_pre>code]:font-mono [&_pre>code]:text-sm","[&_a]:text-accent-foreground [&_a]:hover:text-accent-foreground/80 [&_a]:underline [&_a]:hover:no-underline","[&_blockquote]:border-l-muted-foreground/20 [&_blockquote]:text-muted-foreground/80 [&_blockquote]:border-l-3 [&_blockquote]:pl-3 [&_blockquote>p]:text-sm"),children:t.body})]}),(h.personal.length>0||h.project.length>0)&&(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(ta.Z,{className:"bg-border/75"}),(0,S.jsx)(o_.Z,{allPipelineSecretDeclarations:h,pipelineSecretsRequired:x,isExpanded:!0})]}),(0,S.jsx)(ta.Z,{className:"bg-border/75"}),(0,S.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,S.jsx)(os.Z,{title:"Setup Checklist",description:"To get started with your template, please complete the following steps:",isExpanded:!0,Icon:e8.Z}),f?(0,S.jsx)("div",{className:"flex flex-none flex-col gap-2",children:g.map((e,t)=>{let r=e.node_id?l.find(t=>t.id===e.node_id):null;return(0,S.jsx)(oV,{item:e,node:r,index:t,reactflowInstance:u},"".concat(e.node_id||e.description,"-").concat(t))})}):(0,S.jsx)("div",{className:"flex flex-none flex-col gap-2.5 pt-3",children:(0,S.jsx)("p",{className:"text-muted-foreground text-sm",children:"No set-up required"})})]})]}),(0,S.jsx)("div",{className:"mt-auto flex flex-col gap-1 p-5 pt-2 pb-0",children:m?(0,S.jsx)(el.zx,{variant:"secondary",size:"lg",onClick:()=>r((0,D.wW)(!1)),children:"Close Instructions"}):(0,S.jsx)(oU,{template:t,shouldCloneTriggers:!1})})]})}),oH=(0,K.memo)(()=>{let e=(0,ez.CG)(ew),t=(0,ez.CG)(R.aN),r=(0,ez.CG)(R.$f),{userProfile:a}=(0,ec.H)(),s=(0,ez.TL)(),n=(0,ez.CG)(R.aN),l=(0,ez.CG)(R.LA),{currentProject:o}=(0,e0.d2)(),i=(null==l?void 0:l.author_id)===(null==o?void 0:o.project_id)||(null==l?void 0:l.author_id)===(null==a?void 0:a.user_id),d=e===f.TEMPLATE,c=(null==t?void 0:t.creator_user_id)===(null==a?void 0:a.user_id),u=t&&!c,m=!t||c;return d?(0,S.jsxs)("div",{className:(0,eu.cn)("flex max-w-[var(--template-container-width)] flex-grow flex-col overflow-x-hidden overflow-y-hidden py-4"),children:[(0,S.jsx)("div",{className:(0,eu.cn)("flex flex-col gap-2 px-4 pb-3",!u&&"pb-4"),children:(0,S.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[u?(0,S.jsx)(l9.Z,{width:128,height:36}):(0,S.jsxs)("h3",{className:"text-xl font-semibold",children:[n?"Edit":"Create"," your Template"]}),(null==n?void 0:n.visibility)===tl.N.PUBLIC&&(null==n?void 0:n.status)===tl.C.APPROVED&&!(null==n?void 0:n.organization_id)&&(0,S.jsx)(el.zx,{size:"sm",variant:"ghost",accent:"outline",className:"text-muted-foreground/80",asChild:!0,children:(0,S.jsxs)(es(),{href:"/templates/".concat(null==n?void 0:n.slug),target:"_blank",className:"flex items-center gap-1",children:["View Community Template",(0,S.jsx)(l3.Z,{className:"size-3"})]})}),i&&(0,S.jsxs)(el.zx,{variant:"outline",size:"sm",onClick:()=>{s((0,D.wW)(!1))},children:[(0,S.jsx)(rk.Z,{}),(0,S.jsx)("span",{children:"Return to Draft"})]})]})}),(0,S.jsx)(ta.Z,{className:"bg-border/50 mx-2"}),m&&r&&(0,S.jsx)(oZ,{}),t&&!c&&(0,S.jsx)(oW,{template:t})]}):null}),oJ=()=>{let e=!!(0,en.useSearchParams)().get("run_id"),t=(0,ez.CG)(R.v9);if(t)return null;let r=t?e?"You are viewing your draft with a past run":null:"You are viewing a past version",a=t?e?"Your tabs may not be up to date.":null:"Edits will not be saved.";return r?(0,S.jsxs)("div",{className:"bg-warning text-warning-foreground absolute top-0 right-0 left-0 z-100 flex flex-grow flex-row items-center justify-center gap-2 p-2 text-sm",children:[(0,S.jsx)(tf.Z,{className:"size-4"}),(0,S.jsxs)("p",{className:"flex items-center gap-2",children:[(0,S.jsx)("span",{className:"font-medium",children:r}),a&&(0,S.jsxs)("span",{children:["(",a,")"]})]})]}):null};(i=y||(y={})).CREATOR="creator",i.TRIGGER="trigger",i.INTERFACE="interface",(d=w||(w={})).ALL="No Trigger Filters",d.HAS_TRIGGER="Has Trigger(s)",(c=N||(N={})).ALL="No Interface Filters",c.HAS_INTERFACE="Has Interface";let oq=[{key:"trigger",extractValue:e=>e.metadata.triggers&&Object.keys(e.metadata.triggers).length>0?"Has Trigger(s)":"No Trigger Filters",getOptions:()=>[{value:"No Trigger Filters",label:"No Trigger Filters"},{value:"Has Trigger(s)",label:"Has Trigger(s)"}],label:"Active Triggers"},{key:"interface",extractValue:e=>e.metadata.interfaces&&Object.keys(e.metadata.interfaces).length>0?"Has Interface":"No Interface Filters",getOptions:()=>[{value:"No Interface Filters",label:"No Interface Filters"},{value:"Has Interface",label:"Has Interface"}],label:"Interface"},{key:"creator",extractValue:e=>e.creator_user_id,getOptions:e=>{let t=new Map;return e.forEach(e=>{t.set(e.creator_user_id,e.getCreatorDisplayName())}),Array.from(t.entries()).map(e=>{let[t,r]=e;return{value:t,label:r}}).sort((e,t)=>e.label.localeCompare(t.label))},label:"Creator"}],oK={keys:[{name:"name",weight:1},{name:"description",weight:.3},{name:"created_ts",weight:.2,getFn:e=>(0,e5.p6)(e.created_ts.toISOString())}],threshold:.3,ignoreLocation:!0};var oY=e=>{let{versions:t}=e,[r,a]=(0,K.useState)(""),[s,n]=(0,K.useState)({}),l=(0,K.useMemo)(()=>new am.Z(t,oK),[t]),o=(0,K.useMemo)(()=>t.some(e=>e.metadata.triggers&&Object.keys(e.metadata.triggers).length>0),[t]),i=(0,K.useMemo)(()=>t.some(e=>e.metadata.interfaces&&Object.keys(e.metadata.interfaces).length>0),[t]),d=(0,K.useCallback)((e,t)=>{n(r=>{let a={...r};return t&&"No Trigger Filters"!==t&&"No Interface Filters"!==t?a[e]=t:delete a[e],a})},[]),c=(0,K.useCallback)(e=>{n(t=>{let r={...t};return delete r[e],r})},[]),u=(0,K.useCallback)(()=>{n({})},[]),m=(0,K.useCallback)(e=>{let r=oq.find(t=>t.key===e);return r?r.getOptions(t):[]},[t]);(0,K.useEffect)(()=>{o||"Has Trigger(s)"!==s.trigger||d("trigger","No Trigger Filters")},[o,s,d]),(0,K.useEffect)(()=>{i||"Has Interface"!==s.interface||d("interface","No Interface Filters")},[i,s,d]);let p=(0,K.useMemo)(()=>{let e=r.trim()?l.search(r).map(e=>e.item):t;return Object.keys(s).length>0?e.filter(e=>oq.every(t=>{let{key:r,extractValue:a}=t,n=s[r];return!n||a(e)===n})):e},[l,r,s,t]),x=(0,K.useMemo)(()=>Object.keys(s).filter(e=>s[e]).length,[s]);return{items:p,filters:{searchTerm:r,setSearchTerm:a,filters:s,setFilter:d,clearFilter:c,clearAllFilters:u,getFilterValues:m,activeFilterCount:x,filterDefinitions:oq.reduce((e,t)=>(e[t.key]=t,e),{}),hasTriggers:o,hasInterface:i}}},o$=r(13472);let oQ=o$.z.object({name:o$.z.string().min(1).max(75),description:o$.z.string().max(150).optional()});(u=k||(k={})).DETAILS="details",u.CONFIRM="confirm";var oX=e=>{let{open:t,onOpenChange:r,version:a,onEdit:s,isEditing:n,children:l}=e,[o,i]=(0,eK.P)({open:t,onOpenChange:r}),d=(0,K.useMemo)(()=>({name:(null==a?void 0:a.name)||"",description:(null==a?void 0:a.description)||""}),[a]),c=async e=>{await s({name:e.name,description:e.description,versionId:(null==a?void 0:a.version_id)||""})&&i(!1)},u=(0,l8.cI)({resolver:(0,l6.F)(oQ),defaultValues:d});return(0,K.useEffect)(()=>{setTimeout(()=>{u.reset({name:(null==a?void 0:a.name)||"",description:(null==a?void 0:a.description)||""})},a?0:250)},[a,u]),(0,S.jsxs)(eq.Vq,{open:o||n,onOpenChange:i,children:[l&&(0,S.jsx)(eq.hg,{asChild:!0,children:l}),(0,S.jsx)(eq.cZ,{"aria-describedby":"edit-flow-version-dialog-description",className:"max-w-xl!",children:(0,S.jsx)(l7.l0,{...u,children:(0,S.jsxs)("form",{onSubmit:u.handleSubmit(c),children:[(0,S.jsxs)(eq.a7,{children:[(0,S.jsx)(eq.fK,{children:(0,S.jsx)(eq.$N,{children:"Edit Checkpoint"})}),(0,S.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,S.jsx)(l7.Wi,{control:u.control,name:"name",render:e=>{let{field:t}=e;return(0,S.jsx)(l7.xJ,{children:(0,S.jsx)(l7.NI,{children:(0,S.jsx)(ax.I,{type:"text",placeholder:"Enter name...",...t,maxLength:75,autoComplete:"off"})})})}}),(0,S.jsx)(l7.Wi,{control:u.control,name:"description",render:e=>{let{field:t}=e;return(0,S.jsx)(l7.xJ,{children:(0,S.jsx)(l7.NI,{children:(0,S.jsx)(s3.g,{placeholder:"Enter description...",...t,maxLength:150,autoComplete:"off"})})})}})]})]}),(0,S.jsx)(eq.cN,{children:(0,S.jsx)(el.zx,{type:"submit",loading:n,children:"Save"})})]})})})]})},o0=r(72869),o1=r(99331),o2=r(90163),o5=e=>{let{version:t,isDraft:r,actions:a,states:s}=e,n=[{label:"Make This Checkpoint Live",Icon:o1.Z,onClick:()=>a.onDeploy(t.version_id),description:"Activate the triggers and interfaces on this checkpoint",condition:!t.is_deployed},{label:"Edit Details",Icon:aL.Z,onClick:()=>a.onEdit(t),description:"Change name and description"},{label:"Rollback to This Checkpoint",Icon:o2.Z,onClick:()=>a.onRestore({versionId:t.version_id}),description:"Recover your workflow at this checkpoint",condition:!r}];return(0,S.jsx)("div",{className:"flex flex-row items-end justify-end gap-2 pl-4",children:(0,S.jsxs)(tc.h_,{children:[(0,S.jsx)(tc.$F,{disabled:s.isDeploying,asChild:!0,children:(0,S.jsx)("span",{children:(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-sm",className:"group-hover/table-row:bg-elevated text-muted-foreground group-hover/table-row:text-foreground group-hover/table-row:border-border border border-transparent",disabled:s.isDeploying||s.isRestoring,children:(0,S.jsx)(nq.Z,{})})})}),(0,S.jsx)(tc.AW,{className:"p-1",children:n.map(e=>!1===e.condition?null:(0,S.jsxs)(tc.Xi,{onClick:t=>{t.stopPropagation(),e.onClick()},disabled:e.disabled,className:"flex max-w-sm min-w-xs flex-col items-start gap-0.5 pr-4",children:[(0,S.jsxs)("div",{className:"flex items-center justify-start gap-1.5 font-medium",children:[(0,S.jsx)(e.Icon,{className:"size-3.5"})," ",e.label]}),(0,S.jsx)("p",{className:"text-muted-foreground text-xs",children:e.description})]},e.label))})]})})},o4=e=>{let{version:t,isDraft:r}=e,a=t.metadata.triggers,s=t.metadata.interfaces,n=a&&Object.keys(a).length>0,l=t.metadata.interfaces&&Object.keys(t.metadata.interfaces).length>0,o=n||l,i=(0,K.useMemo)(()=>{let e=n&&a?Object.keys(a).length:0,t=l&&s?Object.keys(s).length:0,r=[];return e>0&&r.push("".concat(e," ").concat((0,e5.Ri)(e,"Trigger"))),t>0&&r.push("".concat(t," ").concat((0,e5.Ri)(t,"Interface"))),r.join(", ")},[n,l,a,s]);return(0,S.jsxs)("div",{className:"flex flex-col gap-2 py-1",children:[(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("div",{className:"flex items-start gap-2",children:(0,S.jsxs)(eo.u,{children:[(0,S.jsxs)("p",{className:"flex items-start gap-1.5 text-sm font-medium",children:[t.name,(0,S.jsx)(eo.aJ,{asChild:!0,children:t.is_deployed&&(0,S.jsxs)(eU.C,{variant:"success",className:"mt-0.5 flex flex-row items-center gap-1",size:"xs",children:[(0,S.jsx)(o1.Z,{className:"text-success-foreground my-auto inline-block size-3.5 animate-pulse"}),"Live"]})})]}),t.is_deployed&&(0,S.jsxs)(eo._v,{align:"start",onClick:e=>{e.stopPropagation()},children:["This checkpoint is live."," ",(0,S.jsx)(es(),{href:"https://docs.gumloop.com/core-concepts/version_history",className:"text-accent-foreground underline underline-offset-2",target:"_blank",children:"What is a live checkpoint?"})]})]})}),(0,S.jsx)("p",{className:(0,eu.cn)("text-muted-foreground text-xs",r&&"italic",!r&&!t.description&&"hidden"),children:r?"You are currently editing this checkpoint.":t.description})]}),o&&(0,S.jsx)("div",{className:"text-muted-foreground flex flex-row gap-1 text-xs",children:(0,S.jsx)("p",{children:i})}),!r&&(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)(e2.Z,{src:t.creator_profile_picture,name:t.getCreatorDisplayName(),className:"size-5 rounded-sm"}),(0,S.jsxs)("p",{className:"text-muted-foreground text-xs",children:[t.creator_first_name," ",t.creator_last_name," "," â€¢ ",(0,e5.QI)(t.created_ts.toISOString())]})]})]})},o3=e=>{let{items:t,activeVersionId:r,draftVersionId:a,actions:s,states:n,hasTrigger:l,hasInterface:o}=e,{isLoading:i}=(0,rD.wL)(),d=e=>{i||s.onPreview(e)};return(0,S.jsxs)("div",{className:"flex h-full flex-grow flex-col gap-1 overflow-y-auto mask-y-from-98% py-4",children:[t.map(e=>(0,S.jsxs)("div",{onClick:()=>d(e.version_id),"aria-disabled":i,className:(0,eu.cn)("hover:bg-muted/50 group/table-row relative flex cursor-pointer flex-row items-center justify-between rounded-md border border-transparent p-2 py-1.5 transition-all",e.version_id===a&&"border-border border-dashed",e.version_id===r&&"bg-elevated border-border hover:bg-elevated border",i&&"pointer-events-none opacity-60"),children:[(0,S.jsx)(o4,{version:e,isDraft:e.version_id===a}),(0,S.jsx)(o5,{version:e,isDraft:e.version_id===a,actions:s,states:n,hasTrigger:l,hasInterface:o})]},e.version_id)),0===t.length&&(0,S.jsx)("div",{className:"flex h-fit flex-col py-16",children:(0,S.jsx)(r3.Z,{Icon:o0.Z,title:"No versions found for your search",description:"Try adjusting your filters, or create a new version."})})]})},o9=r(1998),o6=r(70384),o8=e=>{let{filters:{searchTerm:t,setSearchTerm:r,filters:{creator:a,trigger:s,interface:n},setFilter:l,clearAllFilters:o,getFilterValues:i,filterDefinitions:d,hasTriggers:c,hasInterface:u}}=e,m=i(y.CREATOR),p=(0,K.useMemo)(()=>{let e=0;return a&&e++,s===w.HAS_TRIGGER&&e++,n===N.HAS_INTERFACE&&e++,e},[a,s,n]),x=c||u||m.length>1;return(0,S.jsxs)("div",{className:"xs:flex-nowrap flex flex-wrap items-center gap-3",children:[(0,S.jsx)(ax.I,{placeholder:"Search versions by name or description",LeadingIcon:lN.Z,className:"w-full md:min-w-64 lg:min-w-80",value:t,onChange:e=>r(e.target.value),shadow:!0}),x&&(0,S.jsxs)(ah.J2,{modal:!0,children:[(0,S.jsx)(ah.xo,{asChild:!0,className:"group/popover-trigger",children:(0,S.jsxs)(el.zx,{variant:"outline",className:"xs:w-fit w-full",shadow:!0,children:[p>0?(0,S.jsx)("span",{className:"text-background bg-accent-foreground flex size-4 shrink-0 items-center justify-center rounded-full text-[10px]",children:p}):(0,S.jsx)(o9.Z,{}),(0,S.jsx)("span",{children:"Filters"}),(0,S.jsx)(to.Z,{className:"transition-[rotate] duration-200 group-data-[state=open]/popover-trigger:-rotate-180"})]})}),(0,S.jsxs)(ah.yk,{align:"end",className:"flex flex-col !p-0",children:[m.length>1&&(0,S.jsxs)("div",{className:"flex flex-row items-center gap-2 p-3",children:[(0,S.jsxs)(of._,{className:"text-muted-foreground flex w-40 flex-row items-center gap-2 text-xs",children:[(0,S.jsx)(o6.Z,{className:"h-4 w-4"}),d[y.CREATOR].label]}),(0,S.jsx)(ov.N,{options:m,value:a,placeholder:"Select creator",onSelect:e=>{let t=e===a?void 0:e;l(y.CREATOR,t)},className:"flex !h-8 !w-48 rounded-sm text-xs shadow-xs",modal:!0})]}),(0,S.jsxs)(K.Fragment,{children:[m.length>1&&(0,S.jsx)(ta.Z,{className:"bg-muted"}),c&&(0,S.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 p-3",children:[(0,S.jsxs)(of._,{className:"text-muted-foreground flex w-40 flex-row items-center gap-2 text-xs",children:[(0,S.jsx)(tK.Z,{className:"h-4 w-4"}),d[y.TRIGGER].label]}),(0,S.jsx)(eX.r,{disabled:!c,checked:s===w.HAS_TRIGGER,onCheckedChange:e=>l(y.TRIGGER,e?w.HAS_TRIGGER:w.ALL)})]})]}),(0,S.jsxs)(K.Fragment,{children:[(c||m.length>1)&&(0,S.jsx)(ta.Z,{className:"bg-muted"}),u&&(0,S.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 p-3",children:[(0,S.jsxs)(of._,{className:"text-muted-foreground flex w-40 flex-row items-center gap-2 text-xs",children:[(0,S.jsx)(og.Z,{className:"h-4 w-4"}),d[y.INTERFACE].label]}),(0,S.jsx)(eX.r,{disabled:!u,checked:n===N.HAS_INTERFACE,onCheckedChange:e=>l(y.INTERFACE,e?N.HAS_INTERFACE:N.ALL)})]})]}),p>0&&(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(ta.Z,{className:"bg-muted"}),(0,S.jsx)("div",{className:"flex flex-row items-center justify-end gap-2 p-3",children:(0,S.jsx)(el.zx,{variant:"outline",size:"xs",onClick:()=>{o()},children:"Clear Filters"})})]})]})]})]})},o7=()=>{let[e,t]=(0,K.useState)(!1),[r,a]=(0,K.useState)(null);(0,ez.CG)(A.$g);let s=(0,ez.CG)(R.v9),n=(0,ez.CG)(R._b),l=(0,ez.CG)(R.$b),o=(0,ez.CG)(R.a1),i=(0,ez.TL)(),{versions:d,draftVersion:c,activeVersion:u,actions:m,states:p}=oS({flowbookId:o}),{removeParams:x}=(0,oC.W)(),{filters:h,items:g}=oY({versions:d}),v=d.length>1,j=(0,ez.CG)(ew),b={onEdit:e=>{a(e),t(!0)},onDeploy:m.deploy,onRestore:m.restore,onPreview:m.preview},_=(0,K.useCallback)(()=>{x([ey.VERSION_ID]),setTimeout(()=>{i((0,D.ky)(!1))},100)},[i,x]);return(0,K.useEffect)(()=>{let e=e=>{"h"===e.key&&(e.ctrlKey||e.metaKey)&&j===f.PREVIEW&&(e.preventDefault(),s?i((0,D.ky)(!1)):_())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[i,j,_,s]),(0,S.jsxs)("div",{className:"flex max-w-[var(--gummie-container-width)] flex-grow flex-col px-4 py-2",children:[(0,S.jsxs)("div",{className:"flex flex-col gap-2 pt-2",children:[(0,S.jsxs)("div",{className:"flex flex-row items-end justify-between gap-2",children:[(0,S.jsx)("h3",{className:"text-xl font-medium",children:"Past Checkpoints"}),(0,S.jsxs)(el.zx,{variant:"outline",size:"sm",onClick:_,children:[(0,S.jsx)(rk.Z,{}),(0,S.jsx)("span",{children:"Return to Draft"})]})]}),(0,S.jsxs)("span",{className:"text-muted-foreground text-sm",children:[v?"Manage ".concat(d.length," past ").concat((0,e5.Ri)(d.length,"checkpoint")," of this workbook. "):"Create your first checkpoint of this workbook to get started. ",(0,S.jsx)(es(),{href:"https://docs.gumloop.com/core-concepts/checkpoint_history",className:"underline underline-offset-2 hover:no-underline",target:"_blank",children:"Learn more about checkpoint history."})]})]}),(0,S.jsx)(ta.Z,{className:"my-4"}),(0,S.jsx)(o8,{filters:h}),(0,S.jsx)("div",{className:"flex flex-grow flex-col overflow-hidden",children:(0,S.jsx)(o3,{items:g,activeVersionId:null==u?void 0:u.version_id,draftVersionId:null==c?void 0:c.version_id,actions:b,states:p,hasTrigger:n,hasInterface:l})}),(0,S.jsx)(oX,{open:e,onOpenChange:e=>{t(e),e||a(null)},onEdit:m.edit,isEditing:p.isEditing,version:r})]})},ie=e=>{let{children:t}=e,{isLoading:r}=(0,eg.NN)(),a=(0,ez.CG)(R.JC);(0,ez.CG)(R.aN);let s=(0,ez.CG)(ew),n=(0,ez.CG)(A.ps),l=(null==n?void 0:n.category)?(0,ro.J8)(n.category):void 0;return(0,S.jsx)("div",{style:{...l,background:l?"radial-gradient(circle at bottom left, var(--background-2), color-mix(in srgb, var(--node-color-light) 10%, transparent))":"var(--background-2)"},className:(0,eu.cn)("dndflow relative flex !h-svh min-w-svw flex-col! transition-all"),children:(0,S.jsxs)("div",{className:(0,eu.cn)("relative z-50 flex h-svh transition-all",s!==f.DEFAULT&&"overflow-hidden"),children:[s===f.PREVIEW&&(0,S.jsx)(o7,{}),a&&(0,S.jsx)(l4,{}),s===f.TEMPLATE&&(0,S.jsx)(oH,{}),(0,S.jsx)("div",{className:(0,eu.cn)("relative flex !h-svh flex-grow",s!==f.DEFAULT&&"!h-full justify-center py-2 lg:flex"),children:(0,S.jsxs)("div",{className:it({mode:s}),children:[s===f.PREVIEW&&(0,S.jsx)(oJ,{}),s===f.GUMMIE&&(0,S.jsx)(lL,{}),r?(0,S.jsx)(eg.rX,{className:"w-full!"}):(0,S.jsx)(K.Fragment,{children:t})]})})]})})};let it=(0,lw.j)("relative flex flex-grow flex-col transition-all",{variants:{mode:{[f.GUMMIE]:"shadow-floating max-w-[calc(100dvw-var(--gummie-container-width)-1*var(--radius))] overflow-clip rounded-2xl dark:border",[f.PREVIEW]:"shadow-floating max-w-[calc(100dvw-var(--gummie-container-width)-1*var(--radius))] overflow-clip rounded-2xl dark:border",[f.DEFAULT]:"",[f.TEMPLATE]:"shadow-floating max-w-[calc(100dvw-var(--template-container-width)-1*var(--radius))] overflow-clip rounded-2xl dark:border"}}});var ir=r(54020),ia=r(95207),is=r(38278),il=r(23050),io=r(82126),ii=e=>{let{visible:t,loading:r=!1,onSave:a,onReset:s,onManualEdit:n,className:l,mode:o}=e;(0,K.useEffect)(()=>{let e=e=>{"s"===e.key&&(e.metaKey||e.ctrlKey)&&"manual"===o&&(null==a||a())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o,a]);let{label:i,Icon:d}=(0,K.useCallback)(()=>"autosave"===o?{label:"Autosaved Changes",Icon:il.Z}:"awaiting-save"===o?{label:"Finish editing with Gummie to save",Icon:tf.Z}:"diff"===o?{label:"Viewing changes with previous revision",Icon:io.Z}:{label:"Unsaved Changes",Icon:tf.Z},[o])();return(0,S.jsxs)("div",{className:(0,eu.cn)("gumloop-black-gradient border-border text-foreground absolute bottom-4 left-1/2 z-50 flex -translate-x-1/2 items-center gap-3 rounded-lg border p-2 pl-3 shadow-md transition-all duration-200 ease-in-out select-none",t?"translate-y-0 opacity-100":"translate-y-full opacity-0",l),children:[(0,S.jsx)(d,{className:"h-4 w-4 flex-shrink-0"}),(0,S.jsx)("span",{className:"text-xs font-medium",children:i}),"manual"===o&&a&&s&&(0,S.jsxs)("div",{className:"ml-2 flex items-center gap-2",children:[(0,S.jsx)(el.zx,{variant:"outline",size:"xs",onClick:s,className:"h-7",disabled:r,children:"Reset"}),(0,S.jsxs)(el.zx,{variant:"default",size:"xs",onClick:a,className:"h-7 items-center gap-1",loading:r,children:["Save",(0,S.jsx)("span",{className:"hidden opacity-80 sm:block",children:"âŒ˜"}),(0,S.jsx)("span",{className:"hidden opacity-80 sm:block",children:"S"})]})]}),"diff"===o&&n&&(0,S.jsx)("div",{className:"ml-2 flex items-center gap-2",children:(0,S.jsx)(el.zx,{variant:"outline",size:"xs",onClick:n,className:"h-7",disabled:r,children:"Edit Manually"})})]})},id=()=>{let e=(0,ez.CG)(A.bc),{resolvedTheme:t}=(0,a1.F)(),r=(0,K.useRef)(null),a=(0,K.useRef)(null),s=(0,K.useRef)(!1),n=(0,Q.I0)(),l=(0,ez.CG)(A.d5),o=(0,ez.CG)(A.zd),i=(0,ez.CG)(A.vj),d=(0,ez.CG)(A.Ox),c=(0,ez.CG)(A.pM),u=(0,ez.CG)(rb.tY),m=(0,ez.CG)(A.IW),p=(0,ir.Z)(1520),x=!!d&&d!==(null==o?void 0:o.code),h=c&&x&&l!==O.Cn.MANUAL_CUSTOM_NODE,g=(0,K.useMemo)(()=>(null==o?void 0:o.operator_id)===void 0||!u.find(e=>e.operator_id===(null==o?void 0:o.operator_id)),[null==o?void 0:o.operator_id,u]),f=(0,K.useMemo)(()=>(null==o?void 0:o.code)!==i&&l!==O.Cn.MANUAL_CUSTOM_NODE,[null==o?void 0:o.code,i,l]),v=(0,K.useMemo)(()=>h?"diff":g?"autosave":m!==O.IG.EDIT_CUSTOM_NODE||g?"awaiting-save":"manual",[m,g,h]),{handleApproveAndSave:j,isSaving:b}=(0,ia.X)({customOperator:o});(0,K.useEffect)(()=>{(null==o?void 0:o.code)&&void 0===i&&n((0,A.Yq)(o.code))},[null==o?void 0:o.code,n,i]);let{signatureLine:_,returnLine:y}=(0,K.useMemo)(()=>(0,is.GA)((null==o?void 0:o.code)||""),[null==o?void 0:o.code]),w=(0,K.useCallback)(()=>{let e=r.current,t=a.current;if(!e||!t)return;let s=(0,is.TV)(e,t,[{start:_,end:_},{start:y,end:y}]);e.createDecorationsCollection(s)},[_,y]),N=(0,K.useRef)(),k=(0,K.useCallback)(t=>{N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{if(!o)return;let r=new lV.p(o.operator_id,o.version,o.creator_user_id,o.operator_declaration,t,o.metadata);(0,no.fX)("custom_node_code_edited",{chat_id:e,customOperator:o,before_data:o,after_data:r,change_type:"manual"}),n((0,A.oV)(r))},500)},[o,n]),C=(0,K.useCallback)(e=>{a.current=e},[]),I=(0,K.useCallback)((e,t)=>{r.current=e,a.current=t,(null==o?void 0:o.code)&&w()},[null==o?void 0:o.code,w]),T=(0,K.useCallback)((e,t)=>{if(s.current||!o||!r.current||e===o.code)return;let a=(0,is.y6)(t),n=a.some(e=>(0,is.qq)(e,_)),l=a.some(e=>(0,is.qq)(e,y));if(n||l){s.current=!0,r.current.setValue(o.code||""),w(),setTimeout(()=>{s.current=!1},0);return}void 0!==e&&k(e)},[o,_,y,k,w]),E=(0,K.useCallback)(()=>{var e;i&&o&&(s.current=!0,null===(e=r.current)||void 0===e||e.setValue(i),w(),setTimeout(()=>{s.current=!1},0),n((0,A.oV)(new lV.p(o.operator_id,o.version,o.creator_user_id,o.operator_declaration,i,o.metadata))))},[i,o,n,w]);return(0,S.jsxs)("div",{className:"relative flex h-full w-full flex-col",children:[h?(0,S.jsx)(a0.SV,{className:"monaco-editor-override flex !h-full !w-full flex-col",language:"python",original:d,modified:null==o?void 0:o.code,theme:"dark"===t?"vs-dark":"light",options:{readOnly:!0,lineNumbers:"on",roundedSelection:!0,scrollBeyondLastLine:!1,folding:!1,minimap:{enabled:!1},fontLigatures:!0,scrollbar:{handleMouseWheel:!0,alwaysConsumeMouseWheel:!1},renderSideBySide:!p,diffAlgorithm:"advanced",ignoreTrimWhitespace:!0}}):(0,S.jsx)(a0.ML,{className:"monaco-editor-override flex !h-full !flex-grow flex-col",language:"python",value:null==o?void 0:o.code,beforeMount:C,onMount:I,onChange:T,theme:"dark"===t?"vs-dark":"light",options:{readOnly:!1,lineNumbers:"on",roundedSelection:!0,scrollBeyondLastLine:!1,folding:!1,minimap:{enabled:!1},fontLigatures:!0,scrollbar:{handleMouseWheel:!0,alwaysConsumeMouseWheel:!1}}}),(0,S.jsx)(ii,{visible:h||f,loading:b,onSave:j,onReset:E,onManualEdit:()=>n((0,A.am)(!1)),mode:v})]})},ic=r(32225),iu=()=>{let[e,t]=(0,K.useState)(!1),r=(0,ez.CG)(A.zd),a=(0,ez.CG)(A.d5),s=(0,K.useRef)(a).current,n=(0,nO.J)(),l=(0,ez.TL)(),o=(0,K.useCallback)(()=>{n.abortCoreGummieCompletions(),l((0,A.pj)({mode:O.Cn.MANUAL_CUSTOM_NODE}))},[l,n]),i=(0,K.useCallback)(()=>{l((0,A.pj)({mode:O.Cn.CUSTOM_NODE_CONFIG})),l((0,s6.gJ)())},[l]);return(0,S.jsxs)(eZ.dr,{className:"flex h-[45px] w-full items-center justify-between border-b",children:[(0,S.jsxs)("div",{className:"flex",children:[(0,S.jsxs)(eZ.SP,{value:"canvas",size:"sm",disabled:!(null==r?void 0:r.code),children:[(0,S.jsx)(rw.Z,{}),"Canvas"]}),(0,S.jsxs)(eZ.SP,{disabled:!(null==r?void 0:r.code),value:"code",size:"sm",onClick:()=>{t(!0)},children:[(0,S.jsx)(ic.Z,{}),"Code ",(null==r?void 0:r.getLineCount())?"(".concat(r.getLineCount()," Lines)"):""," ",!e&&a!==O.Cn.MANUAL_CUSTOM_NODE&&(0,S.jsx)("div",{className:"bg-accent-foreground size-2 rounded-full"})]})]}),(0,S.jsx)("div",{className:"flex items-center gap-1 pr-2",children:s===O.Cn.CUSTOM_NODE_CONFIG&&(0,S.jsxs)(K.Fragment,{children:[a===O.Cn.CUSTOM_NODE_CONFIG&&(0,S.jsxs)(el.zx,{onClick:o,variant:"ghost",size:"xs",children:[(0,S.jsx)(aP.Z,{className:"size-3.5"}),"Edit Manually"]}),a===O.Cn.MANUAL_CUSTOM_NODE&&(0,S.jsxs)(el.zx,{onClick:i,variant:"ghost",size:"xs",children:[(0,S.jsx)(an.Z,{className:"size-3.5"}),"Use Gummie"]})]})})]})},im=r(52042),ip=r(87175),ix=r(34357),ih=r(46611);let ig=(0,K.forwardRef)((e,t)=>{let{className:r}=e,a=(0,en.useSearchParams)(),s=a.has("workbook_id")||a.has("flow_id")||a.has("agent_id"),n=a.has("run_id"),l=(0,ez.CG)(R.LA),o=(0,ez.CG)(R.v9),{currentProject:i}=(0,e0.d2)(),{userProfile:d}=(0,ec.H)(),c=(0,ez.CG)(R.$f),[u,m]=(0,K.useState)(!1),[p,x]=(0,K.useState)(l.name||"New Workflow"),h=(0,ez.CG)(R.aN),g=(0,K.useMemo)(()=>!!l.flowbook_id,[l.flowbook_id]);(0,K.useEffect)(()=>{x(l.name||"New Workflow")},[l.name]);let{handleSaveFlowbook:f}=(0,oT.M)();(0,K.useImperativeHandle)(t,()=>({setIsEditingName:e=>{m(e)}}));let v=(0,K.useCallback)(e=>{e.trim()&&x(e)},[]),j=(0,K.useCallback)(async()=>{if(p!=l.name)try{await f({name:p,description:l.description||""})}catch(e){X.Am.error("Failed to update name")}},[p,l.name,l.description,f]),b=(0,K.useCallback)(()=>{if(!g){X.Am.info("Please save the workbook before editing the name!");return}if(h){let e=h.creator_user_id===d.user_id,t=h.status===tl.C.APPROVED;if(!e&&t){X.Am.info("Please clone the template to edit the name!");return}}m(!0)},[h,g,d.user_id]),_=(0,K.useCallback)(()=>{j(),m(!1)},[j]),y=(0,K.useCallback)(e=>{"Enter"===e.key?(j(),m(!1)):"Escape"===e.key&&(m(!1),x(l.name||"New Workflow"))},[j,l.name]),w=(null==h?void 0:h.creator_user_id)===(null==d?void 0:d.user_id)||(null==i?void 0:i.project_id)===(null==h?void 0:h.creator_user_id),N=(null==h?void 0:h.creator_user_id)===(null==d?void 0:d.user_id),k=!h||w||N&&!c,C=s&&n;return u?(0,S.jsx)(lp,{initialValue:p,autoFocus:!0,onChange:v,onKeyDown:y,onBlur:_,className:(0,eu.cn)("max-w-xs rounded-lg text-sm",C?"max-h-6":"max-h-7",r),placeholder:"New Workflow",buffer:24}):(0,S.jsx)("button",{className:(0,eu.cn)("text-foreground max-w-xs truncate rounded-md px-2 text-left text-base font-semibold",!C&&"py-0.5",o&&"hover:bg-muted cursor-pointer",r),onClick:b,disabled:!o||!k,children:k?p:null==h?void 0:h.name})});ig.displayName="FlowName";var iv=r(44659),ij=r(60489),ib=r(30202);let i_=K.forwardRef((e,t)=>{let{variant:r,size:a,shadow:s,fit:n,accent:l,children:o,...i}=e;return(0,S.jsx)("div",{ref:t,className:(0,eu.cn)("inline-flex"),...i,children:K.Children.map(o,e=>K.isValidElement(e)?K.cloneElement(e,{variant:r,size:a,shadow:s,fit:n,accent:l}):e)})});i_.displayName="SplitButton";let iy=K.forwardRef((e,t)=>{let{className:r,variant:a,size:s,shadow:n,fit:l,accent:o,...i}=e;return(0,S.jsx)(el.zx,{ref:t,className:(0,eu.cn)("relative scale-100! rounded-r-none focus:z-10",r,"border-r-[0.5px]"),variant:a,size:s,shadow:n,fit:l,accent:o,...i})});iy.displayName="SplitButtonAction";let iw=e=>{let{children:t,disabled:r,variant:a,size:s,shadow:n,fit:l,accent:o,onOpenChange:i,...d}=e;return(0,S.jsx)(tc.h_,{onOpenChange:i,children:K.Children.map(t,e=>K.isValidElement(e)&&e.type===iN?K.cloneElement(e,{disabled:r,variant:a,size:s,shadow:n,fit:l,accent:o,...d}):e)})},iN=K.forwardRef((e,t)=>{let{className:r,children:a,disabled:s,...n}=e;return(0,S.jsx)(tc.$F,{asChild:!0,ref:t,children:(0,S.jsx)(el.zx,{className:(0,eu.cn)("relative scale-100! rounded-l-none px-2 focus:z-10",r,"border-l-[0.5px]"),disabled:s,...n,children:a})})});iN.displayName="SplitButtonDropdownTrigger";let ik=tc.AW,iC=tc.Xi,iI=(0,r(73588).r)({FLOW_CREATED:"created",FLOW_SAVED:"saved",FLOW_CLONED:"cloned",TEMPLATE_WORKFLOW_COPIED:"template_workflow_copied"},"flow_");var iT=r(32025),iS=r(24266);let iE=e=>{let{isAnyPipelineChanged:t}=e,r=(0,K.useRef)(null),a=(0,ez.CG)(H._I),[s,n]=(0,K.useState)(!1),[l,o]=(0,K.useState)(!1),[i,d]=(0,K.useState)(!1),[c,u]=(0,K.useState)(void 0),[m,p]=(0,K.useState)(!1),x=(0,ib.NL)(),{userProfile:h,idTokenRef:g}=(0,ec.H)(),{currentProject:f}=(0,e0.d2)(),{handleProjectSwitch:v}=(0,oP.W)(),{handleSaveFlowbook:j}=(0,oT.M)(),b=(0,ez.TL)(),_=(0,ez.CG)(R.ai),y=(0,ez.CG)(tZ.ev),w=(0,ez.CG)(R.uE),N=(0,ez.CG)(G.P$),{triggersToDeleteOnSave:k,deletionReasonsBySavedItemId:C}=(0,K.useMemo)(()=>(function(e){let{savedItemIds:t,triggersMap:r,activeTriggersByNodeIdMap:a,formsMap:s,currentUserId:n,currentProjectId:l}=e,o=[],i={};return t.forEach(e=>{let t=r[e]||[],d=a[e]||{},c=s[e],u=[];t.forEach(e=>{!e.node_id||d[e.node_id]||u.includes(e.node_id)||u.push(e.node_id)});let m=function(e){let{allTriggers:t,activeTriggersByNodeId:r,disabledNodeIds:a,subscriptionDisabled:s,currentUserId:n,currentProjectId:l,savedItemId:o}=e,i=[],d="trigger-node-disabled",c=t.filter(e=>!!e.node_id&&a.includes(e.node_id)).filter(e=>!tP(e,n,l));if(i.push(...c),s){let e=tD(t,n,l).filter(e=>!c.some(t=>t.trigger_id===e.trigger_id));i.push(...e),c.length>0&&e.length>0?d="both":e.length>0&&(d="subscription-disabled")}return{triggers:Array.from(new Map(i.map(e=>[e.trigger_id,e])).values()),reason:d,disabledNodeIds:a.length>0?a:void 0}}({allTriggers:t,activeTriggersByNodeId:d,disabledNodeIds:u,subscriptionDisabled:!c||!(null==c?void 0:c.form_elements)||!(null==c?void 0:c.form_elements.some(e=>"TriggerConfiguration"===e.type)),currentUserId:n,currentProjectId:l,savedItemId:e});m.triggers.length>0&&(i[e]=m.reason),m.triggers.forEach(t=>{o.push({triggerId:t.trigger_id,savedItemId:e,trigger:t})})}),{triggersToDeleteOnSave:o,deletionReasonsBySavedItemId:i}})({savedItemIds:_,triggersMap:y,activeTriggersByNodeIdMap:w,formsMap:N,currentUserId:h.user_id,currentProjectId:null==f?void 0:f.project_id}),[_,y,w,N,h.user_id,null==f?void 0:f.project_id]),I=k.length,T=(0,K.useMemo)(()=>{if(0===I)return"";let e=Object.values(C),t=e.some(e=>"subscription-disabled"===e||"both"===e),r=e.some(e=>"trigger-node-disabled"===e||"both"===e);return t?"You manually disabled subscriptions for these flows. Saving will delete ".concat(I," ").concat((0,e5.Ri)(I,"subscription")," to the flows in the workbook by another user. This action cannot be undone."):r?"Saving will delete ".concat(I," ").concat((0,e5.Ri)(I,"subscription")," from the flows in the workbook by another user. This action cannot be undone."):void 0},[I,C]),E=(0,ez.CG)(eb.FI),M=(0,ez.CG)(R.LA),A=(0,ez.CG)(R.aN),O=(0,ez.CG)(R.v9),Z=(0,K.useMemo)(()=>null==A?void 0:A.creator_user_id,[A]),z=(0,K.useMemo)(()=>(0,iS.r)(null==f?void 0:f.project_id,M.author_id,h.user_id,Z,null==A?void 0:A.status),[null==f?void 0:f.project_id,M.author_id,h.user_id,Z,null==A?void 0:A.status]),P=(0,K.useCallback)(async e=>{var t;let{forceClone:r=!1,newAuthorId:s}=e;p(!0);let n=z?"[Copy] "+M.name:M.name||"New Workflow",l=M.description||"";await j({name:n,description:l,beforeSave:()=>{z&&(M.name=n,M.description=l)},forceClone:z||r,afterSave:async()=>{s&&s!==(null==f?void 0:f.project_id)&&v(a.find(e=>e.project_id===s)),z||r?A?await (0,iT.u)(iI.TEMPLATE_WORKFLOW_COPIED,{user_email:h.user_email,first_name:h.first_name,last_name:h.last_name},{template_id:A.template_page_id,template_name:A.name,tags:["marketing","activation"]}):await (0,iT.u)(iI.FLOW_CLONED,{user_email:h.user_email,first_name:h.first_name,last_name:h.last_name},{flowbook_id:M.flowbook_id,tags:["marketing","activation"]}):M.flowbook_id?await (0,iT.u)(iI.FLOW_SAVED,{user_email:h.user_email,first_name:h.first_name,last_name:h.last_name},{flowbook_id:M.flowbook_id,tags:["marketing","activation"]}):await (0,iT.u)(iI.FLOW_CREATED,{user_email:h.user_email,first_name:h.first_name,last_name:h.last_name},{tags:["marketing","activation"]})},newAuthorId:s}),x.invalidateQueries({queryKey:["hub","recent",null!==(t=null==f?void 0:f.project_id)&&void 0!==t?t:h.user_id]}),p(!1)},[j,M,z,v,null==f?void 0:f.project_id,a,x,A,h]),D=(0,K.useCallback)(async()=>{if(c)try{d(!1),s?o(!0):h.uses_autoformat_on_save&&b((0,aC.B7)({shouldFitView:!1})),await P({newAuthorId:c.newAuthorId}),u(void 0)}catch(e){d(!1),u(void 0)}},[c,h,b,s,P]),L=(0,K.useCallback)(async function(){let{newAuthorId:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(b((0,F.hA)()),I>0&&!z){u({newAuthorId:e}),d(!0);return}if(s){o(!0);return}h.uses_autoformat_on_save&&b((0,aC.B7)({shouldFitView:!1})),await P({newAuthorId:e})},[s,P,b,h.uses_autoformat_on_save,I,z]);(0,K.useEffect)(()=>{let e=async e=>{if((e.ctrlKey||e.metaKey)&&"s"===e.key&&O){var t;e.preventDefault(),null===(t=r.current)||void 0===t||t.click()}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[P,r,O]),(0,K.useEffect)(()=>{let e=async()=>{null===await h.fetchUserMetadata(na.m.USES_AUTOFORMAT_ON_SAVE,g.current)&&n(!0)};h.isLoggedIn()&&!h.uses_autoformat_on_save&&e()},[h,g]);let U=(0,K.useMemo)(()=>t&&E&&!z,[t,E,z]);return(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(iA,{handleSave:async e=>L(e?{newAuthorId:e}:{}),shouldDisplayClone:z,shouldShowUnsavedIndicator:U,isSaving:m,disabled:!E||m||h.is_flow_modification_restricted,ref:r}),(0,S.jsx)(eQ.Z,{title:"Automatically format your workflow when saving?",description:"You can always change this in your preferences.",open:l,setOpen:o,onConfirm:()=>{h.setUserMetadata(na.m.USES_AUTOFORMAT_ON_SAVE,"true",g.current),n(!1),b((0,aC.B7)({shouldFitView:!1})),P({})},confirmButtonProps:{text:"Autoformat When Saving"},onCancel:()=>{h.setUserMetadata(na.m.USES_AUTOFORMAT_ON_SAVE,"false",g.current),n(!1),P({})},cancelButtonProps:{text:"Save Without Autoformatting"}}),(0,S.jsx)(eQ.Z,{open:i,setOpen:d,title:"Delete Subscriptions?",description:T||"Saving will delete ".concat(I," ").concat((0,e5.Ri)(I,"subscription"),"."),onConfirm:D,onCancel:()=>{d(!1),u(void 0)},primaryActionButtonLoading:m,confirmButtonProps:{text:"Confirm and Save",variant:"destructive-gradient"},cancelButtonProps:{text:"Cancel"}})]})};iE.displayName="PipelineSaveButton";var iM=(0,K.memo)(iE);let iA=(0,K.memo)((0,K.forwardRef)((e,t)=>{let{handleSave:r,shouldShowUnsavedIndicator:a,disabled:s,shouldDisplayClone:n,isSaving:l}=e,o=(0,ez.TL)(),i=(0,ez.CG)(R.LA),d=(0,ez.CG)(R.cP),c=(0,ez.CG)(R.AV),{actions:u,draftVersion:m,states:{isDeploying:p,isCreating:x}}=oS({flowbookId:i.flowbook_id}),h=(0,K.useMemo)(()=>[{label:"Save & Create New Checkpoint",description:"Save this version of your workflow to go back to later",onClick:()=>u.create(),disabled:!d||x,Icon:iv.Z},{label:"Save & Make This Checkpoint Live",description:"Activate the triggers and interfaces on this checkpoint. You currently have a past checkpoint live",onClick:()=>u.deploy(null==m?void 0:m.version_id),condition:!(null==m?void 0:m.is_deployed)&&d,disabled:!d,Icon:o1.Z},{label:"View Past Checkpoints",onClick:()=>o((0,D.ky)(!0)),description:"See all checkpoints of this workbook",Icon:ij.Z,condition:d&&!n}],[d,x,u,m,o,n]),g=async e=>{e&&await o((0,ej.To)({savedItemId:c}))};return n&&r?(0,S.jsx)(oG,{disabled:s,ref:t,onClone:r}):(0,S.jsx)(K.Fragment,{children:(0,S.jsxs)(eo.u,{children:[(0,S.jsxs)(i_,{variant:"outline",size:"sm",shadow:!0,children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsxs)(iy,{onClick:()=>r(),id:"save-button",disabled:s||p,className:(0,eu.cn)("flex items-center overflow-visible",a&&"border-orange-300 bg-orange-100 text-orange-500 hover:bg-orange-100 dark:border-orange-400 dark:bg-orange-700 dark:text-orange-200"),ref:t,children:[l?(0,S.jsx)(nd.Z,{className:"size-3.5 animate-spin"}):(0,S.jsx)(lU.Z,{}),(0,S.jsx)("span",{className:"hidden md:block",children:"Save"})]})}),(0,S.jsxs)(iw,{onOpenChange:g,disabled:s||p,children:[(0,S.jsx)(iN,{className:(0,eu.cn)(a&&"border-orange-300 bg-orange-100 text-orange-500 hover:bg-orange-100 dark:border-orange-400 dark:bg-orange-700 dark:text-orange-200"),children:(0,S.jsx)(to.Z,{})}),(0,S.jsx)(ik,{align:"end",className:"p-1",children:h.map(e=>!1===e.condition?null:(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(iC,{onClick:e.onClick,disabled:e.disabled||s||p,className:(0,eu.cn)("flex w-xs flex-col items-start gap-0.5 p-2",e.className),asChild:!0,children:(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,S.jsx)(e.Icon,{className:"size-3.5"}),(0,S.jsx)("p",{className:"text-sm font-medium",children:e.label})]}),e.description&&(0,S.jsx)("p",{className:"text-muted-foreground text-xs",children:e.description})]})},e.label)}),e.tooltip&&(0,S.jsx)(eo._v,{children:e.tooltip})]},e.label))})]})]}),(0,S.jsx)(eo._v,{side:"bottom",children:a?"Unsaved changes!":(0,S.jsxs)(K.Fragment,{children:["Save",(0,S.jsx)(s4.Z,{children:(0,s4.V)()?(0,S.jsx)(n1.Z,{className:"h-3 w-3"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"S"})]})})]})})}));iA.displayName="SaveButton";var iO=r(66935),iZ=r(60549),iz=r(29871);let iP=K.memo(e=>{let{alerts:t,alertsLoading:r,alertsError:a,refetchAlerts:s}=e;return r?(0,S.jsx)(tb.Z,{className:"mx-auto h-4 w-4 animate-spin"}):a?(0,S.jsxs)("div",{className:"text-muted-foreground flex flex-col items-center justify-center gap-2 text-center text-sm",children:[(0,S.jsx)("p",{children:"Sorry, we couldn't load your alerts. Please try again later. "}),(0,S.jsxs)(el.zx,{variant:"outline",size:"sm",onClick:()=>s(),children:[(0,S.jsx)(iz.Z,{}),"Refresh"]})]}):(0,S.jsx)("div",{className:"pointer-events-auto flex flex-col gap-2",children:t.length>0?t.map((e,t)=>{var r,a;return(0,S.jsx)("div",{children:(0,S.jsxs)("div",{className:"flex flex-grow flex-col gap-1",children:[(0,S.jsxs)("p",{className:"text-xs",children:["Notifying ",null===(r=e.event.emails)||void 0===r?void 0:r.length," email",(null===(a=e.event.emails)||void 0===a?void 0:a.length)===1?"":"s"," on flow run failure",e.event.only_alert_on_triggered_runs?" (only on triggered runs)":"","."]}),(0,S.jsx)("ul",{className:"flex flex-col gap-1",children:e.event.emails.map((e,t)=>(0,S.jsx)("li",{className:"text-muted-foreground ml-4 list-decimal text-xs",children:e},t))})]})},e.alert_id)}):(0,S.jsx)("p",{className:"text-muted-foreground text-xs",children:"Create or activate an alert to get started."})})});iP.displayName="AlertsDialogContent";let iD=(0,e_.P1)([e=>e.alerts,(e,t)=>t],(e,t)=>t&&e.alertMap[t]||[]);var iL=r(37864),iR=r(65401),iF=r(48966);let iG=(0,K.memo)(e=>{let{open:t,onOpenChange:r,children:a}=e,[s,n]=(0,eK.P)({open:t,onOpenChange:r}),[l]=(0,iO.X5)(),[o]=(0,iO.li)(),[i]=(0,iO.Jr)(),{userProfile:d,idTokenRef:c}=(0,ec.H)(),u=(0,ez.CG)(R.z4),m=(0,Q.v9)(e=>iD(e,null==u?void 0:u.saved_item_id)),p=(0,K.useMemo)(()=>m.length>0?m[0].alert_type:"email",[m]),x=(0,K.useMemo)(()=>m.length>0&&m[0].event&&m[0].event.emails?m[0].event.emails:[],[m]),h=(0,K.useMemo)(()=>m.length>0&&!!m[0].event&&!!m[0].event.only_alert_on_triggered_runs&&m[0].event.only_alert_on_triggered_runs,[m]),[g,f]=(0,K.useState)(p),[v,j]=(0,K.useState)(x),[b,_]=(0,K.useState)(h),[y,w]=(0,K.useState)(""),[N,k]=(0,K.useState)("");(0,K.useEffect)(()=>{t&&(f(p),j(x),_(h))},[t,p,x,h]);let C=(0,K.useCallback)(async e=>{if(e.preventDefault(),!(0,iF.isEmail)(y)){k("Please enter a valid email address.");return}if(v.includes(y.trim())){k("Already sending alerts to ".concat(y.trim(),".")),w("");return}let t=[...v,y.trim()];j(t),w("");let r={emails:t,only_alert_on_triggered_runs:b};if(m.length>0){let e=X.Am.loading("Updating alert...");try{await o({userProfile:d,idToken:c.current,saved_item_id:null==u?void 0:u.saved_item_id,alert_id:m[0].alert_id,event:r}).unwrap(),X.Am.success("Email added and alert updated successfully.",{id:e})}catch(t){X.Am.error("Failed to update alert.",{id:e})}}else{let e=X.Am.loading("Creating alert...");try{await l({userProfile:d,idToken:c.current,saved_item_id:null==u?void 0:u.saved_item_id,alert_type:"email",event:r}).unwrap(),X.Am.success("Email added and alert created successfully.",{id:e})}catch(t){X.Am.error("Failed to create alert.",{id:e})}}},[v,y,m,l,o,d,c,null==u?void 0:u.saved_item_id,w,j,b]),I=(0,K.useCallback)(async e=>{let t=v.filter((t,r)=>r!==e);if(j(t),0===t.length){let e=X.Am.loading("No remaining emails, deleting alert...");try{await i({userProfile:d,idToken:c.current,saved_item_id:null==u?void 0:u.saved_item_id,alert_id:m[0].alert_id}).unwrap(),X.Am.success("Alert deleted successfully.",{id:e})}catch(t){X.Am.error("Failed to delete alert.",{id:e})}return}if(m.length>0){let e=X.Am.loading("Updating alert...");try{await o({userProfile:d,idToken:c.current,saved_item_id:null==u?void 0:u.saved_item_id,alert_id:m[0].alert_id,event:{emails:t,only_alert_on_triggered_runs:b}}).unwrap(),X.Am.success("Email removed and alert updated successfully.",{id:e})}catch(t){X.Am.error("Failed to update alert.",{id:e})}}else X.Am.error("No alert exists to update.")},[v,m,i,o,d,c,null==u?void 0:u.saved_item_id,j,b]),T=(0,K.useCallback)(async e=>{_(e);let t={emails:v,only_alert_on_triggered_runs:e};if(m.length>0){let e=X.Am.loading("Updating alert...");try{await o({userProfile:d,idToken:c.current,saved_item_id:null==u?void 0:u.saved_item_id,alert_id:m[0].alert_id,event:t}).unwrap(),X.Am.success("Alert updated successfully.",{id:e})}catch(t){X.Am.error("Failed to update alert.",{id:e})}}else{let e=X.Am.loading("Creating alert...");try{await l({userProfile:d,idToken:c.current,saved_item_id:null==u?void 0:u.saved_item_id,alert_type:"email",event:t}).unwrap(),X.Am.success("Alert created successfully.",{id:e})}catch(t){X.Am.error("Failed to create alert.",{id:e})}}},[m,l,o,d,c,null==u?void 0:u.saved_item_id,v]);return(0,S.jsxs)(eq.Vq,{open:s,onOpenChange:n,children:[a&&(0,S.jsx)(eq.hg,{asChild:!0,children:a}),(0,S.jsxs)(eq.cZ,{className:"flex max-h-[80vh] max-w-xl min-w-xl overflow-y-visible",children:[(0,S.jsxs)(eq.a7,{children:[(0,S.jsxs)("div",{className:"w-full",children:[(0,S.jsxs)(eq.fK,{children:[(0,S.jsx)(eq.$N,{children:m.length>0?"Edit ".concat(g.charAt(0).toUpperCase()+g.slice(1)," Alert"):"Create ".concat(g.charAt(0).toUpperCase()+g.slice(1)," Alert")}),(0,S.jsx)(eq.Be,{children:"email"===g?"Receive email notifications on flow run failures.":"Configure your alert settings."})]}),(0,S.jsxs)("div",{className:"mt-4 flex flex-col gap-4",children:[(0,S.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,S.jsx)("label",{className:"text-muted-foreground text-sm font-medium",children:"Add Email"}),(0,S.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,S.jsx)(td,{value:y,setValue:w,placeholder:"user@example.com",showOwnEmail:!0}),(0,S.jsx)(el.zx,{disabled:""===y.trim(),onClick:e=>C(e),variant:"secondary",children:"Add"})]}),N&&(0,S.jsx)("p",{className:"text-destructive-foreground mt-1 text-sm",children:N})]}),(0,S.jsxs)("div",{className:"flex items-center justify-between",children:[(0,S.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1 text-sm font-medium",children:[(0,S.jsx)("span",{className:"text-muted-foreground",children:"Alert only on trigger-based failures"}),(0,S.jsx)(iR.Z,{title:"Only receive alerts when workflows fail during externally triggered runs (webhooks, Gmail, Slack, etc.). Manual 'Run' button failures won't send alerts.",arrow:!0,placement:"top",children:(0,S.jsx)(e$.Z,{className:"size-3"})})]}),(0,S.jsx)(eX.r,{checked:b,disabled:0===v.length,onCheckedChange:T,name:"onlyAlertOnTriggeredRuns"})]})]})]}),v.length>0&&(0,S.jsxs)("div",{className:"scrollbar-thin flex max-h-64 flex-col gap-2 overflow-y-auto",children:[(0,S.jsx)("h4",{className:"text-muted-foreground text-sm font-medium",children:"Email Addresses"}),(0,S.jsx)("ul",{className:"flex flex-col gap-2",children:v.map((e,t)=>(0,S.jsxs)("li",{className:"flex items-center justify-between",children:[(0,S.jsx)("span",{className:"truncate text-sm text-ellipsis",children:e}),(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-xs",onClick:e=>{e.stopPropagation(),e.preventDefault(),I(t)},accent:"destructive",children:(0,S.jsx)(iL.Z,{className:"h-4 w-4"})})]},t))})]})]}),(0,S.jsx)(eq.cN,{children:(0,S.jsx)(eq.GG,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"outline",children:"Close"})})})]})]})});iG.displayName="CreateAlertDialog";var iU=e=>{let{align:t="start",className:r,...a}=e,{currentProject:s}=(0,e0.d2)(),{userProfile:n,idTokenRef:l}=(0,ec.H)(),o=(0,ez.CG)(R.z4),i=(0,ez.CG)(R.LA),d=(null==o?void 0:o.author_id)&&(o.author_id===(null==n?void 0:n.user_id)||o.author_id===(null==s?void 0:s.project_id)),c=!(null==o?void 0:o.is_saved())||!n.validateUserSubscriptionTier("starter"),u=(null==i?void 0:i.author_id)&&(i.author_id===(null==n?void 0:n.user_id)||i.author_id===(null==s?void 0:s.project_id)),m=(0,K.useMemo)(()=>n.validateUserSubscriptionTier("starter")?(null==o?void 0:o.is_saved())?d?null:"You need to clone this before creating an alert!":"You need to save this workbook before creating an alert!":"Upgrade to a premium plan to create alerts.",[n,o,d]),{data:p,isLoading:x,isError:h,refetch:g}=(0,iO.TZ)({saved_item_id:null==o?void 0:o.saved_item_id,flowbook_id:null==i?void 0:i.flowbook_id,userProfile:n,idToken:l.current},{skip:!(null==n?void 0:n.user_id)||!!((null==i?void 0:i.flowbook_id)&&!u)||!!((null==o?void 0:o.saved_item_id)&&!d)||!(null==i?void 0:i.flowbook_id)&&!(null==o?void 0:o.saved_item_id),selectFromResult:e=>{let{data:t,isLoading:r,isError:a}=e;return{data:(null==t?void 0:t[null==o?void 0:o.saved_item_id])||[],isLoading:r,isError:a}}});return(0,S.jsxs)(ah.J2,{children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(ah.xo,{asChild:!0,children:(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-xs",disabled:c,className:(0,eu.cn)("text-muted-foreground hover:text-pink-500",p.length>0&&"text-pink-500",c&&"text-muted-foreground! pointer-events-auto! hover:bg-transparent"),children:(0,S.jsx)(iZ.Z,{})})})}),m&&(0,S.jsx)(eo._v,{children:m})]}),(0,S.jsxs)(ah.yk,{align:t,className:(0,eu.cn)("flex w-64 flex-col p-0",r),...a,children:[(0,S.jsxs)("div",{className:"flex items-center justify-between px-3 py-1.5 text-sm font-medium",children:[(0,S.jsx)("p",{children:"Alerts"}),(0,S.jsx)("div",{className:"flex items-center gap-1",children:(0,S.jsx)(iG,{children:(0,S.jsxs)(el.zx,{variant:"ghost",size:"icon-xs",className:"text-muted-foreground text-xs",disabled:c,children:[0===p.length&&(0,S.jsx)(er.Z,{}),p.length>0&&(0,S.jsx)(aL.Z,{})]})})})]}),(0,S.jsx)(ta.Z,{}),(0,S.jsx)("div",{className:"p-3",children:(0,S.jsx)(iP,{alerts:p,alertsLoading:x,alertsError:h,refetchAlerts:g})})]})]})},iB=()=>{let{handleStartPipeline:e}=(0,rD.wL)(),{currentProject:t}=(0,e0.d2)(),{userProfile:r}=(0,ec.H)(),a=(0,K.useRef)(null),s=(0,Q.v9)(R.AV),n=(0,Q.v9)(eb.Me),l=(0,Q.v9)(R.fK),o=(0,Q.v9)(eb.qf),i=(0,Q.I0)(),{addNewNode:d}=(0,rg.A)(n),c=(0,K.useCallback)(()=>{let e=window.location.href;navigator.clipboard.writeText(e).then(()=>{tN.ZP.success("Shareable link copied to clipboard!")})},[]),u=()=>{i((0,G.de)(!0))},m=(0,K.useCallback)(async(e,t)=>{if(!n)return;let r=n.screenToFlowPosition({x:window.innerWidth/2,y:window.innerHeight/3}),a={x:r.x+(Math.random()-.5)*200,y:r.y+(Math.random()-.5)*200};await d(e,a,t)},[n,d]),p=(0,K.useCallback)(async()=>{let e=new eV.Form({form_id:(0,lt.RL)(),title:"",description:"",header_image:"",icon:"",form_elements:[],is_active:!0,created_ts:new Date,author_id:(null==t?void 0:t.project_id)||r.user_id,saved_item_id:s});await m(e,rf.Jq.Form)},[null==t?void 0:t.project_id,s,m,r.user_id]);return(0,S.jsxs)("div",{className:"border-border bg-background pointer-events-auto flex w-full items-center justify-between border-b px-4 py-2 md:hidden",children:[(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)(es(),{href:"/hub",passHref:!0,children:(0,S.jsx)(el.zx,{size:"icon",className:"text-foreground rounded-lg hover:text-pink-400",variant:"ghost",children:(0,S.jsx)(et.Z,{})})}),(0,S.jsxs)("span",{className:"flex items-center gap-2",children:[(0,S.jsx)(ig,{ref:a}),(0,S.jsx)(iU,{align:"center"})]}),(0,S.jsxs)(tc.h_,{children:[(0,S.jsx)(tc.$F,{children:(0,S.jsx)("div",{className:"hover:bg-muted !m-0 cursor-pointer",children:(0,S.jsx)(nq.Z,{className:"text-muted-foreground !m-0 h-5.5 w-5.5"})})}),(0,S.jsx)(tc.AW,{className:"border-border bg-background z-50 w-[200px] rounded-lg border shadow-lg",children:(0,S.jsxs)("div",{className:"p-2",children:[(0,S.jsxs)(tc.Xi,{onClick:()=>{var e;null===(e=a.current)||void 0===e||e.setIsEditingName(!0)},children:[(0,S.jsx)(im.Z,{className:"h-5 w-5"}),"Rename"]}),(0,S.jsxs)(tc.Xi,{onClick:()=>{c()},children:[(0,S.jsx)(eL.Z,{}),"Copy URL"]}),(0,S.jsxs)(tc.Xi,{onClick:()=>{o?u():p()},children:[(0,S.jsx)(ip.Z,{}),o?"Edit Interface":"Add Interface"]}),(0,S.jsx)(tg,{children:(0,S.jsxs)(tc.Xi,{children:[(0,S.jsx)(ix.Z,{}),"Share â€¢ Public"]})}),(0,S.jsxs)(tc.Xi,{onClick:()=>{localStorage.setItem("nodeMenuCategory","Triggers"),localStorage.setItem("nodeMenuCategoryIcon","Radar"),window.dispatchEvent(new Event("nodeMenuCategoryChanged"))},children:[(0,S.jsx)(ih.Z,{}),"Add Trigger"]})]})})]})]}),(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)(lH,{}),(0,S.jsx)(iM,{isAnyPipelineChanged:l}),(0,S.jsx)(r4.Z,{startPipelineRun:e,size:"icon-sm"})]})]})},iV=r(25141),iW=r(66525),iH=r(14582),iJ=r(78618),iq=r(91733),iK=r(84283),iY=e=>{var t;let{baseUrlWithQueryParams:r,apiKey:a,shouldRegeneratePipeline:s}=e,{resolvedTheme:n}=(0,a1.F)(),l=(0,ez.CG)(eb.lF),[o,i]=(0,K.useState)("cURL"),[d,c]=(0,K.useState)([]);(0,K.useEffect)(()=>{s&&c((0,nD.uL)(l.filter(e=>"Input"===e.data.name)))},[s,l]);let u=e=>{let t=e.parameters.inputs;return t?Object.values((0,rO.mG)(t)).map(e=>[e.input_name||"",e.default_value||""]):[]},m=Object.fromEntries(d.flatMap(e=>(0,rO.yp)(e.version||"v0_01","v0_09")?u(e):[[e.parameters.input_name||"input",e.parameters.default_value||""]])),p=[{name:"cURL",language:"bash",code:'curl -X POST \\\n  "'.concat(r,'" \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer ').concat(a,"\" \\\n  -d '").concat(JSON.stringify(m),"'")},{name:"Python",language:"python",code:'import requests\n  \n  url = "'.concat(r,'"\n  \n  payload = ').concat(JSON.stringify(m),'\n  headers = {\n    "Content-Type": "application/json",\n    "Authorization": "Bearer ').concat(a,'"\n  }\n  \n  response = requests.request("POST", url, json=payload, headers=headers)\n  \n  print(response.text)')},{name:"JavaScript",language:"javascript",code:"const options = {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': 'Bearer ".concat(a,"'\n    },\n    body: JSON.stringify(").concat(JSON.stringify(m),")\n  };\n  \n  fetch('").concat(r,"', options)\n    .then(response => response.json())\n    .then(response => console.log(response))\n    .catch(err => console.error(err));")},{name:"Java",language:"java",code:'HttpResponse<String> response = Unirest.post("'.concat(r,'")\n    .header("Content-Type", "application/json")\n    .header("Authorization", "Bearer ').concat(a,'")\n    .body("').concat(JSON.stringify(m).replace(/"/g,'\\"'),'")\n    .asString();')},{name:"C++",language:"clike",code:'#include <curl/curl.h>\n  \n  CURL *curl = curl_easy_init();\n  \n  if(curl) {\n    curl_easy_setopt(curl, CURLOPT_URL, "'.concat(r,'");\n    curl_easy_setopt(curl, CURLOPT_POSTFIELDS, \n      "').concat(JSON.stringify(m).replace(/"/g,'\\"'),'"\n    );\n    struct curl_slist *headers = NULL;\n    headers = curl_slist_append(headers, "Content-Type: application/json");\n    headers = curl_slist_append(headers, "Authorization: Bearer ').concat(a,'");\n    curl_easy_setopt(curl, CURLOPT_HTTPHEADER, headers);\n    CURLcode res = curl_easy_perform(curl);\n    curl_easy_cleanup(curl);\n  }')}],{isCopied:x,handleCopyText:h}=(0,eB.Z)((null===(t=p.find(e=>e.name===o))||void 0===t?void 0:t.code)||"");return(0,S.jsxs)(iH.Zb,{children:[(0,S.jsxs)(iH.Ol,{children:[(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)(aR.Z,{className:"text-primary h-5 w-5"}),(0,S.jsx)(iH.ll,{className:"text-lg",children:"Code Examples"})]}),(0,S.jsx)(iH.SZ,{children:"Integrate your pipeline into applications using these code snippets:"})]}),(0,S.jsx)(iH.aY,{children:a?(0,S.jsxs)(eZ.mQ,{value:o,onValueChange:i,className:"space-y-4",children:[(0,S.jsx)(eZ.dr,{className:"flex",children:p.map(e=>(0,S.jsx)(eZ.SP,{value:e.name,size:"sm",className:"flex-grow",children:e.name},e.name))}),p.map(e=>(0,S.jsx)(eZ.nU,{value:e.name,children:(0,S.jsxs)("div",{className:"relative overflow-hidden rounded-lg border",children:[(0,S.jsx)(iq.Z,{language:e.language,style:"dark"===n?iK.pJ:iK.Yn,customStyle:{fontSize:"0.875rem",lineHeight:"1.5rem",margin:0,padding:"1rem"},showLineNumbers:"cURL"!==e.name,children:e.code}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{onClick:h,variant:"ghost",size:"icon-sm",disabled:x,className:"absolute top-2 right-2 opacity-70 hover:opacity-100",children:x?(0,S.jsx)(eR.Z,{size:14,className:"text-success-foreground"}):(0,S.jsx)(eF.Z,{size:14})})}),(0,S.jsx)(eo._v,{children:"Copy code to clipboard"})]})]})},e.name))]}):(0,S.jsx)("div",{className:"text-muted-foreground flex h-48 flex-col items-center justify-center",children:'No API key exists for the workspace. Click "Generate API Key" to get started.'})})]})},i$=r(52790),iQ=r(77311),iX=e=>{let{baseUrl:t,queryParams:r,apiKey:a,baseUrlWithQueryParams:s,useAuthHeader:n,setUseAuthHeader:l}=e,o=n?s:"".concat(t,"?api_key=").concat(a,"&").concat(r),{isCopied:i,handleCopyText:d}=(0,eB.Z)(o),{isCopied:c,handleCopyText:u}=(0,eB.Z)("Authorization: Bearer ".concat(a));return(0,S.jsxs)(iH.Zb,{children:[(0,S.jsxs)(iH.Ol,{children:[(0,S.jsxs)("div",{className:"flex justify-between",children:[(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)(i$.Z,{className:"text-primary h-5 w-5"}),(0,S.jsx)(iH.ll,{className:"text-lg",children:"Webhook URL"})]}),(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)(iQ.X,{id:"auth-header-mode",checked:n,onCheckedChange:e=>l(!0===e),disabled:!a}),(0,S.jsx)(of._,{htmlFor:"auth-header-mode",className:(0,eu.cn)("text-sm",!n&&"text-muted-foreground"),children:"Use authorization header instead of API key in URL"})]})]}),(0,S.jsx)(iH.SZ,{children:"Use this URL to trigger your pipeline from external services like Zapier, webhooks, or any HTTP client!"})]}),(0,S.jsxs)(iH.aY,{className:"space-y-4",children:[(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)(ax.I,{value:a?o:'No API key exists for the workspace. Click "Generate API Key" to get started.',className:"flex-1 font-mono text-sm focus-visible:ring-0",readOnly:!0,disabled:!a}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{onClick:d,variant:i?"ghost":"secondary",size:"icon",disabled:i||!a,className:"shrink-0",children:i?(0,S.jsx)(eR.Z,{size:16,className:"text-success-foreground"}):(0,S.jsx)(eF.Z,{size:16})})}),(0,S.jsx)(eo._v,{children:(0,S.jsx)("p",{children:i?"Copied!":"Copy to clipboard"})})]})]}),n&&(0,S.jsxs)("div",{className:"bg-muted space-y-2 rounded-lg p-4",children:[(0,S.jsx)("p",{className:"text-sm",children:"Add this header to your requests:"}),(0,S.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,S.jsx)(ax.I,{value:"Authorization: Bearer ".concat(a),className:"focus-visible:ring-0",readOnly:!0}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{onClick:u,variant:"ghost",size:"icon",disabled:c,children:c?(0,S.jsx)(eR.Z,{className:"text-success-foreground"}):(0,S.jsx)(eF.Z,{})})}),(0,S.jsx)(eo._v,{children:"Copy header to clipboard"})]})]})]})]})]})},i0=e=>{let{dialogOpen:t}=e,{userProfile:r,idTokenRef:a}=(0,ec.H)(),s=(0,ez.CG)(R.z4),{currentProject:n}=(0,e0.d2)(),[l,{isLoading:o,error:i}]=(0,J.Ve)(),[d,c]=(0,K.useState)("personal"),[u,m]=(0,K.useState)(!1),{data:p,isLoading:x}=(0,J.Ci)({secretType:"agenthub_api_key",userProfile:r,idToken:a.current},{skip:!1}),{data:h,isLoading:g}=(0,J.Ci)({secretType:"agenthub_api_key",projectId:null==n?void 0:n.project_id,userProfile:r,idToken:a.current},{skip:!(null==n?void 0:n.project_id)}),f=!!n&&(0,iJ.h)(n,r.user_email),v=n&&(!f||r.is_workspace_credential_adding_restricted),j=x||g,b=j||o,_=v&&"workspace"===d,y="".concat(ed.CT,"/api/v1/start_pipeline"),w="user_id=".concat(r.user_id,"&saved_item_id=").concat(s.saved_item_id)+(n?"&project_id=".concat(n.project_id):""),N="".concat(y,"?").concat(w),k="personal"===d?p:h;return(0,S.jsx)("div",{className:"space-y-4",children:j?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(iH.Zb,{children:[(0,S.jsxs)(iH.Ol,{children:[(0,S.jsx)(tu.O,{className:"h-6 w-32"}),(0,S.jsx)(tu.O,{className:"h-4 w-80"})]}),(0,S.jsx)(iH.aY,{className:"space-y-4",children:(0,S.jsx)(tu.O,{className:"h-10 w-full"})})]}),(0,S.jsxs)(iH.Zb,{children:[(0,S.jsxs)(iH.Ol,{children:[(0,S.jsx)(tu.O,{className:"h-6 w-32"}),(0,S.jsx)(tu.O,{className:"h-4 w-96"})]}),(0,S.jsxs)(iH.aY,{className:"space-y-4",children:[(0,S.jsx)(tu.O,{className:"h-10 w-full"}),(0,S.jsx)(tu.O,{className:"h-48 w-full"})]})]})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:"flex items-center justify-between",children:[(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[n&&(0,S.jsxs)(iW.Ph,{value:d,onValueChange:e=>c(e),disabled:b,children:[(0,S.jsx)(iW.i4,{className:"w-52",children:(0,S.jsx)(iW.ki,{placeholder:"Select API key type"})}),(0,S.jsxs)(iW.Bw,{children:[(0,S.jsx)(iW.Ql,{value:"personal",children:"Use Personal API Key"}),(0,S.jsx)(iW.Ql,{value:"workspace",children:"Use Workspace API Key"})]})]}),!k&&!j&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("span",{children:(0,S.jsx)(el.zx,{variant:"default",onClick:()=>{b||l({secret:{secret_type:"agenthub_api_key",project_id:"workspace"===d?null==n?void 0:n.project_id:void 0,value:(0,rW.NV)()},userProfile:r,idToken:a.current})},disabled:b||_,loading:o,children:"Generate API Key"})})}),_&&(0,S.jsx)(eo._v,{children:(0,S.jsx)("p",{children:f?"A workspace admin has restricted workspace credential creation":"Only workspace admins can generate a workspace API key"})})]}),j&&(0,S.jsxs)("div",{className:"text-muted-foreground flex items-center justify-center gap-1",children:[(0,S.jsx)(tb.Z,{className:"h-4 w-4 animate-spin"}),"Loading webhook configuration..."]})]}),(0,S.jsx)(el.zx,{variant:"outline",asChild:!0,children:(0,S.jsxs)(es(),{href:"https://docs.gumloop.com/api-reference/getting-started#webhooks",target:"_blank",children:[(0,S.jsx)(eG.Z,{size:14,className:"mr-2"}),"Need help? View Documentation"]})})]}),!!i&&(0,S.jsx)("div",{className:"text-red-500",children:"Error generating Gumloop API key. Please try again."}),(0,S.jsx)(iX,{baseUrl:y,queryParams:w,apiKey:k,baseUrlWithQueryParams:N,useAuthHeader:u,setUseAuthHeader:m}),(0,S.jsx)(iY,{baseUrlWithQueryParams:N,apiKey:k,shouldRegeneratePipeline:t})]})})},i1=e=>{let{children:t,open:r,onOpenChange:a}=e,[s,n]=(0,eK.P)({open:r,onOpenChange:a}),{userProfile:l}=(0,ec.H)(),{currentProject:o}=(0,e0.d2)();return(0,S.jsxs)(eq.Vq,{open:s,onOpenChange:n,children:[t&&(0,S.jsx)(eq.hg,{asChild:!0,children:t}),(0,S.jsx)(eq.cZ,{className:"min-h-2xl h-4xl max-w-4xl! min-w-xl!",children:(0,S.jsxs)(eq.a7,{children:[(0,S.jsx)(eq.fK,{children:(0,S.jsx)(eq.$N,{children:o?"Select an API key to start your flow from an external service":"Start your flow from an external service"})}),(0,S.jsx)(eq.Be,{children:l.validateUserSubscriptionTier("starter")?(0,S.jsx)("div",{className:"flex w-full items-start",children:(0,S.jsx)("div",{className:"h-full flex-grow overflow-auto",children:(0,S.jsx)(i0,{dialogOpen:!!s})})}):(0,S.jsxs)("div",{className:"flex flex-col items-center justify-center gap-6 p-8 text-center",children:[(0,S.jsx)("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-gradient-to-br from-pink-500 to-blue-500",children:(0,S.jsx)(an.Z,{className:"text-background h-8 w-8"})}),(0,S.jsxs)("div",{className:"space-y-3",children:[(0,S.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,S.jsx)("h3",{className:"text-foreground text-xl font-semibold",children:"Premium Feature"}),(0,S.jsx)(eU.C,{variant:"pink",size:"sm",children:"Upgrade Required"})]}),(0,S.jsx)("p",{className:"text-muted-foreground max-w-md",children:"Triggers allow you to start your flows from external services like webhooks, forms, and APIs. Upgrade to a premium plan to unlock this powerful feature."})]}),(0,S.jsxs)(el.zx,{onClick:()=>window.open("/pricing","_blank"),className:"gap-2",children:[(0,S.jsx)(an.Z,{}),"Upgrade to Premium",(0,S.jsx)(s5.Z,{})]})]})})]})})]})},i2=()=>{let e=(0,ez.CG)(R.AV),t=(0,ez.CG)(t=>(0,a9.SQ)(t,e)),r=(0,en.useSearchParams)(),a=(0,K.useMemo)(()=>null==t?void 0:t.getFormattedCreatedTime(),[t]);if(!t)return null;let s=r.has("workbook_id")||r.has("flow_id")||r.has("agent_id"),n=r.has("run_id");return s&&n?(0,S.jsxs)("div",{className:"flex min-w-0 items-center gap-1 px-2 text-xs",children:[(0,S.jsxs)("span",{className:"text-muted-foreground truncate",children:["Run from ",a]}),(0,S.jsx)("span",{className:"flex-shrink-0 text-gray-400",children:"â€¢"}),(0,S.jsx)("a",{href:"#",className:"flex-shrink-0 text-pink-400 hover:underline",onClick:e=>{e.preventDefault();let t=new URLSearchParams(r.toString());t.delete("run_id");let a=t.toString(),s="".concat(window.location.pathname).concat(a?"?".concat(a):"");window.open(s,"_blank")},children:"See latest version"})]}):null},i5=r(84385),i4=r(92458),i3=r.n(i4),i9=e=>{var t;let{trigger:r,index:a}=e,s=function(e){var t,r,a,s,n,l,o,i,d,c,u,m,p,x,h,g,f,v,j,b,_,y,w,N,k,C,I,T,S,E,M,A,O,Z,z,P,D,L,R,F,G,U,B,V,W,H,J,q,K,Y,$,Q,X,ee,et,er,ea,es,en,el,eo,ei,ed,ec,eu,em,ep,ex,eh,eg,ef,ev,ej,eb,e_,ey,ew,eN,ek,eC,eI,eT,eS,eE,eM,eA,eO,eZ,ez,eP,eD,eL,eR,eF,eG,eU,eB,eV,eW,eH,eJ,eq,eK,eY,e$,eQ,eX,e0;let e1=[];return(e1.push({label:"Created",value:(0,e5.p6)(null!==(a=null==e?void 0:null===(r=e.created_ts)||void 0===r?void 0:null===(t=r.toISOString)||void 0===t?void 0:t.call(r))&&void 0!==a?a:"")}),"incoming_message_slack"===e.trigger_type)?(e1.push({label:"Channel",value:null!==(i=null==e?void 0:null===(s=e.event)||void 0===s?void 0:s.channel_name)&&void 0!==i?i:"N/A"}),(null==e?void 0:null===(n=e.event)||void 0===n?void 0:n.channel_id)&&e1.push({label:"Channel ID",value:null==e?void 0:null===(d=e.event)||void 0===d?void 0:d.channel_id}),e1.push({label:"Ignore Bot Messages",value:(null==e?void 0:null===(l=e.event)||void 0===l?void 0:l.ignore_bot_messages)?"Yes":"No"}),(null==e?void 0:null===(o=e.event)||void 0===o?void 0:o.ignore_replies)!==void 0&&e1.push({label:"Ignore Replies",value:(null==e?void 0:null===(c=e.event)||void 0===c?void 0:c.ignore_replies)?"Yes":"No"})):"incoming_email_gmail"===e.trigger_type?(e1.push({label:"Label",value:null!==(x=null==e?void 0:null===(u=e.event)||void 0===u?void 0:u.label_name)&&void 0!==x?x:""}),(null==e?void 0:null===(m=e.event)||void 0===m?void 0:m.expiry_ts)&&e1.push({label:"Expiry",value:(0,e5.p6)(null==e?void 0:null===(h=e.event)||void 0===h?void 0:h.expiry_ts)}),(null==e?void 0:null===(p=e.event)||void 0===p?void 0:p.historyId)&&e1.push({label:"History ID",value:null==e?void 0:null===(g=e.event)||void 0===g?void 0:g.historyId})):"incoming_file_gdrive"===e.trigger_type?(e1.push({label:"Folder ID",value:null!==(N=null==e?void 0:null===(f=e.event)||void 0===f?void 0:f.folder_id)&&void 0!==N?N:""}),(null==e?void 0:null===(v=e.event)||void 0===v?void 0:v.channelId)&&e1.push({label:"Channel ID",value:null==e?void 0:null===(k=e.event)||void 0===k?void 0:k.channelId}),(null==e?void 0:null===(j=e.event)||void 0===j?void 0:j.expiration)&&e1.push({label:"Expiration",value:null==e?void 0:null===(C=e.event)||void 0===C?void 0:C.expiration}),(null==e?void 0:null===(_=e.event)||void 0===_?void 0:null===(b=_.processed_file_ids)||void 0===b?void 0:b.length)&&e1.push({label:"Processed Files",value:null!==(E=null==e?void 0:null===(S=e.event)||void 0===S?void 0:null===(T=S.processed_file_ids)||void 0===T?void 0:null===(I=T.length)||void 0===I?void 0:I.toString())&&void 0!==E?E:"0"}),(null==e?void 0:null===(y=e.event)||void 0===y?void 0:y.startPageToken)&&e1.push({label:"Start Page Token",value:null==e?void 0:null===(M=e.event)||void 0===M?void 0:M.startPageToken}),(null==e?void 0:null===(w=e.event)||void 0===w?void 0:w.read_all_subfolders)&&e1.push({label:"Read All Subfolders",value:(null==e?void 0:null===(A=e.event)||void 0===A?void 0:A.read_all_subfolders)?"Yes":"No"})):"polling_record_airtable"===e.trigger_type||"incoming_record_airtable"===e.trigger_type?(e1.push({label:"Base",value:null!==(P=null==e?void 0:null===(O=e.event)||void 0===O?void 0:O.base_name)&&void 0!==P?P:""}),e1.push({label:"Table",value:null!==(D=null==e?void 0:null===(Z=e.event)||void 0===Z?void 0:Z.table_name)&&void 0!==D?D:""}),e1.push({label:"View",value:null!==(L=null==e?void 0:null===(z=e.event)||void 0===z?void 0:z.view_name)&&void 0!==L?L:""})):"incoming_submission_typeform"===e.trigger_type?(e1.push({label:"Form Title",value:null!==(U=null==e?void 0:null===(R=e.event)||void 0===R?void 0:R.form_title)&&void 0!==U?U:""}),e1.push({label:"Form ID",value:null!==(B=null==e?void 0:null===(F=e.event)||void 0===F?void 0:F.form_id)&&void 0!==B?B:""}),(null==e?void 0:null===(G=e.event)||void 0===G?void 0:G.webhook_id)&&e1.push({label:"Webhook ID",value:null==e?void 0:null===(V=e.event)||void 0===V?void 0:V.webhook_id})):"polling_page_notion"===e.trigger_type||"incoming_page_notion"===e.trigger_type?e1.push({label:"Database ID",value:null!==(H=null==e?void 0:null===(W=e.event)||void 0===W?void 0:W.database_id)&&void 0!==H?H:""}):"polling_google_calendar"===e.trigger_type?(e1.push({label:"Calendar ID",value:null!==(Y=null==e?void 0:null===(J=e.event)||void 0===J?void 0:J.calendar_id)&&void 0!==Y?Y:""}),(null==e?void 0:null===(q=e.event)||void 0===q?void 0:q.minutes_before_event)!==void 0&&e1.push({label:"Minutes Before Event",value:null!==(X=null==e?void 0:null===(Q=e.event)||void 0===Q?void 0:null===($=Q.minutes_before_event)||void 0===$?void 0:$.toString())&&void 0!==X?X:"0"}),(null==e?void 0:null===(K=e.event)||void 0===K?void 0:K.trigger_mode)&&e1.push({label:"Trigger Mode",value:null==e?void 0:null===(ee=e.event)||void 0===ee?void 0:ee.trigger_mode})):"polling_create_row_gsheets"===e.trigger_type||"polling_create_or_update_row_gsheets"===e.trigger_type?(e1.push({label:"Sheet Name",value:null!==(en=null==e?void 0:null===(et=e.event)||void 0===et?void 0:et.sheet_name)&&void 0!==en?en:""}),e1.push({label:"Trigger Mode",value:null!==(el=null==e?void 0:null===(er=e.event)||void 0===er?void 0:er.trigger_mode)&&void 0!==el?el:""}),(null==e?void 0:null===(ea=e.event)||void 0===ea?void 0:ea.row_hashes)&&Object.keys(null!==(eo=null==e?void 0:null===(es=e.event)||void 0===es?void 0:es.row_hashes)&&void 0!==eo?eo:{}).length>0&&e1.push({label:"Tracked Rows",value:Object.keys(null!==(ed=null==e?void 0:null===(ei=e.event)||void 0===ei?void 0:ei.row_hashes)&&void 0!==ed?ed:{}).length.toString()})):"incoming_submission_gforms"===e.trigger_type?(e1.push({label:"Form ID",value:null!==(ep=null==e?void 0:null===(ec=e.event)||void 0===ec?void 0:ec.form_id)&&void 0!==ep?ep:""}),(null==e?void 0:null===(eu=e.event)||void 0===eu?void 0:eu.expiry_ts)&&e1.push({label:"Expiry",value:(0,e5.QI)(null==e?void 0:null===(ex=e.event)||void 0===ex?void 0:ex.expiry_ts)}),(null==e?void 0:null===(em=e.event)||void 0===em?void 0:em.watch_id)&&e1.push({label:"Watch ID",value:null==e?void 0:null===(eh=e.event)||void 0===eh?void 0:eh.watch_id})):"polling_hubspot_list"===e.trigger_type?(e1.push({label:"List ID",value:null!==(eb=null==e?void 0:null===(eg=e.event)||void 0===eg?void 0:eg.list_id)&&void 0!==eb?eb:""}),e1.push({label:"Object Type",value:null!==(e_=null==e?void 0:null===(ef=e.event)||void 0===ef?void 0:ef.object_type)&&void 0!==e_?e_:""}),(null==e?void 0:null===(ej=e.event)||void 0===ej?void 0:null===(ev=ej.processed_record_ids)||void 0===ev?void 0:ev.length)&&e1.push({label:"Processed Records",value:null!==(ek=null==e?void 0:null===(eN=e.event)||void 0===eN?void 0:null===(ew=eN.processed_record_ids)||void 0===ew?void 0:null===(ey=ew.length)||void 0===ey?void 0:ey.toString())&&void 0!==ek?ek:"0"})):"agent"===e.trigger_type?e1.push({label:"Agent ID",value:null!==(eI=null==e?void 0:null===(eC=e.event)||void 0===eC?void 0:eC.agent_id)&&void 0!==eI?eI:""}):"time_based"===e.trigger_type?(e1.push({label:"Timezone",value:null!==(eM=null==e?void 0:null===(eT=e.event)||void 0===eT?void 0:eT.timezone)&&void 0!==eM?eM:""}),e1.push({label:"Frequency",value:(null==e?void 0:null===(eS=e.event)||void 0===eS?void 0:eS.cron_expression)?i3().toString(null==e?void 0:null===(eE=e.event)||void 0===eE?void 0:eE.cron_expression,{verbose:!0}):"Unknown"})):"incoming_booking_calendly"===e.trigger_type?e1.push({label:"Webhook URI",value:null!==(eO=null==e?void 0:null===(eA=e.event)||void 0===eA?void 0:eA.webhook_uri)&&void 0!==eO?eO:""}):"incoming_message_zendesk"===e.trigger_type||"incoming_ticket_zendesk"===e.trigger_type||"ticket_status_change_zendesk"===e.trigger_type?e1.push({label:"Trigger Mode",value:null!==(ez=null==e?void 0:null===(eZ=e.event)||void 0===eZ?void 0:eZ.trigger_mode)&&void 0!==ez?ez:""}):"polling_incident_incident_io"===e.trigger_type?((null==e?void 0:null===(eD=e.event)||void 0===eD?void 0:null===(eP=eD.severity_filter)||void 0===eP?void 0:eP.length)&&e1.push({label:"Severity Filter",value:null!==(eU=null==e?void 0:null===(eG=e.event)||void 0===eG?void 0:null===(eF=eG.severity_filter)||void 0===eF?void 0:eF.join(", "))&&void 0!==eU?eU:""}),(null==e?void 0:null===(eR=e.event)||void 0===eR?void 0:null===(eL=eR.mode_filter)||void 0===eL?void 0:eL.length)&&e1.push({label:"Mode Filter",value:null!==(eW=null==e?void 0:null===(eV=e.event)||void 0===eV?void 0:null===(eB=eV.mode_filter)||void 0===eB?void 0:eB.join(", "))&&void 0!==eW?eW:""})):"incoming_message_teams"===e.trigger_type&&(e1.push({label:"Channel",value:null!==(e$=null==e?void 0:null===(eH=e.event)||void 0===eH?void 0:eH.channel_name)&&void 0!==e$?e$:"N/A"}),(null==e?void 0:null===(eJ=e.event)||void 0===eJ?void 0:eJ.team_id)&&e1.push({label:"Team ID",value:null==e?void 0:null===(eQ=e.event)||void 0===eQ?void 0:eQ.team_id}),(null==e?void 0:null===(eq=e.event)||void 0===eq?void 0:eq.channel_id)&&e1.push({label:"Channel ID",value:null==e?void 0:null===(eX=e.event)||void 0===eX?void 0:eX.channel_id}),e1.push({label:"Ignore Bot Messages",value:(null==e?void 0:null===(eK=e.event)||void 0===eK?void 0:eK.ignore_bot_messages)?"Yes":"No"}),(null==e?void 0:null===(eY=e.event)||void 0===eY?void 0:eY.ignore_replies)!==void 0&&e1.push({label:"Ignore Replies",value:(null==e?void 0:null===(e0=e.event)||void 0===e0?void 0:e0.ignore_replies)?"Yes":"No"})),e1}(r);return(0,S.jsx)(ap.zF,{asChild:!0,children:(0,S.jsxs)("div",{className:"group flex flex-grow flex-col gap-1 rounded",children:[(0,S.jsxs)(ap.wy,{className:"group/collapsible-trigger hover:bg-muted/50 flex flex-grow items-center justify-between gap-2 rounded px-2 py-1 transition-colors",children:[(0,S.jsxs)("div",{className:"flex flex-grow items-center gap-2",children:[(0,S.jsx)("span",{className:"[&>*]:h-5 [&>*]:w-5",children:(0,S.jsx)(i5.Z,{triggerType:null!==(t=r.trigger_type)&&void 0!==t?t:"",size:16,fallbackIcon:(0,S.jsx)(ih.Z,{className:"h-5 w-5"})})}),(0,S.jsx)("span",{className:"truncate text-xs font-medium",children:tz.sv[r.trigger_type]})]}),(0,S.jsx)(tr.Z,{className:"text-muted-foreground ml-auto hidden h-4 w-4 transition-[rotate,color] duration-200 group-hover/collapsible-trigger:flex group-data-[state=open]/collapsible-trigger:rotate-90"})]}),(0,S.jsx)(ap.Fw,{className:"flex flex-col gap-1",children:(0,S.jsxs)("div",{className:"overflow-hidden pb-1",children:[s.map(e=>(0,S.jsxs)("p",{className:"text-muted-foreground px-2 text-xs",children:[(0,S.jsxs)("span",{className:"font-medium",children:[e.label,":"]})," ",e.value]},e.label)),(0,S.jsxs)("p",{className:"text-muted-foreground px-2 text-xs",children:[(0,S.jsx)("span",{className:"font-medium",children:"Created By:"})," ",(0,S.jsx)(es(),{href:r.creator_user_email?"mailto:".concat(r.creator_user_email):"#",className:"text-accent-foreground underline hover:no-underline",children:r.creatorDisplayName()})]})]})})]},r.trigger_id)})},i6=()=>{let e=(0,ez.CG)(A.$g),t=(0,ez.CG)(R.AV),r=(0,ez.CG)(e=>(0,tZ.K)(e,t)),a=[...new Set(r.map(e=>e.trigger_type))];return a&&0!==a.length||e?e?null:(0,S.jsxs)(ah.J2,{children:[(0,S.jsx)(ah.xo,{asChild:!0,children:(0,S.jsxs)(el.zx,{variant:"outline",className:"text-success-foreground gap-3",size:"sm",shadow:!0,children:[r.length," Trigger",r.length>1?"s":""," On",(0,S.jsx)("div",{className:"bg-border h-full w-px"}),(0,S.jsx)("div",{className:"flex items-center gap-1.5",children:a.map(e=>(0,S.jsx)("div",{className:"h-4 w-4",children:(0,S.jsx)(i5.Z,{triggerType:null!=e?e:"",size:16,fallbackIcon:(0,S.jsx)(tK.Z,{})})},e))})]})}),(0,S.jsxs)(ah.yk,{className:"flex w-64 flex-col p-0",align:"start",children:[(0,S.jsxs)("div",{className:"flex items-center justify-between px-3 py-1.5 text-sm font-medium",children:[(0,S.jsx)("p",{children:"Active triggers"}),(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-xs",className:"text-muted-foreground text-xs",onClick:()=>{localStorage.setItem("nodeMenuCategory","Triggers"),localStorage.setItem("nodeMenuCategoryIcon","Radar"),window.dispatchEvent(new Event("nodeMenuCategoryChanged"))},children:(0,S.jsx)(er.Z,{})})]}),(0,S.jsx)(ta.Z,{}),(0,S.jsx)(nx.E.div,{className:"flex flex-col gap-1 px-1 py-2",children:r.map((e,t)=>(0,S.jsx)(i9,{trigger:e,index:t},e.trigger_id))})]})]}):(0,S.jsxs)(el.zx,{size:"sm",variant:"outline",shadow:!0,onClick:()=>{localStorage.setItem("nodeMenuCategory","Triggers"),localStorage.setItem("nodeMenuCategoryIcon","Radar"),window.dispatchEvent(new Event("nodeMenuCategoryChanged"))},children:[(0,S.jsx)(tK.Z,{}),"Add Trigger"]})};let i8=(0,lw.j)("pointer-events-auto hidden items-center gap-2 p-2.5 pl-3 md:flex",{variants:{mode:{[f.DEFAULT]:"bg-elevated rounded-2xl border shadow-xs",[f.PREVIEW]:"",[f.GUMMIE]:"",[f.TEMPLATE]:""}}});var i7=(0,K.memo)(e=>{var t;let{mode:r}=e,a=(0,ez.CG)(R.BH),s=(0,ez.CG)(eb.Me),n=(0,ez.CG)(eb.qf),l=(0,ez.CG)(A.$g),o=(0,ez.CG)(R.aN),i=(0,ez.CG)(R.$f),{currentProject:d}=(0,e0.d2)(),{userProfile:c}=(0,ec.H)(),u=(0,ez.CG)(ew),{handleClickToAddNode:m}=(0,rg.A)(s),p=(0,ez.TL)(),x=(0,K.useCallback)(async()=>{var e;await m(new eV.Form({form_id:(0,lt.RL)(),title:"",description:"",header_image:"",icon:"",form_elements:[],is_active:!0,created_ts:new Date,author_id:(null==d?void 0:d.project_id)||c.user_id,saved_item_id:null==a?void 0:null===(e=a.savedItem)||void 0===e?void 0:e.saved_item_id}),rf.Jq.Form)},[null==d?void 0:d.project_id,null==a?void 0:null===(t=a.savedItem)||void 0===t?void 0:t.saved_item_id,c.user_id,m]),h=(0,K.useMemo)(()=>u===f.DEFAULT||u===f.GUMMIE,[u]),g=(0,K.useMemo)(()=>!l&&(!o||!i||(null==o?void 0:o.creator_user_id)===(null==c?void 0:c.user_id)),[l,i,null==c?void 0:c.user_id,o]);return(0,S.jsxs)("div",{className:i8({mode:r}),children:[g&&(0,S.jsxs)("div",{className:"group flex h-7 w-7 shrink-0 items-center justify-center",children:[(0,S.jsx)(lW.Z,{size:26,className:(0,eu.cn)(!l&&"group-hover:hidden"),noLink:l}),(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-sm",asChild:!0,className:(0,eu.cn)("hidden cursor-pointer group-hover:flex",l?"hover:bg-pink-200":""),children:(0,S.jsx)(es(),{href:"/hub",children:(0,S.jsx)(et.Z,{})})})]}),(0,S.jsxs)("span",{className:"flex w-full items-center gap-0.5 pr-2 lg:flex-grow",children:[(0,S.jsxs)("div",{className:"items-start-safe flex flex-col",children:[(0,S.jsx)(ig,{className:(0,eu.cn)(!h&&"max-w-md!")}),(0,S.jsx)(i2,{})]}),h&&(0,S.jsx)(iU,{})]}),h&&(0,S.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,S.jsxs)(el.zx,{variant:"outline",shadow:!0,onClick:n?()=>{p((0,G.de)(!0))}:x,size:"sm",children:[(0,S.jsx)(og.Z,{})," ",n?"Edit Interface":"Add Interface"]}),(0,S.jsx)(i6,{}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(i1,{children:(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{size:"icon-sm",variant:"outline",shadow:!0,children:(0,S.jsx)(iV.Z,{})})})}),(0,S.jsx)(eo._v,{children:"Webhooks"})]})]})]})}),de=r(82369),dt=r(15928),dr=r(16173),da=(0,K.memo)(()=>{let e=(0,Q.v9)(R.z4),t=(0,Q.v9)(eb.z6),r=(0,Q.v9)(t=>(0,a9.HM)(t,null==e?void 0:e.saved_item_id)),a=(0,Q.v9)(t=>(0,a9.iD)(t,null==e?void 0:e.saved_item_id)),{handleResumePipeline:s}=(0,rD.wL)(),n=a||!r,l=(0,K.useCallback)(async()=>{s(n)},[s,n]);return((0,K.useEffect)(()=>{let e=e=>{!(!e.key||e.target instanceof HTMLDivElement&&e.target.isContentEditable&&e.target.id.includes("note-editor"))&&(e.metaKey||e.ctrlKey)&&e.shiftKey&&"Enter"==e.key&&l()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l]),r)?(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsxs)(el.zx,{id:"resume-button",variant:"outline",onClick:l,shadow:!0,className:"hidden md:flex",size:"sm",disabled:t,children:[n?(0,S.jsx)(t_.Z,{}):(0,S.jsx)(dr.Z,{}),n?"Cancel":"Resume"]})}),(0,S.jsxs)(eo._v,{align:"end",side:"bottom",className:"flex flex-col gap-1",children:[n?"Cancel":"Run from a selected node using the current run's data up to that node",(0,S.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,S.jsx)(s4.Z,{children:(0,s4.V)()?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"Shift"})," +"," ",(0,S.jsx)(s4.Z,{children:(0,s4.V)()?"Return":"Enter"})]})]})]}):null}),ds=r(32655),dn=e=>{var t;let{currentSavedItem:r}=e,a=(0,Q.I0)(),s=(0,K.useCallback)(e=>{let t=new a$.g({...r,is_incognito:e});a((0,D.vE)({savedItemId:r.saved_item_id,savedItem:t}))},[r,a]),n=null!==(t=null==r?void 0:r.is_incognito)&&void 0!==t&&t;return(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{className:"flex h-full items-center",asChild:!0,children:(0,S.jsxs)("span",{className:"bg-muted/75 flex items-center gap-2 rounded-md p-1.5 text-xs",children:[(0,S.jsx)(ds.Z,{className:(0,eu.cn)("text-muted-foreground size-4",n&&"text-accent-foreground")}),(0,S.jsx)(eX.r,{checked:n,onCheckedChange:s})]})}),(0,S.jsxs)(eo._v,{children:["Incognito is currently ",n?"on":"off"]})]})};let dl=(0,lw.j)("pointer-events-auto hidden items-center gap-2.5 md:flex",{variants:{mode:{[f.DEFAULT]:"bg-elevated rounded-2xl border p-2.5 shadow-xs",[f.PREVIEW]:"",[f.GUMMIE]:"",[f.TEMPLATE]:""}}}),di=e=>{let{mode:t}=e,r=(0,ez.CG)(R.z4),a=(0,ez.CG)(e=>(0,a9.BI)(e,null==r?void 0:r.saved_item_id)),s=(0,ez.CG)(e=>(0,a9.u_)(e,null==r?void 0:r.saved_item_id)),n=(0,ez.CG)(R.fK),l=(0,ez.CG)(R.v9),o=(0,ez.CG)(R.ZA),i=(0,ez.CG)(R.QB),{isCopied:d,handleCopyText:c}=(0,eB.Z)(window.location.href,{successMessage:"Copied workbook link to clipboard"}),{userProfile:u}=(0,ec.H)(),{currentProject:m}=(0,e0.d2)(),{handleStartPipeline:p}=(0,rD.wL)(),x=(0,ez.TL)(),h=(0,ez.CG)(ew),g=(0,ez.CG)(R.LA),v=(0,ez.CG)(R.BH),j=(0,ez.CG)(eb.Z1),b=(0,ez.CG)(R.aN),_=(0,K.useMemo)(()=>h!==f.TEMPLATE&&!!b&&(b.status===tl.C.APPROVED||b.status===tl.C.DRAFT||(null==b?void 0:b.creator_user_id)===u.user_id),[b,u,h]),{label:y,badgeVariant:w}=(0,or.wp)(null==b?void 0:b.status),N=!(null==b?void 0:b.organization_id);return(0,S.jsxs)("div",{className:dl({mode:t}),children:[o&&t===f.DEFAULT&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsxs)(eU.C,{className:"text-success-foreground flex items-center gap-2 text-xs font-medium",variant:"success",size:"xs",children:[(0,S.jsx)(o1.Z,{className:"size-3.5 animate-pulse"}),"Live"]})}),(0,S.jsxs)(eo._v,{side:"bottom",children:["Saved changes go live immediately"," ",(0,S.jsx)(es(),{href:"https://docs.gumloop.com/core-concepts/checkpoint_history",className:"text-accent-foreground underline underline-offset-2",target:"_blank",children:"What is a live checkpoint?"})]})]}),t!==f.PREVIEW&&l&&(0,S.jsxs)(K.Fragment,{children:[_&&t!==f.GUMMIE&&!i&&(0,S.jsx)("button",{disabled:(null==b?void 0:b.creator_user_id)!==u.user_id,className:(null==b?void 0:b.creator_user_id)!==u.user_id?"cursor-default":"",onClick:()=>x((0,D.wW)(!0)),children:(0,S.jsxs)(eU.C,{variant:(null==b?void 0:b.status)===tl.C.APPROVED?N?"accent":"pink":w,children:[(null==b?void 0:b.creator_user_id)===u.user_id?(0,S.jsx)(de.Z,{size:10}):(0,S.jsx)(dt.Z,{size:10}),b&&ot.xh.includes(b.status)?y:(null==b?void 0:b.status)===tl.C.DRAFT?"Draft Template":N?"Community Template":"Template"]})}),u.validateUserSubscriptionTier("enterprise")&&v&&h!==f.TEMPLATE&&(0,S.jsx)(K.Fragment,{children:(0,S.jsx)(dn,{currentSavedItem:v.savedItem})}),h!==f.TEMPLATE&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(tg,{children:(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsxs)(el.zx,{variant:"outline",shadow:!0,size:"sm",disabled:!g.flowbook_id||!!(0,iS.r)(null==m?void 0:m.project_id,g.author_id,u.user_id),children:[(0,S.jsx)(ix.Z,{}),"Share"]})})}),(0,S.jsx)(eo._v,{children:"Share workbook"})]}),h!==f.TEMPLATE&&(0,S.jsx)(iM,{isAnyPipelineChanged:n}),(0,S.jsx)(r4.Z,{startPipelineRun:p,isDisabled:0===j}),!a&&!s&&(0,S.jsx)(da,{})]}),(t===f.PREVIEW||h===f.TEMPLATE)&&(0,S.jsx)(el.zx,{variant:"outline",size:"icon-sm",onClick:c,children:d?(0,S.jsx)(eR.Z,{}):(0,S.jsx)(eL.Z,{})})]})};di.displayName="PipelineRightHeader";var dd=(0,K.memo)(di);let dc=(0,lw.j)("z-100 flex w-full items-center justify-between transition-transform lg:shadow-none",{variants:{mode:{[f.GUMMIE]:"bg-background h-[var(--pipeline-header-height)] shrink-0 border-b px-3 pl-0",[f.PREVIEW]:"bg-background h-[var(--pipeline-header-height)] shrink-0 border-b px-3 pl-0",[f.DEFAULT]:"animate-in slide-in-from-top-3/4 fade-in-0 pointer-events-none absolute top-0 duration-1000 ease-in-out md:p-4",[f.TEMPLATE]:"bg-background h-[var(--pipeline-header-height)] shrink-0 border-b px-3 pl-0"}}});var du=(0,K.memo)(e=>{let{mode:t}=e,r=(0,n6.d)(),a=(0,ez.CG)(A.d5);return a===O.Cn.MANUAL_CUSTOM_NODE||a===O.Cn.CUSTOM_NODE_CONFIG?null:(0,S.jsx)("div",{className:dc({mode:t}),children:r?(0,S.jsx)(iB,{}):(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(i7,{mode:t}),(0,S.jsx)(dd,{mode:t})]})})});let dm={extension_new_flow:{type:"loom",url:"https://www.loom.com/embed/6b343be195ba4a55a66ce26894b303f9",title:"Browser Extension - Running Workflows"}};var dp=()=>{let e=(0,eM.useRouter)(),[t,r]=(0,K.useState)(!1),[a,s]=(0,K.useState)(null);return(0,K.useEffect)(()=>{let t=e.query.tutorial_video;t&&t in dm?(s(dm[t]),r(!0)):r(!1)},[e.query]),(0,S.jsx)(rS.Vq,{open:t,onOpenChange:()=>{r(!1);let{tutorial_video:t,...a}=e.query;e.replace({pathname:e.pathname,query:a},void 0,{shallow:!0})},children:(0,S.jsxs)(rS.cZ,{className:"w-full max-w-4xl p-6",children:[(0,S.jsx)("h2",{className:"mb-4 text-2xl font-bold text-gray-900",children:null==a?void 0:a.title}),a?"loom"===a.type?(0,S.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0},children:(0,S.jsx)("iframe",{src:"".concat(a.url,"?hide_owner=true&hide_share=true&hide_title=true&hideEmbedTopBar=true"),frameBorder:"0",allowFullScreen:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}})}):"youtube"===a.type?(0,S.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0},children:(0,S.jsx)("iframe",{src:a.url,frameBorder:"0",allow:"autoplay; encrypted-media",allowFullScreen:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}})}):void 0:null]})})},dx=r(6335),dh=()=>{let[e,t]=(0,K.useState)(!1),[r,a]=(0,K.useState)(""),[s,n]=(0,K.useState)(!1),[l,o]=(0,K.useState)(""),i=(0,eM.useRouter)(),d=(0,ez.TL)(),{handleSaveFlowbook:c}=(0,oT.M)(),{userProfile:u}=(0,ec.H)(),m=(0,Q.v9)(R.fK),p=(0,Q.v9)(R.LA),x=(0,Q.v9)(R.v9),h=(0,Q.v9)(R.Zy),g=(0,Q.v9)(R.aN),f=(null==g?void 0:g.creator_user_id)===u.user_id,v=(0,K.useMemo)(()=>g&&!f?"Would you like to save a copy of this template?":"Would you like to save your changes before you leave?",[g,f]),j=K.useCallback(e=>{if(m&&(!x||!h))throw e.includes("version_id")?o("Save your draft before previewing another version."):o(v),t(!0),a(e),"cancelRouteChange"},[m,x,h,v]),b=()=>{t(!1),(0,aX.WH)(),d((0,D.a5)()),_(),i.push(r)},_=(0,K.useCallback)(()=>{i.events.off("routeChangeStart",j)},[j,i.events]);K.useEffect(()=>(i.events.on("routeChangeStart",j),_),[j,_,i.events]);let y=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n(!0);try{var t,r;await c({name:null!==(t=p.name)&&void 0!==t?t:void 0,description:null!==(r=p.description)&&void 0!==r?r:void 0,forceClone:e,skipSecretsCheck:!0})}finally{n(!1)}},w=(0,K.useCallback)(()=>{d((0,D.wW)(!0)),t(!1)},[d]);return(0,S.jsx)(K.Fragment,{children:(0,S.jsx)(dx.aR,{open:e,onOpenChange:t,"aria-labelledby":"form-dialog-title",children:(0,S.jsxs)(dx._T,{children:[(0,S.jsx)(dx.iP,{children:(0,S.jsxs)(dx.fY,{children:[(0,S.jsx)(dx.f$,{children:l}),(0,S.jsx)(dx.yT,{children:"Saving ensures that your changes are saved and can be accessed later."})]})}),(0,S.jsxs)(dx.xo,{children:[(0,S.jsx)(el.zx,{variant:"destructive-gradient",onClick:b,children:"Don't Save"}),!!g&&f&&(0,S.jsx)(eQ.Z,{title:"Resubmit Template for Review",description:"Saving a template triggers a new review process. This means that the template cannot be used by other users until the review is complete.",onConfirm:w,confirmButtonProps:{text:"Continue",loading:s},cancelButtonProps:{text:"Cancel",disabled:s},tertiaryButtonProps:{text:"Make a copy instead",onClick:async()=>{await y(!0),t(!1)},loading:s},children:(0,S.jsx)(el.zx,{loading:s,children:"Save"})}),(!g||!f)&&(0,S.jsx)(el.zx,{loading:s,onClick:async()=>{await y(),b()},children:"Save"})]})]})})})},dg=()=>{let e=(0,ez.CG)(R.AV),t=(0,ez.CG)(R.LA),r=(0,ez.CG)(t=>(0,a9.TF)(t,e)),[a,s]=(0,K.useState)(!1),[n,l]=(0,K.useState)(!1),o=(0,ez.TL)(),{handleSaveFlowbook:i}=(0,oT.M)(),{handleStartPipeline:d}=(0,rD.wL)();(0,K.useEffect)(()=>{r&&r.length&&s(!0)},[r]);let c=async()=>{l(!0);try{var r,a;await i({name:null!==(r=t.name)&&void 0!==r?r:void 0,description:null!==(a=t.description)&&void 0!==a?a:void 0}),d(!0),o((0,U.D5)({savedItemId:e}))}catch(e){X.Am.error(e.message)}finally{l(!1),s(!1)}};return(0,S.jsx)(eq.Vq,{open:a,onOpenChange:t=>{s(t),t||o((0,U.F9)({savedItemId:e,isPending:!1}))},"aria-labelledby":"form-dialog-title",children:(0,S.jsxs)(eq.cZ,{children:[(0,S.jsxs)(eq.a7,{children:[(0,S.jsx)(eq.fK,{children:(0,S.jsx)(eq.$N,{children:"Save changes before running?"})}),(0,S.jsxs)(eq.Be,{children:["You have a subflow in this workbook that has ",(0,S.jsx)("strong",{children:"unsaved"})," changes.",(0,S.jsx)("br",{}),(0,S.jsx)("br",{}),"Save your changes so that your run uses your updated subflow!"]})]}),(0,S.jsxs)(eq.cN,{children:[(0,S.jsx)(el.zx,{variant:"outline",onClick:()=>{d(!0),s(!1)},disabled:n,children:"Don't Save & Run"}),(0,S.jsx)(el.zx,{onClick:c,loading:n,children:"Save & Run"})]})]})})},df=(0,K.memo)(e=>{let{hasTutorialVideo:t}=e;return(0,S.jsxs)(K.Fragment,{children:[t&&(0,S.jsx)(dp,{}),(0,S.jsx)(dh,{}),(0,S.jsx)(dg,{})]})}),dv=r(95543),dj=(0,K.memo)(e=>{let{template:t}=e,r=(0,ez.TL)(),{handleSaveFlowbook:a}=(0,oT.M)(),s=(0,ez.CG)(R.QB),n=(0,ez.CG)(H._I),{userProfile:l}=(0,ec.H)(),{handleProjectSwitch:o}=(0,oP.W)(),{currentProject:i}=(0,e0.d2)();return t.creator_user_id===(null==l?void 0:l.user_id)?null:(0,S.jsxs)("div",{className:"bg-background pointer-events-auto absolute right-5 bottom-6 z-50 flex w-md flex-col gap-3 rounded-lg border p-4 shadow-lg",children:[(0,S.jsx)(el.zx,{variant:"outline",size:"icon-xs",shadow:!0,onClick:()=>r((0,D.pZ)(null)),className:"absolute top-0 -left-2 -translate-x-full",children:(0,S.jsx)(t_.Z,{size:16})}),(0,S.jsxs)("div",{className:"flex flex-none flex-col gap-1",children:[(0,S.jsx)("span",{className:"text-xl font-semibold",children:t.name}),t.creator_user_email&&(0,S.jsxs)("p",{className:"text-muted-foreground truncate text-sm",children:["Created by"," ",(0,S.jsxs)("a",{className:"text-accent-foreground hover:text-accent-foreground text-sm underline hover:no-underline",href:"mailto:".concat(t.creator_user_email),children:[t.creator_first_name," ",t.creator_last_name]})]}),(0,S.jsx)(r1.U,{remarkPlugins:[oz.Z],className:(0,eu.cn)("text-foreground overflow-wrap text-sm wrap-break-word lg:max-w-2xl","*:tabular-nums","[&_h1]:text-xl [&_h2]:text-lg [&_h3]:text-base [&_li]:text-sm [&_ol]:text-sm [&_p]:text-sm [&_ul]:text-sm","[&_h1]:font-semibold [&_h2]:font-semibold [&_h3]:font-medium [&_li]:font-normal [&_ol]:font-normal [&_p]:font-normal [&_strong]:font-semibold [&_ul]:font-normal","[&_h1]:my-2 [&_h2]:my-2 [&_h3]:my-2 [&_p]:my-0 [&_strong]:my-0","[&_li]:ml-6 [&_ol]:my-0 [&_ol>li]:my-0 [&_ol>li]:list-decimal [&_ul]:mb-2 [&_ul]:list-disc [&_ul>li]:my-0 [&_ul>li]:list-disc","[&_code]:bg-muted-foreground/10 [&_code]:text-muted-foreground [&_code]:rounded-sm [&_code]:px-1 [&_code]:py-0.5 [&_code]:font-mono [&_code]:text-sm [&_code]:whitespace-pre-wrap","[&_pre]:bg-muted-foreground/7.5 [&_pre]:text-muted-foreground [&_pre>code]:text-muted-foreground [&_pre]:my-2 [&_pre]:rounded-sm [&_pre]:px-3 [&_pre]:py-2 [&_pre]:font-mono [&_pre]:text-sm [&_pre>code]:rounded-none [&_pre>code]:bg-transparent [&_pre>code]:px-0 [&_pre>code]:py-0 [&_pre>code]:font-mono [&_pre>code]:text-sm","[&_a]:text-accent-foreground [&_a]:hover:text-accent-foreground/80 [&_a]:underline [&_a]:hover:no-underline","[&_blockquote]:border-l-muted-foreground/20 [&_blockquote]:text-muted-foreground/80 [&_blockquote]:border-l-3 [&_blockquote]:pl-3 [&_blockquote>p]:text-sm","line-clamp-10"),children:t.body})]}),(0,S.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,S.jsx)(el.zx,{variant:"secondary",onClick:()=>{r((0,D.wW)(!0))},children:"See Full Instructions"}),!s&&(0,S.jsx)(oG,{onClone:e=>a({name:t.name,description:t.description,forceClone:!0,newAuthorId:e,shouldCloneTriggers:!1,afterSave:()=>{e!==(null==i?void 0:i.project_id)&&o(n.find(t=>t.project_id===e))}}),children:(0,S.jsx)(el.zx,{variant:"ghost",size:"lg",children:"Copy Template & Get Started"})})]})]})}),db=r(37121),d_=r(45544),dy=r(44976),dw=r(19425),dN=r(52609),dk=r(86453),dC=r(43832);function dI(){return(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsxs)(eU.C,{variant:"outline",size:"sm",children:[(0,S.jsx)(dC.Z,{}),"Incognito"]})}),(0,S.jsx)(eo._v,{children:"This run is in incognito mode, no data has been saved"})]})}var dT=r(60503);let dS=e=>{var t,r,a;let{run:s,showUserEmail:n}=e,l=(0,K.useMemo)(()=>{let e=(null==s?void 0:s.trigger_type)||"manual",t=tz.RT[e],r=(0,S.jsx)(i5.Z,{triggerType:e,size:16}),a=tz.sv[e];return{color:null==t?void 0:t.color,Icon:r,label:a}},[null==s?void 0:s.trigger_type]),o=(0,K.useMemo)(()=>{let e="".concat(window.location.origin,"/pipeline?run_id=").concat(s.run_id);return s.flowbook_id?e+="&workbook_id=".concat(s.flowbook_id):s.saved_item_id&&(e+="&flow_id=".concat(s.saved_item_id)),e},[null==s?void 0:s.run_id,null==s?void 0:s.flowbook_id,null==s?void 0:s.saved_item_id]),i=(0,K.useMemo)(()=>(null==s?void 0:s.credit_cost)===null||(null==s?void 0:s.credit_cost)===void 0?null:s.credit_cost+(s.child_run_credit_cost||0),[null==s?void 0:s.credit_cost,null==s?void 0:s.child_run_credit_cost]);return(0,S.jsx)(es(),{href:o,target:"_blank",className:"bg-background hover:bg-muted text-foreground border-muted flex cursor-pointer justify-between border-b p-4",children:(0,S.jsxs)("div",{className:"flex w-full flex-col gap-1",children:[(0,S.jsxs)("div",{className:"gap-w flex w-full flex-row items-center",children:[(0,S.jsx)("p",{className:"w-full min-w-0 flex-1 truncate text-sm font-medium",children:s.saved_item_name}),(0,S.jsx)(eU.C,{variant:dT.zR[s.state],size:"sm",children:s.state})]}),(0,S.jsx)("div",{className:"flex shrink-0 items-center gap-1",children:s.is_incognito&&(0,S.jsx)(dI,{})}),(0,S.jsxs)("div",{className:"xs:flex-row xs:items-center xs:justify-between flex flex-col items-start gap-2",children:[(s.creator_first_name||s.creator_last_name||s.creator_user_email)&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsxs)("div",{className:"flex min-w-0 items-center gap-1",children:[(0,S.jsx)(e2.Z,{src:null!==(t=s.creator_profile_picture)&&void 0!==t?t:"",name:null!==(r=s.creatorDisplayName())&&void 0!==r?r:"",className:"!size-4 rounded-sm text-[8px]"}),(0,S.jsx)("span",{className:"text-muted-foreground min-w-0 truncate text-xs",children:s.creatorDisplayName()})]})}),(0,S.jsx)(eo._v,{children:null!==(a=s.creator_user_email)&&void 0!==a?a:""})]}),(0,S.jsxs)("div",{className:"text-muted-foreground xs:shrink-0 flex min-w-0 items-center gap-2 text-xs",children:[null!==i&&(0,S.jsxs)("span",{className:"flex min-w-0 items-center gap-1 truncate",children:[(0,S.jsx)(dN.Z,{size:14}),(0,S.jsxs)("span",{children:[i," ",rv.Z_.pluralize({count:i,singular:"credit"})]}),(0,S.jsx)("span",{children:"â€¢"})]}),(0,S.jsx)("span",{children:(null==s?void 0:s.created_ts)?dk.hT.dateTime(s.created_ts):"N/A"})]})]}),s.trigger_type&&(0,S.jsxs)("p",{className:(0,eu.cn)("text-muted-foreground mt-1.5 flex flex-row items-center gap-1.5 text-xs [&>svg]:size-2.5",null==l?void 0:l.color),children:[null==l?void 0:l.Icon,"Triggered by",(null==l?void 0:l.label)?" ":"",null==l?void 0:l.label]})]})},s.run_id)};var dE=function(e){let{plRuns:t,onLoadMore:r,isLoadingMore:a,hasNextPage:s,showUserEmail:n}=e;return(0,S.jsxs)("div",{className:"text-foreground flex flex-col",children:[t.map(e=>(0,S.jsx)(dS,{run:e,showUserEmail:n},e.run_id)),s&&(0,S.jsx)(el.zx,{onClick:r,variant:"ghost",className:"text-foreground",loading:a,size:"xs",children:"Load More"})]})},dM=r(15527),dA=e=>{let{plRuns:t,isLoading:r,isLoadingMore:a,onLoadMore:s,hasNextPage:n,showUserEmail:l}=e;return(0,S.jsx)("div",{className:(0,eu.cn)("group flex w-full flex-grow flex-col gap-3 overflow-y-auto rounded-xl"),children:r?(0,S.jsx)(dM.Z,{count:6}):t.length>0?(0,S.jsx)(dE,{plRuns:t,onLoadMore:s,isLoadingMore:a,hasNextPage:n,showUserEmail:l}):(0,S.jsx)("div",{className:"flex flex-grow flex-col items-center justify-center",children:(0,S.jsx)(r3.Z,{title:"No runs yet",description:"You haven't run this workflow before. Save and run to start tracking!",Icon:dw.Z})})})},dO=r(50039),dZ=r(77309),dz=r(36454),dP=r(1257),dD=r(65695),dL=r(54594),dR=r(99577),dF=r(39397);let dG=(0,K.memo)(e=>{let{plRun:t,plConfig:r}=e,a=(0,dL.W)({plRun:t,pipelineLength:r.pipeline.length}),s=(0,Q.I0)(),{handleTroubleshootPlRun:n}=(0,al.M)(),l=(0,K.useCallback)(()=>{s((0,A.ym)(!0)),n(t.run_id)},[s,n,t.run_id]);return a.display.showStatus||a.state.isRunning||a.state.isQueued?(0,S.jsxs)("div",{className:(0,eu.cn)("rounded-md",a.display.backgroundColor,a.display.textColor),children:[r&&(0,S.jsx)(dF.Z,{plRun:t,plConfig:r,className:"rounded-none",innerClassName:"rounded-none"}),(0,S.jsx)("div",{className:(0,eu.cn)("p-3",a.state.isFailed&&"pb-2"),children:(0,S.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,S.jsxs)("div",{className:"flex flex-row items-center justify-between gap-4",children:[(0,S.jsx)("p",{className:"flex items-center space-x-2 font-medium whitespace-nowrap",children:a.display.statusText}),(0,S.jsx)(dU,{isRunning:a.state.isRunning,isQueued:a.state.isQueued,queuePosition:t.queue_position,runTime:a.time.runtime,startTime:a.time.startTime,totalCredits:a.credits,textColor:a.display.textColor})]}),a.state.isFailed&&(0,S.jsx)(dB,{onFixWithGummie:l})]})})]}):null});dG.displayName="LogStatus";let dU=(0,K.memo)(e=>{let{isRunning:t,isQueued:r,queuePosition:a,runTime:s,startTime:n,totalCredits:l,textColor:o}=e;return(0,S.jsxs)("div",{className:(0,eu.cn)("flex items-center space-x-3 text-sm [&_svg]:size-4 [&_svg]:shrink-0",o),children:[r?(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)(dO.Z,{}),(0,S.jsx)("span",{children:null!==a?"Queue Position: ".concat(a):"Queued"})]}):t?n&&(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)(dO.Z,{}),(0,S.jsxs)("span",{children:["Started at ",n]})]}):(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)(dZ.Z,{}),(0,e5.ZC)(Number(s))]}),(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)(dN.Z,{}),(0,S.jsxs)("span",{children:[l," Credits"]})]})]})});dU.displayName="StatusStats";let dB=(0,K.memo)(e=>{let{isForm:t=!1,onFixWithGummie:r}=e,{currentUser:a}=(0,dR.Z)();return t?null:(0,S.jsxs)("div",{className:"flex flex-grow flex-col gap-1",children:[(0,S.jsxs)(el.zx,{variant:"tertiary",className:"flex-1/2",onClick:r,children:[(0,S.jsx)(dz.Z,{size:16,strokeWidth:2}),"Fix with Gummie"]}),(0,S.jsx)(dD.Z,{user:a,defaultView:dD.N.FORM,children:(0,S.jsxs)(el.zx,{variant:"destructive",size:"xs",className:"underline-offset-2 hover:underline",children:[(0,S.jsx)(a7.Z,{})," Report to Gumloop Team"]})})]})});dB.displayName="FailedActionButtons",(0,K.memo)(e=>{let{plRun:t,onBack:r,flowbookId:a}=e,s=(0,K.useCallback)(()=>(0,S.jsxs)(el.zx,{variant:"outline",onClick:()=>window.open("".concat(window.origin,"/pipeline?workbook_id=").concat(a,"&run_id=").concat(t.run_id),"_blank"),className:"border-border text-foreground hover:bg-muted flex items-center justify-center rounded-lg border px-4 py-2",children:[(0,S.jsx)(eG.Z,{className:"mr-1 h-4 w-4"}),"View Flow Run"]}),[a,t.run_id]);return(0,S.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[r&&a&&(0,S.jsx)(s,{}),r&&(0,S.jsxs)(el.zx,{variant:"outline",onClick:r,className:"flex w-full rounded-none border-0 border-y",children:[(0,S.jsx)(dP.Z,{className:"mr-1 h-4 w-4"}),"Return to form"]})]})}).displayName="FormActionButtons";var dV=r(34098);(m=C||(C={})).PREVIOUS_RUNS="previous_runs",m.RUN_REPORT="run_report";let dW=nx.E.create(eZ.mQ);var dH=e=>{let{outdatedOperatorDeclarations:t}=e,r=(0,Q.v9)(R.z4),a=(0,Q.v9)(e=>(0,a9.SQ)(e,null==r?void 0:r.saved_item_id)),s=(0,Q.v9)(e=>(0,a9.BI)(e,null==r?void 0:r.saved_item_id)),n=(0,Q.v9)(e=>(0,R.iP)(e,null==r?void 0:r.saved_item_id)),l=(0,Q.v9)(e=>(0,a9.vj)(e,null==r?void 0:r.saved_item_id)),o=(0,Q.v9)(e=>ew(e)),{currentProject:i}=(0,e0.d2)(),{userProfile:d,idTokenRef:c}=(0,ec.H)(),u=(0,K.useMemo)(()=>!!(null==a?void 0:a.run_id)&&!!(null==a?void 0:a.log),[a]),m=(0,Q.I0)(),[p,x]=(0,K.useState)(()=>u?"run_report":"previous_runs");(0,K.useEffect)(()=>{(s||(null==a?void 0:a.run_id))&&x("run_report")},[s,null==a?void 0:a.run_id]);let{data:h,isLoading:g,isFetching:v,refetch:j,hasNextPage:b,fetchNextPage:_,isFetchingNextPage:y}=(0,db.EA)({userProfile:d,idToken:c.current,saved_item_id:null==r?void 0:r.saved_item_id,project_id:null==i?void 0:i.project_id},{skip:!(null==r?void 0:r.saved_item_id)});return(0,S.jsx)(lC.M,{children:l&&(0,S.jsxs)(dW,{value:p,onValueChange:e=>x(e),"data-open":l,className:(0,eu.cn)("bg-background absolute right-2 z-40 flex w-[calc(var(--container-md)+1rem+0.75rem)] flex-col rounded-lg border shadow-xs sm:right-4 sm:max-w-xs lg:max-w-sm 2xl:max-w-md",o===f.TEMPLATE?"top-4 h-[calc(var(--pipeline-panel-height)+0.5rem)]":"top-18 h-[var(--pipeline-panel-height)] sm:top-22"),initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.2,ease:"easeInOut"},children:[(0,S.jsx)(el.zx,{variant:"outline",size:"icon-sm",onClick:()=>m((0,U.rR)({savedItemId:null==r?void 0:r.saved_item_id,showLogs:!1})),shadow:!0,className:(0,eu.cn)("animate-in fade-in slide-in-from-right-full absolute top-0 z-0 duration-500 ease-in-out",l?"-left-2 -translate-x-full":"left-0 translate-x-0"),children:(0,S.jsx)(t_.Z,{})}),(0,S.jsxs)(eZ.dr,{className:"flex w-full flex-none overflow-hidden text-lg [&_svg]:size-5",children:[(0,S.jsxs)(eZ.SP,{value:"run_report",className:"h-12 w-full text-sm [&_svg]:size-4!",children:[(0,S.jsx)(aW.Z,{className:"hidden lg:block"})," Current Run"]}),(0,S.jsx)(eZ.SP,{value:"previous_runs",asChild:!0,className:"h-12 w-full text-sm [&_svg]:size-4!",children:(0,S.jsxs)("div",{className:"group w-full",children:[(0,S.jsx)(d_.Z,{className:"hidden lg:block"}),"Previous Runs",(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-xs",className:"text-muted-foreground",onClick:j,disabled:g||v,children:(0,S.jsx)(dy.Z,{className:(0,eu.cn)("!size-3.5",(v||g)&&"animate-spin")})})}),(0,S.jsx)(eo._v,{children:"Refresh"})]})]})})]}),(0,S.jsxs)(eZ.nU,{value:"run_report",className:"flex flex-grow flex-col overflow-hidden rounded-b-lg lg:max-w-sm xl:max-w-md",children:[(0,S.jsx)("div",{className:"flex flex-grow flex-col overflow-y-auto",children:(0,S.jsx)(dV.Z,{outdatedOperatorDeclarations:t})}),a&&(0,S.jsx)(dG,{plRun:a,plConfig:n})]}),(0,S.jsx)(eZ.nU,{value:"previous_runs",className:"flex flex-1 flex-grow flex-col overflow-clip overflow-y-auto lg:max-w-sm xl:max-w-md",children:(0,S.jsx)(dA,{hasNextPage:b,plRuns:(null==h?void 0:h.pages.flat())||[],isLoading:g||v&&!y,isLoadingMore:y,onLoadMore:()=>_(),showUserEmail:!!i})})]})})},dJ=r(87111),dq=r(31664);let dK=ro.Qr.filter(e=>"Core Nodes"===e.group).map(e=>e.name),dY=new Map(ro.Qr.map(e=>[e.name,e]));[...Object.keys({"Core Nodes":{description:"Essential components for workflow construction",Icon:dJ.Z,subgroups:dK.map(e=>{let t=dY.get(e);return{name:e,description:t.description,filter:t=>t.category===e,image:t.icon}})},"Using AI":{description:"Leverage AI for various tasks",image:"/images/UsingAI.svg",filter:(e,t)=>"Using AI"===e.category},Triggers:{description:"Automate actions based on events",Icon:tK.Z,filter:(e,t)=>!!e.is_trigger_node},"Custom Nodes":{description:"Create your own nodes to automate your workflows",Icon:dq.Z,filter:(e,t)=>t.some(t=>t.operator_id===e.operator_id)},Subflows:{description:"Automate your workflows with subflows",Icon:rw.Z,filter:(e,t)=>"Subflows"===e.category}}),...dK],["Core Nodes","Using AI"].map((e,t)=>[e,t]),["Subflows"].map((e,t)=>[e,t]),["Airtable","Gmail","Google Sheets","Google Drive","Google Docs","Google Calendar","Google Ads"].map((e,t)=>[e,t]),["Slack"].map((e,t)=>[e,t]);var d$=r(73569);function dQ(){let{enabled:e=!0,wrapAround:t=!0,keys:r={next:["ArrowDown","ArrowRight"],previous:["ArrowUp","ArrowLeft"]},indexAttribute:a="data-kb-index",dependencies:s=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,K.useRef)(0),l=(0,K.useMemo)(()=>s.map(e=>String(e)).join("|"),[s]),o=(0,K.useCallback)(()=>n.current++,[]),i=(0,K.useCallback)(()=>{n.current=0},[]),d=(0,K.useCallback)(e=>{if(e<0)return;let t="[".concat(a,'="').concat(e,'"]'),r=document.querySelector(t);r&&requestAnimationFrame(()=>r.focus())},[a]),c=(0,K.useCallback)(()=>n.current,[n]),u=(0,K.useCallback)(()=>{let e=document.activeElement,r=parseInt((null==e?void 0:e.getAttribute(a))||"-1",10),s=document.querySelectorAll("[".concat(a,"]")).length;if(0===s)return;let n=Number.isFinite(r)?r:-1,l=n+1;l>=s&&(l=t?0:n),l!==n&&d(l)},[d,a,t]),m=(0,K.useCallback)(()=>{let e=document.activeElement,r=Number.parseInt((null==e?void 0:e.getAttribute(a))||"-1",10),s=document.querySelectorAll("[".concat(a,"]")).length;if(0===s)return;let n=Number.isFinite(r)?r:-1,l=n-1;l<0&&(l=t?s-1:n),l!==n&&d(l)},[d,a,t]),p=(0,K.useCallback)(e=>{var t,a;let s=null!==(t=r.next)&&void 0!==t?t:["ArrowDown","ArrowRight"],n=null!==(a=r.previous)&&void 0!==a?a:["ArrowUp","ArrowLeft"];if(e.defaultPrevented)return;let l=e.target;!(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement||l instanceof HTMLSelectElement||(null==l?void 0:l.isContentEditable))&&(s.includes(e.key)?(e.preventDefault(),u()):n.includes(e.key)&&(e.preventDefault(),m()))},[r,u,m]);return(0,K.useEffect)(()=>{if(e)return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[e,p,l]),(0,K.useEffect)(()=>{i()},[i,l]),{getNextIndex:o,resetIndex:i,focusIndex:d,getTotalItems:c}}let dX=(0,K.memo)(e=>{let{category:t,onClick:r,type:a,icon:s,title:n,subtitle:l,children:o,actions:i,iconClassName:d,iconSize:c=20,disabled:u=!1,className:m,style:p,...x}=e,h=u||!!x["aria-disabled"],g=t?{...(0,ro.J8)(t),...p}:p;return(0,S.jsxs)("button",{className:(0,eu.cn)("group hover:bg-muted/50 focus-within:bg-muted/50 flex w-full items-center gap-2.5 rounded-md bg-transparent p-2 text-left ring-0 outline-none",m,h&&"pointer-events-none opacity-70"),type:"button",style:g,onClick:r,disabled:h,"aria-disabled":h,...x,children:[(0,S.jsx)("div",{id:"icon-container",className:(0,eu.cn)("pointer-events-none flex size-10 flex-none items-center justify-center rounded-md border",d,"custom-node-builder"===a?"bg-[var(--node-color-dark)] text-[var(--node-color-light)]":"bg-[var(--node-color-light)]/20 text-[var(--node-color-dark)]"),children:s?(0,S.jsx)("span",{className:"flex items-center justify-center",children:(0,rj.Fp)(s)?(0,rj.Zu)(s,c):(0,rj.hY)(s,c)}):(0,S.jsx)("span",{className:"flex items-center justify-center",children:(0,rj.hY)("/images/gumloop_logo_transparent.png",c)})}),(0,S.jsxs)("div",{className:"my-auto flex min-w-0 flex-1 flex-col",children:[(0,S.jsxs)("div",{className:"flex w-full flex-row items-center gap-1.5",children:[(0,S.jsx)("p",{className:"text-foreground line-clamp-1 flex-grow text-sm font-normal",children:n}),i]}),l?(0,S.jsx)("p",{className:"text-muted-foreground line-clamp-1 text-xs",children:l}):null]}),o]})});dX.displayName="NodePaletteBaseItem";let d0=(0,K.memo)(e=>{let{category:t,onClick:r,disabled:a,disabledReason:s,keyboardIndex:n}=e,l=s||"".concat(t.name," is restricted by your admin.");return(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{children:(0,S.jsx)(dX,{category:t.name,onClick:r,type:"category",title:t.name,subtitle:t.description,icon:t.icon,disabled:a,"data-kb-index":n,children:(0,S.jsx)(d1,{supportsMCP:t.supportsMCP,supportsTriggers:t.supportsTriggers})})})}),a?(0,S.jsx)(eo._v,{side:"top",children:l}):null]})});d0.displayName="NodePaletteCategoryItem";let d1=(0,K.memo)(e=>{let{supportsMCP:t,supportsTriggers:r}=e;return t||r?(0,S.jsxs)("div",{className:"flex items-center gap-1",children:[r?(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{className:"flex shrink-0 items-center justify-center p-2",children:(0,S.jsx)(tK.Z,{className:"text-muted-foreground/50 size-4"})})}),(0,S.jsx)(eo._v,{side:"top",children:"This category contains trigger nodes."})]}):null,t?(0,S.jsx)(eU.C,{size:"sm",className:"bg-[var(--node-color-light)] text-[var(--node-color-dark)]",children:"MCP"}):null]}):null});d1.displayName="CategoryItemInformation";let d2=(0,K.memo)(e=>{let{graph:t,filteredCategories:r,onCategoryClick:a}=e,{getNextIndex:s,resetIndex:n}=dQ({dependencies:[r.length]});return(n(),0===r.length)?(0,S.jsx)(r3.Z,{Icon:o0.Z,title:"No Categories Found",description:"Try a different search term"}):(0,S.jsx)("div",{className:"flex h-full flex-col overflow-y-auto p-2.5",children:r.map(e=>{var r;let n=t.categoriesById.get(e);if(!n)return null;let l=null!==(r=t.templateIdsByCategoryId.get(e))&&void 0!==r?r:[],o=l.length>0&&l.every(e=>{let r=t.templatesById.get(e);return!!(null==r?void 0:r.isRestricted)}),i=o?void 0:s();return(0,S.jsx)(d0,{category:n,onClick:()=>a(e),disabled:o,keyboardIndex:i},e)})})});d2.displayName="NodePaletteCategoryList";let d5=(0,K.memo)(e=>{let{group:t,onClick:r,disabled:a,keyboardIndex:s}=e,n="".concat(t.name," is restricted by your admin.");return(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{children:(0,S.jsx)(dX,{category:t.name,onClick:r,type:"group",title:t.name,subtitle:t.description,icon:t.icon,disabled:a,"data-kb-index":s})})}),a?(0,S.jsx)(eo._v,{side:"top",children:n}):null]})});d5.displayName="NodePaletteCategoryGroupItem";let d4=(0,K.memo)(e=>{let{template:t,onTemplateClick:r,keyboardIndex:a}=e,[s,n]=(0,K.useState)(!1),l=t&&"description"in t?t.description:void 0,o=!!t&&"isTrigger"in t&&t.isTrigger,i=!!(null==t?void 0:t.isRestricted),d="custom-node-builder"===t.type&&t.serverId?"Custom node creation has been restricted by your admin.":"".concat(t.name," is restricted by your admin."),c="custom"===t.type,u=c?t.operatorId:void 0,m=c&&"owned"===t.visibility,p=c&&"shared"===t.visibility;return(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{children:(0,S.jsx)(dX,{category:t.category,onClick:()=>r(t.id),type:t.type,icon:t.icon,title:t.name,subtitle:l,disabled:i,"data-kb-index":a,actions:m&&u?(0,S.jsxs)("div",{onClick:e=>e.stopPropagation(),children:[(0,S.jsx)(el.zx,{size:"icon-xs",variant:"ghost",className:"hover:bg-background hover:text-foreground hover:border",onClick:()=>n(!0),children:(0,S.jsx)(nq.Z,{size:14})}),(0,S.jsx)(n$,{operatorId:u,open:s,setOpen:n})]}):p?(0,S.jsx)(eU.C,{size:"sm",className:"group-hover:bg-background group-hover:text-foreground group-hover:border-border",children:"Shared"}):null,children:o?(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{className:"flex shrink-0 items-center justify-center p-2",children:(0,S.jsx)(tK.Z,{className:"text-muted-foreground/50 size-4"})})}),(0,S.jsx)(eo._v,{side:"top",align:"end",children:"This node can be used as a trigger in a flow."})]}):null})})}),i?(0,S.jsx)(eo._v,{side:"top",children:d}):null]})});d4.displayName="NodePaletteTemplateRow";let d3=(0,K.memo)(e=>{let{graph:t,onGroupClick:r,onCategoryClick:a,onTemplateClick:s}=e,n=(0,K.useMemo)(()=>{let e=Array.from(t.categoriesById.values()).filter(e=>"Integrations"===e.group),r=new Map;ro.PE.forEach((e,t)=>{r.set(e.name,t)});let a=e.filter(e=>e.supportsMCP),s=e.filter(e=>!e.supportsMCP),n=a.findIndex(e=>"Slack"===e.name);if(n>-1){let[e]=a.splice(n,1);a.push(e)}return[...a,...s]},[t]),{getNextIndex:l,resetIndex:o}=dQ({dependencies:[t.orderedGroupIds.length,t.featuredTemplatesById.size,n.length]});return o(),(0,S.jsxs)("div",{className:"flex h-full flex-col gap-2 overflow-y-auto p-2.5",children:[(0,S.jsx)(d9,{className:"grid gap-x-2 gap-y-0.5 md:grid-cols-2 lg:grid-cols-3",children:t.orderedGroupIds.map(e=>{var a;let s=t.groupsById[e],n=null!==(a=t.templateIdsByCategoryId.get(s.name))&&void 0!==a?a:[],o=n.length>0&&n.every(e=>{let r=t.templatesById.get(e);return!!(null==r?void 0:r.isRestricted)}),i=o?void 0:l();return(0,S.jsx)(d5,{group:s,onClick:()=>r(e),disabled:o,keyboardIndex:i},e)})}),(0,S.jsx)(d9,{label:"Frequently Used",className:"grid gap-x-2 gap-y-0.5 md:grid-cols-2 lg:grid-cols-3",children:Array.from(t.featuredTemplatesById.values()).map(e=>{let t=e.isRestricted?void 0:l();return(0,S.jsx)(d4,{template:e,onTemplateClick:s,keyboardIndex:t},e.id)})}),(0,S.jsx)(d9,{label:"Integrations",children:n.map(e=>{var r;let s=t.categoriesById.get(e.name);if(!s)return null;let n=null!==(r=t.templateIdsByCategoryId.get(s.name))&&void 0!==r?r:[],o=n.length>0&&n.every(e=>{let r=t.templatesById.get(e);return!!(null==r?void 0:r.isRestricted)}),i=o?void 0:l();return(0,S.jsx)(d0,{category:s,onClick:()=>a(s.name),disabled:o,disabledReason:"All nodes in ".concat(s.name," are restricted by your admin."),keyboardIndex:i},s.name)})})]})});d3.displayName="NodePaletteRoot";let d9=(0,K.memo)(e=>{let{label:t,children:r,className:a}=e;return(0,S.jsxs)("div",{children:[t?(0,S.jsx)("p",{className:"text-muted-foreground/72 px-2 pb-0.5 text-sm select-none",children:t}):null,(0,S.jsx)("div",{className:(0,eu.cn)(a),children:r})]})});d9.displayName="NodePaletteRootSection";var d6=r(30036),d8=r(19069),d7=r(60858),ce=r(8232),ct=r(62666),cr=e=>{let{count:t,setCount:r}=e;return(0,S.jsxs)("div",{className:"flex flex-row items-center justify-between gap-4",children:[(0,S.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,S.jsx)("label",{htmlFor:"failure-count-input",className:"text-foreground block text-sm",children:"Max Failure Count"}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(e$.Z,{className:"text-muted-foreground ml-1 size-3 cursor-pointer"})}),(0,S.jsx)(eo._v,{children:(0,S.jsxs)("p",{className:"whitespace-pre-line",children:["The maximum subsequent failures that the flow can have before the trigger is deleted.","\n\n","If the trigger is deleted, you will receive an email."]})})]})]}),(0,S.jsxs)("div",{className:"ring-accent-foreground relative flex max-w-28 items-center rounded-md ring-offset-2 focus-within:ring-2 focus-within:outline-none",children:[(0,S.jsx)("button",{type:"button",onClick:()=>{r(e=>e>1?e-1:e)},className:"border-border bg-muted h-8 rounded-s-lg border p-2",children:(0,S.jsx)(tq.Z,{className:"text-muted-foreground size-3"})}),(0,S.jsx)("input",{type:"text",id:"failure-count-input",value:t,onChange:e=>{let t=Math.max(1,Math.min(20,Number(e.target.value)));t&&r(t)},className:"border-border z-10 block h-8 w-full border-x-0 bg-gray-50 py-1.5 text-center text-sm text-gray-900 ring-0 focus:ring-0",placeholder:"3",required:!0,pattern:"\\d*",min:"1",max:"20"}),(0,S.jsx)("button",{type:"button",onClick:()=>{r(e=>e<20?e+1:e)},className:"border-border bg-muted h-8 rounded-e-lg border p-2",children:(0,S.jsx)(er.Z,{className:"text-muted-foreground size-3"})})]})]})};let ca=e=>{let{cronExpression:t}=e,r=(0,K.useMemo)(()=>{if(t)try{return i3().toString(t,{verbose:!0})}catch(e){return}},[t]);return(0,S.jsxs)("div",{children:[(0,S.jsx)("p",{className:"bg-muted text-muted-foreground rounded-md border p-2 text-sm",children:null!=r?r:"Please enter a valid time"}),(0,S.jsx)("p",{className:"text-muted-foreground px-1 py-0.5 text-xs italic",children:t})]})},cs=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],cn={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},cl={0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"},co={Sunday:"Sun",Monday:"Mon",Tuesday:"Tue",Wednesday:"Wed",Thursday:"Thu",Friday:"Fri",Saturday:"Sat"};function ci(e){return cn[e]}function cd(e){let t=cl[e];if(!t)throw Error("Invalid cron number: ".concat(e,". Must be between 0-6."));return t}let cc=e=>{let{day:t,checked:r,onCheckedChange:a,displayMode:s,renderDayLabel:n}=e,l="custom"===s;return(0,S.jsxs)("button",{type:"button",onClick:a,className:(0,eu.cn)("group/week-day-item data-[checked=true]:text-accent-foreground data-[checked=true]:text-accent-foreground flex cursor-pointer flex-col items-center gap-2 text-sm"),"data-checked":r,children:[(0,S.jsx)("div",{className:(0,eu.cn)("group-data-[checked=false]/week-day-item:border-muted-foreground/25 group-data-[checked=false]/week-day-item:text-muted-foreground flex size-10 items-center justify-center rounded-full border font-medium group-data-[checked=false]/week-day-item:border-dashed","group-data-[checked=true]/week-day-item:bg-accent-foreground data-[checked=true]/week-day-item:border-transparent group-data-[checked=true]/week-day-item:text-background"),children:t.charAt(0).toUpperCase()}),"compact"!==s&&(0,S.jsx)("p",{children:l&&n?n(t,r):function(e,t){switch(t){case"compact":return e.charAt(0).toUpperCase();case"short":return co[e];case"full":case"custom":return e}}(t,s)})]})};var cu=e=>{let{format:t="string",displayMode:r="full",renderDayLabel:a,days:s=cs,className:n}=e,l=e=>"number"===e.format,o=()=>void 0===e.value?[]:l(e)?e.value.map(cd):e.value.map(e=>e),i=t=>l(e)?t.map(ci).sort((e,t)=>e-t):t,d=void 0!==e.value,[c,u]=(0,K.useState)(o());(0,K.useEffect)(()=>{d&&u(o())},[e.value,t]);let m=t=>{let r=c.includes(t)?c.filter(e=>e!==t):[...c,t];if(d||u(r),e.onValueChange){let t=i(r);l(e),e.onValueChange(t)}},p=d?o():c;return(0,S.jsx)("div",{className:(0,eu.cn)("flex flex-row gap-2",n),children:s.map(e=>(0,S.jsx)(cc,{day:e,checked:p.includes(e),onCheckedChange:()=>m(e),displayMode:r,renderDayLabel:a},e))})};let cm=e=>{let{value:t,onChange:r,type:a,placeholder:s,cronExpression:n,fieldIndex:l,className:o}=e,[i,d]=(0,K.useState)(null),c=e=>{if(!e||""===e.trim())return null;let t=[];try{t=n.split(/\s+/),5!==t.length&&(t=["*","*","*","*","*"])}catch(e){t=["*","*","*","*","*"]}t[l]=e;let r=t.join(" ");try{return i3().toString(r),null}catch(e){return"Invalid cron pattern"}},u=e=>{let t=e.replace(/\s/g,"");r(t),d(c(t))};return(0,S.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{children:(0,S.jsx)(e$.Z,{className:"text-muted-foreground size-3"})}),(0,S.jsx)(eo._v,{children:(0,S.jsx)("p",{className:"whitespace-pre-line",children:"minutes"===a?"Supports: *, */5, 0-30/15, 0,15,30,45, or combinations":"hours"===a?"Supports: *, */2, 9-17, 9-17/2, 9,12,17, or combinations":"daysOfMonth"===a?"Supports: *, */5, 1-15, 1-15/5, 1,15,30, or combinations":"months"===a?"Supports: *, 1-12, 1,3,6,9, or combinations":"Supports: *, 0-6, 0,1,2, or combinations"})})]}),(0,S.jsx)(ax.I,{type:"text",placeholder:s,value:t,onChange:e=>u(e.target.value),className:(0,eu.cn)("w-64",i?"border-red-500":"h-8",o)})]})},cp=["*","*/5","*/10","*/15","*/30","0"],cx=["*","*/2","*/4","*/6","*/10","9","12","17","9-17","9-17/2"],ch=["*","1-5","0,6"],cg=["*","1","15","1-15","16-31"],cf=["*"],cv=[{value:"*",label:"Every minute"},{value:"*/5",label:"Every 5 minutes"},{value:"*/10",label:"Every 10 minutes"},{value:"*/15",label:"Every 15 minutes"},{value:"*/30",label:"Every 30 minutes"},{value:"0",label:"At the start of the hour"}],cj=[{value:"*",label:"Every hour"},{value:"*/2",label:"Every 2 hours"},{value:"*/4",label:"Every 4 hours"},{value:"*/6",label:"Every 6 hours"},{value:"*/10",label:"Every 10 hours"},{value:"9",label:"At 9 AM"},{value:"12",label:"At noon (12 PM)"},{value:"17",label:"At 5 PM"},{value:"9-17",label:"Every hour from 9 AM to 5 PM"},{value:"9-17/2",label:"Every 2 hours from 9 AM to 5 PM"}],cb=[{value:"*",label:"Every day"},{value:"1-5",label:"Weekdays (Mon-Fri)"},{value:"0,6",label:"Weekends (Sat-Sun)"},{value:"1",label:"1st of the month"},{value:"15",label:"15th of the month"}],c_=[{value:"*",label:"Every month"}];function cy(e,t){return t.includes(e)}let cw=e=>{let{daysOfWeek:t,daysOfMonth:r,onDaysOfWeekChange:a,onDaysOfMonthChange:s,customDaysOfWeek:n,onCustomDaysOfWeekChange:l,customDaysOfMonth:o,onCustomDaysOfMonthChange:i,customDaysOfWeekInput:d,onCustomDaysOfWeekInputChange:c,cronExpression:u}=e,m="custom-input"===t,p=m||"custom"===r;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"flex flex-col gap-2",children:(0,S.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("label",{htmlFor:"days-select",className:"text-sm",children:"Days"}),p&&(0,S.jsx)("button",{className:"text-muted-foreground text-xs underline",onClick:()=>{a("*"),s("*")},children:"Use preset options"})]}),p?m?(0,S.jsx)(cm,{value:d,onChange:c,type:"daysOfWeek",placeholder:"e.g., 0,1,2 or 0-5 or */2",cronExpression:u,fieldIndex:4}):(0,S.jsx)(cm,{value:o,onChange:i,type:"daysOfMonth",placeholder:"e.g., 1,15,30 or 1-15 or 1-15/5 or */5",cronExpression:u,fieldIndex:2}):(0,S.jsxs)(iW.Ph,{value:"*"!==t?t:"*"!==r?"custom"===r?"custom-input":r:"*",onValueChange:e=>{let t="*"===e||"1-5"===e||"0,6"===e||"custom"===e||"custom-input"===e,r="1"===e||"15"===e||"1-15"===e||"16-31"===e;t?(a(e),"*"!==e&&s("*"),"custom"===e&&l([]),"custom-input"===e&&c("")):r?(s(e),a("*")):"custom-input"===e?(a("custom-input"),s("*"),c("")):(a(e),s("*"))},children:[(0,S.jsx)(iW.i4,{id:"days-select",className:"h-8! w-full max-w-64",children:(0,S.jsx)(iW.ki,{placeholder:"Select days"})}),(0,S.jsxs)(iW.Bw,{children:[cb.map(e=>(0,S.jsx)(iW.Ql,{value:e.value,children:e.label},e.value)),(0,S.jsx)(iW.U$,{}),(0,S.jsx)(iW.Ql,{value:"custom",children:"Pick specific days of the week"}),(0,S.jsx)(iW.Ql,{value:"custom-input",children:"Custom days"})]})]})]})}),"custom"===t&&(0,S.jsx)(cu,{format:"number",displayMode:"short",className:"w-full flex-row justify-between px-6",value:n,onValueChange:l})]})},cN=["January","February","March","April","May","June","July","August","September","October","November","December"],ck={January:1,February:2,March:3,April:4,May:5,June:6,July:7,August:8,September:9,October:10,November:11,December:12},cC={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},cI={January:"Jan",February:"Feb",March:"Mar",April:"Apr",May:"May",June:"Jun",July:"Jul",August:"Aug",September:"Sep",October:"Oct",November:"Nov",December:"Dec"};function cT(e){return ck[e]}function cS(e){let t=cC[e];if(!t)throw Error("Invalid cron number: ".concat(e,". Must be between 1-12."));return t}let cE=e=>{let{month:t,checked:r,onCheckedChange:a,displayMode:s,renderMonthLabel:n}=e,l="custom"===s;return(0,S.jsxs)("button",{type:"button",onClick:a,className:(0,eu.cn)("group/month-item data-[checked=true]:text-accent-foreground data-[checked=true]:bg-accent data-[checked=true]:border-accent-foreground/25 data-[checked=false]:border-dashed data-[checked=true]:border-solid","flex cursor-pointer flex-col items-center gap-2 rounded-md border p-3 text-sm"),"data-checked":r,children:[(0,S.jsx)("div",{className:(0,eu.cn)("group-data-[checked=false]/month-item:text-muted-foreground bg-muted flex size-10 items-center justify-center rounded-full font-medium","group-data-[checked=true]/month-item:bg-accent-foreground/10 group-data-[checked=true]/month-item:text-accent-foreground group-data-[checked=true]/month-item:border-transparent"),children:t.charAt(0).toUpperCase()}),"compact"!==s&&(0,S.jsx)("p",{children:l&&n?n(t,r):function(e,t){switch(t){case"compact":return e.charAt(0).toUpperCase();case"short":return cI[e];case"full":case"custom":return e}}(t,s)})]})};var cM=e=>{let{format:t="string",displayMode:r="full",renderMonthLabel:a,months:s=cN,className:n}=e,l=e=>"number"===e.format,o=()=>void 0===e.value?[]:l(e)?e.value.map(cS):e.value.map(e=>e),i=t=>l(e)?t.map(cT).sort((e,t)=>e-t):t,d=void 0!==e.value,[c,u]=(0,K.useState)(o());(0,K.useEffect)(()=>{d&&u(o())},[e.value,t]);let m=t=>{let r=c.includes(t)?c.filter(e=>e!==t):[...c,t];if(d||u(r),e.onValueChange){let t=i(r);l(e),e.onValueChange(t)}},p=d?o():c;return(0,S.jsx)("div",{className:(0,eu.cn)("grid grid-cols-4 gap-2",n),children:s.map(e=>(0,S.jsx)(cE,{month:e,checked:p.includes(e),onCheckedChange:()=>m(e),displayMode:r,renderMonthLabel:a},e))})};let cA=e=>{let{value:t,onValueChange:r,customMonths:a,onCustomMonthsChange:s,customMonthsInput:n,onCustomMonthsInputChange:l,cronExpression:o}=e,i="custom-input"===t;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"flex flex-col gap-2",children:(0,S.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("label",{htmlFor:"months-select",className:"text-sm",children:"Months"}),i&&(0,S.jsx)("button",{className:"text-muted-foreground text-xs underline",onClick:()=>r("*"),children:"Use preset options"})]}),i?(0,S.jsx)(cm,{value:n,onChange:l,type:"months",placeholder:"e.g., 1,3,6,9 or 1-6 or */3",cronExpression:o,fieldIndex:3}):(0,S.jsxs)(iW.Ph,{value:t,onValueChange:e=>r(e),children:[(0,S.jsx)(iW.i4,{id:"months-select",className:"h-8! w-full max-w-64",children:(0,S.jsx)(iW.ki,{placeholder:"Select a month"})}),(0,S.jsxs)(iW.Bw,{children:[c_.map(e=>(0,S.jsx)(iW.Ql,{value:e.value,children:e.label},e.value)),(0,S.jsx)(iW.U$,{}),(0,S.jsx)(iW.Ql,{value:"custom",children:"Pick specific months"}),(0,S.jsx)(iW.Ql,{value:"custom-input",children:"Custom months"})]})]})]})}),"custom"===t&&(0,S.jsx)(cM,{format:"number",displayMode:"short",className:"grid grid-cols-4 gap-2",value:a,onValueChange:s})]})},cO=e=>{let{minutes:t,hours:r,onMinutesChange:a,onHoursChange:s,customMinutes:n,onCustomMinutesChange:l,customHours:o,onCustomHoursChange:i,cronExpression:d}=e,c="custom"===t,u="custom"===r;return(0,S.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,S.jsx)("div",{className:"flex flex-col gap-2",children:(0,S.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("label",{htmlFor:"minutes-select",className:"text-sm",children:"Minutes"}),c&&(0,S.jsx)("button",{className:"text-muted-foreground text-xs underline",onClick:()=>a("*"),children:"Use preset options"})]}),c?(0,S.jsx)(cm,{value:n,onChange:l,type:"minutes",placeholder:"e.g., 0,15,30,45, etc.",cronExpression:d,fieldIndex:0}):(0,S.jsxs)(iW.Ph,{value:t,onValueChange:e=>{a(e),"custom"===e&&l("")},children:[(0,S.jsx)(iW.i4,{id:"minutes-select",className:"h-8! w-full max-w-64",children:(0,S.jsx)(iW.ki,{placeholder:"Select minutes"})}),(0,S.jsxs)(iW.Bw,{children:[cv.map(e=>(0,S.jsx)(iW.Ql,{value:e.value,children:e.label},e.value)),(0,S.jsx)(iW.U$,{}),(0,S.jsx)(iW.Ql,{value:"custom",children:"Custom minutes"})]})]})]})}),(0,S.jsx)("div",{className:"flex flex-col gap-2",children:(0,S.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("label",{htmlFor:"hours-select",className:"text-sm",children:"Hours"}),u&&(0,S.jsx)("button",{className:"text-muted-foreground text-xs underline",onClick:()=>s("*"),children:"Use preset options"})]}),u?(0,S.jsx)(cm,{value:o,onChange:i,type:"hours",placeholder:"e.g., 9,12,17 or 9-17 or 9-17/2",cronExpression:d,fieldIndex:1}):(0,S.jsxs)(iW.Ph,{value:r,onValueChange:e=>{s(e),"custom"===e&&i("")},children:[(0,S.jsx)(iW.i4,{id:"hours-select",className:"h-8! w-full max-w-64",children:(0,S.jsx)(iW.ki,{placeholder:"Select hours"})}),(0,S.jsxs)(iW.Bw,{children:[cj.map(e=>(0,S.jsx)(iW.Ql,{value:e.value,children:e.label},e.value)),(0,S.jsx)(iW.U$,{}),(0,S.jsx)(iW.Ql,{value:"custom",children:"Custom hours"})]})]})]})})]})};var cZ=e=>{let{value:t,onChange:r}=e,[a,s]=(0,K.useState)("*"),[n,l]=(0,K.useState)("*"),[o,i]=(0,K.useState)("*"),[d,c]=(0,K.useState)("*"),[u,m]=(0,K.useState)("*"),[p,x]=(0,K.useState)("dow"),[h,g]=(0,K.useState)([]),[f,v]=(0,K.useState)([]),[j,b]=(0,K.useState)(""),[_,y]=(0,K.useState)(""),[w,N]=(0,K.useState)(""),[k,C]=(0,K.useState)(""),[I,T]=(0,K.useState)(""),E=(0,K.useRef)(!1),M=(0,K.useRef)(void 0);(0,K.useEffect)(()=>{if(!(null==t?void 0:t.cron_expression))return;let e=t.cron_expression;if(e===M.current)return;let r=function(e){let t,r,a,s,n,l,o;if(!e||""===e.trim())return null;let i=e.trim().split(/\s+/);if(5!==i.length)return null;let[d,c,u,m,p]=i,x=d;cy(d,cp)?x=d:(x="custom",t=d);let h=c;cy(c,cx)?h=c:(h="custom",r=c);let g="dow";"*"!==u&&"*"===p?g="dom":"*"!==p&&"*"===u?g="dow":"*"!==u&&"*"!==p&&(g="dow");let f=m;if(cy(m,cf))f=m;else if(m.includes(",")){let e=m.split(",").map(e=>parseInt(e.trim(),10)).filter(e=>!isNaN(e)&&e>=1&&e<=12);e.length===m.split(",").length&&e.length>0?(f="custom",a=e):f="custom-input"}else if(m.includes("-")||m.includes("/"))f="custom-input";else{let e=parseInt(m,10);!isNaN(e)&&e>=1&&e<=12?(f="custom",a=[e]):f="custom-input"}let v=p;if(cy(p,ch))v=p;else if("*/14"!==u||"*"===p||p.includes(",")||p.includes("-")){if("*"!==p&&p.includes(",")){let e=p.split(",").map(e=>parseInt(e.trim(),10)).filter(e=>!isNaN(e)&&e>=0&&e<=6);e.length===p.split(",").length&&e.length>0?(v="custom",s=e):v="custom-input"}else if("*"!==p&&(p.includes("-")||p.includes("/")))v="custom-input";else if("*"!==p){let e=parseInt(p,10);!isNaN(e)&&e>=0&&e<=6?(v="custom",s=[e]):v="custom-input"}}else{let e=parseInt(p,10);!isNaN(e)&&e>=0&&e<=6&&(v=e.toString())}let j=u;return cy(u,cg)?j=u:"?"!==u&&(u.includes(",")||u.includes("-")||u.includes("/"))?(j="custom",n=u):"*"!==u&&"?"!==u&&(j="custom",n=u),"custom-input"===v&&(l=p),"custom-input"===f&&(o=m),{minutes:x,hours:h,daysOfMonth:j,months:f,daysOfWeek:v,scheduleBy:g,customMonths:a,customDaysOfWeek:s,customDaysOfMonth:n,customMinutes:t,customHours:r,customDaysOfWeekInput:l,customMonthsInput:o}}(e);r&&(E.current=!0,s(r.minutes),l(r.hours),i(r.daysOfMonth),c(r.months),m(r.daysOfWeek),x(r.scheduleBy),r.customMonths&&v(r.customMonths),r.customDaysOfWeek&&g(r.customDaysOfWeek),r.customDaysOfMonth&&b(r.customDaysOfMonth),r.customMinutes&&y(r.customMinutes),r.customHours&&N(r.customHours),r.customDaysOfWeekInput?C(r.customDaysOfWeekInput):C(""),r.customMonthsInput?T(r.customMonthsInput):T(""),E.current=!1)},[null==t?void 0:t.cron_expression]),(0,K.useEffect)(()=>{"*"!==u?x("dow"):"*"!==o&&x("dom")},[u,o]);let A=(0,K.useMemo)(()=>(function(e){let t="custom"===e.minutes?e.customMinutes:e.minutes,r="custom"===e.hours?e.customHours:e.hours,a="custom"===e.daysOfMonth?"*":e.daysOfMonth,s="custom"===e.months?"*":e.months,n="custom"===e.daysOfWeek?"*":e.daysOfWeek;"custom"===e.months?s=e.customMonths.length>0?e.customMonths.sort((e,t)=>e-t).join(","):"*":"custom-input"===e.months&&e.customMonthsInput&&(s=e.customMonthsInput),"custom"===e.daysOfWeek?n=e.customDaysOfWeek.length>0?e.customDaysOfWeek.sort((e,t)=>e-t).join(","):"*":"custom-input"===e.daysOfWeek&&e.customDaysOfWeekInput?n=e.customDaysOfWeekInput:"*"!==e.daysOfWeek&&"custom"!==e.daysOfWeek&&"custom-input"!==e.daysOfWeek&&(n=e.daysOfWeek),"custom"===e.daysOfMonth&&e.customDaysOfMonth&&(a=e.customDaysOfMonth);let l="dow"===e.scheduleBy&&"*"!==e.daysOfWeek&&"custom"!==e.daysOfWeek&&("*/14"===e.daysOfMonth||"custom"===e.daysOfMonth&&"*/14"===e.customDaysOfMonth);return"dow"===e.scheduleBy?a=l?"*/14":"*":n="*","".concat(t," ").concat(r," ").concat(a," ").concat(s," ").concat(n)})({minutes:a,hours:n,daysOfMonth:o,months:d,daysOfWeek:u,scheduleBy:p,customMonths:f,customDaysOfWeek:h,customDaysOfMonth:j,customMinutes:_,customHours:w,customDaysOfWeekInput:k,customMonthsInput:I}),[a,n,o,d,u,f,h,j,_,w,p,k,I]);return(0,K.useEffect)(()=>{r&&!E.current&&(M.current=A,r({cron_expression:A,timezone:null==t?void 0:t.timezone}))},[A,r,null==t?void 0:t.timezone]),(0,S.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,S.jsx)(ca,{cronExpression:A}),(0,S.jsx)(cO,{minutes:a,hours:n,onMinutesChange:s,onHoursChange:l,customMinutes:_,onCustomMinutesChange:y,customHours:w,onCustomHoursChange:N,cronExpression:A}),(0,S.jsx)(cw,{daysOfWeek:u,daysOfMonth:o,onDaysOfWeekChange:m,onDaysOfMonthChange:i,customDaysOfWeek:h,onCustomDaysOfWeekChange:g,customDaysOfMonth:j,onCustomDaysOfMonthChange:b,customDaysOfWeekInput:k,onCustomDaysOfWeekInputChange:C,cronExpression:A}),(0,S.jsx)(cA,{value:d,onValueChange:c,customMonths:f,onCustomMonthsChange:v,customMonthsInput:I,onCustomMonthsInputChange:T,cronExpression:A})]})},cz=r(92647);let cP={option:(e,t)=>({...e,backgroundColor:t.isSelected?"var(--accent)":t.isFocused?"var(--accent-foreground/10)":"transparent",color:t.isSelected?"var(--accent-foreground)":"var(--foreground)",cursor:"pointer"}),control:()=>({display:"flex",alignItems:"center"}),menu:e=>({...e,backgroundColor:"var(--background)",border:"1px solid var(--border)"}),singleValue:e=>({...e,color:"var(--foreground)"}),input:e=>({...e,color:"var(--foreground)"}),indicatorSeparator:()=>({display:"none"})};var cD=e=>{var t,r;let{open:a,onOpenChange:s,children:n,existingTrigger:l,isEditMode:o=!1}=e,[i,d]=(0,eK.P)({open:a,onOpenChange:s}),[c,u]=(0,K.useState)("AI"),{userProfile:m,idTokenRef:p}=(0,ec.H)(),x=(0,ez.CG)(R.z4),{currentProject:h}=(0,e0.d2)(),[g,f]=(0,ce.Z)((null==l?void 0:null===(t=l.event)||void 0===t?void 0:t.cron_expression)||void 0),[v,j]=(0,ce.Z)((null==l?void 0:null===(r=l.event)||void 0===r?void 0:r.timezone)||Intl.DateTimeFormat().resolvedOptions().timeZone),[b,_]=(0,ce.Z)((null==l?void 0:l.max_num_failures)||3),[y,{isLoading:w}]=(0,eN.iq)(),N=(0,K.useMemo)(()=>{if(g)try{return i3().toString(g)}catch(e){return}},[g]);(0,K.useMemo)(()=>!!g&&!!N,[g,N]);let k=e=>{f(e.cron_expression),e.timezone&&j(e.timezone)},C=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;X.Am.loading("".concat(o?"Updating":"Creating"," your time trigger..."),{id:"time-trigger-edit-create-dialog"});try{let r={trigger_type:"time_based",event:e,max_num_failures:t||3},a=new ct.x(o&&l?{...l,...r}:{...r,saved_item_id:x.saved_item_id,project_id:null==h?void 0:h.project_id,user_id:m.user_id}),s=await y({trigger:a,userProfile:m,idToken:p.current});if("error"in s){X.Am.error(s.error.data,{id:"time-trigger-edit-create-dialog"});return}X.Am.success("Time trigger ".concat(o?"updated":"created"," successfully."),{id:"time-trigger-edit-create-dialog"}),d(!1)}catch(e){X.Am.error("".concat(e.message),{id:"time-trigger-edit-create-dialog"})}};return(0,S.jsxs)(eq.Vq,{open:i||w,onOpenChange:e=>{d(e)},children:[n&&(0,S.jsx)(eq.hg,{asChild:!0,children:n}),(0,S.jsxs)(eq.cZ,{className:"max-w-4xl overflow-visible lg:min-w-xl",children:[(0,S.jsxs)(eq.a7,{children:[(0,S.jsxs)(eq.fK,{children:[(0,S.jsx)(eq.$N,{children:o?"Edit Time Trigger":"Create Time Trigger"}),(0,S.jsx)(eq.Be,{children:"Describe how often you want this to run."})]}),(0,S.jsxs)("div",{className:"flex flex-col gap-4",children:["AI"===c&&(0,S.jsx)(cz.Z,{value:{cron_expression:g,timezone:v},onChange:k}),"manual"===c&&(0,S.jsx)(cZ,{value:{cron_expression:g,timezone:v},onChange:k}),(0,S.jsx)(ta.Z,{className:"my-2"}),(0,S.jsxs)("label",{className:"flex flex-row items-center justify-between gap-2",children:[(0,S.jsx)("label",{className:"text-sm",children:"Timezone"}),(0,S.jsx)(d7.ZP,{value:v,onChange:e=>{j(e.value)},className:"focus:border-accent-foreground w-fit min-w-60 cursor-default text-sm focus:ring-0 focus:outline-none",menuPlacement:"top",styles:cP})]}),(0,S.jsx)(cr,{count:b,setCount:_})]})]}),(0,S.jsxs)(eq.cN,{children:[(0,S.jsxs)("label",{className:"mr-auto flex cursor-pointer flex-row items-center gap-2 select-none",children:[(0,S.jsx)(eX.r,{checked:"manual"===c,onCheckedChange:e=>{u(e?"manual":"AI")},id:"use-ai-switch",name:"use-ai-switch"}),(0,S.jsx)("div",{className:(0,eu.cn)("text-muted-foreground text-sm","manual"===c&&"text-accent-foreground"),children:"Manual"})]}),(0,S.jsx)(el.zx,{onClick:()=>{C({cron_expression:g,timezone:v},b)},disabled:!N,loading:w,children:o?"Update":"Create"})]})]})]})},cL=(0,K.memo)(e=>{let{minimal:t,iconContainerClassName:r,iconSize:a=22,keyboardIndex:s}=e,[n,l]=(0,K.useState)(!1),[o,i]=(0,K.useState)(!1),{userProfile:d,idTokenRef:c}=(0,ec.H)(),{isUserAuthorAndSaved:u,title:m,subtitle:p,state:x,trigger:h}=cR(),[g,{isLoading:f}]=(0,eN.vs)(),v=async e=>{if(h){e.stopPropagation(),i(!1);try{X.Am.loading("Deleting trigger...",{id:"delete-time-trigger"}),await g({trigger:h,userProfile:d,idToken:c.current}),X.Am.success("Trigger deleted successfully.",{id:"delete-time-trigger"})}catch(e){X.Am.error(e.message,{id:"delete-time-trigger"})}}},j=(0,K.useCallback)(()=>{u&&l(!0)},[u]),b=(0,K.useCallback)(e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),j())},[j]);return(0,S.jsx)("div",{className:"flex flex-col gap-4",children:(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsxs)("div",{className:(0,eu.cn)("group/trigger-card flex w-full flex-grow cursor-pointer items-center gap-2.5 rounded-md px-2 py-1.5 text-left",u?"focus-within:bg-pink-50/70 hover:bg-pink-50/70":"cursor-not-allowed opacity-70",!t&&"bg-pink-50",x.hasActiveTrigger&&"bg-success/50 hover:bg-success/70 focus-within:bg-success/70"),onClick:j,onKeyDown:b,role:"button",tabIndex:0,"data-kb-index":s,children:[(0,S.jsxs)("div",{className:(0,eu.cn)("group/icon-container flex size-12 flex-none items-center justify-center rounded-md border border-pink-200/50 bg-pink-100 text-pink-700",r,x.hasActiveTrigger&&"border-success-foreground/25 bg-success text-success-foreground"),children:[(0,S.jsx)(d6.Z,{size:a,className:(0,eu.cn)(x.hasActiveTrigger&&"group-hover/trigger-card:hidden")}),(0,S.jsx)(aL.Z,{size:a-2,className:(0,eu.cn)("hidden",x.hasActiveTrigger&&"hidden group-hover/trigger-card:block")})]}),(0,S.jsxs)("div",{className:(0,eu.cn)("flex w-full flex-col items-start overflow-hidden",!t&&"text-pink-700",x.hasActiveTrigger&&"text-success-foreground"),children:[(0,S.jsxs)("span",{className:"flex w-full items-center justify-between gap-1.5",children:[(0,S.jsx)("span",{className:"w-full truncate text-sm font-medium",children:m}),x.hasActiveTrigger&&(0,S.jsxs)("div",{onClick:e=>e.stopPropagation(),children:[(0,S.jsx)(el.zx,{onClick:()=>i(!0),variant:"ghost",size:"icon-xs",className:(0,eu.cn)("hover:border-border border border-transparent hover:border-pink-200 hover:bg-pink-100",!t&&"text-pink-700",x.hasActiveTrigger&&"hover:border-success-foreground/20 hover:bg-success text-success-foreground bg-transparent"),disabled:f,children:(0,S.jsx)(d8.Z,{size:14})}),(0,S.jsxs)(tc.h_,{open:o,onOpenChange:i,children:[(0,S.jsx)(tc.$F,{asChild:!0,children:(0,S.jsx)("span",{})}),(0,S.jsxs)(tc.AW,{className:"flex w-48 flex-col p-1",align:"end",children:[(0,S.jsxs)(tc.Xi,{onClick:e=>{h&&(e.stopPropagation(),i(!1),l(!0))},disabled:f,className:"hover:bg-muted! hover:text-foreground!",children:["Edit",(0,S.jsx)(aL.Z,{className:"ml-auto"})]}),x.hasActiveTrigger&&(0,S.jsxs)(tc.Xi,{onClick:v,disabled:f,className:"hover:bg-destructive! hover:text-destructive-foreground!",children:["Delete",(0,S.jsx)(rt.Z,{className:"ml-auto"})]})]})]})]})]}),(0,S.jsx)("span",{className:(0,eu.cn)("line-clamp-2 text-xs"),children:p})]})]})}),!u&&(0,S.jsx)(eo._v,{children:"Please save your flow to create a time trigger"})]}),(0,S.jsx)(cD,{open:n,onOpenChange:l,existingTrigger:h,isEditMode:!!h})]})})});let cR=()=>{let e=(0,ez.CG)(R.z4),{userProfile:t}=(0,ec.H)(),{currentProject:r}=(0,e0.d2)(),a=(0,K.useMemo)(()=>(null==e?void 0:e.author_id)&&(e.author_id===(null==t?void 0:t.user_id)||e.author_id===(null==r?void 0:r.project_id)),[e,t,r]),s=e&&e.is_saved()&&a,n=(0,ez.CG)(t=>(0,tZ.K)(t,(null==e?void 0:e.saved_item_id)||"")),l=(0,K.useMemo)(()=>n.find(e=>"time_based"===e.trigger_type&&e.is_active&&e.user_id===(null==t?void 0:t.user_id)),[n,null==t?void 0:t.user_id]),o=(0,K.useMemo)(()=>l?cF(l):"Schedule your flow to run at specified times.",[l]);return{isUserAuthorAndSaved:s,title:(0,K.useMemo)(()=>l?"Time Trigger":"Create a Time Trigger",[l]),subtitle:o,state:{hasActiveTrigger:void 0!==l},trigger:l}},cF=e=>"time_based"===e.trigger_type?"Triggering ".concat(i3().toString(e.event.cron_expression,{verbose:!0}).toLowerCase()):"",cG=(0,K.memo)(e=>{let{template:t,onTemplateClick:r,keyboardIndex:a}=e,s=(0,ez.CG)(eb.qf),n=(0,ez.TL)();return(0,S.jsx)(eq.GG,{className:"focus-within:bg-muted/70 hover:bg-muted/70 rounded-md px-2 py-1.5",children:(0,S.jsx)(nQ,{title:s?"Edit Interface":"Create a Interface",description:s?"Make changes to your interface to share with others":"Share your workflow as a interface that can be triggered",icon:"FilePen",isDraggable:!1,iconSize:20,IconContainerClassName:"size-10",onClick:s?()=>{n((0,G.de)(!0))}:()=>{r(t.id)},"data-kb-index":a})})});cG.displayName="NodePaletteInterfaceItem";let cU=(0,K.memo)(e=>{let{template:t,onTemplateClick:r,keyboardIndex:a}=e;return(null==t?void 0:t.type)==="time-trigger"?(0,S.jsx)(cL,{iconContainerClassName:"size-10",iconSize:20,keyboardIndex:a},t.id):(null==t?void 0:t.type)==="custom-node-builder"?t.serverId?(0,S.jsx)(d4,{template:t,onTemplateClick:r,keyboardIndex:a},t.id):(0,S.jsx)(n0,{onNodeClickToAdd:()=>r(t.id),iconContainerClassName:"size-10",iconSize:20,keyboardIndex:a},t.id):(null==t?void 0:t.type)==="interface"?(0,S.jsx)(cG,{template:t,onTemplateClick:r,keyboardIndex:a},t.id):(null==t?void 0:t.type)?(0,S.jsx)(d4,{template:t,onTemplateClick:r,keyboardIndex:a},t.id):null});cU.displayName="NodePaletteListItem";let cB={search:{templates:{useFuzzy:!0,threshold:.2,ignoreLocation:!0},categories:{useFuzzy:!0,threshold:.2,ignoreLocation:!0},haystacks:{categories:{default:[{key:"name",fallback:""},"description","kind",{key:"supportsMCP",fallback:!1,tokens:["mcp","mcp server"]},{key:"supportsTriggers",fallback:!1,tokens:["trigger","triggers"]}],subflow:[{key:"name",fallback:"Subflows"},{key:"description",fallback:"Subflow nodes"},"kind"]},templates:{default:[{key:"name",fallback:"Node"},{key:"category",fallback:"Nodes"},{key:"type",fallback:"unknown"},{key:"isTrigger",fallback:!1,tokens:["trigger","triggers"]}],"time-trigger":[{key:"name",fallback:"Create a Time Trigger"},{key:"category",fallback:"Triggers"},{key:"type",fallback:"time-trigger"},{key:"isTrigger",fallback:!0,tokens:["trigger","triggers","time"]}],subflow:[{key:"name",fallback:"Untitled subflow"},{key:"category",fallback:"Subflows"},{key:"flowbookName",fallback:"Unknown flowbook"},{key:"external",fallback:!1}],interface:[{key:"name",fallback:"Create a Interface"},{key:"category",fallback:"Flow Basics"},{key:"type",fallback:"interface"}],custom:[{key:"name"}],"custom-node-builder":[{key:"name",tokens:["custom","custom node","create a custom node"]},{key:"category"}]}}},ranking:{root:{templateTypePriority:["time-trigger","interface","integration","custom"],categoryPriority:["Your Custom Node"],pinTypesWithinCategory:["custom-node-builder"]},templates:{templateTypePriority:["custom-node-builder","time-trigger","interface","integration","custom"]}},categories:{defaultCategoryName:"Nodes",hiddenCategoryNames:["mega_node","Subflows"],typeCategoryResolution:{default:{primaryField:"category"},custom:{primaryField:"metadataCategory",fallbackField:"category"},"custom-node-builder":{primaryField:"category"},"time-trigger":{primaryField:"category"},interface:{primaryField:"category"},native:{primaryField:"category"},integration:{primaryField:"category"},subflow:{primaryField:"category"}}},navigation:{groupToCategoryOverrides:{subflows:"automation"}},graph:{pseudoCategories:[{name:"Triggers",field:"isTrigger",match:{truthy:!0}}],featuredTemplates:{names:["Ask AI","Input","Extract Data","Output","Agent","Router"],types:["native"]},hideEmptyCategoriesInGroups:["Integrations"]}},cV=(0,K.memo)(e=>{let{graph:t,filteredRootTemplates:r,normalizedTerm:a,onTemplateClick:s}=e,n=(0,K.useMemo)(()=>(function(e){var t;let{ranking:r,categories:a}=cB,s=r.root,n=e=>{var t;let r=null!==(t=a.typeCategoryResolution[e.type])&&void 0!==t?t:a.typeCategoryResolution.default,s=[(null==r?void 0:r.primaryField)?e[r.primaryField]:void 0,(null==r?void 0:r.fallbackField)?e[r.fallbackField]:void 0,a.defaultCategoryName].find(e=>"string"==typeof e&&e.trim().length>0);return"string"==typeof s&&s.trim().length>0?s:a.defaultCategoryName},l=[],o=new Map;e.templateIds.forEach(t=>{var r;let i=e.graph.templatesById.get(t);if(!i)return;let d=n(i);if(a.hiddenCategoryNames.includes(d))return;o.has(d)||(o.set(d,[]),l.push(d));let c=o.get(d);c&&((null===(r=s.pinTypesWithinCategory)||void 0===r?void 0:r.includes(i.type))?c.unshift(t):c.push(t))});let i=new Set(null!==(t=s.categoryPriority)&&void 0!==t?t:[]),d=[],c=[];return l.forEach(e=>i.has(e)?d.push(e):c.push(e)),[...d,...c].map(t=>{var r;return{categoryName:t,category:e.graph.categoriesById.get(t),templateIds:null!==(r=o.get(t))&&void 0!==r?r:[]}})})({graph:t,templateIds:r}),[t,r]),{getNextIndex:l,resetIndex:o}=dQ({dependencies:[r.length]});return(o(),0===r.length)?(0,S.jsx)(r3.Z,{title:'No results for "'.concat(a,'"'),description:"Didn't find what you're looking for? Create a custom node with âŒ˜ â‡§ G",Icon:o0.Z}):(0,S.jsx)("div",{className:"flex h-full flex-col gap-2 overflow-y-auto p-2.5",children:n.map(e=>{let{categoryName:r,category:a,templateIds:n}=e;return(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{className:"text-foreground text-muted-foreground flex items-center gap-2 px-2 pb-1 text-sm",style:a?(0,ro.J8)(a.name):void 0,children:[(null==a?void 0:a.icon)?(0,S.jsx)("span",{children:(0,rj.hY)(a.icon,16)}):null,(0,S.jsx)("p",{children:r})]}),(0,S.jsx)("div",{className:"flex flex-col",children:n.map(e=>{let r=t.templatesById.get(e);if(!r)return null;let a=r.isRestricted?void 0:l();return(0,S.jsx)(cU,{template:r,onTemplateClick:s,keyboardIndex:a},e)})})]},r)})})});cV.displayName="NodePaletteRootSearchResults";var cW=r(92290);let cH=(0,K.memo)(e=>{let{template:t,onTemplateClick:r,showLink:a=!0,keyboardIndex:s}=e,n=[],l=t.savedItem.inputs.length,o=t.savedItem.outputs.length,i=l>0,d=o>0;if(i||d){let e=i?"".concat(l," ").concat((0,e5.Ri)(l,"input")):"no inputs",t=d?"".concat(o," ").concat((0,e5.Ri)(o,"output")):"no outputs";n.push(e,t)}else n.push("");let c=n.join(", ");return(0,S.jsx)(dX,{category:t.category,onClick:()=>r(t.id),type:t.type,icon:t.icon,title:t.name,subtitle:c,iconSize:18,"data-kb-index":s,children:(0,S.jsx)(cJ,{template:t,showLink:a})},t.id)});cH.displayName="NodePaletteSubflowItem";let cJ=(0,K.memo)(e=>{let{template:t,showLink:r=!0}=e;return(0,S.jsxs)("div",{className:"group flex items-center gap-2",children:[(0,S.jsx)(cW.Z,{keyOperators:t.savedItem.key_operators,operatorIconClassName:"size-7",className:"group-hover:bg-muted!"}),r&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-sm",className:"text-muted-foreground hover:bg-background hover:border-border",asChild:!0,children:(0,S.jsx)(es(),{href:"/pipeline?workbook_id=".concat(t.flowbookId),target:"_blank",onClick:e=>e.stopPropagation(),children:(0,S.jsx)(eG.Z,{})})})}),(0,S.jsx)(eo._v,{side:"top",align:"end",children:"View Flow in New Tab"})]})]})});cJ.displayName="SubflowItemActions";let cq=(0,K.memo)(e=>{let{subflowTemplates:t,searchTerm:r,onTemplateClick:a}=e,[s,n]=(0,K.useState)("this-workbook"),l=(0,ez.CG)(R.AV),o=(0,ez.CG)(R.ai),i=(0,K.useMemo)(()=>t.filter(e=>e.savedItemId!==l),[t,l]),d=(0,K.useMemo)(()=>i.map(e=>({savedItemId:e.savedItemId,flowbookId:e.flowbookId,name:e.name})),[i]),c=(0,K.useMemo)(()=>(function(e){let t=new Set,r=[];return e.forEach(e=>{var a,s,n;let l=e.flowbookId;!l||t.has(l)||(t.add(l),r.push({flowbookId:l,name:null!==(n=null!==(s=null===(a=e.flowbook)||void 0===a?void 0:a.name)&&void 0!==s?s:e.flowbookName)&&void 0!==n?n:"Untitled Flowbook"}))}),r})(i),[i]),u=(0,K.useMemo)(()=>new am.Z(c,{keys:["name"],threshold:.1,ignoreLocation:!0}),[c]),m=(0,K.useMemo)(()=>new am.Z(d,{keys:["name"],threshold:.2,ignoreLocation:!0}),[d]),p=(0,K.useMemo)(()=>r?new Set(u.search(r).map(e=>e.item.flowbookId)):new Set,[r,u]),x=(0,K.useMemo)(()=>r?new Set(m.search(r).map(e=>e.item.savedItemId)):new Set,[r,m]),h=(0,K.useMemo)(()=>{if(!r)return i;let e=p.size>0;return i.filter(t=>{let r=p.has(t.flowbookId),a=x.has(t.savedItemId);return e&&r||a})},[r,i,p,x]),g=(0,K.useMemo)(()=>h.filter(e=>e.external),[h]),f=(0,K.useMemo)(()=>h.filter(e=>o.includes(e.savedItemId)),[h,o]),v=(0,K.useMemo)(()=>(function(e){let t=[],r=new Map;return e.forEach(e=>{let a=e.flowbookId;r.has(a)||(r.set(a,{flowbook:e.flowbook,templates:[]}),t.push(a));let s=r.get(a);s&&(!s.flowbook&&e.flowbook&&(s.flowbook=e.flowbook),s.templates.push(e))}),t.map(e=>{var t;let a=r.get(e),s=null!==(t=null==a?void 0:a.templates)&&void 0!==t?t:[];return{flowbookId:e,flowbook:null==a?void 0:a.flowbook,templates:s}})})(g),[g]);return(0,K.useMemo)(()=>v.reduce((e,t)=>e+t.templates.length,0),[v]),(0,S.jsx)("div",{className:"relative flex h-full flex-col overflow-hidden",children:(0,S.jsxs)(eZ.mQ,{value:s,onValueChange:e=>n(e),className:"flex h-full grow-1 flex-col",children:[(0,S.jsxs)(eZ.dr,{variant:"default",className:"bg-elevated flex w-full",children:[(0,S.jsx)(eZ.SP,{value:"this-workbook",size:"sm",className:"flex-1",children:"This Workbook"}),(0,S.jsx)(eZ.SP,{value:"all-flows",size:"sm",className:"flex-1",children:"Workspace Subflows"})]}),(0,S.jsx)(eZ.nU,{value:"this-workbook",className:"flex h-full grow-1 flex-col overflow-y-auto p-2.5",children:(0,S.jsx)(cK,{localSubflowTemplates:f,onTemplateClick:a,searchTerm:r})}),(0,S.jsx)(eZ.nU,{value:"all-flows",className:"flex h-full grow-1 flex-col overflow-y-auto p-2.5",children:(0,S.jsx)(cY,{groupedGlobalSubflows:v,onTemplateClick:a,searchTerm:r})})]})})});cq.displayName="NodePaletteSubflowCategory";let cK=e=>{let{localSubflowTemplates:t,onTemplateClick:r,searchTerm:a}=e,{getNextIndex:s,resetIndex:n}=dQ({dependencies:[t.length]});return n(),t.length>0?(0,S.jsx)("div",{className:"flex flex-col gap-2",children:t.map(e=>(0,S.jsx)(cH,{template:e,onTemplateClick:r,showLink:!1,keyboardIndex:s()},e.savedItemId))}):(0,S.jsx)(r3.Z,{title:a?"No Subflows Found":"No Subflows in This Workbook",description:a?"Try looking for something else":"Create a new tab, and use it as a node in your flow.",Icon:rw.Z})},cY=e=>{let{onTemplateClick:t,searchTerm:r,groupedGlobalSubflows:a}=e,{getNextIndex:s,resetIndex:n}=dQ({dependencies:[a.length]});return n(),a.length>0?(0,S.jsx)("div",{className:"flex flex-col gap-2",children:a.map(e=>{var r,a,n;let{flowbookId:l,flowbook:o,templates:i}=e;return(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{className:"flex flex-row items-center gap-2 px-2 pb-0.5",children:[(0,S.jsx)("p",{className:"text-muted-foreground text-sm font-medium",children:null!==(r=null==o?void 0:o.name)&&void 0!==r?r:"Untitled Flowbook"}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(e$.Z,{className:"text-muted-foreground size-3 cursor-help"})}),(0,S.jsx)(eo._v,{className:"flex flex-col gap-2",children:(0,S.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,S.jsx)(e2.Z,{src:null==o?void 0:o.creator_profile_picture,name:null!==(a=null==o?void 0:o.creatorDisplayName())&&void 0!==a?a:"Untitled Flowbook",className:"size-5 rounded-sm text-[10px]"}),(0,S.jsx)("p",{className:"",children:null!==(n=null==o?void 0:o.creatorDisplayName())&&void 0!==n?n:"Untitled Flowbook"})]})})]})]}),(0,S.jsx)("div",{className:"flex flex-col gap-2",children:i.map(e=>(0,S.jsx)(cH,{template:e,onTemplateClick:t,keyboardIndex:s()},e.savedItemId))})]},l)})}):(0,S.jsx)(r3.Z,{title:r?"No Global Subflows Found":"No Global Subflows",description:r?"Try looking for something else":"Create a global subflow by saving a flow to reuse it across workbooks.",Icon:rw.Z})},c$=(0,K.memo)(e=>{let{graph:t,filteredTemplates:r,categoryName:a,onTemplateClick:s}=e,{getNextIndex:n,resetIndex:l}=dQ({dependencies:[r.length]});return(l(),0===r.length)?(0,S.jsx)(r3.Z,{title:"Your Custom Nodes"===a?"No Custom Nodes Found":"No ".concat(a," Nodes Found"),description:"Your Custom Nodes"===a?"Try creating a custom node with âŒ˜ â‡§ G":"Try searching for something else, or create a custom node with âŒ˜ â‡§ G",Icon:o0.Z,className:"flex grow-1 flex-col"}):(0,S.jsx)("div",{className:"flex h-full flex-col overflow-y-auto p-2.5",children:r.map(e=>{let r=t.templatesById.get(e);if(!r)return null;let a=r.isRestricted?void 0:n();return(0,S.jsx)(cU,{template:r,onTemplateClick:s,keyboardIndex:a},r.id)})})});c$.displayName="NodePaletteTemplateList";let cQ=e=>{let{graph:t,visible:r,normalizedTerm:a,filteredRootTemplates:s,filteredCategories:n,filteredTemplates:l,handleGroupClick:o,handleCategoryClick:i,isSubflowCategory:d,currentCategory:c,onTemplateClick:u}=e,m=(0,K.useMemo)(()=>{let e=[];return t.templatesById.forEach(t=>{"subflow"===t.type&&e.push(t)}),e},[t.templatesById]);if("root"===r.view&&""===a)return(0,S.jsx)(d3,{graph:t,onGroupClick:o,onCategoryClick:i,onTemplateClick:u});if("root"===r.view)return(0,S.jsx)(cV,{graph:t,filteredRootTemplates:s,normalizedTerm:a,onTemplateClick:u});if("categories"===r.view)return(0,S.jsx)(d2,{graph:t,filteredCategories:n,onCategoryClick:i});if("templates"===r.view){var p;return d?(0,S.jsx)(cq,{subflowTemplates:m,searchTerm:a,onTemplateClick:u}):(0,S.jsx)(c$,{graph:t,filteredTemplates:l,categoryName:null!==(p=null==c?void 0:c.name)&&void 0!==p?p:r.categoryId,onTemplateClick:u})}return(0,S.jsx)(r3.Z,{Icon:o0.Z,title:"No Nodes Found",description:"Refresh the page to try again"})};var cX=r(15432),c0=r(64647);let c1=e=>{let{view:t,currentLabel:r}=e;return(0,S.jsxs)("div",{className:"mt-auto hidden h-10 md:block",children:[(0,S.jsx)(ta.Z,{}),(0,S.jsxs)("div",{className:"text-muted-foreground flex h-full flex-row items-center justify-between px-3 text-xs",children:[(0,S.jsxs)("div",{className:"flex items-center gap-3",children:[(0,S.jsxs)(c5,{children:[(0,S.jsxs)("div",{className:"flex items-center gap-1",children:[(0,S.jsx)(c2,{children:(0,S.jsx)(cX.Z,{className:"size-2.5"})}),(0,S.jsx)(c2,{children:(0,S.jsx)(to.Z,{className:"size-2.5"})})]}),"Navigate"]}),(0,S.jsxs)(c5,{children:[(0,S.jsx)(c2,{children:(0,S.jsx)(c0.Z,{className:"size-2.5"})}),"Select"]}),null]}),(0,S.jsxs)(c5,{children:[(0,S.jsx)(c2,{className:"w-fit px-1 text-[10px]",children:"Esc"}),"Close"]})]})]})},c2=e=>{let{children:t,className:r}=e;return(0,S.jsx)("span",{className:(0,eu.cn)("bg-background flex h-4 w-4 items-center justify-center rounded border",r),children:t})},c5=e=>{let{children:t,className:r}=e;return(0,S.jsx)("span",{className:(0,eu.cn)("text-foreground/80 text-muted-foreground flex items-center gap-1.5",r),children:t})};var c4=e=>{let{onChange:t,value:r,onEmptySearchNavigateBack:a,canGoBack:s,onBack:n,viewContext:l,onEnterPress:o}=e,i="root"!==l.type&&(l.label||l.icon),d="root"===l.type?"Search nodes...":"Search ".concat(l.label,"..."),{focusIndex:c}=dQ({enabled:!1}),u=()=>0!==document.querySelectorAll("[data-kb-index]").length&&(c(0),!0),m=()=>{let e=document.querySelectorAll("[data-kb-index]").length;return 0!==e&&(c(e-1),!0)};return(0,S.jsxs)("div",{children:[(0,S.jsxs)("label",{htmlFor:"node-palette-search",className:(0,eu.cn)("flex flex-row items-center px-3",s&&"px-1.5"),children:[s?(0,S.jsx)(el.zx,{variant:"muted",size:"icon-xs",onClick:()=>n(),className:"rounded-md",children:(0,S.jsx)(lY.Z,{className:"text-muted-foreground size-4"})}):(0,S.jsx)(lN.Z,{className:"text-muted-foreground mx-0.5 mt-[1px] size-4"}),(0,S.jsxs)("div",{className:"flex w-full items-center",children:[(0,S.jsx)(ax.I,{id:"node-palette-search",variant:"transparent",className:(0,eu.cn)("w-full pr-0",s?"pl-1.5":"pl-2"),type:"text",size:"lg",placeholder:d,value:r,onChange:e=>t(e.target.value),onKeyDown:e=>{if("ArrowDown"===e.key||"ArrowRight"===e.key){u()&&e.preventDefault();return}if("ArrowUp"===e.key||"ArrowLeft"===e.key){m()&&e.preventDefault();return}if("Enter"===e.key){e.preventDefault(),null==o||o();return}("Backspace"===e.key||"Delete"===e.key)&&0===r.trim().length&&a()},autoFocus:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false"}),i?(0,S.jsx)(c3,{icon:l.icon,label:l.label}):null]})]}),(0,S.jsx)(ta.Z,{})]})};let c3=e=>{let{icon:t,label:r}=e;return(0,S.jsxs)("div",{className:"text-muted-foreground flex items-center gap-1.5 pr-2 text-xs select-none",children:[t?(0,S.jsx)("span",{className:"flex h-6 w-6 items-center justify-center rounded-md border",children:(0,rj.Fp)(t)?(0,rj.Zu)(t,12):(0,rj.hY)(t,12)}):null,(0,S.jsx)("span",{className:"truncate",children:r})]})};var c9=r(68797);function c6(e,t){var r,a;if("root"===t.type)return[{type:"root"}];let s="group"===t.type?null!==(a=cB.navigation.groupToCategoryOverrides[t.groupId.toLowerCase()])&&void 0!==a?a:cB.navigation.groupToCategoryOverrides[t.groupId]:void 0,n="group"===t.type&&(null===(r=ro.nt[t.groupId])||void 0===r?void 0:r.type)===c9.MT.CATEGORY;return"group"===t.type&&s?[...e,{type:"category",categoryId:s}]:n?[...e,{type:"category",categoryId:t.groupId}]:[...e,t]}function c8(e){return e.length<=1?e:e.slice(0,-1)}function c7(e){var t;return 0===e.length?{type:"root"}:null!==(t=e[e.length-1])&&void 0!==t?t:{type:"root"}}let ue=cB.search.haystacks;function ut(e,t,r){return e?t.map(t=>{let r="string"==typeof t?t:t.key,a=e[r],s="object"==typeof t&&"fallback"in t?t.fallback:"",n="object"==typeof t&&t.tokens?t.tokens:[];return null==a||""===a?String(null!=s?s:""):!0===a?(n.length?n:[String(r).toLowerCase()]).join(" "):!1===a?String(null!=s?s:""):n.length>0&&"string"==typeof a?n.join(" "):String(a)}).join(" ").toLowerCase():r.toLowerCase()}function ur(e){let t=e.split(/\s+/).filter(Boolean),r=t.length>1;return a=>!!a&&!!e&&(!!a.includes(e)||!!r&&t.every(e=>a.includes(e)))}function ua(e,t,r){if(!t)return e;let a=ur(t);if(null==r?void 0:r.templateFuse){let a=new Set(e),s=r.templateFuse.search(t).map(e=>e.item.id).filter(e=>a.has(e));if(s.length)return s}return(null==r?void 0:r.templateHaystackById)?e.filter(e=>a(r.templateHaystackById.get(e))):e}function us(e,t,r){if(!e.length||!r.length)return e;let a=new Map,s=[];for(let n of(r.forEach(e=>a.set(e,[])),e)){let e=t.get(n),r=e?a.get(e.type):void 0;r?r.push(n):s.push(n)}let n=[];return r.forEach(e=>{let t=a.get(e);(null==t?void 0:t.length)&&n.push(...t)}),s.length&&n.push(...s),n}let un={categories:Object.fromEntries(Object.entries(null!==(p=ue.categories)&&void 0!==p?p:{}).map(e=>{var t;let[r,a]=e;return[r,(t=null!=a?a:[],e=>{let{categoryId:r,category:a}=e;return ut(null!=a?a:{name:r},t,r)})]})),templates:Object.fromEntries(Object.entries(null!==(x=ue.templates)&&void 0!==x?x:{}).map(e=>{var t;let[r,a]=e;return[r,(t=null!=a?a:[],e=>ut(e,t,""))]}))},ul=(e,t)=>"".concat(e,":::::").concat(t);function uo(e){let t=!!e.is_trigger_node,r=e.category&&ro.PE.some(t=>t.name.toLowerCase()===e.category.toLowerCase());return{id:ul(e.category,e.name),name:e.name,description:e.description,icon:e.icon,category:e.category,type:r?"integration":"native",isTrigger:t,version:e.version,declaration:e,isRestricted:!!e.is_restricted}}function ui(e){var t,r,a,s,n,l;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"owned",i=e.operator_declaration,d=e.operator_id;return{id:d,name:null!==(r=null==i?void 0:i.name)&&void 0!==r?r:"Custom Node",description:null!==(a=null==i?void 0:i.description)&&void 0!==a?a:"",icon:null!==(s=null==i?void 0:i.icon)&&void 0!==s?s:"",category:null!==(n=null==i?void 0:i.category)&&void 0!==n?n:"Your Custom Nodes",type:"custom",version:null!==(l=null==i?void 0:i.version)&&void 0!==l?l:"v0_01",operatorId:d,visibility:o,metadataCategory:null===(t=e.metadata)||void 0===t?void 0:t.category,customOperator:e,isRestricted:!!(null==i?void 0:i.is_restricted)}}let ud=(0,K.memo)(e=>{let{onNodeClickToAdd:t}=e,{graph:r}=function(){let e=(0,ez.CG)(z.X3),t=(0,ez.CG)(rh.SN.selectMCPDeclarations),r=(0,ez.CG)(rh.SN.selectMCPDeclarationMapByCategory),a=(0,ez.CG)(rb.tY),s=(0,ez.CG)(rb.Yt),n=(0,ez.CG)(rb.Eo),l=(0,ez.CG)(rb.Af),o=(0,ez.CG)(B.v2),i=(0,ez.CG)(B.XR),d=(0,ez.CG)(R.AV),{userProfile:c}=(0,ec.H)(),u=(0,K.useMemo)(()=>e.map(uo),[e]),m=(0,K.useMemo)(()=>Object.values(r).map(e=>{var t;return t=!!((null==c?void 0:c.is_mega_node_creation_restricted)||e.is_restricted),{id:"virtual-mcp-".concat(e.server_id),name:"Create ".concat(rv.Z_.withArticle(e.category)," Node With AI"),description:"Harness the power of MCP to create a custom node",icon:"Wand2",category:e.category,type:"custom-node-builder",serverId:e.server_id,isRestricted:t}}),[r,null==c?void 0:c.is_mega_node_creation_restricted]),p=(0,K.useMemo)(()=>a.map(e=>ui(e,"owned")),[a]),x=(0,K.useMemo)(()=>s.map(e=>ui(e,"shared")),[s]),h=(0,K.useMemo)(()=>n.map(e=>ui(e,"project")),[n]),g=(0,K.useMemo)(()=>l.map(e=>ui(e,"organization")),[l]),f=(0,K.useMemo)(()=>[{id:"virtual-time-trigger",name:"Create a Time Trigger",description:"Schedule your automation to run at specified times",icon:"TimerReset",category:"Triggers",type:"time-trigger",isRestricted:!1},{id:"virtual-custom-node-builder",name:"Create a Custom Node",description:"Tell AI what you want this node to do",icon:"Wand2",category:"Your Custom Nodes",type:"custom-node-builder",isRestricted:!1},{id:"virtual-interface",name:"Create a Interface",description:"Interfaces allow you to share your workflow as a form that anyone can easily use",icon:"FilePen",category:"Flow Basics",type:"interface",isRestricted:!1}],[]),v=(0,K.useMemo)(()=>o.map(e=>{var t,r,a,s,n,l,o,c,u;return r=i.get(null!==(t=e.saved_item_id)&&void 0!==t?t:""),a=null!=d?d:"",{id:null!==(s=e.saved_item_id)&&void 0!==s?s:"",name:e.name,icon:null!==(n=e.icon)&&void 0!==n?n:"",category:"Subflows",type:"subflow",version:null!==(l=e.version)&&void 0!==l?l:"v0_01",savedItemId:null!==(o=e.saved_item_id)&&void 0!==o?o:"",flowbookId:null!==(c=null==r?void 0:r.flowbook_id)&&void 0!==c?c:"",flowbookName:null!==(u=null==r?void 0:r.name)&&void 0!==u?u:"",external:(null==r?void 0:r.flowbook_id)!==a,savedItem:e,flowbook:r,isRestricted:!!e.is_restricted}}),[o,i,d]),j=(0,K.useMemo)(()=>[...f,...m,...u,...p,...x,...h,...g,...v],[f,m,u,p,x,h,g,v]),b=Object.fromEntries(Object.entries(ro.nt).map(e=>{let[t,r]=e;return[t,{...r,name:t,type:r.type===c9.MT.GROUP?"category":"operators"}]})),_=(0,K.useMemo)(()=>(function(e){let{categories:t,operatorDeclarations:r,mcpDeclarations:a}=e,s=[];return t.forEach(e=>{let t=a.some(t=>t.category===e.name),n=r.some(t=>t.category===e.name&&t.is_trigger_node),l="Subflows"===e.name?"subflow":"normal";s.push({...e,supportsMCP:t,supportsTriggers:n,kind:l})}),s})({categories:ro.Qr,operatorDeclarations:e,mcpDeclarations:t}),[e,t]);return{graph:(0,K.useMemo)(()=>(function(e){var t,r;let{groups:a,categories:s,templates:n}=e,l=cB.graph,o=l.pseudoCategories,i=new Set(null!==(t=l.featuredTemplates.names)&&void 0!==t?t:[]),d=new Set(null!==(r=l.featuredTemplates.types)&&void 0!==r?r:[]),c=new Set(l.hideEmptyCategoriesInGroups),u=cB.categories.defaultCategoryName,m=new Map,p=new Map;s.forEach(e=>{var t;m.set(e.name,e);let r=e.group||"";p.has(r)||p.set(r,[]),null===(t=p.get(r))||void 0===t||t.push(e)});let x=new Map,h=new Map;function g(e,t){h.has(e)||h.set(e,[]);let r=h.get(e);r&&!r.includes(t)&&r.push(t)}let f=new Map;n.forEach(e=>{var t;x.set(e.id,e),g(null!==(t=e.category)&&void 0!==t?t:u,e.id),"custom"===e.type&&e.metadataCategory&&g(e.metadataCategory,e.id),o.forEach(t=>{var r;let a=e[t.field],s=null!==(r=t.match)&&void 0!==r&&!!r.truthy&&!!a,n=!!(t.match&&Object.prototype.hasOwnProperty.call(t.match,"equals"))&&a===t.match.equals;(s||n)&&g(t.name,e.id)});let r=i.has(e.name),a=0===d.size||d.has(e.type);r&&a&&f.set(e.id,e)});let v=Object.values(a).map(e=>e.name),j=new Set;h.forEach((e,t)=>{e.length>0&&j.add(t)});let b=new Map;p.forEach((e,t)=>{let r=e.filter(e=>{var t;let r=null!==(t=e.group)&&void 0!==t?t:"";return!c.has(r)||j.has(e.name)});b.set(t,r)});let _=new Map;b.forEach(e=>{e.forEach(e=>_.set(e.name,e))});let y=new Map;return b.forEach((e,t)=>{y.set(t,e.map(e=>e.name))}),{groupsById:a,categoriesById:_,categoriesByGroupId:new Map(Array.from(b.entries()).map(e=>{let[t,r]=e;return[t,r.map(e=>e.name)]})),templatesById:x,templateIdsByCategoryId:h,orderedGroupIds:v,orderedCategoryIdsByGroup:y,featuredTemplatesById:f}})({groups:b,categories:_,templates:j}),[b,_,j])}}(),a=function(e){var t;let[r,a]=(0,K.useState)([{type:"root"}]),[s,n]=(0,K.useState)(""),[l,o]=(0,K.useState)(""),i=(0,K.useMemo)(()=>(function(e,t){var r,a;let s=c7(t);return"root"===s.type?{view:"root"}:"group"===s.type?{view:"categories",categoryIds:null!==(r=e.orderedCategoryIdsByGroup.get(s.groupId))&&void 0!==r?r:[],groupId:s.groupId}:{view:"templates",templateIds:null!==(a=e.templateIdsByCategoryId.get(s.categoryId))&&void 0!==a?a:[],categoryId:s.categoryId}})(e,r),[e,r]),d=(0,K.useMemo)(()=>c7(r),[r]),c="category"===d.type?e.categoriesById.get(d.categoryId):void 0,u="group"===d.type?e.groupsById[d.groupId]:void 0,m=(null==c?void 0:c.kind)==="subflow"||(null==c?void 0:null===(t=c.name)||void 0===t?void 0:t.toLowerCase())==="automation",p=(0,K.useMemo)(()=>l.trim().toLowerCase(),[l]);(0,K.useEffect)(()=>{let e=setTimeout(()=>o(s),100);return()=>clearTimeout(e)},[s]);let x=(0,K.useMemo)(()=>(function(e){let{graph:t,config:r=un}=e,a=cB.search.templates,s=cB.search.categories,n=new Map;t.templatesById.forEach((e,t)=>{var a,s,l,o;n.set(t,(null!==(o=null!==(l=null===(a=r.templates)||void 0===a?void 0:a[e.type])&&void 0!==l?l:null===(s=r.templates)||void 0===s?void 0:s.default)&&void 0!==o?o:()=>"")(e))});let l=new Map;t.categoriesById.forEach((e,t)=>{var a,s,n,o,i;l.set(t,(null!==(i=null!==(o=(a={categoryId:t,category:e}).category?null===(s=r.categories)||void 0===s?void 0:s[a.category.kind]:void 0)&&void 0!==o?o:null===(n=r.categories)||void 0===n?void 0:n.default)&&void 0!==i?i:e=>{let{categoryId:t}=e;return t.toLowerCase()})(a))});let o=Array.from(n.entries()).map(e=>{let[t,r]=e;return{id:t,text:r}}),i=Array.from(l.entries()).map(e=>{let[t,r]=e;return{id:t,text:r}});return{templateHaystackById:n,categoryHaystackById:l,templateFuse:o.length&&a.useFuzzy?new am.Z(o,{keys:["text"],threshold:a.threshold,ignoreLocation:a.ignoreLocation}):void 0,categoryFuse:i.length&&s.useFuzzy?new am.Z(i,{keys:["text"],threshold:s.threshold,ignoreLocation:s.ignoreLocation}):void 0}})({graph:e,config:un}),[e]),{rootTemplateIds:h,categoryIds:g,templateIds:f}=(0,K.useMemo)(()=>(function(e){let{graph:t,visible:r,term:a,config:s=un,searchIndex:n}=e,l=a.trim().toLowerCase(),o=l.length>0,i=Array.from(t.templatesById.keys()),d=("root"===r.view||"groups"===r.view)&&o?ua(i,l,n):[],c="categories"===r.view?o?function(e,t,r){if(!t)return e;let a=ur(t);if(null==r?void 0:r.categoryFuse){let a=new Set(e),s=r.categoryFuse.search(t).map(e=>e.item.id).filter(e=>a.has(e));if(s.length)return s}return(null==r?void 0:r.categoryHaystackById)?e.filter(e=>a(r.categoryHaystackById.get(e))):e}(r.categoryIds,l,n):r.categoryIds:[],u="templates"===r.view?o?ua(r.templateIds,l,n):r.templateIds:[],m=cB.ranking.root.templateTypePriority,p=cB.ranking.templates.templateTypePriority;return{rootTemplateIds:"root"===r.view||"groups"===r.view?us(d,t.templatesById,m):d,categoryIds:c,templateIds:"templates"===r.view?us(u,t.templatesById,p):u}})({graph:e,visible:i,term:p,config:un,searchIndex:x}),[e,p,x,i]),v="root"===d.type?"root":"group"===d.type?d.groupId:"automation"===d.categoryId?"Subflows":d.categoryId;return{graph:e,filterStack:r,visible:i,current:d,currentCategory:c,currentGroup:u,isSubflowCategory:m,searchTerm:s,normalizedTerm:p,filteredRootTemplates:h,filteredCategories:g,filteredTemplates:f,handleBack:()=>{n(""),o(""),a(e=>c8(e))},handleEmptySearchNavigation:()=>{n(""),o("");let e=!1;return a(t=>t.length<=1?(e=!0,t):(e=!1,c8(t))),e},handleGroupClick:e=>{a(t=>c6(t,{type:"group",groupId:e})),n("")},handleCategoryClick:e=>{a(t=>c6(t,{type:"category",categoryId:e})),n("")},handleSearch:e=>{n(e)},currentLabel:v}}(r),s=(0,ez.CG)(eb.Me),{handleClickToAddNode:n}=(0,rg.A)(s),{filterStack:l,handleEmptySearchNavigation:o}=a,i=l.length>1,d=(0,ez.CG)(rh.SN.selectMCPDeclarations),c=(0,K.useMemo)(()=>new Map(d.map(e=>[e.server_id,e])),[d]),u=(0,K.useCallback)(e=>{if(!t)return;let a=r.templatesById.get(e);if(a&&!a.isRestricted){if("native"===a.type||"integration"===a.type){t(a.declaration,rf.Jq.Operator);return}if("custom"===a.type){let e=a.customOperator.operator_declaration;e&&t(e,rf.Jq.Operator);return}if("subflow"===a.type){t(a.savedItem,rf.Jq.Operator);return}if("custom-node-builder"===a.type){if(a.serverId){let e=c.get(a.serverId);e&&t(e,rf.Jq.CustomNodeBuilder);return}t(nX,rf.Jq.CustomNodeBuilder)}if("interface"===a.type){n(new eV.Form({form_id:(0,lt.RL)(),title:"New Interface",description:"Share your workflow as a interface that can be triggered",header_image:"",icon:"",form_elements:[]}),rf.Jq.Form);return}}},[n,t,r.templatesById,c]),{visible:m,normalizedTerm:p,filteredRootTemplates:x,filteredCategories:h,filteredTemplates:g,graph:f,handleGroupClick:v,handleCategoryClick:j}=a,b=(0,K.useCallback)(()=>{if("root"===m.view){if(""!==p){let e=x[0];e&&u(e);return}let e=f.orderedGroupIds[0];e&&v(e);return}if("categories"===m.view){let e=h[0];e&&j(e);return}if("templates"===m.view){let e=g[0];e&&u(e)}},[f.orderedGroupIds,h,x,g,j,v,u,p,m.view]),_=(0,K.useMemo)(()=>{var e,t,r;return{type:a.visible.view,label:a.currentLabel,icon:null!==(r=null===(e=a.currentGroup)||void 0===e?void 0:e.icon)&&void 0!==r?r:null===(t=a.currentCategory)||void 0===t?void 0:t.icon}},[a.visible.view,a.currentLabel,a.currentGroup,a.currentCategory]),y=(0,K.useCallback)(e=>{if("Backspace"!==e.key&&"Delete"!==e.key)return;let t=e.target,r=t instanceof HTMLInputElement&&"node-palette-search"===t.id,a=t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||(null==t?void 0:t.isContentEditable);!r&&!a&&i&&(o()||e.preventDefault())},[i,o]);return(0,S.jsxs)(d$.VY,{className:(0,eu.cn)("bg-elevated data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-98 data-[state=closed]:slide-out-to-bottom-2 fixed top-[50%] left-[50%] z-50 flex max-h-[80vh] w-full max-w-[95vw] translate-x-[-50%] translate-y-[-50%] flex-col overflow-clip rounded-xl border shadow-lg outline-none data-[state=closed]:duration-100 sm:max-w-4xl"),onKeyDown:y,children:[(0,S.jsx)(eq.$N,{className:"sr-only",children:"Node Library"}),(0,S.jsxs)("div",{className:"flex h-120 flex-col overflow-hidden text-sm",children:[(0,S.jsx)(c4,{onChange:a.handleSearch,value:a.searchTerm,onEmptySearchNavigateBack:o,canGoBack:i,onBack:a.handleBack,viewContext:_,onEnterPress:b}),(0,S.jsx)(cQ,{graph:a.graph,visible:a.visible,normalizedTerm:a.normalizedTerm,filteredRootTemplates:a.filteredRootTemplates,filteredCategories:a.filteredCategories,filteredTemplates:a.filteredTemplates,handleGroupClick:a.handleGroupClick,handleCategoryClick:a.handleCategoryClick,isSubflowCategory:a.isSubflowCategory,currentCategory:a.currentCategory,onTemplateClick:u}),(0,S.jsx)(c1,{view:a.visible.view,currentLabel:a.currentLabel})]})]})});ud.displayName="NodePaletteBody",(0,K.forwardRef)((e,t)=>{var r;let{operator:a,minimal:s=!0,onNodeClickToAdd:n,...l}=e,o=(0,ro.J8)(a.category);return(0,S.jsxs)("button",{id:a.name,onClick:()=>{n(a,rf.Jq.Operator)},className:"ring-offset-background focus:ring-accent hover:bg-muted/50 group focus-visible:bg-muted flex h-fit w-full items-center gap-2 rounded-md px-2 py-1.5 text-left text-sm ring-offset-2 outline-none",style:o,ref:t,...l,children:[(0,S.jsx)("div",{className:(0,eu.cn)("flex flex-shrink-0 items-center justify-center rounded-md bg-[var(--node-color-light)]/25","size-9",(a.operator_id||a.metadata)&&"border"),children:(0,rj.hY)(a.icon,s?16:20,"",null!==(r=o["--node-color-dark"])&&void 0!==r?r:"")}),(0,S.jsxs)("div",{children:[(0,S.jsx)("p",{className:"font-medium",children:a.name}),(a.operator_id||a.metadata)&&(0,S.jsx)("p",{className:"text-muted-foreground line-clamp-1 text-xs",children:a.description})]}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(ih.Z,{size:14,className:(0,eu.cn)(a.is_trigger_node?(0,eu.cn)("fill-muted-foreground text-muted-foreground ml-auto","group-focus-within:fill-[var(--node-color-dark)] group-focus-within:text-[var(--node-color-dark)] group-hover:fill-[var(--node-color-dark)] group-hover:text-[var(--node-color-dark)]"):"hidden")})}),(0,S.jsx)(eo._v,{children:"This node supports triggers!"})]})]},a.name)}).displayName="FloatingNodeLibraryOperatorListItem",r(7739);var uc=e=>{let{onNodeClickToAdd:t}=e,[r,a]=(0,K.useState)(!1);(0,K.useEffect)(()=>{let e=e=>{if("k"===e.key&&e.metaKey){if(r){a(!1);return}a(!0);return}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,r]);let s=(0,K.useCallback)((e,r)=>{a(!1),t(e,r)},[t]);return(0,S.jsx)(eq.Vq,{open:r,onOpenChange:a,children:(0,S.jsxs)(eq.PK,{children:[(0,S.jsx)(eq.t9,{className:"bg-background/10 backdrop-blur-none data-[state=open]:duration-0"}),(0,S.jsx)(ud,{onNodeClickToAdd:s})]})})},uu=(0,K.memo)(e=>{let{menuState:t}=e,r=(0,ez.TL)();return(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsxs)(el.zx,{"aria-label":"AI Chat Assistant",variant:"outline",className:(0,eu.cn)("bg-elevated absolute bottom-4 left-4 z-10 transition-[translate] duration-300",t.isOpen&&"sm:translate-x-[calc(var(--container-xs)+16px)] 2xl:translate-x-[calc(var(--container-md)+16px)]"),onClick:()=>r((0,A.ym)(!0)),shadow:!0,children:[(0,S.jsx)(an.Z,{className:"text-pink-500"}),(0,S.jsx)("span",{className:"bg-gradient-to-br from-pink-500 to-pink-600 bg-clip-text text-transparent",children:"Ask Gummie for help"})]})}),(0,S.jsxs)(eo._v,{children:[(0,S.jsx)(s4.Z,{children:(0,s4.V)()?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," +",(0,S.jsx)(s4.Z,{children:"G"})]})]})}),um=r(70123);let up=(0,K.memo)(e=>{var t;let{nodesContainsForm:r}=e,a=(0,ez.CG)(eb.Me),{handleClickToAddNode:s}=(0,rg.A)(a),{currentProject:n}=(0,e0.d2)(),{userProfile:l}=(0,ec.H)(),o=(0,ez.CG)(R.BH),i=(0,ez.TL)(),d=(0,K.useCallback)(async()=>{var e;await s(new eV.Form({form_id:(0,lt.RL)(),title:"",description:"",header_image:"",icon:"",form_elements:[],is_active:!0,created_ts:new Date,author_id:(null==n?void 0:n.project_id)||l.user_id,saved_item_id:null==o?void 0:null===(e=o.savedItem)||void 0===e?void 0:e.saved_item_id}),rf.Jq.Form)},[null==n?void 0:n.project_id,null==o?void 0:null===(t=o.savedItem)||void 0===t?void 0:t.saved_item_id,l.user_id,s]);return(0,S.jsx)("div",{className:"focus-within:bg-muted/70 hover:bg-muted/70 rounded-md px-2 py-1.5",children:(0,S.jsx)(nQ,{title:r?"Edit Interface":"Create a Interface",description:r?"Make changes to your interface to share with others":"Share your workflow as a interface that can be triggered",icon:"FilePen",isDraggable:!1,onClick:r?()=>{i((0,G.de)(!0))}:d})})});up.displayName="InterfaceListItem";var ux=r(70088),uh=e=>{var t;let{declaration:r,onDragStart:a,onClick:s}=e;return(0,S.jsxs)("div",{"data-testid":"operator-item-".concat(null===(t=r.name)||void 0===t?void 0:t.toLowerCase().replaceAll(" ","-")),className:"group hover:bg-muted relative flex cursor-pointer gap-x-6 overflow-hidden rounded-md border p-4",onDragStart:a?e=>a(e,r):void 0,draggable:!!a,onClick:()=>s(r),children:[r.icon&&"automation"!==r.category&&(0,S.jsx)("div",{className:"mt-1 flex h-9 w-9 flex-none items-center justify-center rounded-lg",children:"string"==typeof(0,rj.Qq)(r)?(0,S.jsx)(tw(),{src:(0,rj.Qq)(r),className:"h-8 w-8",draggable:!1,alt:r.name}):(0,rj.Qq)(r,20,"","black")}),(0,S.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,S.jsx)("div",{className:"text-foreground font-semibold",children:(0,S.jsxs)("div",{className:"flex flex-row gap-4 text-xs md:text-sm",children:[r.name,"free"!==r.subscription_tier&&(0,S.jsxs)("div",{className:"flex items-center gap-x-1 text-pink-400",children:[(0,S.jsx)(ux.Z,{className:"h-4 w-4",fill:"currentColor"}),(0,S.jsx)("span",{children:"Premium"})]})]})}),(0,S.jsx)("p",{className:"text-muted-foreground mt-1 text-xs md:text-sm",children:r.description}),"automation"==r.category&&r.key_operators&&Object.keys(r.key_operators).length>0&&(0,S.jsx)("div",{className:"flex pt-2",children:(0,S.jsx)(a8,{item:r||{}})})]}),(0,S.jsx)(eU.C,{variant:"outline",size:"xs",children:(0,e5.V9)(r.version)})]})},ug=r(94106),uf=r(4291);let uv=(0,K.memo)(e=>{let{flowbook:t,children:r,isCollapsed:a,onToggle:s}=e;return(0,S.jsxs)("div",{className:"text-foreground flex flex-col gap-4 p-2",children:[(0,S.jsxs)("div",{className:"flex cursor-pointer items-center justify-between gap-2",onClick:e=>{e.stopPropagation(),s()},children:[(0,S.jsx)("p",{className:"text-sm font-semibold",children:t.name}),(0,S.jsx)("div",{className:"flex h-6 w-6 items-center justify-center",children:(0,S.jsx)(tr.Z,{className:(0,eu.cn)("h-4 w-4 transition-transform duration-200",!a&&"rotate-90")})})]}),(0,S.jsx)(uf.Z,{in:!a,timeout:"auto",unmountOnExit:!0,children:(0,S.jsx)("div",{className:"flex flex-col gap-2",children:r})})]})},(e,t)=>e.flowbook.name===t.flowbook.name&&e.flowbook.automations.length===t.flowbook.automations.length&&e.isCollapsed===t.isCollapsed);uv.displayName="CollapsibleFlowbook";let uj=e=>{let{onNodeDragStart:t,onNodeClickToAdd:r,searchTerm:a}=e,s=(0,Q.v9)(B.v2),n=(0,Q.v9)(B.v9),l=(0,Q.v9)(B.xQ),o=(0,Q.v9)(R.LA),i=(0,K.useMemo)(()=>(0,ug.UJ)(s),[s]),d=(0,K.useMemo)(()=>l&&i?l.filter(e=>e.flowbook_id!==o.flowbook_id).map(e=>{let t=(e.saved_item_plconfigs||[]).map(e=>i.find(t=>t.saved_item_id===e.savedItem.saved_item_id)).filter(e=>!!e);return{...e,automations:t,matchesSearch:e.name.toLowerCase().includes(a.toLowerCase())}}).filter(e=>e.matchesSearch):[],[l,i,o.flowbook_id,a]),c=(0,K.useMemo)(()=>{if(!i)return[];let e=new Set(l.flatMap(e=>{var t;return(null===(t=e.saved_item_plconfigs)||void 0===t?void 0:t.map(e=>e.savedItem.saved_item_id))||[]}));return i.filter(t=>t.saved_item_id&&!e.has(t.saved_item_id)&&t.name.toLowerCase().includes(a.toLowerCase())).map(e=>({name:e.name,automations:[e]}))},[i,l,a]),u=(0,K.useMemo)(()=>[...d,...c],[d,c]),[m,p]=(0,K.useState)({}),x=(0,K.useCallback)(e=>{p(t=>({...t,[e]:!t[e]}))},[]);return(0,S.jsx)("div",{className:"flex h-full flex-col gap-y-2",children:"loading"===n?[,,,,,].fill(0).reverse().map((e,t)=>(0,S.jsx)(dM.Z,{count:1},"skeleton-".concat(t))):u.length?u.map((e,a)=>{var s,n;let l="".concat(e.name,"-").concat(a);return(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(uv,{flowbook:e,isCollapsed:null===(n=m[l])||void 0===n||n,onToggle:()=>x(l),children:null===(s=e.automations)||void 0===s?void 0:s.filter(e=>!!e).map(e=>{let a=e.saved_item_id||e.name;return(0,S.jsx)(uh,{declaration:e,onDragStart:(e,r)=>t(e,r,rf.Jq.Operator),onClick:e=>r(e,rf.Jq.Operator)},a)})},l),a!==u.length-1&&(0,S.jsx)(ta.Z,{})]},l)}):(0,S.jsxs)("p",{className:"text-muted-foreground",children:["No other flows created yet! Subflows let you use a flow as a node. Learn more in our"," ",(0,S.jsx)("a",{href:"https://docs.gumloop.com/core-concepts/subflows",className:"underline",children:"documentation"})]})})},ub=e=>{let{onNodeDragStart:t,onNodeClickToAdd:r,searchTerm:a}=e,s=(0,ez.CG)(B.v9),n=(0,ez.CG)(R.AV),l=(0,ez.CG)(R.ai),o=(0,ez.CG)(B.v2),i=(0,K.useMemo)(()=>(0,ug.UJ)(o),[o]),d=(0,K.useMemo)(()=>i?i.filter(e=>e.saved_item_id&&l.includes(e.saved_item_id)&&e.saved_item_id!=n&&e.name.toLowerCase().includes(a.toLowerCase())):[],[i,l,n,a]);return(0,S.jsx)("div",{className:"flex flex-col gap-y-2",children:"loading"===s?[,,,,,].fill(0).reverse().map((e,t)=>(0,S.jsx)(dM.Z,{count:1},"skeleton-".concat(t))):d.length?d.map((e,a)=>(0,S.jsx)(uh,{declaration:e,onDragStart:(e,r)=>t(e,r,rf.Jq.Operator),onClick:e=>r(e,rf.Jq.Operator)},"operator-".concat(a))):(0,S.jsxs)("p",{className:"text-muted-foreground",children:["No other flows created yet! Subflows let you use a flow as a node. Learn more in our"," ",(0,S.jsx)("a",{href:"https://docs.gumloop.com/core-concepts/subflows",className:"underline",children:"documentation"})," ","or watch our"," ",(0,S.jsx)("a",{href:"https://www.youtube.com/watch?v=QpLV6e0oReQ",className:"underline",children:"YouTube tutorial"})," ","on Subflows."]})})};var u_=e=>{let{onNodeDragStart:t,onNodeClickToAdd:r}=e,[a,s]=(0,K.useState)("");return(0,S.jsxs)(eZ.mQ,{defaultValue:I.ThisWorkbook,className:"flex w-full grow flex-col gap-4 px-2 !pt-0",children:[(0,S.jsx)(ax.I,{value:a,onChange:e=>s(e.target.value),placeholder:"Search for a subflow..."}),(0,S.jsxs)(eZ.dr,{className:"w-full !py-0",variant:"segmented",children:[(0,S.jsx)(eZ.SP,{value:I.ThisWorkbook,variant:"segmented",children:"This Workbook"}),(0,S.jsx)(eZ.SP,{value:I.AllFlows,variant:"segmented",children:"All Flows"})]}),(0,S.jsx)(eZ.nU,{value:I.ThisWorkbook,children:(0,S.jsx)(ub,{onNodeDragStart:t,onNodeClickToAdd:r,searchTerm:a})}),(0,S.jsx)(eZ.nU,{value:I.AllFlows,children:(0,S.jsx)(uj,{onNodeDragStart:t,onNodeClickToAdd:r,searchTerm:a})})]})};let uy=(0,K.memo)(e=>{let{onNodeClickToAdd:t,onNodeDragStart:r,...a}=e;return(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{children:(0,S.jsx)("div",{draggable:!0,id:uE(a.category),onDragStart:e=>{e.stopPropagation(),r(e,a.mcp_server_declaration,rf.Jq.CustomNodeBuilder)},onClick:e=>{e.stopPropagation(),t(a.mcp_server_declaration,rf.Jq.CustomNodeBuilder)},className:(0,eu.cn)("flex items-center gap-2 px-2",a.restricted&&"pointer-events-none opacity-50"),children:(0,S.jsx)(nQ,{...a})})})}),a.restricted&&(0,S.jsx)(eo._v,{children:(0,S.jsx)("p",{children:"Custom node creation has been restricted by your admin."})})]})});uy.displayName="NodeLibraryListItemMCP";let uw=(0,K.memo)(e=>{var t,r,a;let{pinnedNodeMenu:s,onNodeClickToAdd:n,onNodeDragStart:l,...o}=e,[i,d]=(0,K.useState)(!1),c=(0,K.useRef)(null),u=null===(t=o.operatorDeclaration)||void 0===t?void 0:t.is_restricted,m=null===(r=o.operatorDeclaration)||void 0===r?void 0:r.operator_id,p=!!m&&(null===(a=o.defaultCustomOperatorsMap)||void 0===a?void 0:a.has(m));return(0,S.jsxs)(K.Fragment,{children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{children:(0,S.jsx)("div",{draggable:!0,onClick:e=>{e.stopPropagation(),n(o.operatorDeclaration,rf.Jq.Operator)},onDragStart:e=>{e.stopPropagation(),l(e,o.operatorDeclaration,rf.Jq.Operator)},onContextMenu:e=>{var t,r,a;e.stopPropagation(),e.preventDefault(),!m||(null===(t=o.sharedCustomOperatorsMap)||void 0===t?void 0:t.has(m))||(null===(r=o.projectCustomOperatorsMap)||void 0===r?void 0:r.has(m))||p||(s||null===(a=o.actions)||void 0===a||a.togglePin(),requestAnimationFrame(()=>{c.current={x:e.clientX,y:e.clientY},d(!0)}))},className:(0,eu.cn)("hover:bg-muted/50 rounded-md px-2 py-1.5",u&&"!pointer-events-none opacity-70"),children:(0,S.jsx)(nQ,{...o,pinnedNodeMenu:s,isDefaultCustomOperator:p})})})}),u&&(0,S.jsx)(eo._v,{children:"".concat(o.title," is restricted by your admin.")})]}),m&&c.current&&"undefined"!=typeof document&&aH.createPortal((0,S.jsx)("div",{style:{position:"fixed",left:0,top:0,width:0,height:0,pointerEvents:"none"},children:(0,S.jsx)("div",{style:{position:"absolute",left:c.current.x,top:c.current.y,pointerEvents:"auto"},children:(0,S.jsx)(n$,{open:i,setOpen:d,operatorId:m})})}),document.body)]})});uw.displayName="NodeLibraryListItemNode";let uN=(0,K.memo)(e=>{let{onNodeDragStart:t,onlyMCP:r,categoryNodes:a,...s}=e,n=!!((null==a?void 0:a.length)&&(null==a?void 0:a.every(e=>null==e?void 0:e.is_restricted)));return(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{children:(0,S.jsxs)("div",{className:(0,eu.cn)("flex items-center gap-2 px-2",n&&"!pointer-events-none opacity-70"),draggable:!r,onDragStart:e=>{if(r||!t){e.preventDefault();return}e.stopPropagation(),t(e,{name:s.category,categoryNodes:a,filteredCategoryNodes:a},rf.Jq.Launchpad)},children:[(0,S.jsx)(nQ,{...s,onlyMCP:r}),(0,S.jsx)(tr.Z,{size:16,className:"text-muted-foreground"})]})})}),n&&(0,S.jsx)(eo._v,{children:"".concat(s.title," is restricted by your admin.")})]})});uN.displayName="NodeLibraryListItemParent",(h=I||(I={})).ThisWorkbook="ThisWorkbook",h.AllFlows="AllFlows";let uk={name:"Create a Time Trigger",description:"Schedule your automation to run at specified times",category:"Triggers",icon:"TimerReset",isTriggerCard:!0},uC={name:"Create a Custom Node",description:"Tell AI what you want this node to do",category:"Your Custom Nodes",icon:"Wand2",isCustomNodeCard:!0},uI={name:"Create a Interface",description:"Interfaces allow you to share your workflow as a form that anyone can easily use",category:"Core Nodes",icon:"FilePen",isInterfaceCard:!0},uT=(0,K.memo)(e=>{var t,r,a,s,n,l,o,i,d,c,u,m,p,x,h,g,f,v,j;let{open:b,pinnedNodeMenu:_,actions:y,onNodeClickToAdd:w,filterStack:N,setFilterStack:k}=e,C=(0,K.useRef)(null),[I,T]=(0,K.useState)(""),[E,M]=(0,K.useState)([]),A=(0,Q.v9)(z.X3),O=(0,Q.v9)(rh.SN.selectMCPDeclarations),Z=(0,Q.v9)(rb.b9),P=(0,Q.v9)(rb.Ax),D=(0,Q.v9)(rb.dH),L=(0,Q.v9)(rb.ps),R=(0,ez.CG)(eb.qf),{userProfile:F}=(0,ec.H)();(0,K.useEffect)(()=>{T("")},[N]);let G=(0,K.useCallback)(()=>0===N.length?null:N[N.length-1],[N]),U=(0,K.useCallback)(e=>{k(t=>[...t,e])},[k]),B=(0,K.useCallback)(()=>{N.length>0&&k(e=>e.slice(0,-1))},[N,k]),V=(0,K.useMemo)(()=>O.reduce((e,t)=>{let r=t.category;return e[r]||(e[r]=t),e},{}),[O]),W=(0,K.useMemo)(()=>{var e,t,r;let a=ro.Qr.reduce((e,t)=>(e[t.name]={...t,nodes:[],mcp_server_declaration:V[t.name]},e),{}),s=new Set;for(let e of A){let n=e.category,l=null===(t=e.metadata)||void 0===t?void 0:t.category;if(a[n]){if(e.operator_id){let t=D.get(e.operator_id)||Z.get(e.operator_id)||P.get(e.operator_id),r=L.has(e.operator_id);t?(a["Your Custom Nodes"].nodes.push(e),s.add(e)):r&&(a[n].nodes.push(e),s.add(e))}else a[n].nodes.push(e),s.add(e)}if(a[l]){if(e.operator_id){let t=D.get(e.operator_id)||Z.get(e.operator_id)||P.get(e.operator_id),r=L.has(e.operator_id);t?(a[l].nodes.push(e),a["Your Custom Nodes"].nodes.push(e),s.add(e)):r&&(a[l].nodes.push(e),s.add(e))}else a[l].nodes.push(e),s.add(e)}e.is_trigger_node&&a.Triggers&&(null===(r=a.Triggers)||void 0===r||r.nodes.push(e),s.add(e))}return M(Array.from(s)),null===(e=Object.values(a))||void 0===e?void 0:e.filter(e=>(null==e?void 0:e.nodes.length)>0||(null==e?void 0:e.mcp_server_declaration))},[A,V,P,D,Z,L]),H=(0,K.useMemo)(()=>{let e=["Ask AI","Input","Extract Data","Output","Agent","Router"];return A.filter(t=>e.includes(t.name)).sort((t,r)=>e.indexOf(t.name)-e.indexOf(r.name))},[A]),J=(0,K.useMemo)(()=>{let e=W.filter(e=>"Integrations"===e.group),t=e.filter(e=>!!e.mcp_server_declaration),r=e.filter(e=>!e.mcp_server_declaration),a=t.findIndex(e=>"slack"===e.name.toLowerCase());if(a>-1){let[e]=t.splice(a,1);t.push(e)}return[...t,...r]},[W]),q=(0,K.useMemo)(()=>W.reduce((e,t)=>(e[t.name]=t.icon,e),{}),[W]),Y=(0,K.useMemo)(()=>[...E,uk,uC,uI],[E]),$=(0,K.useMemo)(()=>Object.values(V),[V]),X=(0,K.useMemo)(()=>Object.keys(V),[V]),ee=(0,K.useMemo)(()=>new am.Z(Y,{keys:[{name:"name",weight:.8},{name:"description",weight:.1},{name:"category",weight:.1}],threshold:.2,ignoreLocation:!0,minMatchCharLength:1,includeScore:!0}),[Y]),et=(0,K.useMemo)(()=>new am.Z($,{keys:["category","server_id"],threshold:.3,ignoreLocation:!0,minMatchCharLength:1}),[$]),er=(0,K.useMemo)(()=>{if(!I)return null;let e=I.toLowerCase().includes("mcp"),t=ee.search(I),r=t.map(e=>e.item),a=new Map;t.forEach(e=>{a.set(e.item.name,e.score||1)});let s=et.search(I).map(e=>e.item),n={};return e&&X.forEach(e=>{n[e]=[]}),s.forEach(e=>{let t=e.category;n[t]||(n[t]=[])}),r.forEach(e=>{let t=e.category;if("mega_node"!==t&&(n[t]||(n[t]=[]),"isTriggerCard"in e&&e.isTriggerCard||"isCustomNodeCard"in e&&e.isCustomNodeCard||"isInterfaceCard"in e&&e.isInterfaceCard,n[t].unshift(e)),"mega_node"===t){var r;let t=null===(r=e.metadata)||void 0===r?void 0:r.category;t&&(n[t]||(n[t]=[]),n[t].some(t=>"name"in t&&t.name===e.name)||n[t].unshift(e))}}),Object.entries(n).map(e=>{let[t,r]=e;return{category:t,nodes:r.sort((e,t)=>(a.get(e.name)||1)-(a.get(t.name)||1)),icon:q[t]}})},[I,ee,et,X,q]),ea=(0,K.useMemo)(()=>{let e=G();if(!e)return W;if(e.type===c9.MT.GROUP)return W.filter(t=>t.group===e.label);if(e.type===c9.MT.CATEGORY){let t=W.find(t=>t.name===e.label);return t?t.nodes:[]}return W},[W,G]);(0,K.useEffect)(()=>{if(b){var e;null===(e=C.current)||void 0===e||e.focus()}},[b]);let es=(0,K.useCallback)((e,t,r)=>{e.dataTransfer.setData("application/reactflow",r),e.dataTransfer.setData("application/reactflow-data",JSON.stringify(t)),e.dataTransfer.effectAllowed="move"},[]);return(0,S.jsxs)(K.Fragment,{children:[!b&&(0,S.jsx)("div",{className:(0,eu.cn)("absolute top-18 z-30 grid h-[var(--pipeline-panel-height)] w-2 place-items-center transition-all duration-300 ease-in-out sm:top-22"),onMouseEnter:()=>{_||y.openViaHover()},children:(0,S.jsx)(tr.Z,{size:28,className:"text-muted-foreground/50",strokeWidth:2})}),(0,S.jsx)(lC.M,{children:b&&(0,S.jsx)(nx.E.div,{className:(0,eu.cn)("absolute top-18 z-40 flex pl-2 sm:top-22 sm:pl-4","h-[var(--pipeline-panel-height)]"),onMouseEnter:()=>{_||y.openViaHover()},onMouseLeave:()=>{_||y.closeMenu()},initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{duration:.2,ease:"easeInOut"},children:(0,S.jsxs)("div",{"data-open":b,id:"node-library-menu",className:(0,eu.cn)("bg-elevated @container/node-library-menu flex w-[calc(100dvw-4rem)] flex-col gap-4 rounded-lg border sm:w-sm 2xl:w-md"),children:[(0,S.jsx)("div",{className:(0,eu.cn)("animate-in fade-in slide-in-from-left-full absolute top-0 right-0 z-0 pr-4 pb-10 pl-2 duration-500 ease-in-out",b?"translate-x-full":"-translate-x-10"),children:(0,S.jsx)(el.zx,{variant:"outline",type:"button",size:"icon-sm",onClick:()=>{_?(T(""),k([]),y.closeMenu()):y.openViaClick()},shadow:!0,children:_?(0,S.jsx)(t_.Z,{}):(0,S.jsx)(um.Z,{})})}),(0,S.jsxs)("div",{className:(0,eu.cn)("flex flex-grow flex-col overflow-hidden shadow-xs lg:max-w-sm xl:max-w-md",(null===(t=G())||void 0===t?void 0:t.label)==="Subflows"?"gap-0":"gap-4"),children:[(0,S.jsxs)("div",{className:"flex flex-col gap-4 px-4 pt-4",children:[(null==N?void 0:N.length)>0&&(0,S.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,S.jsx)(el.zx,{variant:"ghost",size:"icon",onClick:()=>B(),children:(0,S.jsx)(lY.Z,{})}),(null===(r=G())||void 0===r?void 0:r.icon)&&(0,S.jsx)("div",{className:"flex size-8 flex-none items-center justify-center rounded-md border",children:(0,rj.hY)(null===(a=G())||void 0===a?void 0:a.icon,16)}),(0,S.jsx)("span",{className:"text-sm font-medium",children:null===(s=G())||void 0===s?void 0:s.label})]}),(null===(n=G())||void 0===n?void 0:n.label)!=="Subflows"&&(0,S.jsx)("div",{className:"flex h-fit w-full flex-col gap-4",children:(0,S.jsx)(ti.Z,{ref:C,value:I,onSearch:e=>{T(e),_&&b||!(e.trim().length>0)||y.openViaClick()},placeholder:"Search all nodes",debounceTime:50})})]}),(0,S.jsxs)("div",{className:"flex flex-col gap-2.5 overflow-x-hidden overflow-y-auto px-2 pb-5",children:[(null==N?void 0:N.length)===0&&(0,S.jsx)("div",{className:"mb-1 flex flex-col gap-2.5",children:Object.entries(ro.nt).filter(e=>{let[t,r]=e;if(!I)return!0;let a=I.toLowerCase();return t.toLowerCase().includes(a)||r.description.toLowerCase().includes(a)}).map((e,t)=>{let[r,a]=e;return(0,S.jsx)(uN,{title:r,description:a.description,icon:a.icon,onClick:()=>{U({type:a.type===c9.MT.GROUP?c9.MT.GROUP:c9.MT.CATEGORY,label:r,icon:a.icon})},category:r,isDraggable:!1},r+t)})}),I?er&&(null==er?void 0:er.length)>0?null==er?void 0:er.map(e=>{var t;let{category:r,nodes:a,icon:s}=e;return(0,S.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,S.jsx)(uS,{title:r,icon:s}),(0,S.jsxs)("div",{className:"flex flex-col gap-2.5",children:[V[r]&&(0,S.jsx)(uy,{title:"Create ".concat(rv.Z_.withArticle(r)," Node With AI"),description:"Harness the power of MCP to create a custom node",icon:"Wand2",category:r,onNodeClickToAdd:w,onNodeDragStart:es,mcp_server_declaration:V[r],isMCP:!0,restricted:!!((null==F?void 0:F.is_mega_node_creation_restricted)||(null===(t=V[r])||void 0===t?void 0:t.is_restricted))}),a.map((e,t)=>"isTriggerCard"in e&&e.isTriggerCard?(0,S.jsx)(cL,{},"trigger-card"):"isCustomNodeCard"in e&&e.isCustomNodeCard?(0,S.jsx)(n0,{onNodeClickToAdd:w,onNodeDragStart:es},"custom-node-card"):"isInterfaceCard"in e&&e.isInterfaceCard?(0,S.jsx)(up,{nodesContainsForm:R},"interface-card"):(0,S.jsx)(uw,{operatorDeclaration:e,onNodeClickToAdd:w,onNodeDragStart:es,title:e.name,description:e.description,icon:e.icon,category:e.category,actions:y,sharedCustomOperatorsMap:P,projectCustomOperatorsMap:Z,defaultCustomOperatorsMap:L,pinnedNodeMenu:_},e.name+t))]})]},r)}):(0,S.jsx)(r3.Z,{Icon:lN.Z,title:"No Nodes Found",description:"Try a different search term"}):(0,S.jsxs)(K.Fragment,{children:[(null==N?void 0:N.length)===0&&(0,S.jsxs)("div",{className:"flex flex-col gap-2.5",children:[(0,S.jsxs)("div",{className:"mt-1 flex flex-col gap-1.5",children:[(0,S.jsx)(uS,{title:"Frequently Used"}),(0,S.jsx)("div",{className:"grid grid-cols-2 gap-0",children:H.map((e,t)=>(0,S.jsx)(uw,{operatorDeclaration:e,onNodeClickToAdd:w,onNodeDragStart:es,title:e.name,description:e.description,icon:e.icon,category:e.category,actions:y,sharedCustomOperatorsMap:P,defaultCustomOperatorsMap:L,pinnedNodeMenu:_,clampDescription:!0},e.name+t))})]}),(0,S.jsx)(uS,{title:"Integrations"}),J.map((e,t)=>{let r=e.nodes,a=e.mcp_server_declaration,s=a&&(!r||(null==r?void 0:r.length)===0);return(0,S.jsx)(uN,{title:e.name,description:e.description,icon:e.icon,onClick:()=>{U({type:c9.MT.CATEGORY,label:e.name,icon:e.icon})},category:e.name,onlyMCP:s,onNodeDragStart:es,categoryNodes:r,hasMCP:!!a},e.name+t)})]}),(0,S.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(null===(l=G())||void 0===l?void 0:l.type)===c9.MT.GROUP&&(null==ea?void 0:ea.map((e,t)=>{let r=e.nodes,a=e.mcp_server_declaration&&(!r||(null==r?void 0:r.length)===0);return(0,S.jsx)(uN,{title:e.name,description:e.description,icon:e.icon,onClick:()=>{U({type:c9.MT.CATEGORY,label:e.name,icon:e.icon})},category:null==e?void 0:e.name,onlyMCP:a,onNodeDragStart:es,categoryNodes:r,hasMCP:!!e.mcp_server_declaration},e.name+t)})),(null===(o=G())||void 0===o?void 0:o.type)===c9.MT.CATEGORY&&(0,S.jsxs)(K.Fragment,{children:[V[null===(i=G())||void 0===i?void 0:i.label]&&(0,S.jsx)(uy,{title:"Create ".concat(rv.Z_.withArticle((null===(d=G())||void 0===d?void 0:d.label)||"")," node with AI"),description:"Harness the power of MCP to create a custom node",icon:"Wand2",category:null===(c=G())||void 0===c?void 0:c.label,onNodeClickToAdd:w,onNodeDragStart:es,mcp_server_declaration:V[null===(u=G())||void 0===u?void 0:u.label],isMCP:!0,actions:y,restricted:!!((null==F?void 0:F.is_mega_node_creation_restricted)||(null===(m=V[null===(p=G())||void 0===p?void 0:p.label])||void 0===m?void 0:m.is_restricted))}),(null===(x=G())||void 0===x?void 0:x.label)==="Triggers"&&(0,S.jsx)(cL,{}),(null===(h=G())||void 0===h?void 0:h.label)==="Your Custom Nodes"&&(0,S.jsx)(n0,{onNodeClickToAdd:w,onNodeDragStart:es}),(null===(g=G())||void 0===g?void 0:g.label)==="Flow Basics"&&(0,S.jsx)(up,{nodesContainsForm:R}),ea&&(null==ea?void 0:ea.length)>0||!I&&V[null===(f=G())||void 0===f?void 0:f.label]?null==ea?void 0:ea.map((e,t)=>(0,S.jsx)(uw,{operatorDeclaration:e,onNodeClickToAdd:w,onNodeDragStart:es,title:e.name,description:e.description,icon:e.icon,category:null==e?void 0:e.category,actions:y,sharedCustomOperatorsMap:P,defaultCustomOperatorsMap:L,pinnedNodeMenu:_},e.name+t)):(null===(v=G())||void 0===v?void 0:v.label)!=="Subflows"?(0,S.jsx)(r3.Z,{Icon:o0.Z,title:"No Nodes",description:"No nodes found in this category"}):null]})]}),(null===(j=G())||void 0===j?void 0:j.label)==="Subflows"&&(0,S.jsx)(u_,{onNodeDragStart:es,onNodeClickToAdd:w})]})]})]})]})})})]})});uT.displayName="NodeLibrary";let uS=e=>{let{title:t,icon:r}=e;return(0,S.jsxs)("div",{className:"flex w-full items-center gap-1.5 px-3",children:[r&&(0,rj.hY)(r,16),(0,S.jsx)("span",{className:"text-muted-foreground text-sm font-medium",children:t})]})},uE=e=>{try{if(!e||"string"!=typeof e)return"node-".concat(Math.random().toString(36).substring(2,10));return e.replace(/\s+/g,"-")+"-node"}catch(e){return console.warn("Error generating node ID:",e),"node-".concat(Math.random().toString(36).substring(2,10))}};var uM=r(66377),uA=r(4473);let uO=Object.fromEntries([{category:"Triggers",icon:"Radar"},{category:"Integrations",icon:"Blocks"},{category:"Using AI",icon:"/images/UsingAI.svg"}].map(e=>[e.category,e.icon]));var uZ=e=>{let{onOpenNodeLibrary:t,isNodeLibraryOpen:r}=e,a=e=>{e&&(localStorage.setItem("nodeMenuCategory",e),localStorage.setItem("nodeMenuCategoryIcon",uO[e]),window.dispatchEvent(new Event("nodeMenuCategoryChanged",{bubbles:!0,cancelable:!0})))};return(0,S.jsxs)("div",{className:(0,eu.cn)("absolute top-1/2 left-1/2 flex w-full max-w-xl -translate-x-1/2 -translate-y-1/2 flex-col items-center justify-center gap-3 p-3",r&&"hidden"),style:{"--dash":"10px","--gap":"8px","--thickness":"1px","--line-color":"var(--border)","--line":"linear-gradient(to right, var(--line-color) var(--dash), transparent 0)","--line-size":"calc(var(--dash) + var(--gap)) var(--thickness)"},children:[(0,S.jsx)(uM.SV,{children:(0,S.jsx)(uA.Z,{})}),(0,S.jsxs)("div",{className:"flex w-full items-center gap-4",children:[(0,S.jsx)("div",{className:"w-full",style:{height:"var(--thickness)",backgroundImage:"var(--line)",backgroundSize:"var(--line-size)",backgroundRepeat:"repeat-x"}}),(0,S.jsx)("p",{className:"text-muted-foreground",children:"OR"}),(0,S.jsx)("div",{className:"w-full",style:{height:"var(--thickness)",backgroundImage:"var(--line)",backgroundSize:"var(--line-size)",backgroundRepeat:"repeat-x"}})]}),(0,S.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,S.jsxs)("div",{className:"flex max-w-24 flex-col items-center gap-2",children:[(0,S.jsx)(el.zx,{size:"icon-xl",variant:"outline",shadow:!0,onClick:()=>a("Triggers"),children:(0,S.jsx)(tK.Z,{className:"text-success-foreground size-5!"})}),(0,S.jsx)("p",{className:"text-muted-foreground text-center text-sm",children:"Start with a trigger"})]}),(0,S.jsxs)("div",{className:"flex max-w-24 flex-col items-center gap-2",children:[(0,S.jsx)(el.zx,{size:"icon-xl",variant:"outline",shadow:!0,onClick:()=>t(),children:(0,S.jsx)(dJ.Z,{className:"text-accent-foreground size-5!"})}),(0,S.jsx)("p",{className:"text-muted-foreground text-center text-sm",children:"Start with an integration"})]})]})]})},uz=e=>{let{onClick:t}=e;return(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{id:"add-node-button",size:"icon-lg",className:"slide-in-from-left-[200%] fade-in animate-in border-border bg-background text-foreground absolute top-18 left-4 z-10 h-fit rounded-full border drop-shadow-sm duration-1000 md:top-22",onClick:t,children:(0,S.jsx)(er.Z,{})})}),(0,S.jsxs)(eo._v,{side:"right",children:["Add a Node or Subflow",(0,S.jsx)(s4.Z,{children:(0,s4.V)()?"âŒ˜":"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"B"})]})]})},uP=(0,K.memo)(e=>{let{onNodeClickToAdd:t}=e,{menuState:r,actions:a,filterStack:s,setFilterStack:n}=(0,c9.Vz)(),l=(0,Q.v9)(A.$g),o=(0,Q.v9)(eb.Z1);return(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)(uz,{onClick:a.openViaClick}),(0,S.jsx)(uT,{open:r.isOpen,pinnedNodeMenu:r.isPinned,actions:a,onNodeClickToAdd:t,filterStack:s,setFilterStack:n}),!l&&0===o&&(0,S.jsx)(uZ,{onOpenNodeLibrary:a.openViaClick,isNodeLibraryOpen:r.isOpen}),(0,S.jsx)(uu,{menuState:r})]})}),uD=r(18178),uL=r(13835),uR=r(95333),uF=r(17429),uG=r(60689),uU=r(42901),uB=r(72887),uV=r(55736),uW=r(87590),uH=(0,K.memo)(e=>{var t,r,a,s;let{open:n,setOpen:l}=e,{userProfile:o,setUserProfile:i,idTokenRef:d}=(0,K.useContext)(ec.f),[c,u]=(0,K.useState)(null===(t=o.uses_default_cursor)||void 0===t||t),[m,p]=(0,K.useState)(null===(r=o.uses_default_edges)||void 0===r||r),[x,h]=(0,K.useState)(null!==(a=o.uses_snap_to_grid)&&void 0!==a&&a),[g,f]=(0,K.useState)(null!==(s=o.uses_autoformat_on_save)&&void 0!==s&&s);(0,K.useEffect)(()=>{var e,t,r,a;u(null===(e=o.uses_default_cursor)||void 0===e||e),p(null===(t=o.uses_default_edges)||void 0===t||t),h(null!==(r=o.uses_snap_to_grid)&&void 0!==r&&r),f(null!==(a=o.uses_autoformat_on_save)&&void 0!==a&&a)},[o]);let v=e=>(0,S.jsx)("svg",{width:"18",height:"24",viewBox:"0 0 18 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,S.jsx)("path",{d:"M4 4V12H14V20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),j=e=>(0,S.jsx)("svg",{width:"20",height:"24",viewBox:"0 0 20 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,S.jsx)("path",{d:"M4 4C4 12 7 12 10 12C13 12 16 12 16 20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),b=(0,K.useMemo)(()=>(0,S.jsx)(eX.r,{checked:g,onCheckedChange:e=>{f(e),o.isLoggedIn()&&o.setUserMetadata("uses_autoformat_on_save",e.toString(),d.current),o.update(i,{uses_autoformat_on_save:e})}}),[g,o,i,d]),_=(0,K.useMemo)(()=>(0,S.jsxs)(nL.t,{type:"single",value:m?"straight":"curved",onValueChange:e=>{if(!e)return;let t="straight"===e;p(t),o.isLoggedIn()&&o.setUserMetadata("uses_default_edges",t.toString(),d.current),o.update(i,{uses_default_edges:t})},children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("span",{children:(0,S.jsx)(nL.G,{value:"straight","aria-label":"Straight Edges",children:(0,S.jsx)(v,{className:"text-current"})})})}),(0,S.jsx)(eo._v,{children:"Straight Edges"})]}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("span",{children:(0,S.jsx)(nL.G,{value:"curved","aria-label":"Curved Edges",children:(0,S.jsx)(j,{className:"text-current"})})})}),(0,S.jsx)(eo._v,{children:"Curved Edges"})]})]}),[m,i,o,d]),y=(0,K.useMemo)(()=>(0,S.jsxs)(nL.t,{type:"single",value:c?"default":"custom",onValueChange:e=>{if(!e)return;let t="default"===e;u(t),o.isLoggedIn()&&o.setUserMetadata("uses_default_cursor",t.toString(),d.current),o.update(i,{uses_default_cursor:t})},children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("span",{children:(0,S.jsx)(nL.G,{value:"default","aria-label":"Drag to Pan",children:(0,S.jsx)(uG.Z,{className:"h-4 w-4"})})})}),(0,S.jsx)(eo._v,{children:"Drag to Pan"})]}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("span",{children:(0,S.jsx)(nL.G,{value:"custom","aria-label":"Drag to Select",children:(0,S.jsx)(uU.Z,{className:"h-4 w-4"})})})}),(0,S.jsx)(eo._v,{children:"Scroll to Pan"})]})]}),[c,o,i,d]),w=(0,K.useMemo)(()=>(0,S.jsxs)(nL.t,{type:"single",value:x?"snap":"default",onValueChange:e=>{if(!e)return;let t="default"!==e;h(t),o.isLoggedIn()&&o.setUserMetadata("uses_snap_to_grid",t.toString(),d.current),o.update(i,{uses_snap_to_grid:t})},children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("span",{children:(0,S.jsx)(nL.G,{value:"default","aria-label":"Free Move",children:(0,S.jsx)(aT.Z,{className:"h-4 w-4"})})})}),(0,S.jsx)(eo._v,{children:"Free Move"})]}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("span",{children:(0,S.jsx)(nL.G,{value:"snap","aria-label":"Snap to Grid",children:(0,S.jsx)(uB.Z,{className:"h-4 w-4"})})})}),(0,S.jsx)(eo._v,{children:"Snap to Grid"})]})]}),[x,o,i,d]);return(0,S.jsxs)("div",{"data-open":n,className:(0,eu.cn)(n?"translate-x-0":"translate-x-[250%]","border-border bg-elevated fixed top-18 right-4 z-[100] w-md overflow-y-auto rounded-lg border shadow-xs transition-transform duration-300 ease-in-out sm:top-22","h-[var(--pipeline-panel-height)]"),children:[(0,S.jsxs)("div",{className:"flex h-12 items-center justify-between border-b px-4",children:[(0,S.jsx)("p",{className:"font-medium",children:"Preferences"}),(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-sm",onClick:()=>l(!1),className:"text-muted-foreground",children:(0,S.jsx)(ay.Z,{})})]}),(0,S.jsx)(()=>(0,S.jsxs)("div",{className:"text-foreground space-y-4 p-4",children:[(0,S.jsxs)("div",{className:"flex items-center justify-between",children:[(0,S.jsx)("span",{className:"text-sm",children:"Autoformat Flow on Save:"}),(0,S.jsx)("div",{className:"flex items-center",children:b})]}),(0,S.jsxs)("div",{className:"flex items-center justify-between",children:[(0,S.jsx)("span",{className:"text-sm",children:"Edge Type:"}),(0,S.jsx)("div",{className:"flex items-center",children:_})]}),(0,S.jsxs)("div",{className:"flex items-center justify-between",children:[(0,S.jsx)("span",{className:"text-sm",children:"Panning Behavior:"}),(0,S.jsx)("div",{className:"flex items-center",children:y})]}),(0,S.jsxs)("div",{className:"flex items-center justify-between",children:[(0,S.jsx)("span",{className:"text-sm",children:"Snap to Grid:"}),(0,S.jsx)("div",{className:"flex items-center",children:w})]})]}),{}),(0,S.jsx)("div",{className:"flex h-12 items-center border-y px-4",children:(0,S.jsx)("p",{className:"font-medium",children:"Keyboard Shortcuts"})}),(0,S.jsx)(uW.iA,{children:(0,S.jsx)(uW.RM,{children:uJ((0,s4.V)()).map(e=>(0,S.jsxs)(uW.SC,{className:"border-0 hover:bg-transparent",children:[(0,S.jsx)(uW.pj,{className:"text-foreground pl-4",children:e.title}),(0,S.jsx)(uW.pj,{className:"text-muted-foreground flex items-center justify-end pr-4",children:e.keys})]},e.title))})})]})});let uJ=e=>[{title:"Floating Node Library",keys:(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"K"})]})},{title:"Copy",keys:(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"C"})]})},{title:"Paste",keys:(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"V"})]})},{title:"Paste Without Connections",keys:(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"Shift"})," + ",(0,S.jsx)(s4.Z,{children:"V"})]})},{title:"Undo/Redo",keys:(0,S.jsxs)("span",{className:"flex flex-col items-end gap-1",children:[(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"Z"})]}),(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"Shift"})," + ",(0,S.jsx)(s4.Z,{children:"Z"})]})]})},{title:"Save/Save As",keys:(0,S.jsxs)("span",{className:"flex flex-col items-end gap-1",children:[(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"S"})]}),(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"Shift"})," + ",(0,S.jsx)(s4.Z,{children:"S"})]})]})},{title:"Delete Selected Node(s)",keys:(0,S.jsx)(s4.Z,{children:"Backspace/Delete"})},{title:"Toggle Node Menu",keys:(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"B"})]})},{title:"Start/Stop Run",keys:(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:e?"Return":"Enter"})]})},{title:"Resume Run",keys:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"Shift"})," +"," ",(0,S.jsx)(s4.Z,{children:e?"Return":"Enter"})]})},{title:"New Workflow/Make Subflow",keys:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"Shift"})," + ",(0,S.jsx)(s4.Z,{children:"+"})]})},{title:"Prev/Next Flow",keys:(0,S.jsxs)("span",{className:"flex flex-col items-end gap-1",children:[(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," +"," ",(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(uV.Z,{className:"h-2 w-2"}):"Alt"})," + ",(0,S.jsx)(s4.Z,{children:"["})]}),(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," +"," ",(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(uV.Z,{className:"h-2 w-2"}):"Alt"})," + ",(0,S.jsx)(s4.Z,{children:"]"})]})]})},{title:"Toggle AI Chat",keys:(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"G"})]})},{title:"Zoom to Fit",keys:(0,S.jsxs)("span",{className:"flex items-center gap-1",children:[(0,S.jsx)(s4.Z,{children:e?(0,S.jsx)(n1.Z,{className:"h-2 w-2"}):"Ctrl"})," + ",(0,S.jsx)(s4.Z,{children:"0"})]})}],uq=Array.from({length:10},(e,t)=>.1*(t+1)),uK=(0,K.memo)(e=>{let{handleZoomTo:t}=e,{zoom:r}=(0,eC.Sj)(),a=(0,K.useMemo)(()=>Math.round(100*r).toString(),[r]);return(0,S.jsxs)(tc.h_,{children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(tc.$F,{asChild:!0,children:(0,S.jsxs)(el.zx,{variant:"ghost",size:"sm",className:"w-12 tabular-nums",children:[a,"%"]})})}),(0,S.jsx)(eo._v,{children:"Current Zoom"})]},"current-zoom"),(0,S.jsx)(tc.AW,{side:"top",align:"center",className:"w-16 p-1",children:uq.map(e=>(0,S.jsx)(tc.Xi,{asChild:!0,children:(0,S.jsxs)(el.zx,{onClick:()=>t(e),variant:"ghost",size:"xs",className:"relative w-full text-xs",children:[Math.round(100*e).toString(),"%",a===Math.round(100*e).toString()&&(0,S.jsx)(eR.Z,{className:"absolute top-1/2 right-2 -translate-y-1/2"})]})},e))})]})});uK.displayName="PipelineToolbarZoomButton";var uY=()=>{let e=(0,Q.v9)(R.z4),t=(0,Q.v9)(eb.Me),r=(0,Q.v9)(t=>(0,a9.vj)(t,null==e?void 0:e.saved_item_id)),a=(0,Q.v9)(ew),[s,n]=(0,K.useState)(!1),l=(0,ez.TL)(),o=(0,K.useCallback)(()=>{l((0,F.fL)(e=>e.map(e=>e.type===rf.Jq.Operator&&e.data&&e.data.is_collapsed?{...e,data:{...e.data,is_collapsed:!1}}:e)))},[l]),i=(0,K.useCallback)(()=>{l((0,F.fL)(e=>e.map(e=>{var t;return e.type!==rf.Jq.Operator||!e.data||"subNodeId"in e.data&&(null===(t=e.data)||void 0===t?void 0:t.subNodeId)||e.data.is_collapsed?e:{...e,data:{...e.data,is_collapsed:!0}}})))},[l]),d=(0,K.useMemo)(()=>[{icon:(0,S.jsx)(uD.Z,{}),label:"Autoformat Nodes",onClick:()=>{t&&l((0,aC.B7)({shouldFitView:!0}))}},{icon:(0,S.jsx)(uL.Z,{}),label:"Expand All",onClick:o},{icon:(0,S.jsx)(uR.Z,{}),label:"Collapse All",onClick:i},{icon:(0,S.jsx)(lK.Z,{}),label:"Canvas Preferences",onClick:()=>{r?(l((0,U.rR)({savedItemId:null==e?void 0:e.saved_item_id,showLogs:!1})),setTimeout(()=>n(e=>!e),200)):n(e=>!e)}}],[o,i,t,null==e?void 0:e.saved_item_id,l,r]),c=(0,K.useCallback)(()=>{if(!t)return;let e=t.getZoom();t.zoomTo(Math.min(Math.ceil(10*e)/10+.1,3))},[t]),u=(0,K.useCallback)(()=>{if(!t)return;let e=t.getZoom();t.zoomTo(Math.max(Math.floor(10*e)/10-.1,.1))},[t]),m=(0,K.useCallback)(e=>{t&&t.zoomTo(e)},[t]),p=(0,K.useCallback)(()=>{t&&t.fitView({padding:.3,duration:100})},[t]);return(0,S.jsxs)("div",{className:(0,eu.cn)("fixed right-5 z-20 flex gap-3 transition-[translate] duration-300",a!==f.DEFAULT?"bottom-[calc(var(--pipeline-tab-bar-height)+2rem)]":"bottom-[calc(var(--pipeline-tab-bar-height)+1rem)]",r&&a===f.DEFAULT&&"sm:translate-x-[calc((var(--container-xs)+1rem+0.75rem)*-1)] lg:translate-x-[calc((var(--container-sm)+1rem+0.75rem)*-1)] 2xl:translate-x-[calc((var(--container-md)+1rem+0.75rem)*-1)]"),children:[(0,S.jsxs)("div",{className:"bg-elevated hidden rounded-lg border p-0.5 shadow-xs md:flex",children:[(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{onClick:u,variant:"ghost",size:"icon-sm",children:(0,S.jsx)(tq.Z,{})})}),(0,S.jsx)(eo._v,{children:"Zoom Out"})]},"minus-zoom"),(0,S.jsx)(uK,{handleZoomTo:m}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{onClick:c,variant:"ghost",size:"icon-sm",children:(0,S.jsx)(er.Z,{})})}),(0,S.jsx)(eo._v,{children:"Zoom In"})]},"plus-zoom"),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{onClick:p,variant:"ghost",size:"icon-sm",children:(0,S.jsx)(uF.Z,{})})}),(0,S.jsx)(eo._v,{children:"Fit View"})]},"fit-view")]}),(0,S.jsxs)("div",{className:"bg-elevated flex rounded-lg border p-0.5 shadow-xs",children:[d.map(e=>(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{onClick:e.onClick,variant:"ghost",size:"icon-sm",children:e.icon})}),(0,S.jsx)(eo._v,{children:e.label})]},e.label)),!1]}),(0,S.jsx)(uH,{open:s,setOpen:n})]})},u$=(0,K.memo)(e=>{let{outdatedOperatorDeclarations:t,onNodeClickToAdd:r}=e,a=(0,ez.CG)(R.AV),s=(0,ez.TL)(),n=(0,ez.CG)(ew),l=(0,ez.CG)(R.aN),o=(0,K.useMemo)(()=>n===f.DEFAULT,[n]),i=(0,K.useMemo)(()=>n===f.DEFAULT||n===f.GUMMIE||n===f.TEMPLATE,[n]);return(0,S.jsxs)(K.Fragment,{children:[n===f.DEFAULT&&l?(0,S.jsx)(dj,{template:l}):(0,S.jsx)(uY,{}),o&&(0,S.jsx)(uP,{onNodeClickToAdd:r}),i&&(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)("div",{className:(0,eu.cn)("group slide-in-from-right-[200%] fade-in animate-in absolute right-4 z-10 flex flex-col rounded-full duration-1000",n===f.TEMPLATE?"top-4":"top-18 sm:top-22"),children:(0,S.jsxs)(el.zx,{variant:"outline",size:"icon-lg",className:"bg-elevated w-fit rounded-full border shadow-xs hover:px-4",onClick:()=>{s((0,U.rR)({savedItemId:a,showLogs:!0}))},children:[(0,S.jsx)(dv.Z,{}),(0,S.jsx)("span",{className:"fade-in hidden text-sm font-medium whitespace-nowrap group-hover:flex",children:"Previous Runs"})]})}),(0,S.jsx)(dH,{outdatedOperatorDeclarations:t})]}),(0,S.jsx)(uc,{onNodeClickToAdd:r})]})});let uQ={[nP.P.Edge]:nH,[nP.P.MegaEdge]:nW,[nP.P.AnimatedSVGEdge]:nV,[nP.P.SubscriptionEdge]:nA},uX={[rf.Jq.Operator]:sK,[rf.Jq.Launchpad]:e=>{let{userProfile:t}=(0,ec.H)(),{data:r,id:a,positionAbsoluteX:s,positionAbsoluteY:n}=e,{category:l,categoryNodes:o,filteredCategoryNodes:i}=r,d=(0,Q.v9)(eb.Me),{createNodeObject:c}=(0,rg.A)(d),u=(0,Q.v9)(rh.SN.selectMCPDeclarations),m=(0,K.useMemo)(()=>u.find(e=>e.category===l.name),[u,l.name]),p=(0,K.useMemo)(()=>new Set(i.map(e=>e.name)),[i]),x=(0,K.useMemo)(()=>[...o].sort((e,t)=>{let r=p.has(e.name),a=p.has(t.name);return r&&!a?-1:!r&&a?1:0}),[o,p]),h=(0,Q.I0)(),g=async e=>{let t=await c(e,{x:s,y:n},rf.Jq.Operator);t&&(h((0,F.gz)(t)),h((0,F.IK)(a)))},f=async e=>{let t=await c(e,{x:s,y:n},rf.Jq.CustomNodeBuilder);t&&(h((0,F.gz)(t)),h((0,F.IK)(a)))},v=ro.Bt.Grey,j=(0,ro.T2)(l.name);return(0,S.jsxs)("div",{className:"div-wrapper border-border! bg-elevated flex max-h-[600px] w-[500px] flex-col overflow-hidden rounded-3xl border shadow-none",children:[(0,S.jsx)("div",{className:"frame p-1 pb-5",children:(0,S.jsxs)("div",{className:"group-wrapper flex flex-col rounded-[20px] p-4",style:{backgroundColor:"color-mix(in srgb, ".concat(null==j?void 0:j.light,", transparent 50%)")},children:[(0,S.jsxs)("div",{className:"group-2 mb-2 flex items-center justify-between",children:[(0,S.jsxs)("div",{className:"flex items-center",children:[(0,S.jsx)("div",{className:"img bg-background mr-3 flex h-[52px] w-[52px] items-center justify-center rounded-lg shadow-sm",children:(0,S.jsx)(tw(),{src:"".concat((0,ro.F1)(l.name)),alt:"Category Icon",className:"h-9 w-9",width:36,height:36})}),(0,S.jsxs)("div",{className:"frame-2",children:[(0,S.jsx)("div",{className:"text-wrapper-3 text-xs",style:{fontSize:"12px",fontWeight:500,lineHeight:"130%",color:"color-mix(in srgb, ".concat(null==j?void 0:j.black,", transparent 20%)")},children:"Node Category"}),(0,S.jsx)("div",{className:"text-wrapper-4 text-[20px]",style:{fontWeight:500,lineHeight:"130%",color:"color-mix(in srgb, ".concat(null==j?void 0:j.black,", transparent 0%)")},children:l.name})]})]}),(0,S.jsx)("button",{className:"text-wrapper-2 hover:bg-background mb-6 cursor-pointer rounded-full border-none bg-transparent p-1 transition-colors duration-200",style:{color:"color-mix(in srgb, ".concat(null==j?void 0:j.black,", transparent 20%)")},onClick:e=>{e.preventDefault(),h((0,F.IK)(a))},children:(0,S.jsx)(t_.Z,{className:"nodrag",size:20})})]}),(0,S.jsx)("p",{className:"text-wrapper text-muted-foreground text-xs",style:{color:"color-mix(in srgb, ".concat(null==j?void 0:j.black,", transparent 20%)"),fontSize:"12px",fontWeight:400,lineHeight:"normal"},children:l.description})]})}),(0,S.jsx)("div",{className:"frame-wrapper nodrag nowheel flex-grow space-y-[12px] overflow-y-auto px-5 pb-2",onMouseDown:e=>{e.stopPropagation()},style:{pointerEvents:"all"},children:(0,S.jsxs)("div",{className:"frame-3",children:[m&&(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{children:(0,S.jsxs)("div",{className:(0,eu.cn)("frame-4 border-border! bg-elevated hover:bg-muted mb-3 flex cursor-pointer items-center rounded-lg border p-3 transition-colors",(null==t?void 0:t.is_mega_node_creation_restricted)&&"pointer-events-none opacity-50"),onClick:()=>f(m),children:[(0,S.jsx)("div",{className:"img-wrapper text-background mr-3 flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-md",style:{backgroundColor:"color-mix(in srgb, ".concat(null==j?void 0:j.dark,", transparent 0%)")},children:(0,rj.hY)("Wand2",20,"text-background")}),(0,S.jsxs)("div",{className:"group-4 min-w-0 flex-grow",children:[(0,S.jsxs)("div",{className:"flex w-full items-center gap-1.5",children:[(0,S.jsxs)("div",{className:"text-wrapper-6 text-foreground w-full truncate",style:{fontSize:"14px",fontWeight:600,lineHeight:"normal"},children:["Create ",rv.Z_.withArticle(l.name)," node with AI"]}),(0,S.jsx)(eU.C,{size:"sm",className:"text-background !rounded-sm font-medium",style:{backgroundColor:"color-mix(in srgb, ".concat(null==j?void 0:j.dark,", transparent 0%)")},children:"MCP"})]}),(0,S.jsx)("div",{className:"text-wrapper-5 text-muted-foreground line-clamp-2 text-xs",style:{fontSize:"12px",fontWeight:400,lineHeight:"normal"},children:"Harness the power of MCP to create a custom node"})]}),(0,S.jsx)(tr.Z,{className:"text-muted-foreground ml-4",size:20})]})})}),(null==t?void 0:t.is_mega_node_creation_restricted)&&(0,S.jsx)(eo._v,{children:"Custom node creation has been restricted by your admin."})]}),x.map((e,t)=>(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)("div",{children:(0,S.jsxs)("div",{className:(0,eu.cn)("frame-4 border-border! bg-elevated hover:bg-muted mb-3 flex cursor-pointer items-center rounded-lg border p-3 transition-colors",(null==e?void 0:e.is_restricted)&&"pointer-events-none opacity-50"),onClick:()=>g(e),children:[(0,S.jsx)("div",{className:"img-wrapper mr-3 flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-md",style:{backgroundColor:"color-mix(in srgb, ".concat(p.has(e.name)?null==j?void 0:j.light:null==v?void 0:v.light,", transparent 0%)")},children:(0,rj.hY)(e.icon,20,"",null==j?void 0:j.dark)}),(0,S.jsxs)("div",{className:"group-4 min-w-0 flex-grow",children:[(0,S.jsx)("div",{className:"text-wrapper-6 text-foreground truncate",style:{fontSize:"14px",fontWeight:600,lineHeight:"normal"},children:e.name}),(0,S.jsx)("div",{className:"text-wrapper-5 text-muted-foreground line-clamp-2 text-xs",style:{fontSize:"12px",fontWeight:400,lineHeight:"normal"},children:e.short_description||e.description})]}),(0,S.jsx)(tr.Z,{className:"text-muted-foreground ml-4",size:20})]})})}),(null==e?void 0:e.is_restricted)&&(0,S.jsx)(eo._v,{children:(0,S.jsx)("p",{children:"This node is restricted by your admin."})})]},e.name||t))]})})]})},[rf.Jq.Form]:rp,[rf.Jq.CustomNodeBuilder]:e=>(0,S.jsx)(sQ.zu,{value:e,children:(0,S.jsx)(nE,{})})};(g=T||(T={})).CANVAS="canvas",g.CODE="code";let u0={x:200,y:200,zoom:.75};var u1=()=>{let e=void 0!==(0,eM.useRouter)().query.tutorial_video,t=(0,Q.I0)(),{userProfile:r,idTokenRef:a}=(0,K.useContext)(ec.f),s=(0,K.useRef)(null),{currentProject:n}=(0,K.useContext)(e0.xI),{setConnectionInProgress:l}=rU(),o=(0,Q.v9)(R.LA),i=(0,Q.v9)(z.iZ),d=(0,Q.v9)(A.zd),c=(0,Q.v9)(A.d5),u=(0,Q.v9)(A.$g),m=(0,Q.v9)(ew),p=(0,Q.v9)(R.v9),x=(0,Q.v9)(R.JC),h=(0,Q.v9)(R.cP),g=(0,Q.v9)(eb.Me),v=(0,Q.v9)(eb.lF),j=(0,Q.v9)(eb.Y1),b=(0,Q.v9)(R.g2),_=(0,Q.v9)(R.z4),y=(0,Q.v9)(eb.qS),w=(0,Q.v9)(eb.vl),N=(0,Q.v9)(eb.x1),{active:k}=(0,Q.v9)(R.HA),{addNewNode:C,handleClickToAddNode:I}=(0,rg.A)(g),{abortCoreGummieCompletions:T}=(0,nO.J)(),[E,M]=(0,K.useState)("canvas"),Z=(0,K.useRef)(!1),{handleStartPipeline:P}=(0,rD.wL)(),L=(0,K.useMemo)(()=>{var e;return null===(e=r.uses_default_cursor)||void 0===e||e},[r.uses_default_cursor]);(0,K.useMemo)(()=>(null==o?void 0:o.author_id)&&(o.author_id===(null==r?void 0:r.user_id)||o.author_id===(null==n?void 0:n.project_id)),[o,r,n]),(0,K.useMemo)(()=>(null==_?void 0:_.author_id)&&(_.author_id===(null==r?void 0:r.user_id)||_.author_id===(null==n?void 0:n.project_id)),[_,r,n]),(0,eN.Fe)({flowbookId:null==o?void 0:o.flowbook_id,userProfile:r,idToken:a.current,savedItemId:null==_?void 0:_.saved_item_id},{skip:!(null==r?void 0:r.user_id)||!(null==o?void 0:o.flowbook_id)&&!(null==_?void 0:_.saved_item_id)});let{copy:G,paste:U}=nz({nodes:v,edges:j,currentSavedItem:_}),B=(0,K.useMemo)(()=>[...j,...N],[j,N]),V=(0,K.useCallback)(async(e,t)=>{await I(e,t)},[I]);(0,K.useEffect)(()=>{let e=async e=>{if(!(!e.key||e.target instanceof HTMLDivElement&&e.target.isContentEditable&&e.target.id.includes("note-editor"))&&m===f.DEFAULT&&x&&(e.ctrlKey||e.metaKey)){switch(e.key){case"h":if(!h)return;e.preventDefault(),t((0,D.ky)(!0));return;case"Enter":0===v.filter(e=>e.type&&(0,nD.iT)(e)&&"Note"!==e.data.declaration.name).length||e.shiftKey||P();return;case"g":e.preventDefault(),e.shiftKey?V(nX,rf.Jq.CustomNodeBuilder):(t((0,A.ym)(!0)),(0,ad.rB)(nr.z.CHAT_VIEW_TOGGLED));return;case"+":case"=":e.preventDefault(),null==g||g.zoomIn();return;case"-":e.preventDefault(),null==g||g.zoomOut();return;case"0":e.preventDefault(),null==g||g.fitView({padding:.4,duration:800});return}if(!(e.target instanceof HTMLDivElement)||!e.target.isContentEditable)switch(e.key){case"z":e.preventDefault(),Z.current=!0,await t(e.shiftKey?(0,ej.KX)():(0,ej.Yw)()),Z.current=!1;break;case"c":if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;G();break;case"v":if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;U(e.shiftKey?nZ.ws.NONE:nZ.ws.INTERNAL)}}},r=e=>{if(!e.key)return};return window.addEventListener("keydown",e),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",r)}},[t,G,U,g,u,m,x,P,v,d,j,V,h]);let W=(0,K.useMemo)(()=>eT()(async(e,r,a)=>{let s=e=>({...e,canResume:void 0,declaration:void 0,is_collapsed:void 0,form:"form"in e&&e.form?eV.Form.calculate_hash(e.form):void 0});(a.nodes.length!==e.length||a.edges.length!==r.length||e.some((e,t)=>{let r=a.nodes[t];return e!==r&&(e.id!==r.id||e.position.x!==r.position.x||e.position.y!==r.position.y||!eE()(s(e.data),s(r.data)))})||r.some((e,t)=>{let r=a.edges[t];return e!==r&&(e.id!==r.id||e.source!==r.source||e.target!==r.target||!eE()(e.data,r.data))}))&&(Z.current=!0,await t((0,ej.zV)()),Z.current=!1)},150),[t]);(0,K.useEffect)(()=>{!Z.current&&k===(null==_?void 0:_.saved_item_id)&&p&&W(v,j,b)},[v,j,b,W,k,_]);let H=(0,K.useCallback)(e=>{if(e.source===e.target)return;let r=v.find(t=>t.id===e.source);if((null==r?void 0:r.type)===rf.Jq.Operator&&r.data.subNodeId===e.target){X.Am.error("You cannot connect a node to its own subnode");return}let a=v.find(t=>t.id===e.target);if(y.some(t=>t.id===e.target)&&w){X.Am.error("Trigger nodes cannot accept manual connections when subscriptions are enabled");return}if(j.find(t=>t.source===e.source&&t.target===e.target)&&(null==a?void 0:a.data.name)!=="Join Paths"){X.Am.warning("Please use the Join Paths node to rejoin different paths"),localStorage.setItem("nodeMenuCategory","Flow Basics"),localStorage.setItem("nodeMenuCategoryIcon","FlowBasics.svg"),window.dispatchEvent(new Event("nodeMenuCategoryChanged"));return}let s=(0,rO.e4)({sourceId:e.source,targetId:e.target,connectionGroupType:(0,rO.nf)(e.sourceHandle)}),n=[...j,s].filter(t=>t.source===e.target).map(e=>{var t;return{source:e.source,connectionGroupType:(null===(t=e.data)||void 0===t?void 0:t.connectionGroupType)||"DEFAULT"}});t((0,F.Z_)(s)),t((0,F.fL)(t=>t.map(r=>{var a;return r.id!==e.target||(null===(a=r.data)||void 0===a?void 0:a.name)!=="Router"?r:(0,rB.ce)(r,e,t,n)})))},[t,v,j,y,w]),J=(0,K.useCallback)(e=>{let r=e.filter(e=>e.type!==nP.P.SubscriptionEdge);if(0===r.length)return;let a=r.map(e=>e.id);t((0,F.Cj)(a))},[t]),q=(0,K.useCallback)(e=>{let r=e.map(e=>e.id);t((0,F._l)(r))},[t]),Y=(0,K.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),$=(0,K.useCallback)(async e=>{if(e.preventDefault(),g){let t=e.dataTransfer.getData("application/reactflow"),r=e.dataTransfer.getData("application/reactflow-data");if(!r)return;let a=s.current.getBoundingClientRect(),n=g.screenToFlowPosition({x:e.clientX-a.left,y:e.clientY-a.top});await C(JSON.parse(r),n,t)}},[g,C]),ee=(0,K.useCallback)(()=>{l(!0)},[l]),et=(0,K.useCallback)(()=>{l(!1)},[l]),er=(0,K.useCallback)((e,r,a)=>{let s=new Set;t((0,F.fL)(e=>{if(!(0,nD.iT)(r)&&!e.length)return e;let{updatedNodes:t,nodeIdsToRemoveEdges:n}=(0,sx.AW)({draggedNode:r,draggedNodes:a,allNodes:e});return s=n,t})),s.size&&t((0,F.vd)(e=>e.filter(e=>!s.has(e.source))))},[t]),ea=(0,K.useMemo)(()=>eT()(e=>{t((0,ej.Ns)({viewport:e})),window.dispatchEvent(new CustomEvent("pipeline-viewport-change"))},50),[t]),es=(0,K.useCallback)((e,t)=>{ea(t)},[ea]),en=(0,K.useCallback)(e=>{let r=e.nodes,a=e.edges,s=new Set(r.map(e=>e.id)),n=new Set(a.map(e=>e.id));t((0,F.vd)(e=>e.map(e=>{if(e.type===nP.P.SubscriptionEdge)return e;let t=n.has(e.id)||s.has(e.source)||s.has(e.target)?nP.P.AnimatedSVGEdge:nP.P.MegaEdge;return e.type===t?e:{...e,type:t}})))},[t]),el=r.uses_default_edges?ek.t8.SmoothStep:ek.t8.Bezier;(0,K.useEffect)(()=>{u||(T(),M("canvas"))},[u]),(0,K.useEffect)(()=>{(null==d?void 0:d.code)||M("canvas")},[d]),(0,K.useEffect)(()=>{u&&c===O.Cn.MANUAL_CUSTOM_NODE&&M("code")},[u,c]);let eo=(0,K.useRef)(),ei=(0,K.useRef)(new Map),ed=(0,K.useCallback)(e=>{e.forEach(e=>{if("position"===e.type&&"id"in e){let t=ei.current.get(e.id);if(t&&"position"===t.type&&t.position&&e.position&&t.position.x===e.position.x&&t.position.y===e.position.y)return;ei.current.set(e.id,e);return}ei.current.set("".concat(e.type,"-").concat(Date.now(),"-").concat(Math.random()),e)}),eo.current||(eo.current=requestAnimationFrame(()=>{let e=Array.from(ei.current.values());ei.current.clear(),eo.current=void 0,t((0,F.ur)(e))}))},[t]),em=(0,K.useMemo)(()=>!!u&&(c===O.Cn.MANUAL_CUSTOM_NODE||c===O.Cn.CUSTOM_NODE_CONFIG),[c,u]);return(0,S.jsx)(eC.tV,{children:(0,S.jsxs)(ie,{children:[x&&(0,S.jsx)(du,{mode:m}),(0,S.jsxs)("div",{className:(0,eu.cn)("dark:bg-muted bg-background relative flex flex-grow flex-col"),children:[(0,S.jsxs)(eZ.mQ,{defaultValue:"canvas",className:"reactflow-wrapper flex flex-grow flex-col",ref:s,value:E,onValueChange:e=>{M(e)},children:[em&&(0,S.jsx)(iu,{}),(0,S.jsx)(eZ.nU,{value:"canvas",asChild:!0,children:(0,S.jsx)(eC.x$,{nodes:v,edges:B,onNodesChange:e=>ed(e),onEdgesChange:e=>t((0,F.Yw)(e)),onConnect:H,onInit:e=>{t((0,F.Az)(e)),e.fitView({padding:.4,nodes:v})},onDrop:$,onDragOver:Y,fitViewOptions:{padding:.4},nodeTypes:uX,edgeTypes:uQ,onNodeDragStop:er,onEdgesDelete:J,onNodesDelete:q,onSelectionChange:en,connectionLineType:el,minZoom:.1,proOptions:{hideAttribution:!0},deleteKeyCode:["Backspace","Delete"],selectionMode:ek.oW.Partial,selectionOnDrag:!L,panOnScroll:!L,panOnScrollSpeed:.9,panOnDrag:L,onMove:es,snapToGrid:!0,snapGrid:r.uses_snap_to_grid?[100,100]:[1,1],className:L?"":"react-flow--pointer",connectionRadius:64,onConnectStart:ee,onConnectEnd:et,defaultViewport:u0,children:(0,S.jsx)(eC.Aq,{color:"var(--muted-foreground)",variant:eC.T7.Dots,gap:100,offset:100,size:4.5,style:{opacity:.3}})})}),(0,S.jsx)(eZ.nU,{value:"code",className:"flex flex-grow flex-col",children:(0,S.jsx)(id,{})})]}),u?null:(0,S.jsx)(u$,{outdatedOperatorDeclarations:i,onNodeClickToAdd:V}),(0,S.jsx)(df,{hasTutorialVideo:e})]}),(0,S.jsx)(ly,{})]})})},u2=r(19275),u5=r(93601);let u4="pipeline-status-banner-incident";var u3=()=>{let{overallCurrentWorstImpact:e,message:t,hasOngoingIncident:r,highestSeverityIncident:a}=(0,u5.M)(),[s,n]=(0,K.useState)(!1);if((0,K.useEffect)(()=>{if(!a)return;let e=localStorage.getItem(u4);e&&JSON.parse(e).name===a.name&&n(!0)},[a]),!r||!a||s)return null;let l=(0,u2._)(a),o=(0,u2.N)(e),i=a.provider?"We may be experiencing issues with ".concat(a.provider):t;return(0,S.jsxs)("div",{className:"text-foreground bg-background fixed top-4 left-1/2 z-[9999] flex w-[calc(100%-2rem)] -translate-x-1/2 items-center gap-4 rounded-lg border p-4 shadow-lg transition-all duration-200 ease-in-out select-none sm:w-fit",children:[(0,S.jsx)(tf.Z,{className:"h-5 w-5 flex-shrink-0 ".concat(o.text)}),(0,S.jsxs)("div",{className:"flex flex-col gap-y-0.5 text-center sm:text-left",children:[(0,S.jsx)("p",{className:"max-w-lg truncate text-sm leading-tight font-medium",children:i}),(0,S.jsx)("p",{className:"text-muted-foreground max-w-lg truncate text-xs",children:l})]}),(0,S.jsxs)(eo.u,{children:[(0,S.jsx)(eo.aJ,{asChild:!0,children:(0,S.jsx)(el.zx,{variant:"ghost",size:"icon-xs",className:"text-muted-foreground",onClick:()=>{n(!0),localStorage.setItem(u4,JSON.stringify({name:null==a?void 0:a.name}))},children:(0,S.jsx)(t_.Z,{})})}),(0,S.jsx)(eo._v,{children:"Dismiss"})]})]})},u9=r(33682),u6=r(68934),u8=()=>{let e=(0,Q.I0)(),{userProfile:t,idTokenRef:r,setIsUserSignInModalOpen:a}=(0,K.useContext)(ec.f),{currentProject:s,setCurrentProject:n}=(0,K.useContext)(e0.xI),l=(0,Q.v9)(R.LA),o=(0,n6.d)(),i=(0,Q.v9)(z.po),d=(0,Q.v9)(B.v9),c=(0,Q.v9)(B.Pb),u=(0,Q.v9)(H.ak),m=(0,Q.v9)(H._I),p=(0,Q.v9)(R.fK),{isLoading:x}=(0,J.jL)({userProfile:t,idToken:r.current,projectId:null==s?void 0:s.project_id}),h=(0,Q.v9)(A.d5);(0,M.c)({userProfile:t,idToken:r.current,creator_user_id:t.user_id},{skip:(null==t?void 0:t.isLoading())||!r.current}),(0,L.F2)({flowbookId:l.flowbook_id,userProfile:t,idToken:r.current},{skip:!l.flowbook_id}),(0,Z.Y)({userProfile:t,idToken:r.current},{skip:null==t?void 0:t.isLoading()});let[g,f]=(0,K.useState)(!0),{isLoading:v,showSplashScreen:j,hideSplashScreen:b}=(0,eg.NN)(),{loadPipelineData:_,loadPipelineError:y,searchParams:w}=oI();(0,K.useEffect)(()=>{!o||(null==t?void 0:t.isLoggedIn())||g||a(!0)},[t,o,a,g]),(0,K.useEffect)(()=>{x||g?j():b()},[b,g,x,j]),(0,K.useEffect)(()=>{(h===O.Cn.CUSTOM_GUMMIE||h===O.Cn.GENERAL||h===O.Cn.GUMSTACK||h===O.Cn.ONBOARDING)&&e((0,A.nz)())},[e]);let N=(0,K.useCallback)(async()=>{try{let a=[];if(t&&t.user_id&&!t.isLoading()&&(i===z.JU.IDLE&&(f(!0),a.push((0,z.OU)({userProfile:t}))),t.isLoggedIn()&&"idle"===u&&(f(!0),await e((0,H.bl)({userProfile:t,idToken:r.current}))),!t.isLoggedIn()||"succeeded"===u)){f(!0);let o=localStorage.getItem("currentProfile"),i=null==s?void 0:s.project_id;if(o&&(!s||s&&s.project_id!=o)){let e=m.find(e=>e.project_id===o);e&&(n(e),i=e.project_id)}if(await Promise.all([...a.map(e)]),"idle"===d&&(f(!0),await e((0,B.U3)({userProfile:t,idToken:r.current,projectId:i}))),f(!0),l.created_ts){let t=E.Z.getState(),r=Object.values(t.flowManager.flows).reduce((e,t)=>{var r,a;return(null===(a=t.plConfig)||void 0===a?void 0:null===(r=a.dependent_declarations)||void 0===r?void 0:r.length)?e.concat(t.plConfig.dependent_declarations):e},[]);r.length&&e((0,B.ER)(r)),await _({projectId:i,versionId:w.versionId})}else e((0,D.ki)({flows:e=>Object.keys(e).reduce((r,a)=>(r[a]={...e[a],savedItem:new a$.g({...e[a].savedItem,author_id:i||t.user_id})},r),{...e})})),await _({projectId:i,versionId:w.versionId});f(!1)}}catch(e){X.Am.error(e.message),f(!1)}},[e,t,u,i,m,s,d,_,w.versionId,l.created_ts,r,n]);(0,K.useEffect)(()=>{N()},[null==t?void 0:t.user_id,u,w.versionId,t.isLoading()]),(0,K.useEffect)(()=>()=>{e((0,q.d3)()),e((0,V.vr)()),e((0,G.Vw)()),e((0,W.DO)()),e((0,P.s5)()),e((0,A.nz)()),e((0,F.UZ)()),e((0,D.xe)()),e((0,U.EM)())},[e]),(0,K.useEffect)(()=>{let e=e=>{p&&(e.preventDefault(),e.returnValue="You have unsaved changes, are you sure you want to leave?")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[p]);let k=(0,K.useCallback)(e=>{(e.ctrlKey||e.metaKey)&&e.preventDefault()},[]);return((0,K.useEffect)(()=>(document.addEventListener("wheel",k,{passive:!1}),()=>{document.removeEventListener("wheel",k)}),[k]),(0,K.useEffect)(()=>{y&&"string"==typeof y&&X.Am.error(y)},[y]),y&&"object"==typeof y&&"unauthorized_flowbook_view"===y.error||c===ok.Z.unauthorized_sign_in)?(0,S.jsx)(ee.ZP,{children:(0,S.jsx)(ep,{adminEmails:y?y.admin_emails:void 0})}):(0,S.jsxs)(K.Fragment,{children:[(0,S.jsx)($(),{children:(0,S.jsx)("title",{children:l&&l.name?"".concat(l.name," | Gumloop"):"Gumloop | Automation Builder"})}),(0,S.jsx)("div",{className:"pointer-events-none absolute opacity-0",children:(0,S.jsx)("a",{href:u6.hZ,children:"Outgoing Link"})}),(0,S.jsx)(u9.x,{children:(0,S.jsx)(rD.ZP,{isLoading:v,children:(0,S.jsx)(rG,{children:(0,S.jsx)(nn,{children:(0,S.jsx)(aY.C,{children:(0,S.jsx)("div",{className:"flex h-svh min-w-full flex-col",children:(0,S.jsxs)("div",{className:"flex h-[calc(100vh-64px)] flex-col md:flex-row",children:[(0,S.jsx)(u3,{}),(0,S.jsx)(ef.Z,{}),(0,S.jsx)(u1,{}),(0,S.jsx)(ev.Z,{authorId:null==l?void 0:l.author_id,entityType:ev.R.FLOWBOOK})]})})})})})})})]})}},19975:function(e,t,r){"use strict";var a=r(85893),s=r(67294),n=r(62190),l=r(36127),o=r(64127),i=r(18998);let d=(0,s.forwardRef)((e,t)=>{let{onSearch:r,onChange:d,onEnter:c,placeholder:u="Search nodes",debounceTime:m=150,value:p,className:x,icon:h,iconClassName:g,...f}=e,[v,j]=(0,s.useState)(p||""),b=(0,s.useRef)(v);return b.current=v,(0,s.useEffect)(()=>{void 0!==p&&p!==v&&j(p)},[p]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{r(b.current)},m);return()=>{clearTimeout(e)}},[v,r]),(0,a.jsx)(o.I,{id:"node-search-input",ref:t,value:v,onChange:e=>{d&&d(),j(e.target.value)},onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),c&&c())},LeadingIcon:h||l.Z,TrailingIcon:n.Z,TrailingIconProps:{onClick:e=>{e.preventDefault(),j("")},className:v?"opacity-100":"opacity-0"},placeholder:u,className:(0,i.cn)(x),autoComplete:"off",...f})});d.displayName="SearchBar",t.Z=d},1365:function(e,t,r){"use strict";var a=r(85893);r(67294),t.Z=e=>{let{count:t,contentLines:r=2,className:s}=e,n=()=>Array.from({length:r}).map((e,t)=>(0,a.jsx)("div",{className:"bg-muted mt-2 h-4 rounded",style:{width:"".concat((4-t)/5*100,"%")}},t));return(0,a.jsx)("div",{className:"h-full w-full space-y-4",children:Array.from({length:t}).map((e,t)=>(0,a.jsxs)("div",{className:"animate-pulse rounded p-4",children:[(0,a.jsx)("div",{className:"bg-muted h-6 w-1/2 rounded ".concat(s||"")})," ",n()]},t))})}},15527:function(e,t,r){"use strict";var a=r(85893);r(67294);let s=()=>(0,a.jsxs)("div",{className:"w-full animate-pulse p-4",children:[(0,a.jsx)("div",{className:"bg-muted h-4 w-3/4 rounded"}),(0,a.jsx)("div",{className:"bg-muted mt-2 h-4 w-1/2 rounded"})]});t.Z=e=>{let{count:t}=e;return(0,a.jsx)("div",{className:"w-full space-y-4",children:Array.from({length:t}).map((e,t)=>(0,a.jsx)(s,{},t))})}},6919:function(e,t,r){"use strict";var a=r(85893),s=r(67294),n=r(23432),l=r(92437),o=r(18998);t.Z=(0,s.memo)(e=>{let{value:t,label:r,description:s,checked:i,loading:d,disabled:c,idPrefix:u,Icon:m,className:p}=e;return(0,a.jsxs)("label",{htmlFor:u+t,className:(0,o.cn)("flex cursor-pointer snap-center items-center gap-2.5 rounded-md border p-4",i&&"border-accent-foreground/30 bg-accent",c&&"opacity-50",p),children:[(0,a.jsxs)("div",{className:"flex w-full flex-col gap-0.5 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[m&&(0,a.jsx)(m,{className:"size-3.5 flex-none"}),(0,a.jsx)("p",{className:"text-foreground w-full truncate text-left text-sm font-medium",children:r})]}),s&&(0,a.jsx)("p",{className:"text-muted-foreground line-clamp-2 text-left text-xs text-pretty",children:s})]}),d?(0,a.jsx)(n.Z,{className:"text-accent-foreground size-4.5 flex-none animate-spin"}):(0,a.jsx)(l.m,{value:t,id:u+t,checked:i,disabled:d||c})]},t)})},73920:function(e,t,r){"use strict";r.d(t,{R:function(){return s}});var a,s,n=r(85893),l=r(22495),o=r(93713),i=r(67294),d=r(62190),c=r(29876),u=r(42414),m=r(15649),p=r(9751),x=r(97257),h=r(45837);let g=e=>{let{authorId:t}=e,r=(0,l.CG)(o._I),{currentProject:a}=(0,x.d2)(),{userProfile:s}=(0,h.H)(),[n,d]=(0,i.useState)(!(null==s?void 0:s.isLoggedIn()));(0,i.useEffect)(()=>{d(!(null==s?void 0:s.isLoggedIn()))},[s]);let c=(0,i.useMemo)(()=>{if(t)return r.find(e=>e.project_id===t)},[t,r]),u=(0,i.useMemo)(()=>t===(null==a?void 0:a.project_id),[t,null==a?void 0:a.project_id]),m=(0,i.useMemo)(()=>{let e=t===(null==s?void 0:s.user_id),r=!a&&(null==s?void 0:s.isLoggedIn());return e&&r},[t,a,s]),p=(0,i.useMemo)(()=>!t||!!u||!!m,[t,u,m]),g=(0,i.useMemo)(()=>c?!!c:t===(null==s?void 0:s.user_id),[c,t,null==s?void 0:s.user_id]);return{ignoreWorkspaceMismatch:n,setIgnoreWorkspaceMismatch:d,isInCorrectWorkspace:p,entityAuthorProject:c,hasAccessToEntityWorkspace:g}};(a=s||(s={})).FLOWBOOK="flow",a.CUSTOM_AGENT="agent",t.Z=e=>{let{authorId:t,entityType:r}=e,{handleProjectSwitch:a}=(0,m.W)(),{handleProjectSwitch:s}=(0,p.y)(),{isInCorrectWorkspace:l,entityAuthorProject:o,ignoreWorkspaceMismatch:i,setIgnoreWorkspaceMismatch:x,hasAccessToEntityWorkspace:h}=g({authorId:t}),f=(null==o?void 0:o.project_name)||"Personal",v=f.length>10;return l||i||!h?null:(0,n.jsxs)("div",{className:"gumloop-gray-gradient text-foreground absolute bottom-[calc(var(--pipeline-tab-bar-height)+1rem)] left-1/2 z-50 flex w-[calc(100%-1rem)] -translate-x-1/2 flex-col items-center gap-3 rounded-lg border p-2 shadow-xs transition-all duration-200 ease-in-out select-none sm:w-fit sm:flex-row md:gap-8",children:[(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,n.jsx)(c.zx,{variant:"ghost",size:"icon-xs",className:"text-muted/75 hover:text-muted-foreground hidden sm:flex",onClick:()=>x(!0),children:(0,n.jsx)(d.Z,{})}),(0,n.jsxs)("div",{className:"text-center sm:text-left",children:[(0,n.jsx)("p",{className:"max-w-sm text-sm leading-tight font-medium",children:v?"This ".concat(r," was created in a different workspace."):"This ".concat(r," was created in ").concat((null==o?void 0:o.project_name)?"the ":"your "," ").concat(f," workspace.")}),(0,n.jsxs)("p",{className:"text-muted/80 text-xs",children:["May behave unexpectedly."," ",(0,n.jsx)("a",{className:"underline underline-offset-2",href:"https://docs.gumloop.com/core-concepts/projects#organizations-and-workspaces",target:"_blank",rel:"noopener noreferrer",children:"What is a workspace?"})]})]})]}),(0,n.jsxs)("div",{className:"flex w-full items-center justify-between gap-x-4 sm:w-fit",children:[(0,n.jsxs)(u.u,{children:[(0,n.jsx)(u.aJ,{asChild:!0,children:(0,n.jsx)(c.zx,{variant:"ghost",size:"xs",className:"text-muted hover:text-muted-foreground flex sm:hidden",onClick:()=>x(!0),children:"Dismiss"})}),(0,n.jsx)(u._v,{children:"Dismiss"})]}),(0,n.jsx)(c.zx,{onClick:()=>{"flow"===r?a(o):s(o)},variant:"secondary",size:"xs",shadow:!0,className:"w-full sm:w-fit",children:v?"Switch to right workspace":"Switch to ".concat(f)})]})]})}},92437:function(e,t,r){"use strict";r.d(t,{E:function(){return i},m:function(){return d}});var a=r(85893),s=r(67294),n=r(37918),l=r(70162),o=r(18998);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.fC,{className:(0,o.cn)("grid gap-2",r),...s,ref:t})});i.displayName=n.fC.displayName;let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.ck,{ref:t,className:(0,o.cn)("border-accent-foreground text-accent-foreground focus-visible:ring-ring aspect-square h-4 w-4 rounded-full border shadow focus:outline-none focus-visible:ring-1 disabled:cursor-not-allowed disabled:opacity-50",r),...s,children:(0,a.jsx)(n.z$,{className:"flex items-center justify-center",children:(0,a.jsx)(l.Z,{className:"fill-accent-foreground h-3.5 w-3.5"})})})});d.displayName=n.ck.displayName},86193:function(e,t,r){"use strict";var a=r(85893),s=r(48491),n=r(53985),l=r(22495),o=r(57939),i=r(67294),d=r(28900),c=r(3002),u=r(79535),m=r(33058),p=r(10071),x=r(3528),h=r(41949),g=r(33633),f=r(89354),v=r(90437),j=r(4307),b=r(57440),_=r(85337),y=r(21872),w=r(45837);let N=[{message:"What can you do?",Icon:d.Z},{message:"What are custom nodes and how do I use them?",Icon:c.Z}],k=[{message:"Build me an automation from scratch",Icon:u.Z},{message:"Help me brainstorm ideas for an automation",Icon:m.Z}],C=[{message:"Explain this flow to me",Icon:p.Z},{message:"Help me debug this flow",Icon:x.Z},{message:"Rename all my nodes to be more descriptive",Icon:h.Z}],I=[{message:"What can you do?",Icon:d.Z},{message:"Explain how this custom node works",Icon:c.Z}],T=[{message:"Who are my top 3 most active users this week?",Icon:g.Z},{message:"What are the most used tools this week?",Icon:f.Z},{message:"What are the most used servers this week?",Icon:v.Z}];t.Z=e=>{let{disabled:t=!1}=e,r=(0,l.CG)(s.d5),d=(0,l.CG)(o.FA),{userProfile:c,setIsUserSignInModalOpen:u}=(0,w.H)(),{handleSubmitAgentModeMessage:m}=(0,y.M)(),{handleSubmitCustomNodeConfigMessage:p}=(0,b.n)(),{handleSubmitGumstackMessage:x}=(0,_.F)(),h=(0,i.useCallback)(e=>{if(!c.isLoggedIn()){u(!0);return}r===n.Cn.AGENT?m({messageContent:e}):r===n.Cn.CUSTOM_NODE_CONFIG?p({messageContent:e}):r===n.Cn.GUMSTACK&&x({messageContent:e})},[m,p,x,u,c,r]),g=(0,i.useMemo)(()=>([...N],d?[...k,...N]:[...C,...N]),[d]),f=(0,i.useMemo)(()=>[...I],[]),v=(0,i.useMemo)(()=>r===n.Cn.AGENT?g:r===n.Cn.CUSTOM_NODE_CONFIG?f:r===n.Cn.GUMSTACK?T:[],[r,g,f]);return(0,a.jsx)("div",{className:"divide-border flex flex-col items-center divide-y px-4",children:v.map((e,r)=>(0,a.jsxs)("button",{disabled:t,className:"text-foreground flex w-full items-center gap-2 px-2 py-4 text-start text-sm disabled:cursor-not-allowed",onClick:()=>!t&&h(e.message),children:[(0,a.jsx)(e.Icon,{className:"size-4"}),(0,a.jsx)("span",{className:"flex-1 text-start",children:e.message}),(0,a.jsx)(j.Z,{className:"size-4"})]},r+e.message))})}},76344:function(e,t,r){"use strict";r.d(t,{Z:function(){return h}});var a=r(85893),s=r(48491),n=r(53985),l=r(22495),o=r(67294),i=r(39281),d=r(78293);let c=(e,t,r,a)=>0===t?0:Math.floor(e+(t-e)*Math.min(1,Math.max(0,(a.getTime()-r.getTime())/9e5)));var u=()=>{var e,t;let{activityCountData:r}=(0,d.Tj)(),a=null!==(e=null==r?void 0:r.count)&&void 0!==e?e:0,s=null!==(t=null==r?void 0:r.previous_count)&&void 0!==t?t:0,n=(0,o.useMemo)(()=>(null==r?void 0:r.counted_at)?new Date(r.counted_at):null,[null==r?void 0:r.counted_at]),[l,i]=(0,o.useState)(()=>n&&0!==a?c(s,a,n,new Date):0);return(0,o.useEffect)(()=>{if(!n||0===a){i(0);return}i(c(s,a,n,new Date))},[s,a,n]),(0,o.useEffect)(()=>{if(!n||0===a)return;let e=setInterval(()=>{i(c(s,a,n,new Date))},2e3);return()=>clearInterval(e)},[s,a,n]),{displayCount:l}},m=r(45837);let p=e=>{let{digit:t,delay:r=0}=e;return(0,a.jsx)("span",{className:"bg-muted relative inline-block overflow-hidden px-1 py-0.25",style:{height:"".concat(1.3,"em")},children:(0,a.jsx)(i.E.span,{className:"flex flex-col",initial:!1,animate:{y:"".concat(-(1.3*t),"em")},transition:{type:"spring",stiffness:100,damping:15,delay:r},children:[0,1,2,3,4,5,6,7,8,9].map(e=>(0,a.jsx)("span",{className:"flex items-center justify-center leading-none",style:{height:"".concat(1.3,"em")},children:e},e))})})},x=()=>{let{displayCount:e}=u(),t=(0,o.useMemo)(()=>e.toString().padStart(4,"0").split("").map(e=>parseInt(e,10)),[e]);return 0===e?(0,a.jsx)("p",{className:"text-muted-foreground text-center md:text-xl",children:"Make MCP tool calls in Gumloop to get started"}):(0,a.jsxs)("p",{className:"text-muted-foreground text-center md:text-xl",children:["Understand the"," ",(0,a.jsx)("span",{className:"border-border/50 divide-border/50 inline-flex flex-row divide-x overflow-hidden rounded-sm border font-mono tabular-nums",children:t.map((e,t)=>(0,a.jsx)(p,{digit:e,delay:.1*t},t))})," ","tool calls made this month"]})};var h=()=>{let e=(0,l.CG)(s.d5),{userProfile:t}=(0,m.H)(),r=(0,o.useMemo)(()=>e===n.Cn.AGENT?"I'm your AI co-pilot. I can build flows, help you answer questions, and make you a Gumloop expert.":e===n.Cn.CUSTOM_NODE_CONFIG?"I'm your AI co-pilot. I can help you build and edit custom nodes.":e===n.Cn.GUMSTACK?(0,a.jsx)(x,{}):e===n.Cn.CUSTOM_GUMMIE||e===n.Cn.GENERAL?null:"I'm your AI co-pilot.",[e]),i=(0,o.useMemo)(()=>{var r,s;return t.isLoggedIn()||e!==n.Cn.GENERAL?e===n.Cn.GUMSTACK?(0,a.jsxs)("span",{className:"text-foreground mb-0.5 text-center text-xl font-medium md:text-3xl",children:["Hey ",null!==(r=t.first_name)&&void 0!==r?r:"there",",",(0,a.jsx)("br",{})]}):(0,a.jsxs)("span",{className:"text-foreground text-center text-xl font-medium md:text-2xl",children:["Hey ",null!==(s=t.first_name)&&void 0!==s?s:"there",", how can I help?"]}):(0,a.jsx)("span",{className:"text-foreground mb-0.5 text-center text-xl font-medium md:text-3xl",children:"Welcome to Gumloop, how can I help?"})},[e,t]);return(0,a.jsxs)("div",{className:"flex flex-col items-center gap-1 px-4",children:[i,r&&"string"==typeof r?(0,a.jsx)("span",{className:"text-muted-foreground text-center text-sm text-balance",children:r}):r]})}},60503:function(e,t,r){"use strict";r.d(t,{ns:function(){return l},zR:function(){return n}});var a=r(99882),s=r(75318);let n={[s.a.DONE]:"success",[s.a.FAILED]:"destructive",[s.a.QUEUED]:"warning",[s.a.RUNNING]:"accent",[s.a.STARTED]:"muted",[s.a.TERMINATED]:"destructive",[s.a.TERMINATING]:"destructive"};a.t.IDLE,a.t.PROCESSING,a.t.ASYNC_PROCESSING,a.t.COMPLETED,a.t.FAILED,a.t.ERROR,a.t.DECLINED,a.t.APPROVAL_REQUIRED,a.t.EDIT_CUSTOM_NODE,a.t.COMPLETED,a.t.PROCESSING,a.t.ASYNC_PROCESSING,a.t.IDLE,a.t.FAILED,a.t.ERROR,a.t.DECLINED,a.t.APPROVAL_REQUIRED,a.t.EDIT_CUSTOM_NODE;let l={[s.a.DONE]:"Success",[s.a.FAILED]:"Failed",[s.a.TERMINATED]:"Terminated",[s.a.TERMINATING]:"Terminating",[s.a.STARTED]:"Started",[s.a.RUNNING]:"Running",[s.a.QUEUED]:"Queued"}},27466:function(e,t,r){"use strict";var a=r(85893),s=r(42414),n=r(68262),l=r(18998),o=r(84385);t.Z=e=>{let{triggerType:t,className:r,size:i=16}=e,d=(0,a.jsx)(o.Z,{triggerType:t||"manual",size:i}),c=n.sv[t||"manual"],u=n.RT[t||"manual"]||{background:"bg-accent",border:"border-accent-foreground/10",color:"text-accent-foreground"};return(0,a.jsxs)(s.u,{children:[(0,a.jsx)(s.aJ,{className:(0,l.cn)("flex size-8 flex-row items-center justify-center rounded-md border p-1",u.background,u.border,u.color,r),children:d}),(0,a.jsx)(s._v,{children:c})]})}},81162:function(e,t,r){"use strict";r.d(t,{Ww:function(){return i},runCustomNodeCode:function(){return u}});var a=r(53985),s=r(73587),n=r(44079),l=r(90273),o=r(83001);let i=async(e,t,r)=>{var a;return null!==(a=(await (0,l.eN)("custom_operator/environment_variables",t,r,"POST",{code:e})).required_environment_variables)&&void 0!==a?a:[]},d=null,c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.kr.MANUAL,t=arguments.length>1?arguments[1]:void 0;if(d){var r,l,o;e===a.kr.TIMEOUT&&t?(0,n.gW)(s.z.API_TIMEOUT,{customOperator:t.custom_operator,chat_id:null===(r=t.chat)||void 0===r?void 0:r.id,context:t}):(0,n.gW)(s.z.COMPLETION_ABORTED,{chat_id:null!==(o=null==t?void 0:null===(l=t.chat)||void 0===l?void 0:l.id)&&void 0!==o?o:"",reason:e}),d.abort(e)}},u=async(e,t,r,s,n,i)=>{var u,p;d=new AbortController;let x=setTimeout(()=>c(a.kr.TIMEOUT),9e4);try{let a={context:e,inputs:(0,o.KD)(t),parameters:(0,o.Du)(r)},c=await (0,l.bV)("run_custom_operator",s,n,"POST",a,{signal:d.signal});clearTimeout(x);let m=null===(u=c.body)||void 0===u?void 0:u.getReader();if(!m)throw Error("Reader not available");let p=new TextDecoder,h="",g={},f="";for(;;){let{value:e,done:t}=await m.read();if(t)break;let r=(h+=p.decode(e,{stream:!0})).split("@@@");for(let e of(h=r.pop(),r))if(e.trim())try{let t=JSON.parse(e);i&&i(t),g=t,t.content_chunk&&(f+=t.content_chunk)}catch(t){console.error("Could not parse chunk",t,e)}}if((h+=p.decode()).trim()){let e=JSON.parse(h);i&&i(e),g=e,e.content_chunk&&(f+=e.content_chunk)}return g}catch(t){if(m(s,(null===(p=e.chat)||void 0===p?void 0:p.id)||"unknown",t,n),(0,l.UJ)(d,a.kr.MANUAL))throw Error(a.kr.MANUAL);throw console.error("Error in runCustomNodeCode:",t),t}finally{clearTimeout(x),d=null}},m=async(e,t,r,a)=>{try{let s={interaction_id:String(t),error_message:"string"==typeof r?{error:r}:r};await (0,l.eN)("metrics/mega_operator",e,a,"POST",s)}catch(e){console.error("Failed to log MCP node error:",e)}}},43526:function(e,t,r){"use strict";var a=r(85893);r(67294);var s=r(52542),n=r(65329),l=r(18998);t.Z=e=>{let{warnings:t,hasBannerAbove:r,fullRounded:o=!1}=e;return t.length?(0,a.jsx)("div",{className:(0,l.cn)("mx-1 mt-1",r?"mb-1":""),children:(0,a.jsx)(n.bZ,{className:(0,l.cn)("bg-warning/50 dark:bg-warning/75 flex flex-col gap-2.5 border-none pr-2",o?"rounded-[0.85rem]":"rounded-b-none",!o&&(r?"rounded-t-none":"rounded-t-[0.85rem]")),children:(0,a.jsxs)("div",{className:"text-warning-foreground dark:text-foreground flex flex-col gap-1",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,a.jsx)(s.Z,{className:"shrink-0 !stroke-[2]",size:20}),(0,a.jsx)(n.Cd,{className:"text-sm font-semibold",children:"Important Notice"})]}),(0,a.jsx)(n.X,{className:"text-warning-foreground dark:text-foreground text-sm",children:t.map((e,t)=>(0,a.jsx)("div",{className:(0,l.cn)(t>0&&"mt-2"),children:e},t))})]})})}):null}},33682:function(e,t,r){"use strict";r.d(t,{x:function(){return m}});var a=r(85893),s=r(22495),n=r(62685),l=r(77739),o=r(67294),i=r(41248),d=r(75318),c=r(45837);let u=(0,o.createContext)(null),m=e=>{let{children:t}=e,r=(0,i.v9)(l.sG),{userProfile:m,idTokenRef:p}=(0,o.useContext)(c.f),x=(0,s.TL)();return(0,o.useEffect)(()=>{let e;let t=async()=>{for(let e in r)try{let t=await d.U.loadRun(e,m,p.current);t&&x((0,n.dj)({plRun:t,savedItem:{saved_item_id:r[e].saved_item_id,name:r[e].saved_item_name,is_saved:()=>!!r[e].saved_item_id},flowbook:{flowbook_id:r[e].flowbook_id,is_saved:()=>!!r[e].flowbook_id}}))}catch(t){console.log("Failed to update run ".concat(e,": ").concat(t))}};return Object.keys(r).length>0&&(e=setInterval(t,2e3)),()=>{e&&clearInterval(e)}},[r,x,m,p]),(0,a.jsx)(u.Provider,{value:{activePipelineRuns:r},children:t})}},31443:function(e,t,r){"use strict";r.d(t,{D:function(){return s}});var a=r(821);let s=(e,t)=>(0,a.DV)({path:"get_operator_category_scopes?category=".concat(e),queryKey:["".concat(e,"-app-scopes-operators")],options:t})},40930:function(e,t,r){"use strict";r.d(t,{y:function(){return l}});var a=r(37825),s=r(45837),n=r(821);function l(e){let{serverId:t,categoryName:r,groupId:l,options:o}=e,{userProfile:i}=(0,s.H)();return(0,n.DV)({path:(()=>{var e;let s="organization_permission_group_app_permissions?organization_id=".concat(null==i?void 0:null===(e=i.organization)||void 0===e?void 0:e.organization_id),n=[];return l&&n.push("group_id=".concat(l)),r&&n.push("category_name=".concat((0,a.Sp)(r))),t&&n.push("server_id=".concat((0,a.Sp)(t))),n.length>0?"".concat(s,"&").concat(n.join("&")):s})(),queryKey:(()=>{let e=[];return l&&e.push("".concat(l,"-app-permissions")),r&&e.push("".concat(r,"-app-permissions")),t&&e.push("".concat(t,"-app-permissions")),e})(),...o})}},94453:function(e,t,r){"use strict";r.d(t,{HN:function(){return u},i7:function(){return c},pN:function(){return d}});var a=r(69245),s=r(67294),n=r(31443),l=r(821),o=r(45837),i=r(40930);let d=e=>(0,l.DV)({path:"get_operator_categories_with_scopes",queryKey:["operator-categories-with-scopes"],options:{staleTime:1/0,...e}}),c=e=>(0,l.DV)({path:"get_operator_categories_summary",queryKey:["operator-categories-summary"],options:{staleTime:1/0,...e}}),u=e=>{var t;let{categoryName:r,secretDeclaration:c,groupId:u,passedScopes:m,externalOperatorDeclarations:p,enabled:x=!0}=e,{userProfile:h,idTokenRef:g}=(0,o.H)(),f=(0,s.useMemo)(()=>r||(null==c?void 0:c.category),[r,null==c?void 0:c.category]),{data:v,isLoading:j}=d(),{data:b}=(0,n.D)(f,{enabled:x&&!!f&&!m&&(null==v?void 0:v.categories.includes(f))&&!j,initialData:m?{scopes:m}:void 0}),{data:_,isLoading:y}=(0,i.y)({categoryName:null!=f?f:"",groupId:u,options:{enabled:x&&!!f&&!!(u||(null==h?void 0:h.group_id))}}),{data:w,isLoading:N,isPending:k}=(0,l.DV)({path:"/operator_declarations",queryKey:["operator_declarations"],options:{enabled:!p||(null==p?void 0:p.length)<1}}),{data:C}=(0,a.Y)({userProfile:h,idToken:g.current},{skip:!x||!h.isLoggedIn()||h.isLoading()}),I=(0,s.useMemo)(()=>{var e;let t=f||r;return null==C?void 0:null===(e=C.find(e=>e.category===t))||void 0===e?void 0:e.server_id},[C,f,r]),{data:T,isLoading:S,isPending:E}=(0,l.DV)({path:I?"gumcp_server_tools?server_id=".concat(I,"&organization_id=").concat(null==h?void 0:null===(t=h.organization)||void 0===t?void 0:t.organization_id,"&group_id=").concat(null!=u?u:null==h?void 0:h.group_id):"",queryKey:["mcp-tools-".concat(I,"-").concat(u||(null==h?void 0:h.group_id))],options:{enabled:x&&!!I&&!!(u||(null==h?void 0:h.group_id))}}),M=null!=p?p:null==w?void 0:w.pipeline_components,A=(0,s.useMemo)(()=>{var e;return(null==_?void 0:null===(e=_.scopes)||void 0===e?void 0:e.item_list)?null==m?void 0:m.map(e=>null==e?void 0:e.name).filter(e=>{var t,r;return _&&!(null==_?void 0:null===(r=_.scopes)||void 0===r?void 0:null===(t=r.item_list)||void 0===t?void 0:t.includes(e))}):[]},[m,_]),O=(0,s.useMemo)(()=>null!=m?m:null==b?void 0:b.scopes,[m,b]),Z=(0,s.useMemo)(()=>null==M?void 0:M.filter(e=>{let t=(null==c?void 0:c.category)?(null==e?void 0:e.category)===(null==c?void 0:c.category):!!f&&(null==e?void 0:e.category)===f,r=(null==c?void 0:c.secret_type)?Object.keys(null==e?void 0:e.secrets).includes(null==c?void 0:c.secret_type):Object.keys(null==e?void 0:e.secrets).length>0;return t&&r}),[M,c,f]),z=(0,s.useMemo)(()=>{if(!T||!O)return[];let e=new Set(O.map(e=>e.name));return(null==T?void 0:T.filter(t=>{var r;return!(null===(r=t.required_scopes)||void 0===r?void 0:r.length)||t.required_scopes.some(t=>e.has(t))}))||[]},[T,O]),P=(0,s.useMemo)(()=>((null==Z?void 0:Z.length)||0)+((null==z?void 0:z.length)||0),[Z,z]);return{scopes:O,operatorDeclarations:M,permittedScopesOperators:_,categoryName:f,disabledScopes:A,operatorDeclarationsAssociatedWithSecret:Z,mcpToolsAssociatedWithScopes:z,totalOperatorDeclarationsCount:P,isLoadingPermittedScopesOperators:y,isLoadingMCPTools:S,isLoadingOperatorDeclarations:N,isPendingMCPTools:E,isPendingOperatorDeclarations:k}}},5447:function(e,t,r){"use strict";r.d(t,{p:function(){return c}});var a=r(67294),s=r(78551),n=r(11163),l=r(45837),o=r(90273);let i=["/analytics","/analytics/customers"],d=e=>!!e.startsWith("/super-admin-dashboard")||i.includes(e),c=()=>{let{userProfile:e,idTokenRef:t}=(0,l.H)(),r=(0,n.useRouter)(),{data:i,isLoading:c}=(0,s.a)({queryKey:["isSuperAdmin",e.user_id],queryFn:async()=>{try{var r;return(await (0,o.eN)("super_admin_action",e,null!==(r=t.current)&&void 0!==r?r:void 0,"GET")).success}catch(e){return console.error("Error checking super admin status:",e),!1}},enabled:e.isLoggedIn()&&r.isReady});return(0,a.useEffect)(()=>{r.isReady&&d(r.pathname)&&!i&&void 0!==i&&!c&&r.push("/")},[r.pathname,i,c,r.isReady]),{isSuperAdmin:i,isLoading:c,showProtectedPage:i&&!c||!d(r.pathname)}}},26659:function(e,t,r){"use strict";r.d(t,{X:function(){return n}});var a=r(67294),s=r(69386);function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{searchKeys:[]},[r,n]=(0,a.useState)(""),{searchKeys:l,threshold:o=.2,ignoreLocation:i=!0}=t,d=(0,a.useMemo)(()=>new s.Z(e,{keys:l,threshold:o,ignoreLocation:i}),[e,l,o,i]),c=(0,a.useMemo)(()=>r?d.search(r).map(e=>e.item):e,[d,e,r]),u=(0,a.useMemo)(()=>0===c.length,[c]);return[r,n,c,u]}},15649:function(e,t,r){"use strict";r.d(t,{W:function(){return m}});var a=r(34849),s=r(22495),n=r(75669),l=r(57939),o=r(45966),i=r(67294),d=r(41248),c=r(97257),u=r(45837);let m=()=>{let e=(0,s.TL)(),{userProfile:t,idTokenRef:r}=(0,u.H)(),{setCurrentProject:m}=(0,c.d2)(),p=(0,s.CG)(l.ts);return{handleProjectSwitch:(0,i.useCallback)(async s=>{(0,d.dC)(async()=>{if(!p)return;await e((0,n.To)({savedItemId:p,userProfile:t,idToken:r.current,projectId:null==s?void 0:s.project_id})),m(s,!1),localStorage.setItem("currentProfile",(null==s?void 0:s.project_id)||""),await e((0,o.U3)({userProfile:t,idToken:r.current,projectId:null==s?void 0:s.project_id}));let l=Object.values(a.Z.getState().flowManager.flows).reduce((e,t)=>{var r,a;return(null===(a=t.plConfig)||void 0===a?void 0:null===(r=a.dependent_declarations)||void 0===r?void 0:r.length)?e.concat(t.plConfig.dependent_declarations):e},[]);l.length&&e((0,o.ER)(l))})},[e,r,t,m,p])}}}},function(e){e.O(0,[8368,7918,1036,821,2270,6252,8293,3818,1693,8335,1105,4924,2454,2888,9774,179],function(){return e(e.s=55324)}),_N_E=e.O()}]);