"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1461],{96888:function(e,t,r){r.d(t,{HM:function(){return c},Um:function(){return a},f1:function(){return g},gJ:function(){return u},mv:function(){return m},qv:function(){return i},si:function(){return f},t9:function(){return p},vm:function(){return h},zQ:function(){return l}});var n=r(44194),o=r(52338);let i=r(8260).g.injectEndpoints({endpoints:e=>({fetchAgentFolderContents:e.query({query:e=>{let{userProfile:t,idToken:r,folderId:n,projectId:o}=e,i=n?"folders/contents/".concat(n):"folders/contents/",l=new URLSearchParams;n||l.append("folder_type","GUMMIE"),o&&l.append("project_id",o);let d=l.toString();return{path:d?"".concat(i,"?").concat(d):i,userProfile:t,idToken:r}},transformResponse:e=>{var t,r;return{folders:(null===(t=e.folders)||void 0===t?void 0:t.map(e=>new n.g({folder_id:e.folder_id,name:e.name,parent_folder_id:e.parent_folder_id,author_id:e.author_id,created_ts:e.created_ts?new Date(e.created_ts):null})).sort((e,t)=>{let r=e.created_ts?new Date(e.created_ts).getTime():0;return(t.created_ts?new Date(t.created_ts).getTime():0)-r}))||[],gummies:(null===(r=e.gummies)||void 0===r?void 0:r.map(e=>new o.a(e)).sort((e,t)=>{let r=e.created_ts?new Date(e.created_ts).getTime():0;return(t.created_ts?new Date(t.created_ts).getTime():0)-r}))||[]}},providesTags:(e,t,r)=>[{type:"GummiesFolders",id:r.folderId||"root"}]}),fetchAgentFolderTree:e.query({query:e=>{let{userProfile:t,idToken:r,projectId:n,includeCounts:o}=e,i=new URLSearchParams;n&&i.append("project_id",n),o&&i.append("include_counts","true");let l=i.toString();return{path:l?"folders/tree/GUMMIE?".concat(l):"folders/tree/GUMMIE",userProfile:t,idToken:r}},transformResponse:e=>({folderTree:e.folder_tree}),providesTags:[{type:"GummiesFolders",id:"tree"}]}),moveGummieToFolder:e.mutation({query:e=>{let{userProfile:t,idToken:r,gummieId:n,folderId:o}=e;return{path:"gummies/".concat(n,"/move-to-folder"),userProfile:t,idToken:r,method:"PATCH",body:{folder_id:o}}},async onQueryStarted(e,t){let{gummieId:r,folderId:n,oldFolderId:o,gummieData:l,userProfile:d,idToken:a,projectId:s}=e,{dispatch:u,queryFulfilled:c}=t;if(!l)return;let m=u(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:d,idToken:a,folderId:null!=o?o:null,folderType:"GUMMIE",projectId:s},e=>{e.gummies=e.gummies.filter(e=>e.gummie_id!==r)})),f=u(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:d,idToken:a,folderId:null!=n?n:null,folderType:"GUMMIE",projectId:s},e=>{l.folder_id=n,e.gummies.push(l)}));try{await c}catch(e){m.undo(),f.undo()}}}),moveGummiesToFolder:e.mutation({query:e=>{let{userProfile:t,idToken:r,gummieIds:n,folderId:o}=e;return{path:"gummies/bulk-move-to-folder",userProfile:t,idToken:r,method:"PATCH",body:{gummie_ids:n,folder_id:o}}},async onQueryStarted(e,t){let{gummieIds:r,folderId:n,oldFolderIds:o,gummiesData:l,userProfile:d,idToken:a,projectId:s}=e,{dispatch:u,queryFulfilled:c}=t;if(!l||0===l.length)return;let m=[];for(let e of[...new Set(o||[])]){let t=u(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:d,idToken:a,folderId:null!=e?e:null,folderType:"GUMMIE",projectId:s},e=>{e.gummies=e.gummies.filter(e=>!r.includes(e.gummie_id))}));m.push(t)}let f=u(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:d,idToken:a,folderId:null!=n?n:null,folderType:"GUMMIE",projectId:s},e=>{for(let t of l)t.folder_id=n,e.gummies.push(t)}));m.push(f);try{await c}catch(e){m.forEach(e=>e.undo())}}}),createAgentFolder:e.mutation({query:e=>{let{userProfile:t,idToken:r,folderId:n,name:o,parentFolderId:i,authorId:l}=e;return{path:"folder",userProfile:t,idToken:r,method:"POST",body:{folder_id:n,name:o,parent_folder_id:i,author_id:l,folder_type:"GUMMIE"}}},async onQueryStarted(e,t){let{folderId:r,name:o,parentFolderId:l,authorId:d,userProfile:a,idToken:s,projectId:u}=e,{dispatch:c,queryFulfilled:m}=t,f=new Date().toISOString(),p=c(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:a,idToken:s,folderId:l,folderType:"GUMMIE",projectId:u},e=>{let t=new n.g({folder_id:r,name:o,parent_folder_id:l,author_id:d,created_ts:new Date(f)});e.folders.push(t)})),g=c(i.util.updateQueryData("fetchAgentFolderTree",{userProfile:a,idToken:s,projectId:u},e=>{let t={folder_id:r,name:o,parent_folder_id:l,author_id:d,children:[]},n=e=>e.folder_id===l?(e.children.push(t),!0):e.children.some(e=>n(e));null===l?e.folderTree.children.push(t):n(e.folderTree)}));try{await m}catch(e){p.undo(),g.undo()}}}),deleteAgentFolder:e.mutation({query:e=>{let{userProfile:t,idToken:r,folderId:n}=e;return{path:"folders/".concat(n),userProfile:t,idToken:r,method:"DELETE"}},async onQueryStarted(e,t){let{folderId:r,parentFolderId:l,userProfile:d,idToken:a,projectId:s}=e,{dispatch:u,queryFulfilled:c}=t,m=[],f=u(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:d,idToken:a,folderId:null!=l?l:null,folderType:"GUMMIE",projectId:s},e=>{e.folders=e.folders.filter(e=>e.folder_id!==r)})),p=u(i.util.updateQueryData("fetchAgentFolderTree",{userProfile:d,idToken:a,projectId:s},e=>{let t=e=>{let n=e.children.findIndex(e=>e.folder_id===r);return -1!==n?(m=e.children[n].children.map(e=>({...e,parent_folder_id:null!=l?l:null})),e.children.splice(n,1),e.children.push(...m),!0):e.children.some(e=>t(e))};t(e.folderTree)}));try{let{data:e}=await c;(e.moved_folders.length>0||e.moved_gummies.length>0)&&u(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:d,idToken:a,folderId:null!=l?l:null,folderType:"GUMMIE",projectId:s},t=>{for(let r of e.moved_folders)t.folders.find(e=>e.folder_id===r.folder_id)||t.folders.push(new n.g({folder_id:r.folder_id,name:r.name,parent_folder_id:r.parent_folder_id,author_id:r.author_id,created_ts:r.created_ts?new Date(r.created_ts):null}));for(let r of e.moved_gummies)t.gummies.find(e=>e.gummie_id===r.gummie_id)||t.gummies.push(new o.a(r))}))}catch(e){f.undo(),p.undo()}}}),renameAgentFolder:e.mutation({query:e=>{let{userProfile:t,idToken:r,folderId:n,name:o,projectId:i}=e;return{path:"folders/".concat(n,"/rename").concat(i?"?project_id=".concat(i):""),userProfile:t,idToken:r,method:"PATCH",body:{name:o}}},async onQueryStarted(e,t){let{folderId:r,name:n,userProfile:o,idToken:l,projectId:d,parentFolderId:a}=e,{dispatch:s,queryFulfilled:u}=t,c=[],m=s(i.util.updateQueryData("fetchAgentFolderTree",{userProfile:o,idToken:l,projectId:d},e=>{let t=e=>{var o;e.folder_id===r&&(e.name=n),null===(o=e.children)||void 0===o||o.forEach(t)};t(e.folderTree)}));if(c.push(m),void 0!==a){let e=s(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:o,idToken:l,folderId:a,folderType:"GUMMIE",projectId:d},e=>{let t=e.folders.find(e=>e.folder_id===r);t&&(t.name=n)}));c.push(e)}try{await u}catch(e){c.forEach(e=>e.undo())}}}),moveAgentFolderToParent:e.mutation({query:e=>{let{userProfile:t,idToken:r,folderId:n}=e;return{path:"folders/".concat(n,"/move-to-parent"),userProfile:t,idToken:r,method:"PATCH"}},async onQueryStarted(e,t){let{folderId:r,currentParentFolderId:o,userProfile:l,idToken:d,projectId:a,folderData:s}=e,{dispatch:u,queryFulfilled:c}=t;if(!s)return;let m=null;u(i.util.updateQueryData("fetchAgentFolderTree",{userProfile:l,idToken:d,projectId:a},e=>{let t=(e,r)=>{if(e.folder_id===o)return r;for(let r of e.children){let n=t(r,e.folder_id);if(void 0!==n)return n}},r=t(e.folderTree,null);void 0!==r&&(m=r)})).undo();let f=u(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:l,idToken:d,folderId:null!=o?o:null,folderType:"GUMMIE",projectId:a},e=>{e.folders=e.folders.filter(e=>e.folder_id!==r)})),p=u(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:l,idToken:d,folderId:m,folderType:"GUMMIE",projectId:a},e=>{let t=new n.g({folder_id:s.folder_id,name:s.name,parent_folder_id:m,author_id:s.author_id,created_ts:s.created_ts?new Date(s.created_ts):null});e.folders.push(t)})),g=u(i.util.updateQueryData("fetchAgentFolderTree",{userProfile:l,idToken:d,projectId:a},e=>{let t=null,n=e=>{let o=e.children.findIndex(e=>e.folder_id===r);return -1!==o?(t={...e.children[o],parent_folder_id:m},e.children.splice(o,1),!0):e.children.some(e=>n(e))};if(n(e.folderTree),t){let r=e=>e.folder_id===m?(e.children.push(t),!0):e.children.some(e=>r(e));null===m?e.folderTree.children.push(t):r(e.folderTree)}}));try{await c}catch(e){f.undo(),p.undo(),g.undo()}}}),moveAgentFolderToSibling:e.mutation({query:e=>{let{userProfile:t,idToken:r,folderId:n,targetFolderId:o}=e;return{path:"folders/".concat(n,"/move-into-sibling"),userProfile:t,idToken:r,method:"PATCH",body:{target_folder_id:o}}},async onQueryStarted(e,t){let{folderId:r,targetFolderId:o,currentParentFolderId:l,userProfile:d,idToken:a,projectId:s,folderData:u}=e,{dispatch:c,queryFulfilled:m}=t;if(!u)return;let f=c(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:d,idToken:a,folderId:null!=l?l:null,folderType:"GUMMIE",projectId:s},e=>{e.folders=e.folders.filter(e=>e.folder_id!==r)})),p=c(i.util.updateQueryData("fetchAgentFolderContents",{userProfile:d,idToken:a,folderId:o,folderType:"GUMMIE",projectId:s},e=>{let t=new n.g({folder_id:u.folder_id,name:u.name,parent_folder_id:o,author_id:u.author_id,created_ts:u.created_ts?new Date(u.created_ts):null});e.folders.push(t)})),g=c(i.util.updateQueryData("fetchAgentFolderTree",{userProfile:d,idToken:a,projectId:s},e=>{let t=null,n=e=>{let i=e.children.findIndex(e=>e.folder_id===r);return -1!==i?(t={...e.children[i],parent_folder_id:o},e.children.splice(i,1),!0):e.children.some(e=>n(e))};if(n(e.folderTree),t){let r=e=>e.folder_id===o?(e.children.push(t),!0):e.children.some(e=>r(e));r(e.folderTree)}}));try{await m}catch(e){f.undo(),p.undo(),g.undo()}}})})}),{useFetchAgentFolderContentsQuery:l,useLazyFetchAgentFolderContentsQuery:d,useFetchAgentFolderTreeQuery:a,useLazyFetchAgentFolderTreeQuery:s,useMoveGummieToFolderMutation:u,useMoveGummiesToFolderMutation:c,useCreateAgentFolderMutation:m,useDeleteAgentFolderMutation:f,useRenameAgentFolderMutation:p,useMoveAgentFolderToParentMutation:g,useMoveAgentFolderToSiblingMutation:h}=i},63455:function(e,t,r){r.d(t,{Z:function(){return E}});var n=r(85893),o=r(96888),i=r(10869),l=r(67294),d=r(34357),a=r(18289),s=r(76345),u=r(53695),c=r(98641),m=r(48578),f=r(45573),p=r(86762),g=r(30740),h=r(30202),_=r(27379),v=r(64712),x=r(9962),y=r(29876),j=r(30010),w=r(14142),T=r(97257),b=r(45837),I=r(31172),A=r(82141),k=r(22495),C=r(98029),N=r(7161),M=r(64127),D=r(54178),F=r(52338),P=e=>{let{open:t,onOpenChange:r,gummie:o,onSuccess:i}=e,[d,a]=(0,D.P)({open:t,onOpenChange:r}),[s,u]=(0,l.useState)(o.name),{userProfile:c,idTokenRef:m}=(0,b.H)(),f=(0,k.TL)(),p=e=>{u(e)},g=(0,C.D)({mutationFn:async()=>{if(""===s.trim()||c.is_gummie_modification_restricted)return;let e=new F.a({...o.toDict(),name:s});await e.save_to_spanner(c,m.current,!1),f((0,A.Is)({gummieId:e.gummie_id,updates:{name:s}}))},onSuccess:()=>{v.Am.success("Agent renamed successfully"),i()},onError:e=>{console.error("Failed to rename agent:",e),v.Am.error("Failed to rename agent. Please try again.")}}),h=async e=>{e.preventDefault(),await g.mutateAsync()};return(0,n.jsx)(N.Vq,{open:d,onOpenChange:a,children:(0,n.jsx)(N.cZ,{children:(0,n.jsxs)("form",{onSubmit:h,children:[(0,n.jsxs)(N.a7,{children:[(0,n.jsx)(N.fK,{children:(0,n.jsx)(N.$N,{children:"Rename your agent"})}),(0,n.jsx)(M.I,{name:"name",value:s,onChange:e=>p(e.target.value),placeholder:"Enter agent name",autoFocus:!0})]}),(0,n.jsx)(N.cN,{children:(0,n.jsx)(y.zx,{variant:"secondary",type:"submit",loading:g.isPending,disabled:""===s.trim(),children:"Save"})})]})})})},E=e=>{let{agent:t,onDelete:r,onShare:A,onMoveToWorkspace:k,isOutline:C=!0}=e,{userProfile:N,idTokenRef:M}=(0,b.H)(),{currentProject:D}=(0,T.d2)(),F=(0,h.NL)(),E=(0,_.useRouter)(),[S]=(0,i.ct)(),[Q]=(0,o.gJ)(),[Z,G]=l.useState(!1),U=t.author_id===N.user_id||D&&t.author_id===D.project_id,[q,z]=(0,l.useState)(!1),[L,O]=(0,l.useState)(!1),{data:K,isLoading:H}=(0,o.Um)({userProfile:N,idToken:M.current,projectId:null==D?void 0:D.project_id},{skip:N.isLoading()}),R=(0,l.useMemo)(()=>{if(!(null==K?void 0:K.folderTree))return null;let e=t=>{var r;return{folder_id:t.folder_id,name:t.name,children:(null===(r=t.children)||void 0===r?void 0:r.map(e))||[]}};return e(K.folderTree)},[K]),W=!!(R&&R.children.length>0),B=async e=>{e.stopPropagation(),G(!1),(0,w.v)("".concat(window.location.origin,"/agents/").concat(t.gummie_id),{successMessage:"Link to agent copied"})},V=async(e,r)=>{let n=Array.isArray(e)?e[0]:e;await Q({userProfile:N,idToken:M.current,gummieId:n.gummie_id,folderId:r,oldFolderId:n.folder_id,gummieData:n,projectId:null==D?void 0:D.project_id}).unwrap(),F.invalidateQueries({queryKey:["hub","recent",t.author_id]})},$=[{label:"Share",onClick:e=>{e.stopPropagation(),G(!1),A(!0)},Icon:d.Z,condition:U,destructive:!1},{label:"Copy Link",onClick:B,Icon:a.Z},{label:"Rename",onClick:e=>{e.stopPropagation(),G(!1),z(!0)},Icon:s.Z,condition:U&&!N.is_gummie_modification_restricted},{label:"Duplicate",onClick:async e=>{e.stopPropagation(),G(!1);let r=v.Am.loading("Duplicating gummie...");try{var n;let e=await S({userProfile:N,idToken:M.current,originalGummie:t,newAuthorId:null!==(n=null==D?void 0:D.project_id)&&void 0!==n?n:N.user_id});if(F.invalidateQueries({queryKey:["hub","recent",t.author_id]}),e.error||!e.data){v.Am.error("Failed to duplicate gummie",{id:r});return}v.Am.success("Gummie duplicated successfully",{id:r})}catch(e){console.error("Failed to clone gummie:",e),v.Am.error("Failed to duplicate gummie",{id:r})}},Icon:u.Z,condition:!N.is_gummie_modification_restricted,destructive:!1},{label:"Move to Workspace",onClick:e=>{e.stopPropagation(),G(!1),k(!0)},Icon:c.Z,condition:U&&!N.is_gummie_modification_restricted,destructive:!1},{label:"Move to Folder",onClick:e=>{e.stopPropagation(),G(!1),O(!0)},Icon:m.Z,condition:U&&!N.is_gummie_modification_restricted&&W,destructive:!1},{label:"Create Template",onClick:e=>{e.stopPropagation(),G(!1),E.push("/agents/".concat(t.gummie_id,"/publish"))},Icon:f.Z,condition:U&&!N.is_gummie_modification_restricted,destructive:!1},{label:"Delete",onClick:e=>{e.stopPropagation(),G(!1),r(!0)},Icon:p.Z,condition:U&&!N.is_gummie_modification_restricted,destructive:!0}],J=(0,I.xW)($);return 0===J.length?null:(0,n.jsxs)("div",{onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)(j.h_,{open:Z,onOpenChange:G,children:[(0,n.jsx)(j.$F,{asChild:!0,children:(0,n.jsx)(y.zx,{className:"data-[state=open]:bg-muted flex flex-row items-center justify-center",variant:C?"outline":"ghost",size:"icon-sm",children:(0,n.jsx)(g.Z,{})})}),(0,n.jsx)(j.AW,{align:"end",className:"p-1",children:J.map(e=>(0,n.jsx)(I.ZP,{label:e.label,onClick:e.onClick,Icon:e.Icon,destructive:e.destructive,description:e.description,noDescriptions:!0},e.label))})]}),(0,n.jsx)(P,{open:q,onOpenChange:z,gummie:t,onSuccess:()=>{z(!1),G(!1),F.invalidateQueries({queryKey:["hub","recent",t.author_id]})}},t.gummie_id),(0,n.jsx)(x.$,{rootName:"Agents",open:L,onOpenChange:O,entity:t,entityName:"agent",entityNamePlural:"agents",getEntityName:e=>e.name,getEntityFolderId:e=>{var t;return null!==(t=e.folder_id)&&void 0!==t?t:null},folderTree:R,isLoadingTree:H,onMove:V,onSuccess:()=>{O(!1),G(!1)}})]})}},1461:function(e,t,r){r.d(t,{w:function(){return M},Z:function(){return D}});var n=r(85893),o=r(96888),i=r(10869),l=r(22495),d=r(67294),a=r(30202),s=r(41664),u=r.n(s),c=r(64712),m=r(29876),f=r(38719),p=r(97257),g=r(45837),h=r(5197),_=r(50855),v=r(98150),x=r(69307),y=r(5357),j=r(79535),w=r(25675),T=r.n(w),b=r(42414),I=r(5295),A=e=>{let{tools:t,mcpDeclarationsMap:r,maxToolsToDisplay:o}=e,i=null==t?void 0:t.filter(e=>e.saved_item_id).length,l=(0,d.useMemo)(()=>{if(!t)return[];let e=t.filter(e=>e.server_id),r=t.find(e=>e.saved_item_id),n=r?[...e,r]:e;return o?n.slice(0,o):n},[t,o]);return 0===l.length?null:(0,n.jsx)("div",{className:"flex w-fit flex-row gap-2 overflow-clip",children:l.map((e,t)=>{var o,l;let d=r.get(e.server_id),a=e.server_id||e.saved_item_id||e.saved_item_version_id||"custom-agent-tools-preview-".concat(t);return(0,n.jsxs)(b.u,{children:[(0,n.jsx)(b.aJ,{asChild:!0,children:(0,n.jsxs)("span",{className:"bg-background relative grid size-10 shrink-0 place-items-center rounded-md border",children:[e.server_id?(0,n.jsx)(T(),{src:(0,I.F1)(null!==(o=null==d?void 0:d.category)&&void 0!==o?o:""),alt:null!==(l=e.name)&&void 0!==l?l:"",width:20,height:20}):(0,n.jsx)(j.Z,{className:"text-muted-foreground size-5"}),e.saved_item_id&&(0,n.jsx)("span",{className:"bg-muted-foreground/20 text-muted-foreground absolute right-0 bottom-0 grid size-[10px] place-items-center rounded-tl-[2px] text-[8px] font-medium",children:i})]})}),(0,n.jsx)(b._v,{children:e.name})]},a)})})},k=r(32578),C=r(63455),N=r(39608);let M=()=>(0,n.jsxs)("div",{className:"h-fit rounded-lg shadow-xs",children:[(0,n.jsx)("div",{className:"bg-background dot-pattern dot-pattern-dark relative z-10 -mb-10 ml-4 grid size-20 shrink-0 place-items-center rounded-full border",children:(0,n.jsx)("div",{className:"bg-muted size-9 animate-pulse rounded-full"})}),(0,n.jsxs)("div",{className:"bg-background z-0 flex flex-col gap-3 rounded-lg border p-4 pt-13",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,n.jsx)("div",{className:"bg-muted h-7 w-3/4 animate-pulse rounded"}),(0,n.jsx)("div",{className:"bg-muted/60 mt-1 h-4 w-4/5 animate-pulse rounded"}),(0,n.jsx)("div",{className:"bg-muted/60 mt-1 h-4 w-1/2 animate-pulse rounded"})]}),(0,n.jsxs)("div",{className:"flex flex-row items-end gap-2",children:[(0,n.jsx)("div",{className:"divide-border flex w-fit flex-wrap divide-x overflow-clip rounded-sm border",children:Array.from({length:3}).map((e,t)=>(0,n.jsx)("span",{className:"bg-muted/30 relative grid size-8.5 shrink-0 animate-pulse place-items-center",children:(0,n.jsx)("div",{className:"bg-muted size-5 rounded"})},t))}),(0,n.jsx)("div",{className:"bg-muted/30 ml-auto h-3 w-32 animate-pulse rounded"})]})]})]});var D=e=>{var t;let{agent:r,template:s,mcpDeclarationsMap:j}=e,w=(0,l.TL)(),{userProfile:T,idTokenRef:b}=(0,g.H)(),{currentProject:I}=(0,p.d2)(),M=(0,a.NL)(),[D,F]=(0,d.useState)(!1),[P,E]=(0,d.useState)(!1),[S,Q]=(0,d.useState)(!1),[Z,{isLoading:G}]=(0,i.Mk)(),U=async()=>{var e,t;let n=c.Am.loading("Deleting agent...");try{await Z({userProfile:T,idToken:b.current,gummie_id:r.gummie_id}).unwrap(),(0,_.rB)(f.Z.DELETED,{gummie_id:r.gummie_id});let t=null!==(e=r.folder_id)&&void 0!==e?e:null;try{w(o.qv.util.updateQueryData("fetchAgentFolderContents",{userProfile:T,idToken:b.current,folderId:t,folderType:"GUMMIE",projectId:null==I?void 0:I.project_id},e=>{e.gummies&&(e.gummies=e.gummies.filter(e=>e.gummie_id!==r.gummie_id))}))}catch(e){w(o.qv.util.invalidateTags([{type:"GummiesFolders",id:t||"root"}]))}M.invalidateQueries({queryKey:["hub","recent",r.author_id]}),c.Am.success("Agent deleted successfully",{id:n}),E(!1)}catch(r){let e=(null==r?void 0:null===(t=r.data)||void 0===t?void 0:t.error)||(null==r?void 0:r.message)||"Failed to delete agent";c.Am.error(e,{id:n})}},q=(0,d.useMemo)(()=>{var e,t;return(null===(e=r.description)||void 0===e?void 0:e.trim())||(null===(t=r.system_prompt)||void 0===t?void 0:t.trim())},[r.description,r.system_prompt]);return(0,n.jsxs)(d.Fragment,{children:[(0,n.jsxs)(u(),{href:"/agents/".concat(r.gummie_id),className:"hover:text-foreground group/agents-grid-item flex h-full flex-col rounded-lg",children:[(0,n.jsx)("div",{className:"bg-background dot-pattern dot-pattern-dark relative z-10 -mb-10 ml-4 grid size-20 shrink-0 place-items-center overflow-clip rounded-full border",children:(0,n.jsx)(y.Z,{iconUrl:r.metadata.icon_url,alt:r.name,size:"lg"})}),(0,n.jsxs)("div",{className:"bg-background relative z-0 flex flex-grow flex-col gap-3 rounded-lg border p-4 pt-13",children:[(0,n.jsxs)("div",{className:"absolute top-2 right-2 flex items-center gap-2",children:[s&&(0,n.jsx)(x.O,{status:s.status,isCreator:s.creator_user_id===T.user_id,isMarketplaceTemplate:!s.organization_id}),(0,n.jsx)(C.Z,{agent:r,onDelete:E,onShare:F,onMoveToWorkspace:Q,isOutline:!1})]}),(0,n.jsxs)("div",{className:"flex flex-grow flex-col gap-0.5",children:[(0,n.jsx)("span",{className:"truncate text-lg font-medium",children:r.name}),q&&(0,n.jsx)("span",{className:"text-muted-foreground line-clamp-2 text-sm",children:q})]}),(0,n.jsxs)("div",{className:"flex w-full flex-row items-end gap-2",children:[(0,n.jsx)(A,{tools:r.tools,mcpDeclarationsMap:j,maxToolsToDisplay:3},"".concat(r.gummie_id,"-tools-preview")),(0,n.jsxs)("div",{className:"text-muted-foreground ml-auto flex min-w-0 gap-1 text-xs select-none",children:[(0,n.jsx)("span",{className:"truncate",children:null!==(t=r.creator_first_name)&&void 0!==t?t:r.creator_user_email}),(0,n.jsx)("span",{className:"shrink-0",children:"â€¢"}),(0,n.jsx)("span",{className:"shrink-0",children:(0,h.Sy)(new Date(r.created_ts||""))})]})]})]})]},"".concat(r.gummie_id,"-link")),(0,n.jsx)(k.Z,{gummie:r,userProfile:T,idToken:b.current,open:D,onOpenChange:F},"".concat(r.gummie_id,"-share-dialog")),(0,n.jsx)(v.Z,{open:P,setOpen:E,title:"Delete Agent",description:'Are you sure you want to delete "'.concat(r.name,'"? This action cannot be undone.'),onConfirm:U,primaryActionButtonLoading:G,primaryActionButtonVariant:m.f1.DESTRUCTIVE,confirmButtonProps:{text:"Delete"}},"".concat(r.gummie_id,"-delete-dialog")),(0,n.jsx)(N.E,{open:S,onOpenChange:Q,gummie:r,onSuccess:()=>{M.invalidateQueries({queryKey:["hub","recent",r.author_id]})}},"".concat(r.gummie_id,"-move-to-workspace-dialog"))]})}},39608:function(e,t,r){r.d(t,{E:function(){return M}});var n=r(85893),o=r(67294),i=r(98641),l=r(36127),d=r(70563),a=r(8267),s=r(28979),u=r(30202),c=r(29876),m=r(7161),f=r(64127),p=r(92437),g=r(26659),h=r(96888),_=r(10869),v=r(93713),x=r(41248),y=r(64712),j=r(97257),w=r(45837),T=r(78618),b=r(54178),I=r(38719),A=r(18998),k=r(50855),C=r(98150),N=r(50016);function M(e){let{open:t,onOpenChange:r,gummie:M,onSuccess:D}=e,[F,P]=(0,o.useState)(!1),[E,S]=(0,b.P)({open:t,onOpenChange:r}),Q=(0,u.NL)(),[Z,G]=(0,o.useState)(void 0);(0,o.useEffect)(()=>{t&&M?G(M):t||G(void 0)},[t,M]);let U=Z||M,{availableWorkspaces:q,selectedProject:z,setSelectedProject:L,handleMove:O,isMoving:K,currentWorkspaceName:H}=function(e){let{gummie:t,onSuccess:r}=e,{userProfile:n,idTokenRef:i}=(0,w.H)(),{currentProject:l}=(0,j.d2)(),d=(0,x.I0)(),a=(0,x.v9)(v.ak),s=(0,x.v9)(v._I),[u,c]=(0,o.useState)(),[m,{isLoading:f}]=(0,_.VM)();return(0,o.useEffect)(()=>{n.isLoggedIn()&&"idle"===a&&d((0,v.bl)({userProfile:n,idToken:i.current}))},[n,a,d,i]),{availableWorkspaces:(0,o.useMemo)(()=>t&&"succeeded"===a?[new T.IK({project_name:"Personal",project_id:"personal"}),...s.filter(e=>e.project_id!==(null==l?void 0:l.project_id)).sort((e,t)=>(null==e?void 0:e.project_name.localeCompare((null==t?void 0:t.project_name)||""))||0)].filter(e=>"personal"===e.project_id?t.author_id!==n.user_id:t.author_id!==e.project_id):[],[t,s,a,l,n.user_id]),selectedProject:u,setSelectedProject:c,handleMove:async e=>{if(!t){y.Am.error("No agent selected");return}let o=(null==e?void 0:e.project_id)==="personal"?n.user_id:null==e?void 0:e.project_id;if(!o){y.Am.error("Invalid workspace selected");return}let l=(null==e?void 0:e.project_name)||"Personal",a=y.Am.loading("Moving agent to ".concat(l,"..."));try{var s;await m({userProfile:n,idToken:i.current,gummie_id:t.gummie_id,new_author_id:o}).unwrap();let e=null!==(s=t.folder_id)&&void 0!==s?s:null;d(h.qv.util.invalidateTags([{type:"GummiesFolders",id:e||"root"}])),y.Am.success('Agent moved to "'.concat(l,'" successfully!'),{id:a}),null==r||r()}catch(e){y.Am.error("Failed to move agent: ".concat(e.message||"Unknown error"),{id:a})}},isMoving:f,currentWorkspaceName:(null==l?void 0:l.project_name)||"Personal"}}({gummie:U,onSuccess:()=>{(0,k.rB)(I.Z.MOVED_TO_WORKSPACE,{gummie_id:null==U?void 0:U.gummie_id}),S(!1),null==D||D()}}),[R,W,B,V]=(0,g.X)(q,{searchKeys:["project_name"]}),$=async()=>{P(!1),await O(z),Q.invalidateQueries({queryKey:["hub","recent",null==U?void 0:U.author_id]})};if(!U)return null;let J='Move "'.concat(U.name,'" to Workspace'),X='Moving "'.concat(U.name,'" to "').concat(null==z?void 0:z.project_name,'" will change the owner. You will not be able to undo this action unless you have administrator permissions in "').concat(null==z?void 0:z.project_name,'".');return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.Vq,{open:E,onOpenChange:S,children:(0,n.jsxs)(m.cZ,{className:"max-h-3/4 max-w-2xl",children:[(0,n.jsxs)(m.a7,{children:[(0,n.jsx)(m.fK,{children:(0,n.jsxs)(m.$N,{className:"flex items-center gap-2",children:[(0,n.jsx)(i.Z,{}),J]})}),(0,n.jsxs)("p",{className:"text-muted-foreground text-xs",children:["Currently in: ",(0,n.jsx)("span",{className:"text-foreground font-medium",children:H})]}),(0,n.jsx)(f.I,{placeholder:"Search workspaces...",value:R,LeadingIcon:l.Z,type:"search",onChange:e=>W(e.target.value)}),0===B.length&&(0,n.jsx)(N.Z,{title:"No workspaces found",description:"No workspaces found".concat(R?" for '".concat(R,"'"):""),Icon:d.Z,className:"py-16"}),B.length>0&&(0,n.jsx)(p.E,{value:(null==z?void 0:z.project_id)||"none",onValueChange:e=>{L(q.find(t=>t.project_id===e))},className:"max-h-96 gap-0 divide-y overflow-y-auto rounded-lg border",children:B.map(e=>{let t=(null==z?void 0:z.project_id)===e.project_id,r="personal"===e.project_id;return(0,n.jsxs)("label",{htmlFor:"workspace-".concat(e.project_id),className:(0,A.cn)("flex cursor-pointer items-center gap-3 p-3 transition-colors",!t&&"hover:bg-muted/50"),children:[r?(0,n.jsx)(a.Z,{className:"size-4 flex-none"}):(0,n.jsx)(s.Z,{className:"size-4 flex-none"}),(0,n.jsx)("span",{className:"flex-1 text-sm font-medium",children:e.project_name}),(0,n.jsx)(p.m,{value:e.project_id,id:"workspace-".concat(e.project_id)})]},e.project_id)})})]}),(0,n.jsxs)(m.cN,{className:"flex items-center justify-between",children:[(0,n.jsx)(m.GG,{asChild:!0,children:(0,n.jsx)(c.zx,{type:"button",variant:"ghost",disabled:K,children:"Cancel"})}),(0,n.jsx)(c.zx,{onClick:()=>{z&&"personal"!==z.project_id?P(!0):$()},disabled:!z||K,children:K?"Moving...":"Move"})]})]})}),(0,n.jsx)(C.Z,{open:F,setOpen:P,title:"Change owner of this agent?",description:X,onConfirm:$,onCancel:()=>P(!1),primaryActionButtonVariant:c.f1.DEFAULT,confirmButtonProps:{text:"Move to Workspace"},cancelButtonProps:{text:"Cancel"}})]})}}}]);