"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7833],{19975:function(e,l,s){var t=s(85893),i=s(67294),r=s(62190),n=s(36127),o=s(64127),a=s(18998);let d=(0,i.forwardRef)((e,l)=>{let{onSearch:s,onChange:d,onEnter:c,placeholder:u="Search nodes",debounceTime:m=150,value:x,className:v,icon:p,iconClassName:h,...f}=e,[g,j]=(0,i.useState)(x||""),_=(0,i.useRef)(g);return _.current=g,(0,i.useEffect)(()=>{void 0!==x&&x!==g&&j(x)},[x]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{s(_.current)},m);return()=>{clearTimeout(e)}},[g,s]),(0,t.jsx)(o.I,{id:"node-search-input",ref:l,value:g,onChange:e=>{d&&d(),j(e.target.value)},onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),c&&c())},LeadingIcon:p||n.Z,TrailingIcon:r.Z,TrailingIconProps:{onClick:e=>{e.preventDefault(),j("")},className:g?"opacity-100":"opacity-0"},placeholder:u,className:(0,a.cn)(v),autoComplete:"off",...f})});d.displayName="SearchBar",l.Z=d},1365:function(e,l,s){var t=s(85893);s(67294),l.Z=e=>{let{count:l,contentLines:s=2,className:i}=e,r=()=>Array.from({length:s}).map((e,l)=>(0,t.jsx)("div",{className:"bg-muted mt-2 h-4 rounded",style:{width:"".concat((4-l)/5*100,"%")}},l));return(0,t.jsx)("div",{className:"h-full w-full space-y-4",children:Array.from({length:l}).map((e,l)=>(0,t.jsxs)("div",{className:"animate-pulse rounded p-4",children:[(0,t.jsx)("div",{className:"bg-muted h-6 w-1/2 rounded ".concat(i||"")})," ",r()]},l))})}},74238:function(e,l,s){s.d(l,{T2:function(){return r},ZP:function(){return W}});var t,i,r,n,o=s(85893),a=s(69245),d=s(45788),c=s(67294),u=s(23432),m=s(36127),x=s(80734),v=s(83989),p=s(82606),h=s(4307),f=s(25675),g=s.n(f),j=s(27379),_=s(64712),w=s(29876),N=s(7161),y=s(64127),C=s(20132),b=s(42414),k=s(99910),z=s(80755),A=s(33018),S=s(28687),I=s(86330),Z=s(49038),T=s(94453),L=s(821),P=s(71613),O=s(77118),D=s(22455),M=s(73835),E=s(45837),G=s(66763),R=s(94750),q=s(18998),B=s(5197);let F=(e,l,s,t,i,r,n,o)=>{if(e)return"This API only allows one account per project. You already have an account configured.";if(l)return"This API requires a ".concat(o.subscription_tier," subscription. Upgrade your plan to use this app.");if(!s){if(r)return"Only project admins can add credentials to this project.";if(i)return"Only organization admins can add organization-wide credentials."}return t&&!i?"This API can only be configured at the organization level.":r&&(null==n?void 0:n.is_workspace_credential_adding_restricted)?"Adding credentials is restricted for your user group.":null};var K=s(5295),U=s(50016),V=s(61537),J=s(3067),H=s(86680),Y=s(12585),$=s(8644),Q=s(97827);(t=r||(r={})).DEFAULT="default",t.SCOPES="scopes",t.OPERATORS="operators",t.TOOLS="tools",(i=n||(n={})).REGULAR="regular",i.PREMIUM="premium",i.GUMSTACK="gumstack";var W=e=>{var l,s,t,i,r,n,p,h,f,_;let{open:S,onOpenChange:I,existingAppScopes:H,existingToolAcls:W,groupId:el,catalogFunction:es="default",project:et,organization:ei,defaultSecretType:er}=e,[en,eo]=(0,c.useState)(""),[ea,ed]=(0,c.useState)(!1),[ec,eu]=(0,c.useState)(!1),[em,ex]=(0,c.useState)(!1),[ev,ep]=(0,c.useState)(!1),[eh,ef]=(0,c.useState)(void 0),[eg,ej]=(0,c.useState)(void 0),[e_,ew]=(0,c.useState)(void 0),[eN,ey]=(0,c.useState)(!1),[eC,eb]=(0,c.useState)("regular"),[ek,ez]=(0,c.useState)(!1),{userProfile:eA,idTokenRef:eS}=(0,E.H)(),eI=(0,P.y)("gumstack-v0"),{data:eZ}=(0,L.DV)({path:"operator_declarations",queryKey:["operator_declarations"],options:{enabled:!!S&&eA.isLoggedIn()&&!eA.isLoading()}}),{data:eT}=(0,a.Y)({userProfile:eA,idToken:eS.current},{skip:!S||!eA.isLoggedIn()||eA.isLoading()}),{data:eL}=(0,T.pN)({enabled:S&&"scopes"===es}),eP=(0,j.useSearchParams)();(0,c.useEffect)(()=>{let e=eP.get("provider");e&&"all"!==e&&(I(!0),eo(e))},[eP,I,eo]),(0,c.useEffect)(()=>{if(S&&er){let e=D.ZP.find(e=>e.secret_type===er);e&&(ef(e),eo(e.secret_name))}},[S,er]);let eO=(0,c.useMemo)(()=>"operators"!==es?[]:K.Qr.map(e=>({category:null==e?void 0:e.name,secret_name:null==e?void 0:e.name,image_path:null==e?void 0:e.icon,description:null==e?void 0:e.description})),[es]),{data:eD}=(0,d.jL)({userProfile:eA,idToken:eS.current,projectId:null==et?void 0:et.project_id,organizationId:null==ei?void 0:ei.organization_id},{skip:!eA.user_id}),eM=(0,c.useMemo)(()=>null==eD?void 0:eD.some(e=>e.secret_type===M.NH),[eD]),{data:eE,isLoading:eG}=(0,Z.Z)({options:{enabled:S&&eI&&eM&&("gumstack"===eC||"tools"===es)&&("default"===es||"tools"===es)}}),eR=(0,c.useMemo)(()=>D.ZP.find(e=>e.secret_type===M.NH),[]),{handleAuthentication:eq}=(0,O.C)({secretDeclaration:eR,projectId:null==et?void 0:et.project_id,organizationId:null==ei?void 0:ei.organization_id,onAddAccount:()=>{ez(!1)}}),eB=async()=>{ez(!0),await eq()},{data:eF}=(0,d.jL)({userProfile:eA,idToken:eS.current,organizationId:null===(l=eA.organization)||void 0===l?void 0:l.organization_id},{skip:!(null===(s=eA.organization)||void 0===s?void 0:s.organization_id)}),eK=(0,c.useMemo)(()=>new Set((null==eF?void 0:eF.map(e=>null==e?void 0:e.secret_type))||[]),[eF]),eU=(0,c.useMemo)(()=>{let e=D.ZP.filter(e=>!e.isDeprecated&&!e.hide_on_secrets_page);return ei&&(e=e.filter(e=>null==e?void 0:e.availability)),e=e.filter(e=>{var l;if(!(null==e?void 0:e.entityRestrictions)||(null==e?void 0:e.entityRestrictions.length)===0)return!0;let s={[G.g.ORGANIZATION]:null==eA?void 0:null===(l=eA.organization)||void 0===l?void 0:l.organization_id,[G.g.PROJECT]:null==et?void 0:et.project_id};return e.entityRestrictions.some(e=>s[e.entityType]===e.entityId)}),eI||(e=e.filter(e=>e.secret_type!==M.NH)),e},[ei,et,null==eA?void 0:null===(t=eA.organization)||void 0===t?void 0:t.organization_id,eI]),eV=eU.filter(e=>(!e.subscription_tier||"free"===e.subscription_tier)&&("default"===es||(null==e?void 0:e.category))),eJ=eU.filter(e=>(null==e?void 0:e.subscription_tier)&&(null==e?void 0:e.subscription_tier)!=="free"&&("default"===es||(null==e?void 0:e.category))),eH=(0,c.useMemo)(()=>Array.from([...eV,...eJ,...eO].reduce((e,l)=>{let s=l.secret_name.toLowerCase();return e.has(s)||e.set(s,l),e},new Map).values()).sort((e,l)=>e.secret_name.localeCompare(l.secret_name)),[eV,eJ,eO]),eY=(0,c.useMemo)(()=>{if("tools"!==es)return[];let e=eT||[];if(W&&W.length>0){let l=new Set(W.map(e=>e.server_id));e=e.filter(e=>!l.has(e.server_id))}return en?e.filter(e=>{var l,s;return(null===(l=e.category)||void 0===l?void 0:l.toLowerCase().includes(en.toLowerCase()))||(null===(s=e.server_id)||void 0===s?void 0:s.toLowerCase().includes(en.toLowerCase()))}):e},[es,eT,W,en]),e$=(0,c.useMemo)(()=>{var e;if("tools"!==es||!eI)return[];let l=(null!==(e=null==eE?void 0:eE.servers)&&void 0!==e?e:[]).filter(e=>"active"===e.status);if(W&&W.length>0){let e=new Set(W.map(e=>e.server_id));l=l.filter(l=>!e.has(l.server_id))}return en?l.filter(e=>{var l,s;return(null===(l=e.name)||void 0===l?void 0:l.toLowerCase().includes(en.toLowerCase()))||(null===(s=e.server_id)||void 0===s?void 0:s.toLowerCase().includes(en.toLowerCase()))}):l},[es,eI,null==eE?void 0:eE.servers,W,en]),eQ=(0,c.useMemo)(()=>{if("tools"===es)return[];let e=H?ee(eH,H):eH;return("scopes"===es&&(null==eL?void 0:eL.categories)&&(e=e.filter(e=>!!e.category&&eL.categories.includes(e.category))),en)?null==e?void 0:e.filter(e=>{var l;return null==e?void 0:null===(l=e.secret_name.toLowerCase())||void 0===l?void 0:l.includes(null==en?void 0:en.toLowerCase())}):"regular"===eC&&"operators"!==es?null==e?void 0:e.filter(e=>null==eV?void 0:eV.includes(e)):"premium"===eC&&"operators"!==es?null==e?void 0:e.filter(e=>null==eJ?void 0:eJ.includes(e)):e},[en,eC,H,eV,eJ,es,eH,eL]),eW=(0,c.useMemo)(()=>{var e;if("gumstack"!==eC||"default"!==es)return[];let l=(null==eE?void 0:null===(e=eE.servers)||void 0===e?void 0:e.filter(e=>{var l;return"active"===e.status&&(null===(l=e.config)||void 0===l?void 0:l.auth_method)!=="none"}))||[];return[...en?l.filter(e=>{var l,s;return(null===(l=e.name)||void 0===l?void 0:l.toLowerCase().includes(en.toLowerCase()))||(null===(s=e.server_id)||void 0===s?void 0:s.toLowerCase().includes(en.toLowerCase()))}):l].sort((e,l)=>{var s,t;let i=(null===(s=e.config)||void 0===s?void 0:s.auth_method)==="none";return i===((null===(t=l.config)||void 0===t?void 0:t.auth_method)==="none")?0:i?1:-1})},[eC,es,null==eE?void 0:eE.servers,en]);(0,c.useEffect)(()=>{"regular"===eC&&(null==eV?void 0:eV.length)===0&&(null==eJ?void 0:eJ.length)>0?eb("premium"):"premium"===eC&&(null==eJ?void 0:eJ.length)===0&&(null==eV?void 0:eV.length)>0&&eb("regular")},[eC,null==eV?void 0:eV.length,null==eJ?void 0:eJ.length]);let eX={default:{title:"Apps Available",description:"Select the app you would like to authenticate with."},scopes:{title:"Apps Available",description:"Select the app you want to configure. You can add more later."},operators:{title:"Node Categories",description:"Select the category you want to add to your deny list. You can add more later."},tools:{title:"MCP Servers",description:"Select the MCP server you want to configure tool restrictions for. You can add more later."}},e0=(0,c.useCallback)(e=>{!e&&en&&eo(""),I(e),eb("regular")},[I,eo,en]);return(0,o.jsxs)(N.Vq,{open:S,onOpenChange:e0,children:[(0,o.jsxs)(N.cZ,{className:"w-full lg:min-w-3xl",children:[(0,o.jsxs)(N.a7,{children:[(0,o.jsxs)(N.fK,{children:[(0,o.jsx)(N.$N,{children:null===(i=eX[es])||void 0===i?void 0:i.title}),(0,o.jsx)(N.Be,{children:null===(r=eX[es])||void 0===r?void 0:r.description})]}),(0,o.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,o.jsxs)("div",{className:"flex grow flex-col-reverse items-center gap-2.5 md:flex-row",children:["default"===es&&(0,o.jsxs)(C.t,{type:"single",value:eC,defaultValue:eC,onValueChange:e=>{e&&eb(e)},className:"w-full md:w-auto",children:[eV.length>0&&(0,o.jsx)(C.G,{value:"regular",className:"w-full md:w-auto",children:"Regular"}),eJ.length>0&&(0,o.jsx)(C.G,{value:"premium",className:"w-full md:w-auto",children:"Premium"}),eI&&(0,o.jsx)(C.G,{value:"gumstack",className:"w-full md:w-auto",children:"Gumstack"})]}),(0,o.jsx)(y.I,{placeholder:"Search for an app",value:en,onChange:e=>eo(e.target.value),type:"search",autoComplete:"off",name:"search-credentials",id:"search-credentials"})]}),(0,o.jsx)("div",{className:"flex max-h-[60svh] min-h-[60svh] w-full flex-col gap-3 overflow-y-auto",children:"gumstack"===eC&&"default"===es?eM?eG?(0,o.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,o.jsx)(u.Z,{className:"text-muted-foreground h-8 w-8 animate-spin"})}):eW.length>0?eW.map(e=>(0,o.jsx)(X,{server:e,onClose:()=>I(!1),project:et},e.server_id)):(0,o.jsx)(U.Z,{Icon:en?m.Z:x.Z,title:en?"No matching servers found":"No Gumstack servers found",description:en?"Try searching for a different server":"Deploy MCP servers on Gumstack to manage their credentials here."}):(0,o.jsx)(k.Nh,{onConnect:eB,isAuthenticating:ek}):"tools"===es?(null==eY?void 0:eY.length)>0||(null==e$?void 0:e$.length)>0?(0,o.jsxs)(o.Fragment,{children:[eY.map(e=>{var l;let s=null===(l=K.Qr.find(l=>l.name===e.category))||void 0===l?void 0:l.icon;return(0,o.jsxs)("div",{onClick:()=>{ej(e.server_id),ep(!0)},className:"border-muted bg-background flex cursor-pointer items-center gap-4 overflow-clip rounded-md border",children:[(0,o.jsx)("div",{className:"relative h-[88px] w-[104px] flex-none",children:s&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g(),{src:s,alt:e.server_id,className:"overflow-clip rounded-full object-contain blur-3xl",fill:!0}),(0,o.jsx)(g(),{src:s,alt:e.server_id,className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",width:40,height:40})]})}),(0,o.jsxs)("div",{className:"flex w-full flex-col gap-0 overflow-hidden",children:[(0,o.jsx)("span",{className:"font-medium",children:(0,B.LF)(e.category||e.server_id)}),(0,o.jsx)("span",{className:"text-muted-foreground line-clamp-2 text-sm",children:"Control what actions users are allowed to perform with this server."})]}),(0,o.jsx)("div",{className:"mr-4",children:(0,o.jsx)(v.Z,{size:16,className:"text-muted-foreground"})})]},e.server_id)}),e$.map(e=>(0,o.jsxs)("div",{onClick:()=>{ew(e.server_id),ey(!0)},className:"border-muted bg-background flex cursor-pointer items-center gap-4 overflow-clip rounded-md border",children:[(0,o.jsx)("div",{className:"grid h-[88px] w-[104px] flex-none place-items-center",children:(0,o.jsx)(k.dn,{name:e.name,size:"lg",className:"border-0"})}),(0,o.jsxs)("div",{className:"flex w-full flex-col gap-0 overflow-hidden",children:[(0,o.jsx)("span",{className:"font-medium",children:e.name}),(0,o.jsx)("span",{className:"text-muted-foreground line-clamp-2 text-sm",children:"Control what actions users are allowed to perform with this server."})]}),(0,o.jsx)("div",{className:"mr-4",children:(0,o.jsx)(v.Z,{size:16,className:"text-muted-foreground"})})]},e.server_id))]}):eG?(0,o.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,o.jsx)(u.Z,{className:"text-muted-foreground h-8 w-8 animate-spin"})}):(0,o.jsx)(U.Z,{Icon:m.Z,title:"No servers found",description:"Try searching for a different server"}):(null==eQ?void 0:eQ.length)>0?null==eQ?void 0:eQ.map(e=>{var l,s,t;let i;let r=z.L0;(null==e?void 0:e.isMultiAuth)?r=z.FN:(null==e?void 0:e.isInstructional)&&(null==e?void 0:e.isOAuth)?r=z.nl:(null==e?void 0:e.isOAuth)&&(null==e?void 0:e.has_custom_subdomain)?r=z.s2:(null==e?void 0:e.isMCPAuth)?r=z.p7:(null==e?void 0:e.isOAuth)&&(r=z.LX);let n=null!==(s=null==eD?void 0:eD.filter(l=>(null==l?void 0:l.secret_type)===(null==e?void 0:e.secret_type)))&&void 0!==s?s:[],a=!et||ei&&(0,R.pp)(ei,null==eA?void 0:eA.user_email)||!!(null==eA?void 0:eA.user_email)&&(null==et?void 0:null===(l=et.admins)||void 0===l?void 0:l.some(e=>(null==e?void 0:e.user_email)===(null==eA?void 0:eA.user_email))),d=!!(null==e?void 0:e.multipleAccountsDisallowed)&&(null==n?void 0:n.length)>0,c=!!(null==e?void 0:e.subscription_tier)&&!eA.validateUserSubscriptionTier(null==e?void 0:e.subscription_tier),u=eK.has(null==e?void 0:e.secret_type),m=d||c||(0,A.l)(e,a,u,ei)||!!(et&&(null==eA?void 0:eA.is_workspace_credential_adding_restricted));if("operators"===es){i=null==eZ?void 0:null===(t=eZ.pipeline_components)||void 0===t?void 0:t.filter(l=>null!=e&&!!e.category&&l.category===(null==e?void 0:e.category));let l=(null==eT?void 0:eT.filter(l=>l.category===(null==e?void 0:e.category)))||[];if(i&&(null==i?void 0:i.length)<1&&l.length<1)return null}let x=F(d,c,a,u,ei,et||null,eA,e),p=(0,o.jsxs)("div",{onClick:()=>{ef(e),"scopes"===es?ed(!0):"operators"===es&&ex(!0)},className:(0,q.cn)("flex items-center gap-4 overflow-clip","default"!==es&&!m&&"cursor-pointer",m&&"cursor-not-allowed"),children:[(0,o.jsx)("div",{className:"grid size-12 shrink-0 place-items-center rounded-md border",children:(0,o.jsx)(g(),{src:null==e?void 0:e.image_path,alt:null==e?void 0:e.secret_name,width:24,height:24})}),(0,o.jsxs)("div",{className:"flex w-full flex-col gap-0.5 overflow-hidden",children:[(0,o.jsx)("span",{className:"text-sm font-medium",children:null==e?void 0:e.secret_name}),(0,o.jsx)("span",{className:"text-muted-foreground line-clamp-2 text-xs opacity-80",children:null==e?void 0:e.description})]}),(0,o.jsx)("div",{className:"",children:"default"===es?(0,o.jsx)(r,{secretDeclaration:e,project:et,organization:ei,disabled:m,onAddAccount:()=>{I(!1)},size:"sm"}):(0,o.jsx)(v.Z,{size:16,className:"text-muted-foreground"})})]});return x?(0,o.jsxs)(b.u,{children:[(0,o.jsx)(b.aJ,{asChild:!0,children:p}),(0,o.jsx)(b._v,{children:x})]},e.secret_name):(0,o.jsx)("div",{children:p},e.secret_name)}):(0,o.jsx)(U.Z,{Icon:m.Z,title:"No apps found",description:"Try searching for a different app"})})]})]}),(0,o.jsx)(N.cN,{children:(0,o.jsx)(N.GG,{asChild:!0,children:(0,o.jsx)(w.zx,{variant:"outline",children:"Back"})})})]}),el&&(0,o.jsx)(Y.Z,{open:em,setOpen:ex,selectedSecretDeclaration:eh,onParentClose:()=>{ef(void 0),ex(!1)},groupId:el,operatorDeclarations:null!==(f=null==eZ?void 0:eZ.pipeline_components)&&void 0!==f?f:[]}),(0,o.jsx)(Q.Z,{open:ec,setOpen:eu,selectedSecretDeclaration:eh,onParentClose:()=>{ef(void 0),eu(!1)},groupId:el}),(0,o.jsx)($.Z,{open:ea,setOpen:ed,selectedSecretDeclaration:eh,groupId:el,onParentClose:()=>{ef(void 0),ed(!1)},categoryName:null==eh?void 0:eh.category,operatorDeclarations:null!==(_=null==eZ?void 0:eZ.pipeline_components)&&void 0!==_?_:[]}),el&&eg&&(0,o.jsx)(J.Z,{open:ev,setOpen:e=>{ep(e),e||setTimeout(()=>{ej(void 0)},250)},groupId:el,serverId:eg,serverName:(null==eT?void 0:null===(n=eT.find(e=>e.server_id===eg))||void 0===n?void 0:n.category)||eg}),el&&e_&&(0,o.jsx)(V.Z,{open:eN,setOpen:e=>{ey(e),e||setTimeout(()=>{ew(void 0)},250)},groupId:el,serverId:e_,serverName:(null==eE?void 0:null===(h=eE.servers)||void 0===h?void 0:null===(p=h.find(e=>e.server_id===e_))||void 0===p?void 0:p.name)||e_})]})};let X=e=>{var l,s,t,i,r,n,a;let{server:d,onClose:m,project:x}=e,[v,f]=(0,c.useState)(!1),[g,j]=(0,c.useState)(null),N=(null===(l=d.config)||void 0===l?void 0:l.auth_method)==="none",{data:y,isLoading:C}=(0,I.Z)({serverId:d.server_id,projectId:null==x?void 0:x.project_id,enabled:!N}),b=null!==(i=null==y?void 0:null===(s=y.providers)||void 0===s?void 0:s.length)&&void 0!==i?i:0,{data:z,isLoading:A}=(0,S.wD)({serverId:d.server_id,projectId:null==x?void 0:x.project_id,enabled:!N&&(1===b||v)}),{mutate:Z,isPending:T}=(0,S.Hu)(),L=null!==(r=null==y?void 0:y.providers)&&void 0!==r?r:[],P=null!==(n=null==z?void 0:z.credentials)&&void 0!==n?n:[],O=P.length>0,D=N||0===L.length,M=1===L.length,E=L.length>=2,G=(e,l)=>{if(null==l||l.stopPropagation(),e.is_oauth){let l=window.location.pathname;Z({serverId:d.server_id,provider:e.name,redirectPath:l,projectId:null==x?void 0:x.project_id},{onSuccess:l=>{window.open(l.url,"_blank","noopener,noreferrer"),_.Am.info("Please complete ".concat(e.name," authentication in the new tab"))},onError:e=>_.Am.error("Failed to start OAuth flow: ".concat(e.message))})}else j(e)},R=null!==(a=null===(t=d.config)||void 0===t?void 0:t.description)&&void 0!==a?a:O?"".concat(P.length," credential(s)"):"Not connected";return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{onClick:()=>{E&&f(!v)},className:(0,q.cn)("flex items-center gap-4 overflow-clip",E&&"cursor-pointer",v&&"border-muted border-b"),children:[(0,o.jsx)("div",{className:"grid size-12 shrink-0 place-items-center rounded-md border",children:(0,o.jsx)(k.dn,{name:d.name,size:"lg",className:"border-0"})}),(0,o.jsxs)("div",{className:"flex w-full flex-col gap-0.5 overflow-hidden",children:[(0,o.jsx)("span",{className:"text-sm font-medium",children:d.name}),(0,o.jsx)("span",{className:"text-muted-foreground line-clamp-2 text-xs opacity-80",children:R})]}),(0,o.jsx)("div",{className:"shrink-0",children:(()=>{if(N)return(0,o.jsx)("span",{className:"text-muted-foreground text-xs",children:"No Action Needed"});if(C&&0===b)return(0,o.jsx)(p.Z,{className:"text-muted-foreground size-4 animate-spin"});if(D)return(0,o.jsx)("span",{className:"text-muted-foreground text-xs",children:"No Action Needed"});if(M){let l=L[0],s=P.filter(e=>e.provider===l.name);if(s.length>0){var e;let t=l.name.charAt(0).toUpperCase()+l.name.slice(1);return(0,o.jsxs)("span",{className:"text-muted-foreground text-xs",children:["Connected as ",(null===(e=s[0])||void 0===e?void 0:e.nickname)||t]})}return(0,o.jsxs)(w.zx,{size:"sm",variant:"outline",onClick:e=>G(l,e),disabled:T,children:[T?(0,o.jsx)(p.Z,{className:"size-4 animate-spin"}):null,"Connect"]})}return E?(0,o.jsx)(h.Z,{size:20,className:(0,q.cn)("text-muted-foreground transition-transform",v&&"rotate-90")}):null})()})]}),v&&E&&(0,o.jsx)("div",{className:"border-muted border-t px-4",children:C||A?(0,o.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,o.jsx)(u.Z,{className:"text-muted-foreground h-5 w-5 animate-spin"})}):(0,o.jsx)("div",{className:"divide-muted divide-y",children:L.map(e=>{var l;let s=P.filter(l=>l.provider===e.name),t=s.length>0,i=e.name.charAt(0).toUpperCase()+e.name.slice(1);return(0,o.jsxs)("div",{className:"flex items-center justify-between py-2",onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,o.jsx)("span",{className:"text-sm font-medium",children:i}),(0,o.jsxs)("span",{className:"text-muted-foreground text-xs",children:[e.is_oauth?"OAuth":"API Key",t&&" \xb7 Connected as ".concat((null===(l=s[0])||void 0===l?void 0:l.nickname)||i)]})]}),!t&&(0,o.jsx)(w.zx,{size:"sm",variant:"outline",onClick:l=>G(e,l),disabled:T,children:"Connect"})]},e.name)})})}),g&&(0,o.jsx)(H.k,{open:!!g,onOpenChange:e=>!e&&j(null),server:d,provider:g,projectId:null==x?void 0:x.project_id})]})},ee=(e,l)=>null==e?void 0:e.filter(e=>!(null==l?void 0:l.some(l=>(null==l?void 0:l.category_name)===(null==e?void 0:e.category))))},33018:function(e,l,s){s.d(l,{Z:function(){return es},l:function(){return H}});var t=s(85893),i=s(45788),r=s(67294),n=s(4270),o=s(31051),a=s(70088),d=s(92385),c=s(93461),u=s(53645),m=s(9008),x=s.n(m),v=s(25675),p=s.n(v),h=s(64712),f=s(64127),g=s(50016),j=s(2689),_=s(29876),w=s(7161),N=s(42414),y=s(94453),C=s(71613),b=s(77118),k=s(22455),z=s(45837),A=s(66763),S=s(5197),I=s(94750),Z=s(19975),T=s(1365),L=s(80755),P=s(74238),O=s(86680),D=s(4307),M=s(78865),E=s(8267),G=s(62190),R=s(71424),q=s(61857),B=s(54178),F=s(18998),K=s(27801),U=s(66682),V=s(3029),J=e=>{var l,s;let{open:i,onOpenChange:n,secretType:o,secretDeclaration:a,categoryName:d,groupId:c,passedScopes:u}=e,[m,x]=(0,B.P)({open:i,onOpenChange:n}),{scopes:v,categoryName:p,operatorDeclarationsAssociatedWithSecret:h,mcpToolsAssociatedWithScopes:f,totalOperatorDeclarationsCount:g,isLoadingPermittedScopesOperators:j,isLoadingMCPTools:C,isPendingMCPTools:b,isLoadingOperatorDeclarations:k,isPendingOperatorDeclarations:z}=(0,y.HN)({categoryName:d,secretDeclaration:a,groupId:c,passedScopes:u,enabled:!!m}),A=null!==(l=o.scopes)&&void 0!==l?l:[],S=null!==(s=null==v?void 0:v.length)&&void 0!==s?s:0,I=(0,r.useMemo)(()=>((null==h?void 0:h.filter(e=>Object.values(e.secrets).some(e=>Array.isArray(e)?e.every(e=>A.includes(e)):A.includes(e))).length)||0)+((null==f?void 0:f.filter(e=>!e.required_scopes||0===e.required_scopes.length||e.required_scopes.every(e=>A.includes(e))).length)||0),[h,f,A]),Z=(0,r.useMemo)(()=>g>0?I/g*100:100,[I,g]),T=j||C||k||b||z;return p&&v&&o.scopes?(0,t.jsxs)(w.Vq,{open:m,onOpenChange:x,children:[(0,t.jsx)(w.hg,{asChild:!0,children:(0,t.jsx)(_.zx,{variant:"unstyled",size:"unset",children:(0,t.jsxs)(R.C,{variant:"muted",size:"sm",className:"gap-1",children:[A.length,"/",S," scopes granted",(0,t.jsx)(D.Z,{})]})})}),(0,t.jsxs)(w.cZ,{className:(0,F.cn)("flex flex-col",g>0?"min-w-[88svw]":"md:min-w-3xl"),children:[(0,t.jsxs)(w.a7,{className:"flex flex-grow gap-0! p-0!",children:[(0,t.jsx)(w.fK,{className:"border-b p-5",children:(0,t.jsxs)(w.$N,{className:"flex items-center gap-2",children:[(0,t.jsx)("img",{src:null==a?void 0:a.image_path,alt:null==a?void 0:a.secret_name,className:"h-10 w-10 rounded-lg border p-2"}),'Granted Scopes for "',o.nickname,'"']})}),(0,t.jsxs)("div",{className:"flex w-full flex-grow overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex flex-grow flex-col gap-4 border-r px-4 pt-8 md:px-12 xl:max-w-3xl xl:min-w-3xl",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-5",children:[(0,t.jsx)(U.Z,{title:"Granted Permission Scopes"}),A.length>0&&(0,t.jsx)("div",{className:"text-muted-foreground flex items-center gap-1.5 text-base",children:(0,t.jsxs)(R.C,{variant:"accent",className:"flex items-center gap-1",children:[(0,t.jsx)(M.Z,{size:16}),(0,t.jsxs)("span",{children:[A.length,"/",S," scopes granted"]})]})})]}),(0,t.jsx)("div",{className:"flex max-h-96 w-full flex-col overflow-y-auto sm:max-h-[60dvh] md:min-h-[60dvh]",children:j&&!u?(0,t.jsx)("div",{className:"flex flex-col",children:Array.from({length:5}).map((e,l)=>(0,t.jsxs)("div",{className:"flex items-center gap-4 px-2 py-3",children:[(0,t.jsx)(q.O,{className:"h-4 flex-none rounded-full md:max-w-1/3 md:min-w-1/3"}),(0,t.jsx)(q.O,{className:"h-4 w-full"}),(0,t.jsx)(q.O,{className:"flex size-4 flex-none rounded-md"})]},l))}):null==v?void 0:v.map(e=>{let{flag:l,displayName:s}=(0,K.Gx)(e.name);return(0,t.jsxs)("div",{className:"flex w-full items-center gap-6 border-b px-2 py-3",children:[(0,t.jsxs)("div",{className:"flex flex-grow flex-col gap-1 md:flex-row",children:[(0,t.jsxs)("div",{className:"text-accent-foreground flex items-center gap-1.5 text-sm font-medium break-words! md:max-w-1/3 md:min-w-1/3",children:[l&&"user scope"===l&&(0,t.jsxs)(N.u,{children:[(0,t.jsx)(N.aJ,{asChild:!0,children:(0,t.jsx)(E.Z,{size:16})}),(0,t.jsx)(N._v,{children:"User Scope"})]}),(0,t.jsx)("p",{className:"break-all",children:s})]}),(null==e?void 0:e.description)&&(0,t.jsx)("span",{className:"text-muted-foreground text-sm",children:e.description})]}),(0,t.jsx)("span",{children:A.includes(e.name)?(0,t.jsx)(M.Z,{className:"text-success-foreground",size:20}):(0,t.jsx)(G.Z,{className:"text-destructive-foreground",size:20})})]},e.name)})})]}),(g>0||(null==f?void 0:f.length)>0||T)&&(0,t.jsx)(V.Z,{title:"Available Nodes",description:"Nodes that can be used with the selected scopes.",totalOperatorDeclarationsCount:g,selectedOperatorDeclarationsRatio:Z,selectedOperatorDeclarationsCount:I,operatorDeclarationsAssociatedWithSecret:h,mcpToolsAssociatedWithScopes:f,scopesSelected:A,categoryName:p,isLoadingMCPTools:C||b,isLoadingOperatorDeclarations:j||z})]})]}),(0,t.jsx)(w.cN,{children:(0,t.jsx)(w.GG,{asChild:!0,children:(0,t.jsx)(_.zx,{variant:"outline",children:"Close"})})})]})]}):null};let H=(e,l,s,t)=>e.availability!==A.v.ALL&&(!l||e.availability===A.v.ORGANIZATION_MANAGED&&s&&!t),Y=e=>{var l,s;let{project:a,organization:d,secretTypes:c}=e,[u,m]=(0,r.useState)(!1),{userProfile:x,idTokenRef:v}=(0,r.useContext)(z.f),[p,h]=(0,r.useState)(""),{data:f}=(0,i.jL)({userProfile:x,idToken:v.current,organizationId:null===(l=x.organization)||void 0===l?void 0:l.organization_id},{skip:!(null===(s=x.organization)||void 0===s?void 0:s.organization_id)}),j=(0,r.useMemo)(()=>d?k.ZP.filter(e=>e.availability&&!e.hide_on_secrets_page):k.ZP.filter(e=>!e.hide_on_secrets_page&&(!e.isDeprecated||(null==c?void 0:c.some(l=>l.secret_type===e.secret_type)))),[d,c]),w=(0,r.useMemo)(()=>p?j.filter(e=>e.secret_name.toLowerCase().includes(p.toLowerCase())):j,[j,p]),N=c?w.filter(e=>c.some(l=>l.secret_type===e.secret_type)):[],y=(0,r.useMemo)(()=>new Set((null==f?void 0:f.map(e=>e.secret_type))||[]),[f]),b=(0,C.y)("gumstack-v0");if(!x.isLoading()&&!x.isLoggedIn())return(0,t.jsx)("h6",{className:"text-medium",children:"Please sign-in to link your credentials"});let A=b&&!d&&!!x.organization;return(0,t.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,t.jsxs)("div",{className:"z-10 flex w-full flex-wrap items-center justify-between gap-4",children:[(0,t.jsx)(Z.Z,{className:"xs:w-72 w-full",onSearch:h,placeholder:"Search your linked credentials"}),(0,t.jsxs)(_.zx,{onClick:()=>m(!0),className:"xs:w-auto w-full",children:[(0,t.jsx)(n.Z,{}),"Add Credential"]})]}),0===N.length&&c?(0,t.jsx)("div",{className:"flex flex-col items-center px-4 py-10",children:(0,t.jsx)(g.Z,{title:c.length&&p?"No credentials found matching '".concat(p,"'"):"No credentials added yet. Add your first credential!",Icon:o.Z,children:(0,t.jsx)(_.zx,{variant:"default",onClick:()=>m(!0),children:"Add Credential"})})}):(0,t.jsx)($,{secretTypes:c,secretDeclarations:N,project:a,organization:d,orgSecretTypeSet:y}),A&&(0,t.jsx)(O.Z,{searchTerm:p,showSectionDivider:N.length>0,project:a}),(0,t.jsx)(P.ZP,{open:u,onOpenChange:m,project:a,organization:d})]})},$=e=>{let{secretTypes:l,secretDeclarations:s,project:i,organization:r,compact:n,onAddAccount:o,orgSecretTypeSet:a}=e,{data:d}=(0,y.i7)();return l?(0,t.jsx)("div",{className:"flex flex-grow flex-col gap-8",children:s.map(e=>(0,t.jsx)(Q,{secretDeclaration:e,filteredSecretTypes:null==l?void 0:l.filter(l=>l.secret_type===e.secret_type),project:i,organization:r,compact:n,onAddAccount:o,orgSecretTypeSet:a,categoriesSummaryData:d},e.secret_type))}):(0,t.jsx)("div",{className:"flex flex-grow flex-col gap-8",children:(0,t.jsx)(T.Z,{count:5})})},Q=e=>{let{secretDeclaration:l,filteredSecretTypes:s,project:i,organization:n,compact:o,onAddAccount:d,orgSecretTypeSet:c,categoriesSummaryData:u}=e,{userProfile:m}=(0,r.useContext)(z.f),x=L.L0;l.isMultiAuth?x=L.FN:l.isInstructional&&l.isOAuth?x=L.nl:l.isOAuth&&l.has_custom_subdomain?x=L.s2:l.isMCPAuth?x=L.p7:l.isOAuth&&(x=L.LX);let v=!i||n&&(0,I.pp)(n,m.user_email)||!!m.user_email&&i.admins.some(e=>e.user_email===m.user_email),h=!!l.multipleAccountsDisallowed&&s.length>0,f=!!l.subscription_tier&&!m.validateUserSubscriptionTier(l.subscription_tier),g=c.has(l.secret_type),j=h||f||H(l,v,g,n)||!!(i&&m.is_workspace_credential_adding_restricted),_=(0,r.useMemo)(()=>ee({action:"add",isAdmin:v,subscriptionTierInvalid:f,secretDeclaration:l,isOrgSecret:g,organization:n,atAccountLimit:h}),[v,f,h,g,n,l]);return(0,t.jsx)("div",{className:"flex items-start gap-4",children:(0,t.jsxs)("div",{className:"flex flex-grow flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col justify-between gap-4 lg:flex-row lg:items-center",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(p(),{src:l.image_path,alt:l.secret_type,className:"h-12 w-12 rounded-lg border object-contain p-2.5",width:48,height:48}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("h3",{className:"text-card-foreground flex items-center gap-2 text-lg font-semibold",children:[l.secret_name," ",l.subscription_tier&&(0,t.jsxs)(N.u,{children:[(0,t.jsx)(N.aJ,{asChild:!0,children:(0,t.jsx)(a.Z,{className:"h-5 w-5"})}),(0,t.jsx)(N._v,{children:"".concat(l.subscription_tier.charAt(0).toUpperCase()+l.subscription_tier.slice(1)," tier and above")})]})]}),(0,t.jsx)("p",{className:"text-muted-foreground font-regular text-xs lg:text-sm",children:l.description})]})]}),(0,t.jsxs)(N.u,{children:[(0,t.jsx)(N.aJ,{asChild:!0,children:(0,t.jsx)("div",{className:"shrink-0",children:(0,t.jsx)(x,{secretDeclaration:l,project:i,organization:n,disabled:j,onAddAccount:d})})}),_&&(0,t.jsx)(N._v,{children:_})]})]}),s.length>0&&!o&&(0,t.jsx)("div",{className:"border-border flex flex-col divide-y rounded-xl border",children:s.map(e=>{var s;return(0,t.jsx)(W,{secretDeclaration:l,secretType:e,project:i,organization:n,isAdmin:v,subscriptionTierInvalid:f,isOrgSecret:g,passedScopes:l.category?null==u?void 0:null===(s=u.categories)||void 0===s?void 0:s[l.category]:void 0},e.secret_id)})})]})})},W=e=>{let{secretDeclaration:l,secretType:s,project:n,organization:o,isAdmin:a,subscriptionTierInvalid:c,isOrgSecret:u,passedScopes:m}=e,{userProfile:x,idTokenRef:v}=(0,r.useContext)(z.f),[p,{isLoading:g}]=(0,i.ww)(),[j,{isLoading:w}]=(0,i.OG)(),[y,C]=(0,r.useState)(s.nickname),{handleAuthentication:k}=(0,b.C)({secretDeclaration:l,projectId:null==n?void 0:n.project_id,organizationId:null==o?void 0:o.organization_id,passedScopes:m}),A=async e=>{if(!e){h.Am.error("Nickname cannot be empty"),C(s.nickname);return}if(e===s.nickname)return;let l=await j({secretId:s.secret_id,nickname:e,userProfile:x,idToken:v.current,projectId:null==n?void 0:n.project_id,organizationId:null==o?void 0:o.organization_id});"error"in l&&(h.Am.error("Could not update secret: ".concat(l.error.data)),C(s.nickname))},I=c||H(l,a,u,o),Z=(0,r.useMemo)(()=>ee({action:"modify",isAdmin:a,subscriptionTierInvalid:c,secretDeclaration:l,isOrgSecret:u,organization:o}),[a,c,u,o,l]);return(0,t.jsxs)("div",{className:"flex flex-col gap-4 p-3 lg:flex-row lg:items-center lg:p-4 ".concat(g||w?"opacity-50":""),children:[(0,t.jsx)("div",{className:"flex flex-grow items-center gap-3",children:(0,t.jsxs)("div",{className:"flex w-full flex-col gap-0.5",children:[(0,t.jsx)(f.I,{size:"sm",type:"text",value:y,disabled:I,onChange:e=>C(e.target.value),onKeyDown:e=>{("Enter"===e.key||"Escape"===e.key)&&e.target.blur()},onBlur:()=>{A(y)},className:"!h-7 !min-w-fit !py-0.5 !pr-0.5 not-focus-within:border-none not-focus-within:pl-1 focus-within:pl-2"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"text-muted-foreground pl-1 text-xs",title:new Date(s.created_ts).toLocaleString(),children:[l.isOAuth?"Last refreshed":"Created"," ",(0,S.Sy)(new Date(s.created_ts),!0)]}),(0,t.jsx)(J,{secretDeclaration:l,categoryName:l.category,secretType:s,passedScopes:m})]})]})}),(0,t.jsxs)(N.u,{children:[(0,t.jsx)(N.aJ,{asChild:!0,children:(0,t.jsxs)("div",{className:"flex w-full flex-col items-center gap-2 sm:w-auto sm:flex-row",children:[(0,t.jsx)(X,{secretType:s,secretDeclaration:l,project:n,organization:o,deleteSecret:p,disabled:g||w||H(l,a,u,o)}),l.isOAuth&&!l.isInstructional&&!l.has_custom_subdomain&&(0,t.jsxs)(_.zx,{variant:"outline",className:"w-full rounded-md sm:w-auto",disabled:c||g||w||H(l,a,u,o),onClick:()=>k(void 0,s.secret_id),children:[(0,t.jsx)(d.Z,{className:"mr-0.5 h-4 w-4"}),"Reauthenticate"]}),!l.isOAuth&&!l.isInstructional&&(0,t.jsx)(L.is,{secretDeclaration:l,secretId:s.secret_id,project:n,organization:o,className:"w-full sm:w-auto",disabled:c||g||w||H(l,a,u,o)}),!l.isMCPAuth&&(0,t.jsx)(el,{secretType:s,secretDeclaration:l,project:n,organization:o,updateSecret:j,disabled:c||g||w||H(l,a,u,o)})]})}),Z&&(0,t.jsx)(N._v,{children:Z})]})]})},X=e=>{let{secretType:l,secretDeclaration:s,project:i,organization:n,deleteSecret:o,disabled:a}=e,{userProfile:d,idTokenRef:u}=(0,r.useContext)(z.f),[m,x]=(0,r.useState)(!1),v=async()=>{let e=await o({secretId:l.secret_id,userProfile:d,idToken:u.current,projectId:null==i?void 0:i.project_id,organizationId:null==n?void 0:n.organization_id});if("error"in e)h.Am.error("Could not delete secret: ".concat(e.error.data));else{if(n&&s.canAddAIProxy)try{let e="".concat(s.secret_type,"_proxy_url"),l="".concat(s.secret_type,"_model_proxy_map");await Promise.all([(0,I.ij)(n,d,u.current,e),(0,I.ij)(n,d,u.current,l)])}catch(e){console.error("Error cleaning up proxy metadata:",e)}h.Am.success("Successfully revoked ".concat(s.secret_name," account ").concat(l.nickname,"!")),x(!1)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(_.zx,{variant:"ghost",accent:"destructive",disabled:a,onClick:()=>x(!0),className:"w-full sm:w-auto",children:[(0,t.jsx)(c.Z,{className:"mr-0.5 h-4 w-4 rotate-45"}),"Revoke"]}),(0,t.jsx)(w.Vq,{open:m,onOpenChange:x,children:(0,t.jsxs)(w.cZ,{children:[(0,t.jsx)(w.a7,{children:(0,t.jsxs)(w.fK,{children:[(0,t.jsx)(w.$N,{children:"Revoke Credential?"}),(0,t.jsx)(w.Be,{children:"Are you sure you want to revoke this credential? Any existing flows currently using this credential will stop working, and any triggers using this credential may stop working properly."})]})}),(0,t.jsxs)(w.cN,{children:[(0,t.jsx)(_.zx,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),(0,t.jsx)(_.zx,{variant:"destructive-gradient",onClick:v,children:"Revoke"})]})]})})]})},ee=e=>{let{action:l,isAdmin:s,subscriptionTierInvalid:t,secretDeclaration:i,isOrgSecret:r,organization:n,atAccountLimit:o=!1}=e;if(!s)return"You must be an admin to ".concat(l," credentials");if(t&&i.subscription_tier){let e=i.subscription_tier,s=e.charAt(0).toUpperCase()+e.slice(1);return"You must be ".concat(s," tier or above to ").concat(l," this credential")}return"add"===l&&o?"Currently only supports one account at a time":r&&!n?"This credential is managed at the organization level":null},el=e=>{let{secretType:l,secretDeclaration:s,project:i,organization:n,updateSecret:o,disabled:a}=e,{userProfile:d,idTokenRef:c}=(0,r.useContext)(z.f),[m,x]=(0,r.useState)(!1),v=async()=>{let e=await o({secretId:l.secret_id,isDefault:!0,userProfile:d,idToken:c.current,projectId:null==i?void 0:i.project_id,organizationId:null==n?void 0:n.organization_id});"error"in e?h.Am.error("Could not update secret: ".concat(e.error.data)):(h.Am.success("Successfully set ".concat(l.nickname," as default!")),x(!1))};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row",children:[(0,t.jsxs)(_.zx,{variant:"outline",className:"bg-muted hover:bg-muted/80 w-full rounded-md border-none text-nowrap transition-colors sm:w-auto",disabled:!!l.is_default||a,onClick:()=>x(!0),children:[l.is_default&&(0,t.jsx)(u.Z,{className:"mr-1 h-4 w-4"}),l.is_default?"Default":"Set as default"]}),n&&s.canAddAIProxy&&(0,t.jsx)(L.Ye,{secretType:l,secretDeclaration:s,organization:n,disabled:a})]}),(0,t.jsx)(w.Vq,{open:m,onOpenChange:x,children:(0,t.jsxs)(w.cZ,{children:[(0,t.jsxs)(w.a7,{children:[(0,t.jsx)(w.$N,{children:"Change Default Credential?"}),(0,t.jsx)("p",{children:"Are you sure you want to set this as the default credential?"}),(0,t.jsxs)("p",{children:["Any nodes currently using the default credential for ",s.secret_name," will start using this credential. Existing flows may stop working."]})]}),(0,t.jsxs)(w.cN,{children:[(0,t.jsx)(_.zx,{variant:"ghost",onClick:()=>x(!1),children:"Cancel"}),(0,t.jsx)(_.zx,{variant:"default",onClick:v,children:"Confirm"})]})]})})]})};var es=e=>{let{project:l,organization:s}=e,{userProfile:n,idTokenRef:o}=(0,r.useContext)(z.f),{data:a}=(0,i.jL)({userProfile:n,idToken:o.current,projectId:null==l?void 0:l.project_id,organizationId:null==s?void 0:s.organization_id},{skip:!n.user_id});return(0,t.jsxs)(t.Fragment,{children:[!l&&!s&&(0,t.jsx)(x(),{children:(0,t.jsx)("title",{children:"Gumloop | Credentials"})}),(0,t.jsxs)("div",{className:"flex h-fit w-full flex-col gap-8",children:[!l&&!s&&(0,t.jsx)(j.Z,{title:"Your Credentials",description:"Manage your personal API keys and credentials"}),(0,t.jsx)(Y,{project:l,organization:s,secretTypes:a})]})]})}},61537:function(e,l,s){var t=s(85893),i=s(67294),r=s(36127),n=s(30202),o=s(64712),a=s(29876),d=s(7161),c=s(64127),u=s(84547),m=s(40930),x=s(821),v=s(45837),p=s(44898),h=s(22231),f=s(1602);function g(e){var l;return{id:e.name,name:e.name,description:null!==(l=e.description)&&void 0!==l?l:"",required_scopes:e.required_scopes}}l.Z=e=>{var l,s,j;let{open:_,setOpen:w,groupId:N,serverId:y,serverName:C}=e,[b,k]=(0,i.useState)(""),[z,A]=(0,i.useState)([]),{userProfile:S}=(0,v.H)(),I=(0,n.NL)(),Z=null==S?void 0:null===(l=S.organization)||void 0===l?void 0:l.organization_id,{data:T,isLoading:L}=(0,u.Z)({serverId:y,enabled:_&&!!y}),P=(0,i.useMemo)(()=>{var e;let l=null==T?void 0:null===(e=T.server)||void 0===e?void 0:e.tools;if(l)return l.map(g)},[null==T?void 0:null===(s=T.server)||void 0===s?void 0:s.tools]),{data:O}=(0,m.y)({serverId:y,groupId:N,options:{enabled:_&&!!y&&!!N&&!!Z}}),D=(0,i.useMemo)(()=>_?(0,p.Cz)((null==O?void 0:O.tools)||null,P):[],[null==O?void 0:O.tools,P,_]);(0,i.useEffect)(()=>{_?A(D):(A([]),k(""))},[D,_]);let M=(0,i.useMemo)(()=>{var e;return(0,p.b6)(Z,null==O?void 0:null===(e=O.tools)||void 0===e?void 0:e.organization_acl_id)},[Z,null==O?void 0:null===(j=O.tools)||void 0===j?void 0:j.organization_acl_id]),E=(0,x.QH)({path:M,method:(null==O?void 0:O.tools)?x.J7.PUT:x.J7.POST}),G=(0,i.useMemo)(()=>(0,p.FW)(P,b),[P,b]),R=(null==P?void 0:P.length)||0,q=z.length,B=(0,i.useCallback)(()=>{A((0,p.BE)(P))},[P]),F=(0,i.useCallback)(()=>{A([])},[]),K=(0,i.useCallback)(e=>{A(l=>l.includes(e)?l.filter(l=>l!==e):[...l,e])},[]),U=(0,i.useCallback)(()=>{E.mutate({item_type:"".concat(y,"_gumstack_tools"),item_list:z,is_allowed:!0,group_id:N},{onSuccess:()=>{I.invalidateQueries({queryKey:["".concat(N,"-app-permissions")]});let e=(null==O?void 0:O.tools)?"updated":"created";o.Am.success("".concat(C," tool permissions ").concat(e," successfully")),w(!1)},onError:e=>{let l=(null==e?void 0:e.message)||"Failed to update tool permissions";o.Am.error(l)}})},[z,y,N,E,I,null==O?void 0:O.tools,C,w]);return(0,t.jsx)(d.Vq,{open:_,onOpenChange:w,children:(0,t.jsxs)(d.cZ,{className:"w-full max-w-3xl!",children:[(0,t.jsxs)(d.a7,{className:"flex flex-grow gap-0! p-0!",children:[(0,t.jsx)(d.fK,{className:"border-b p-5",children:(0,t.jsxs)(d.$N,{title:y,children:["Configure Tool Restrictions for ",C]})}),(0,t.jsx)("div",{className:"flex w-full flex-grow overflow-hidden",children:(0,t.jsxs)("div",{className:"flex flex-grow flex-col gap-4 px-4 pt-8 md:px-16",children:[(0,t.jsx)(f.$,{totalToolsCount:R,selectedToolsCount:q,onSelectAll:B,onDeselectAll:F}),(0,t.jsx)(c.I,{LeadingIcon:r.Z,placeholder:"Search for tools",value:b,onChange:e=>k(e.target.value),type:"search"}),(0,t.jsx)("div",{className:"scrollbar-hide flex max-h-96 w-full flex-col overflow-y-auto sm:max-h-[60dvh] md:min-h-[60dvh]",children:(0,t.jsx)(h.B,{tools:G,selectedToolIds:z,isLoading:L,onToggleTool:K})})]})})]}),(0,t.jsxs)(d.cN,{children:[(0,t.jsx)(d.GG,{asChild:!0,children:(0,t.jsx)(a.zx,{variant:"outline",children:"Back"})}),(0,t.jsx)(a.zx,{onClick:U,loading:E.isPending,children:"Confirm"})]})]})})}},3067:function(e,l,s){var t=s(85893),i=s(67294),r=s(36127),n=s(30202),o=s(64712),a=s(29876),d=s(7161),c=s(64127),u=s(40930),m=s(821),x=s(45837),v=s(5197),p=s(44898),h=s(22231),f=s(1602);l.Z=e=>{var l,s;let{open:g,setOpen:j,groupId:_,serverId:w,serverName:N}=e,[y,C]=(0,i.useState)(""),[b,k]=(0,i.useState)([]),{userProfile:z}=(0,x.H)(),A=(0,n.NL)(),S=null==z?void 0:null===(l=z.organization)||void 0===l?void 0:l.organization_id,{data:I,isLoading:Z}=(0,m.DV)({path:"gumcp_server_tools?server_id=".concat(w,"&organization_id=").concat(S,"&group_id=").concat(_),queryKey:["mcp-tools-".concat(w,"-").concat(_)],options:{enabled:g&&!!w&&!!_&&!!S}}),{data:T}=(0,u.y)({serverId:w,groupId:_,options:{enabled:g&&!!w&&!!_&&!!S}}),L=(0,i.useMemo)(()=>g?(0,p.Cz)((null==T?void 0:T.tools)||null,I):[],[null==T?void 0:T.tools,I,g]);(0,i.useEffect)(()=>{g?k(L):(k([]),C(""))},[L,g]);let P=(0,i.useMemo)(()=>{var e;return(0,p.b6)(S,null==T?void 0:null===(e=T.tools)||void 0===e?void 0:e.organization_acl_id)},[S,null==T?void 0:null===(s=T.tools)||void 0===s?void 0:s.organization_acl_id]),O=(0,m.QH)({path:P,method:(null==T?void 0:T.tools)?m.J7.PUT:m.J7.POST}),D=(0,i.useMemo)(()=>(0,p.FW)(I,y),[I,y]),M=(null==I?void 0:I.length)||0,E=b.length;(0,i.useMemo)(()=>(0,p.nm)(I),[I]);let G=(0,i.useCallback)(()=>{k((0,p.BE)(I))},[I]),R=(0,i.useCallback)(()=>{k([])},[]),q=(0,i.useCallback)(e=>{k(l=>l.includes(e)?l.filter(l=>l!==e):[...l,e])},[]),B=(0,i.useCallback)(()=>{O.mutate({item_type:"".concat(w,"_tools"),item_list:b,is_allowed:!0,group_id:_},{onSuccess:()=>{A.invalidateQueries({queryKey:["".concat(_,"-app-permissions")]}),A.invalidateQueries({queryKey:["mcp-tools-".concat(w,"-").concat(_)]});let e=(null==T?void 0:T.tools)?"updated":"created";o.Am.success("".concat(N," tool permissions ").concat(e," successfully")),j(!1)},onError:e=>{let l=(null==e?void 0:e.message)||"Failed to update tool permissions";o.Am.error(l)}})},[b,w,_,O,A,null==T?void 0:T.tools,N,j]);return(0,t.jsx)(d.Vq,{open:g,onOpenChange:j,children:(0,t.jsxs)(d.cZ,{className:"w-full max-w-3xl!",children:[(0,t.jsxs)(d.a7,{className:"flex flex-grow gap-0! p-0!",children:[(0,t.jsx)(d.fK,{className:"border-b p-5",children:(0,t.jsxs)(d.$N,{title:w,children:["Gumloop is Requesting Permission to Access ",(0,v.KD)(N,"this MCP server"),"'s Tools"]})}),(0,t.jsx)("div",{className:"flex w-full flex-grow overflow-hidden",children:(0,t.jsxs)("div",{className:"flex flex-grow flex-col gap-4 px-4 pt-8 md:px-16",children:[(0,t.jsx)(f.$,{totalToolsCount:M,selectedToolsCount:E,onSelectAll:G,onDeselectAll:R}),(0,t.jsx)(c.I,{LeadingIcon:r.Z,placeholder:"Search for tools",value:y,onChange:e=>C(e.target.value),type:"search"}),(0,t.jsx)("div",{className:"scrollbar-hide flex max-h-96 w-full flex-col overflow-y-auto sm:max-h-[60dvh] md:min-h-[60dvh]",children:(0,t.jsx)(h.B,{tools:D,selectedToolIds:b,isLoading:Z,onToggleTool:q})})]})})]}),(0,t.jsxs)(d.cN,{children:[(0,t.jsx)(d.GG,{asChild:!0,children:(0,t.jsx)(a.zx,{variant:"outline",children:"Back"})}),(0,t.jsx)(a.zx,{onClick:B,loading:O.isPending,children:"Confirm"})]})]})})}},44898:function(e,l,s){s.d(l,{BE:function(){return o},Cz:function(){return n},FW:function(){return r},_8:function(){return t},b6:function(){return i},nm:function(){return a}});let t=6;function i(e,l){if(!e)return"";let s="organization_acl?organization_id=".concat(e);return l&&(s+="&acl_id=".concat(l)),s}function r(e,l){if(!e)return[];if(!l.trim())return e;let s=l.toLowerCase();return e.filter(e=>{let l=(e.name||"").toLowerCase(),t=(e.id||"").toLowerCase();return l.includes(s)||t.includes(s)})}function n(e,l){return(null==e?void 0:e.item_list)?e.item_list:l&&l.length>0?l.map(e=>e.id).filter(Boolean):[]}function o(e){return e?e.map(e=>e.id).filter(Boolean):[]}function a(e){return e?e.filter(e=>e.is_restricted).map(e=>e.id).filter(Boolean):[]}},22231:function(e,l,s){s.d(l,{B:function(){return d}});var t=s(85893);s(67294);var i=s(44898),r=s(77311),n=s(61857);let o=e=>{let{tool:l,isSelected:s,onToggle:i}=e,n=l.id||"";return(0,t.jsxs)("label",{className:"border-muted hover:bg-muted/10 flex w-full cursor-pointer flex-row-reverse items-center gap-6 border-b px-2 py-3 md:flex-row",children:[(0,t.jsxs)("div",{className:"flex flex-grow flex-col gap-1 md:flex-row",children:[(0,t.jsx)("div",{className:"text-accent-foreground flex items-center gap-1.5 text-sm font-medium break-words md:max-w-1/3 md:min-w-1/3",children:(0,t.jsx)("p",{className:"break-all",children:l.name})}),l.description&&(0,t.jsx)("span",{className:"text-muted-foreground flex flex-grow text-sm",children:l.description})]}),(0,t.jsx)(r.X,{variant:"accent-strong",checked:s,onCheckedChange:()=>{i(n)}})]})},a=()=>(0,t.jsxs)("div",{className:"border-muted flex w-full flex-row-reverse items-center gap-6 border-b px-2 py-3 md:flex-row",children:[(0,t.jsxs)("div",{className:"flex flex-grow flex-col gap-1 md:flex-row",children:[(0,t.jsx)("div",{className:"flex items-center gap-1.5 md:max-w-1/3 md:min-w-1/3",children:(0,t.jsx)(n.O,{className:"h-4 w-32"})}),(0,t.jsx)(n.O,{className:"h-4 w-full max-w-md"})]}),(0,t.jsx)(n.O,{className:"size-5 shrink-0 rounded"})]}),d=e=>{let{tools:l,selectedToolIds:s,isLoading:r,onToggleTool:n}=e;return r?(0,t.jsx)("div",{className:"flex w-full flex-col",children:Array.from({length:i._8}).map((e,l)=>(0,t.jsx)(a,{},l))}):l&&0!==l.length?(0,t.jsxs)(t.Fragment,{children:[l.map(e=>{let l=e.id||"",i=s.includes(l);return(0,t.jsx)(o,{tool:e,isSelected:i,onToggle:n},l)}),(0,t.jsx)("div",{className:"h-8 w-full flex-none"})]}):(0,t.jsx)("div",{className:"text-muted-foreground p-4 text-center text-sm",children:"No tools found"})}},1602:function(e,l,s){s.d(l,{$:function(){return c}});var t=s(85893);s(67294);var i=s(78865),r=s(62190),n=s(4270),o=s(66682),a=s(29876),d=s(42414);let c=e=>{let{totalToolsCount:l,selectedToolsCount:s,onSelectAll:c,onDeselectAll:u}=e,m=s===l;return(0,t.jsxs)("div",{className:"flex flex-col gap-5 sm:flex-row",children:[(0,t.jsx)(o.Z,{title:"Permission Tools",description:"You have full control about what you can do through Gumloop."}),l>0&&(0,t.jsxs)(d.u,{children:[(0,t.jsx)(d.aJ,{asChild:!0,children:(0,t.jsxs)(a.zx,{variant:"ghost",size:"xs",onClick:m?u:c,className:"text-muted-foreground group hidden text-base md:flex",accent:m?"destructive":"success",children:[(0,t.jsxs)("div",{className:"flex items-center gap-0.5 font-medium",children:[(0,t.jsx)("span",{children:s}),"/",(0,t.jsx)("span",{children:l})]}),(0,t.jsx)(i.Z,{className:"group-hover:hidden"}),m?(0,t.jsx)(r.Z,{className:"hidden group-hover:block"}):(0,t.jsx)(n.Z,{className:"hidden group-hover:block"})]})}),(0,t.jsx)(d._v,{children:m?"Deselect all tools":"Select all tools"})]})]})}},12585:function(e,l,s){var t=s(85893),i=s(69245),r=s(67294),n=s(30202),o=s(64712),a=s(29876),d=s(7161),c=s(30671),u=s(821),m=s(45837),x=s(18998),v=s(98150),p=s(37825),h=s(90572);l.Z=e=>{var l;let{open:s,setOpen:f,selectedSecretDeclaration:g,disabledOperators:j,onParentClose:_,categoryName:w,groupId:N,operatorDeclarations:y}=e,[C,b]=(0,r.useState)([]),[k,z]=(0,r.useState)(!1),{userProfile:A,idTokenRef:S}=(0,m.H)(),{data:I}=(0,u.DV)({path:"/operator_declarations",queryKey:["operator_declarations"],options:{enabled:!y||(null==y?void 0:y.length)<1}}),{data:Z}=(0,i.Y)({userProfile:A,idToken:S.current},{skip:!A.isLoggedIn()||A.isLoading()}),T=null!=y?y:null==I?void 0:I.pipeline_components,L=(0,n.NL)(),P="organization_acl?organization_id=".concat(null==A?void 0:null===(l=A.organization)||void 0===l?void 0:l.organization_id);j&&(P+="&acl_id=".concat(null==j?void 0:j.organization_acl_id));let O=(0,u.QH)({path:P,method:j?u.J7.PUT:u.J7.POST}),D=(0,r.useMemo)(()=>null==T?void 0:T.filter(e=>(null==g?void 0:g.category)?e.category===(null==g?void 0:g.category):!!w&&e.category===w),[T,g,w]),M=(0,r.useMemo)(()=>{var e;let l=(null==g?void 0:g.category)||w;return null!==(e=null==Z?void 0:Z.filter(e=>e.category===l))&&void 0!==e?e:[]},[Z,g,w]),E=(0,r.useMemo)(()=>{var e;return null!==(e=null==C?void 0:C.length)&&void 0!==e?e:0},[C]);return(0,r.useEffect)(()=>{if(w){var e;b(null!==(e=null==j?void 0:j.item_list)&&void 0!==e?e:[])}else b([])},[s]),(0,t.jsxs)(d.Vq,{open:s,onOpenChange:f,children:[(0,t.jsxs)(d.cZ,{className:"flex min-w-2xl flex-col",children:[(0,t.jsxs)(d.a7,{children:[(0,t.jsx)(d.fK,{children:(0,t.jsx)(d.$N,{children:"Which nodes would you like to restrict?"})}),(0,t.jsxs)("div",{className:"flex max-h-[60svh] flex-col gap-2 overflow-y-auto",children:[null==D?void 0:D.map(e=>{var l,s;return(0,t.jsxs)("label",{htmlFor:null!==(l=null==e?void 0:e.operator_id)&&void 0!==l?l:void 0,className:(0,x.cn)("bg-background flex cursor-pointer items-center gap-3 rounded-2xl border p-1 pr-4 shadow-xs",(null==C?void 0:C.includes(null==e?void 0:e.name))&&"border-destructive-foreground/20"),children:[(0,t.jsx)(h.Z,{operator:e}),(0,t.jsx)(c.r,{className:"data-[state=checked]:bg-destructive-foreground!",id:null!==(s=null==e?void 0:e.operator_id)&&void 0!==s?s:void 0,checked:null==C?void 0:C.includes(null==e?void 0:e.name),onCheckedChange:l=>{if(l)b([...null!=C?C:[],null==e?void 0:e.name]);else{var s;b(null===(s=null!=C?C:[])||void 0===s?void 0:s.filter(l=>l!==(null==e?void 0:e.name)))}}})]},null==e?void 0:e.operator_id)}),null==M?void 0:M.map(e=>(0,t.jsxs)("label",{htmlFor:e.server_id,className:(0,x.cn)("bg-background flex cursor-pointer items-center gap-3 rounded-2xl border p-1 pr-4 shadow-xs",(null==C?void 0:C.includes("MCP Node"))&&"border-destructive-foreground/20"),children:[(0,t.jsx)(h.Z,{operator:e}),(0,t.jsx)(c.r,{className:"data-[state=checked]:bg-destructive-foreground!",id:e.server_id,checked:null==C?void 0:C.includes("MCP Node"),onCheckedChange:e=>{if(e)b([...null!=C?C:[],"MCP Node"]);else{var l;b(null===(l=null!=C?C:[])||void 0===l?void 0:l.filter(e=>"MCP Node"!==e))}}})]},e.server_id))]})]}),(0,t.jsxs)(d.cN,{children:[(0,t.jsx)(d.GG,{asChild:!0,children:(0,t.jsx)(a.zx,{variant:"outline",children:"Close"})}),(0,t.jsxs)(a.zx,{onClick:()=>{z(!0)},variant:a.f1.DESTRUCTIVE_GRADIENT,disabled:0===E,loading:O.isPending,children:["Restrict ",E," node(s)"]})]})]}),(0,t.jsx)(v.Z,{open:k,setOpen:z,onConfirm:()=>{let e;(null==g?void 0:g.category)?e=(0,p.Sp)(null==g?void 0:g.category):w&&(e=(0,p.Sp)(w)),N&&e&&O.mutate({group_id:N,item_type:"".concat((0,p.Sp)(e),"_operators"),item_list:null!=C?C:[],is_allowed:!1},{onSuccess:()=>{f(!1),null==_||_(),o.Am.success("".concat(e," denied nodes ").concat(j?"updated":"created"," successfully")),L.invalidateQueries({queryKey:["".concat(N,"-app-permissions")]})}})},title:"Are you sure you want to restrict these nodes?",description:"This action will restrict the group members from using these nodes. You can undo this at anytime.",primaryActionButtonLoading:O.isPending,primaryActionButtonVariant:a.f1.DESTRUCTIVE_GRADIENT})]})}}}]);